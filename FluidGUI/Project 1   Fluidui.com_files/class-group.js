var group={drawExisting:function(c){function f(q,p){for(var n in p){var j=p[n];var o=n;var l=fluid.util._.last(j);if(q==l){var m=group.getCommonArray(o,p);var k=fluid.util._.last(m);if(o==k){group.draw(o,p)}}}}group.erase();var e=project.get("currentZoom");if(e==1){var c=(c)?c:project.getActivePageId();var a=$.extend({},storage.get(c));var h=a.widgets;for(var b=0;b<h.length;b++){var g=h[b];var d=project.get("widgetGroups");f(g,d)}}},enableGroupBtns:function(j){var j=j.not(".backgroundWidget");var h=j.length;var e=project.get("widgetGroups");var f=(h>1)?true:false;if(e){var d=group.createSelArray(j,e);var k=[];for(var a=0;a<d.length;a++){var b=d[a];if(b.charAt(0)=="g"){var c=group.getCommonArray(b,e);var g=fluid.util._.last(c);k.push(g)}else{if(b.charAt(0)=="w"){k.push(b)}}}var k=fluid.util._.uniq(k);group.selectFromArray(k,e);if(k.length>=1){if(k.length==1){var f=(k[0].charAt(0)=="w")?false:"ungroup"}else{var f=true}}}return f},calculateAlign:function(m,k){var c=project.get("widgetGroups");var a={left:0,right:0,top:0,bottom:0};for(var f in c){var e=c[f];var p=e.indexOf(m);if(p>-1){var v=$("#"+f);var g=fluid.util._.last(e);var s=parseFloat($("#"+g).css("top"));var r=parseFloat($("#"+g).css("left"));var j=parseFloat(v.css("width"));var l=parseFloat(v.css("height"));var h=r+parseFloat(v.css("left"));var d=s+parseFloat(v.css("top"));var i=l+s;var o=j+h;var n=parseFloat(k.css("left"));var q=parseFloat(k.css("top"));var b=parseFloat(k.css("width"))+n;var u=parseFloat(k.css("height"))+q;a.left=n-h;a.top=q-d;a.right=o-b;a.bottom=i-u;a.height=l;a.width=j;a.groupLeft=h;a.groupTop=d}}return a},copyGroups:false,copy:function(e){group.copyGroups=false;var c=project.get("widgetGroups");var b=$.extend([],e);if(c){var d=group.createSelFromArray(b);var a=widget.getRoots(d);a.each(function(h){var g=$(this).attr("id");for(var i in c){var f=c[i];var k=f.indexOf(g);if(k>-1){var j=b.indexOf(g);if(j>-1){b[j]=i}}}})}group.copyGroups=b},allGroups:false,paste:function(g,h){function c(q,m,p){var o=[];for(var n=0;n<(p.length+1);n++){if(p[n]==m){o.push(k[n])}}group.allGroups[q]=o}var j=project.get("widgetGroups");group.allGroups=false;group.allGroups=$.extend({},j);var k=$.extend([],g);var l=$.extend([],h);var b=fluid.util._.uniq(l);for(var e=0;e<b.length;e++){var d=b[e];if(d.charAt(0)=="g"||d.charAt(0)=="G"){var f=group.createGroupIndex(group.allGroups);c(f,d,l,k)}}var a=group.allGroups;project.set({widgetGroups:a});group.drawExisting()},select:function(a){group.deselect();var g=project.get("widgetGroups");if(g){var h=widget.getRoots(a);var f=group.createSelArray(h,g);group.selectFromArray(f,g);for(var b=0;b<f.length;b++){var c=f[b];if(c.charAt(0)=="g"){var d=group.getCommonArray(c,g);var j=fluid.util._.last(d);if(c==j){var e=$("#"+c);if(e){e.addClass("selectedGroup")}}}}}var a=$("#canvasPages .ui-selected");return a},createSelFromArray:function(c){var b=$([]);for(var a=0;a<c.length;a++){b=b.add($("#"+c[a]))}return b},store:function(){return JSON.stringify(project.get("widgetGroups"))},removeOnDelete:function(e){var c=project.get("widgetGroups");if(c){var d=group.createSelFromArray(e);var f=$.extend({},c);var a=widget.getRoots(d);var g=group.createSelArray(a,c);for(var b=0;b<g.length;b++){var h=g[b];if(h.charAt(0)=="g"){delete f[h]}}}project.set({widgetGroups:f})},restore:function(b){var c=project.get("widgetGroups");var a=JSON.parse(b.widgetGroups);if(a){var d=b.id;project.set({widgetGroups:a});group.drawExisting(b.pageId)}},selArray:[],deleteIds:[],createSelArray:function(a,b){var a=a.not(".backgroundWidget");group.selArray=[];group.deleteIds=[];a.each(function(){var g=$(this);var j=g.attr("id");group.selArray.push(j);for(var f in b){var e=b[f];var h=e.indexOf(j);if(h>-1){group.selArray.push(f);group.deleteIds.push(j)}}});var d=fluid.util._.uniq(group.selArray);var c=fluid.util._.uniq(group.deleteIds);d=fluid.util._.difference(d,c);return d},selectFromArray:function(f,e){for(var d=0;d<f.length;d++){var c=f[d];if(c.charAt(0)=="g"){var b=e[c];for(var a=0;a<b.length;a++){$("#"+b[a]).addClass("ui-selected")}}}},getCommonArray:function(b,d){e=[];var d=(!d)?project.get("widgetGroups"):d;var c=d[b];for(var a in d){var f=fluid.util._.intersection(c,d[a]);if(f.length>0){e.push(a)}}var e=fluid.util._.uniq(e);return e},draw:function(f,l){function o(r){var v=$([]);for(var u=0;u<r.length;u++){var s=$("#"+r[u]);v=v.add(s)}return v}var d=f;var n=l[d];var c=o(n);var i=c.last();var h=widget.getLockTos(i);var b=(h.length>0)?h:i;var a=utils.getBoundingAreaRelative(c);var e=a.right-a.left;var k=a.bottom-a.top;var j=parseInt(b.css("top"));var m=parseInt(b.css("left"));var g=(j-a.top)*-1;var q=(m-a.left)*-1;var p={top:g,left:q,width:e,height:k,groupId:d};$("#tmplWidgGroup").tmpl(p).appendTo("#"+b.attr("id"))},addWidgets:function(a){function c(){var d=$(this);var e=d.attr("id");b.push(e)}var b=new Array;var a=a.not(".backgroundWidget");a.each(c);return b},createGroupIndex:function(e){(e)?e:project.get("widgetGroups");for(var c in e){var b=c}var d=b.replace("g","");var a=parseInt(d);a="g"+(a+1);return a},create:function(d){function a(){$("#multiSelBox").remove();group.drawExisting();$("#"+f).addClass("selectedGroup");contextMenu.hide();contextMenu.place();updateTLWH();widget.drawMultiSelBox(i)}var d=(d)?d:$("#canvasPages .ui-selected");var i=widget.getRoots(d);var i=i.not(".backgroundWidget");var e=project.get("widgetGroups");var c=group.addWidgets(i);var h=group.enableGrouping(i,e,c);if(h==true){if(!e||jQuery.isEmptyObject(e)==true){var f="g1";var g={g1:c}}else{var f=group.createGroupIndex(e);var b=$.extend({},e);b[f]=c;var g=b}project.set({widgetGroups:g});setTimeout(a,100)}},enableGrouping:function(k,c,a){var h=true;if(a.length<2){var h=false;return h}if(c){var g=group.createSelArray(k,c);var j=false;var d=false;for(var f=0;f<g.length;f++){var e=g[f];if(e.charAt(0)=="g"){var l=c[e];var b=fluid.util._.difference(l,a);if(b.length<1&&(a.length==l.length)){var j=true}}}if(j==true){var h=false}}return h},erase:function(){$("#canvasPages .groupWidgetHolder").remove()},deselect:function(){$("#canvasPages .groupWidgetHolder").removeClass("selectedGroup")},getIdFromGroup:function(e,f){var d=false;for(var c in e){var a=e[c];var b=fluid.util._.difference(a,f);if(b.length<1){d=c}}return d},ungroup:function(f){function g(){group.drawExisting();$("#multiSelBox").remove();contextMenu.hide();contextMenu.place();updateTLWH();widget.drawMultiSelBox(f);group.select(f)}var e=project.get("widgetGroups");if(e){var f=(f)?f:$("#canvasPages .ui-selected");var a=widget.getRoots(f);var a=a.not(".backgroundWidget");var h=group.addWidgets(a);var b=group.enableGrouping(a,e,h);if(b==false){var d=group.getIdFromGroup(e,h);if(d){var c=$.extend([],e);delete c[d];project.set({widgetGroups:c});setTimeout(g,100)}}else{return}}}};