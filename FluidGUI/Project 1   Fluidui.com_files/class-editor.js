/*
 * jQuery UI 1.8.18
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function(f,e){function g(a){return !f(a).parents().andSelf().filter(function(){return f.curCSS(this,"visibility")==="hidden"||f.expr.filters.hidden(this)}).length}function h(a,l){var k=a.nodeName.toLowerCase();if("area"===k){var j=a.parentNode,i=j.name,d;if(!a.href||!i||j.nodeName.toLowerCase()!=="map"){return !1}d=f("img[usemap=#"+i+"]")[0];return !!d&&g(d)}return(/input|select|textarea|button|object/.test(k)?!a.disabled:"a"==k?a.href||l:l)&&g(a)}f.ui=f.ui||{};f.ui.version||(f.extend(f.ui,{version:"1.8.18",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),f.fn.extend({propAttr:f.fn.prop||f.fn.attr,_focus:f.fn.focus,focus:function(a,d){return typeof a=="number"?this.each(function(){var b=this;setTimeout(function(){f(b).focus(),d&&d.call(b)},a)}):this._focus.apply(this,arguments)},scrollParent:function(){var a;f.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?a=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(f.curCSS(this,"position",1))&&/(auto|scroll)/.test(f.curCSS(this,"overflow",1)+f.curCSS(this,"overflow-y",1)+f.curCSS(this,"overflow-x",1))}).eq(0):a=this.parents().filter(function(){return/(auto|scroll)/.test(f.curCSS(this,"overflow",1)+f.curCSS(this,"overflow-y",1)+f.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!a.length?f(document):a},zIndex:function(j){if(j!==e){return this.css("zIndex",j)}if(this.length){var i=f(this[0]),b,a;while(i.length&&i[0]!==document){b=i.css("position");if(b==="absolute"||b==="relative"||b==="fixed"){a=parseInt(i.css("zIndex"),10);if(!isNaN(a)&&a!==0){return a}}i=i.parent()}}return 0},disableSelection:function(){return this.bind((f.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(b){b.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),f.each(["Width","Height"],function(l,k){function a(m,p,o,n){f.each(j,function(){p-=parseFloat(f.curCSS(m,"padding"+this,!0))||0,o&&(p-=parseFloat(f.curCSS(m,"border"+this+"Width",!0))||0),n&&(p-=parseFloat(f.curCSS(m,"margin"+this,!0))||0)});return p}var j=k==="Width"?["Left","Right"]:["Top","Bottom"],i=k.toLowerCase(),b={innerWidth:f.fn.innerWidth,innerHeight:f.fn.innerHeight,outerWidth:f.fn.outerWidth,outerHeight:f.fn.outerHeight};f.fn["inner"+k]=function(d){if(d===e){return b["inner"+k].call(this)}return this.each(function(){f(this).css(i,a(this,d)+"px")})},f.fn["outer"+k]=function(d,m){if(typeof d!="number"){return b["outer"+k].call(this,d)}return this.each(function(){f(this).css(i,a(this,d,!0,m)+"px")})}}),f.extend(f.expr[":"],{data:function(a,j,i){return !!f.data(a,i[3])},focusable:function(a){return h(a,!isNaN(f.attr(a,"tabindex")))},tabbable:function(a){var i=f.attr(a,"tabindex"),c=isNaN(i);return(c||i>=0)&&h(a,!c)}}),f(function(){var a=document.body,d=a.appendChild(d=document.createElement("div"));d.offsetHeight,f.extend(d.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),f.support.minHeight=d.offsetHeight===100,f.support.selectstart="onselectstart" in d,a.removeChild(d).style.display="none"}),f.extend(f.ui,{plugin:{add:function(a,l,k){var j=f.ui[a].prototype;for(var i in k){j.plugins[i]=j.plugins[i]||[],j.plugins[i].push([l,k[i]])}},call:function(j,i,m){var l=j.plugins[i];if(!!l&&!!j.element[0].parentNode){for(var k=0;k<l.length;k++){j.options[l[k][0]]&&l[k][1].apply(j.element,m)}}}},contains:function(d,c){return document.compareDocumentPosition?d.compareDocumentPosition(c)&16:d!==c&&d.contains(c)},hasScroll:function(a,k){if(f(a).css("overflow")==="hidden"){return !1}var j=k&&k==="left"?"scrollLeft":"scrollTop",i=!1;if(a[j]>0){return !0}a[j]=1,i=a[j]>0,a[j]=0;return i},isOverAxis:function(i,d,j){return i>d&&i<d+j},isOver:function(a,m,l,k,j,i){return f.ui.isOverAxis(a,l,j)&&f.ui.isOverAxis(m,k,i)}}))})(jQuery);
/*
 * jQuery UI Widget 1.8.18
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(f,e){if(f.cleanData){var h=f.cleanData;f.cleanData=function(a){for(var j=0,i;(i=a[j])!=null;j++){try{f(i).triggerHandler("remove")}catch(c){}}h(a)}}else{var g=f.fn.remove;f.fn.remove=function(a,d){return this.each(function(){d||(!a||f.filter(a,[this]).length)&&f("*",this).add([this]).each(function(){try{f(this).triggerHandler("remove")}catch(c){}});return g.call(f(this),a,d)})}}f.widget=function(a,m,l){var k=a.split(".")[0],j;a=a.split(".")[1],j=k+"-"+a,l||(l=m,m=f.Widget),f.expr[":"][j]=function(b){return !!f.data(b,a)},f[k]=f[k]||{},f[k][a]=function(d,c){arguments.length&&this._createWidget(d,c)};var i=new m;i.options=f.extend(!0,{},i.options),f[k][a].prototype=f.extend(!0,i,{namespace:k,widgetName:a,widgetEventPrefix:f[k][a].prototype.widgetEventPrefix||a,widgetBaseClass:j},l),f.widget.bridge(a,f[k][a])},f.widget.bridge=function(b,a){f.fn[b]=function(j){var i=typeof j=="string",d=Array.prototype.slice.call(arguments,1),c=this;j=!i&&d.length?f.extend.apply(null,[!0,j].concat(d)):j;if(i&&j.charAt(0)==="_"){return c}i?this.each(function(){var l=f.data(this,b),k=l&&f.isFunction(l[j])?l[j].apply(l,d):l;if(k!==l&&k!==e){c=k;return !1}}):this.each(function(){var k=f.data(this,b);k?k.option(j||{})._init():f.data(this,b,new a(j,this))});return c}},f.Widget=function(d,c){arguments.length&&this._createWidget(d,c)},f.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(a,j){f.data(j,this.widgetName,this),this.element=f(j),this.options=f.extend(!0,{},this.options,this._getCreateOptions(),a);var i=this;this.element.bind("remove."+this.widgetName,function(){i.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return f.metadata&&f.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(i,b){var a=i;if(arguments.length===0){return f.extend({},this.options)}if(typeof i=="string"){if(b===e){return this.options[i]}a={},a[i]=b}this._setOptions(a);return this},_setOptions:function(a){var d=this;f.each(a,function(i,c){d._setOption(i,c)});return this},_setOption:function(d,c){this.options[d]=c,d==="disabled"&&this.widget()[c?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",c);return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(a,m,l){var k,j,i=this.options[a];l=l||{},m=f.Event(m),m.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase(),m.target=this.element[0],j=m.originalEvent;if(j){for(k in j){k in m||(m[k]=j[k])}}this.element.trigger(m,l);return !(f.isFunction(i)&&i.call(this.element[0],m,l)===!1||m.isDefaultPrevented())}}})(jQuery);
/*
 * jQuery UI Mouse 1.8.18
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *	jquery.ui.widget.js
 */
(function(e,d){var f=!1;e(document).mouseup(function(b){f=!1}),e.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(b){return a._mouseDown(b)}).bind("click."+this.widgetName,function(b){if(!0===e.data(b.target,a.widgetName+".preventClickEvent")){e.removeData(b.target,a.widgetName+".preventClickEvent"),b.stopImmediatePropagation();return !1}}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(a){if(!f){this._mouseStarted&&this._mouseUp(a),this._mouseDownEvent=a;var h=this,g=a.which==1,c=typeof this.options.cancel=="string"&&a.target.nodeName?e(a.target).closest(this.options.cancel).length:!1;if(!g||c||!this._mouseCapture(a)){return !0}this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){h.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)){this._mouseStarted=this._mouseStart(a)!==!1;if(!this._mouseStarted){a.preventDefault();return !0}}!0===e.data(a.target,this.widgetName+".preventClickEvent")&&e.removeData(a.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(b){return h._mouseMove(b)},this._mouseUpDelegate=function(b){return h._mouseUp(b)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),a.preventDefault(),f=!0;return !0}},_mouseMove:function(a){if(e.browser.msie&&!(document.documentMode>=9)&&!a.button){return this._mouseUp(a)}if(this._mouseStarted){this._mouseDrag(a);return a.preventDefault()}this._mouseDistanceMet(a)&&this._mouseDelayMet(a)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,a)!==!1,this._mouseStarted?this._mouseDrag(a):this._mouseUp(a));return !this._mouseStarted},_mouseUp:function(a){e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,a.target==this._mouseDownEvent.target&&e.data(a.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(a));return !1},_mouseDistanceMet:function(b){return Math.max(Math.abs(this._mouseDownEvent.pageX-b.pageX),Math.abs(this._mouseDownEvent.pageY-b.pageY))>=this.options.distance},_mouseDelayMet:function(b){return this.mouseDelayMet},_mouseStart:function(b){},_mouseDrag:function(b){},_mouseStop:function(b){},_mouseCapture:function(b){return !0}})})(jQuery);(function(j,i){j.ui=j.ui||{};var p=/left|center|right/,o=/top|center|bottom/,n="center",m={},l=j.fn.position,k=j.fn.offset;j.fn.position=function(c){if(!c||!c.of){return l.apply(this,arguments)}c=j.extend({},c);var q=j(c.of),g=q[0],f=(c.collision||"flip").split(" "),e=c.offset?c.offset.split(" "):[0,0],d,a,r;g.nodeType===9?(d=q.width(),a=q.height(),r={top:0,left:0}):g.setTimeout?(d=q.width(),a=q.height(),r={top:q.scrollTop(),left:q.scrollLeft()}):g.preventDefault?(c.at="left top",d=a=0,r={top:c.of.pageY,left:c.of.pageX}):(d=q.outerWidth(),a=q.outerHeight(),r=q.offset()),j.each(["my","at"],function(){var b=(c[this]||"").split(" ");b.length===1&&(b=p.test(b[0])?b.concat([n]):o.test(b[0])?[n].concat(b):[n,n]),b[0]=p.test(b[0])?b[0]:n,b[1]=o.test(b[1])?b[1]:n,c[this]=b}),f.length===1&&(f[1]=f[0]),e[0]=parseInt(e[0],10)||0,e.length===1&&(e[1]=e[0]),e[1]=parseInt(e[1],10)||0,c.at[0]==="right"?r.left+=d:c.at[0]===n&&(r.left+=d/2),c.at[1]==="bottom"?r.top+=a:c.at[1]===n&&(r.top+=a/2),r.left+=e[0],r.top+=e[1];return this.each(function(){var z=j(this),y=z.outerWidth(),x=z.outerHeight(),w=parseInt(j.curCSS(this,"marginLeft",!0))||0,v=parseInt(j.curCSS(this,"marginTop",!0))||0,u=y+w+(parseInt(j.curCSS(this,"marginRight",!0))||0),t=x+v+(parseInt(j.curCSS(this,"marginBottom",!0))||0),s=j.extend({},r),b;c.my[0]==="right"?s.left-=y:c.my[0]===n&&(s.left-=y/2),c.my[1]==="bottom"?s.top-=x:c.my[1]===n&&(s.top-=x/2),m.fractions||(s.left=Math.round(s.left),s.top=Math.round(s.top)),b={left:s.left-w,top:s.top-v},j.each(["left","top"],function(A,h){j.ui.position[f[A]]&&j.ui.position[f[A]][h](s,{targetWidth:d,targetHeight:a,elemWidth:y,elemHeight:x,collisionPosition:b,collisionWidth:u,collisionHeight:t,offset:e,my:c.my,at:c.at})}),j.fn.bgiframe&&z.bgiframe(),z.offset(j.extend(s,{using:c.using}))})},j.ui.position={fit:{left:function(a,h){var g=j(window),f=h.collisionPosition.left+h.collisionWidth-g.width()-g.scrollLeft();a.left=f>0?a.left-f:Math.max(a.left-h.collisionPosition.left,a.left)},top:function(a,h){var g=j(window),f=h.collisionPosition.top+h.collisionHeight-g.height()-g.scrollTop();a.top=f>0?a.top-f:Math.max(a.top-h.collisionPosition.top,a.top)}},flip:{left:function(a,u){if(u.at[0]!==n){var t=j(window),s=u.collisionPosition.left+u.collisionWidth-t.width()-t.scrollLeft(),r=u.my[0]==="left"?-u.elemWidth:u.my[0]==="right"?u.elemWidth:0,q=u.at[0]==="left"?u.targetWidth:-u.targetWidth,e=-2*u.offset[0];a.left+=u.collisionPosition.left<0?r+q+e:s>0?r+q+e:0}},top:function(a,u){if(u.at[1]!==n){var t=j(window),s=u.collisionPosition.top+u.collisionHeight-t.height()-t.scrollTop(),r=u.my[1]==="top"?-u.elemHeight:u.my[1]==="bottom"?u.elemHeight:0,q=u.at[1]==="top"?u.targetHeight:-u.targetHeight,e=-2*u.offset[1];a.top+=u.collisionPosition.top<0?r+q+e:s>0?r+q+e:0}}}},j.offset.setOffset||(j.offset.setOffset=function(a,v){/static/.test(j.curCSS(a,"position"))&&(a.style.position="relative");var u=j(a),t=u.offset(),s=parseInt(j.curCSS(a,"top",!0),10)||0,r=parseInt(j.curCSS(a,"left",!0),10)||0,q={top:v.top-t.top+s,left:v.left-t.left+r};"using" in v?v.using.call(a,q):u.css(q)},j.fn.offset=function(a){var d=this[0];if(!d||!d.ownerDocument){return null}if(a){return this.each(function(){j.offset.setOffset(this,a)})}return k.call(this)}),function(){var a=document.getElementsByTagName("body")[0],v=document.createElement("div"),u,t,s,r,q;u=document.createElement(a?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&j.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(var f in s){u.style[f]=s[f]}u.appendChild(v),t=a||document.documentElement,t.insertBefore(u,t.firstChild),v.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",r=j(v).offset(function(d,c){return c}).offset(),u.innerHTML="",t.removeChild(u),q=r.top+r.left+(a?2000:0),m.fractions=q>21&&q<22}()})(jQuery);(function(d,c){d.widget("ui.draggable",d.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!!this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy();return this}},_mouseCapture:function(a){var e=this.options;if(this.helper||e.disabled||d(a.target).is(".ui-resizable-handle")){return !1}this.handle=this._getHandle(a);if(!this.handle){return !1}e.iframeFix&&d(e.iframeFix===!0?"iframe":e.iframeFix).each(function(){d('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css(d(this).offset()).appendTo("body")});return !0},_mouseStart:function(a){var e=this.options;this.helper=this._createHelper(a),this._cacheHelperProportions(),d.ui.ddmanager&&(d.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},d.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(a),this.originalPageX=a.pageX,this.originalPageY=a.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),e.containment&&this._setContainment();if(this._trigger("start",a)===!1){this._clear();return !1}this._cacheHelperProportions(),d.ui.ddmanager&&!e.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(a,!0),d.ui.ddmanager&&d.ui.ddmanager.dragStart(this,a);return !0},_mouseDrag:function(a,f){this.position=this._generatePosition(a),this.positionAbs=this._convertPositionTo("absolute");if(!f){var e=this._uiHash();if(this._trigger("drag",a,e)===!1){this._mouseUp({});return !1}this.position=e.position}if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}d.ui.ddmanager&&d.ui.ddmanager.drag(this,a);return !1},_mouseStop:function(a){var f=!1;d.ui.ddmanager&&!this.options.dropBehaviour&&(f=d.ui.ddmanager.drop(this,a)),this.dropped&&(f=this.dropped,this.dropped=!1);if((!this.element[0]||!this.element[0].parentNode)&&this.options.helper=="original"){return !1}if(this.options.revert=="invalid"&&!f||this.options.revert=="valid"&&f||this.options.revert===!0||d.isFunction(this.options.revert)&&this.options.revert.call(this.element,f)){var e=this;d(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){e._trigger("stop",a)!==!1&&e._clear()})}else{this._trigger("stop",a)!==!1&&this._clear()}return !1},_mouseUp:function(a){this.options.iframeFix===!0&&d("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),d.ui.ddmanager&&d.ui.ddmanager.dragStop(this,a);return d.ui.mouse.prototype._mouseUp.call(this,a)},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this},_getHandle:function(a){var e=!this.options.handle||!d(this.options.handle,this.element).length?!0:!1;d(this.options.handle,this.element).find("*").andSelf().each(function(){this==a.target&&(e=!0)});return e},_createHelper:function(a){var f=this.options,e=d.isFunction(f.helper)?d(f.helper.apply(this.element[0],[a])):f.helper=="clone"?this.element.clone().removeAttr("id"):this.element;e.parents("body").length||e.appendTo(f.appendTo=="parent"?this.element[0].parentNode:f.appendTo),e[0]!=this.element[0]&&!/(fixed|absolute)/.test(e.css("position"))&&e.css("position","absolute");return e},_adjustOffsetFromHelper:function(a){typeof a=="string"&&(a=a.split(" ")),d.isArray(a)&&(a={left:+a[0],top:+a[1]||0}),"left" in a&&(this.offset.click.left=a.left+this.margins.left),"right" in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left),"top" in a&&(this.offset.click.top=a.top+this.margins.top),"bottom" in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&d.browser.msie){a={top:0,left:0}}return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var b=this.element.position();return{top:b.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:b.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a=this.options;a.containment=="parent"&&(a.containment=this.helper[0].parentNode);if(a.containment=="document"||a.containment=="window"){this.containment=[a.containment=="document"?0:d(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a.containment=="document"?0:d(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(a.containment=="document"?0:d(window).scrollLeft())+d(a.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a.containment=="document"?0:d(window).scrollTop())+(d(a.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!/^(document|window|parent)$/.test(a.containment)&&a.containment.constructor!=Array){var j=d(a.containment),i=j[0];if(!i){return}var h=j.offset(),g=d(i).css("overflow")!="hidden";this.containment=[(parseInt(d(i).css("borderLeftWidth"),10)||0)+(parseInt(d(i).css("paddingLeft"),10)||0),(parseInt(d(i).css("borderTopWidth"),10)||0)+(parseInt(d(i).css("paddingTop"),10)||0),(g?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(d(i).css("borderLeftWidth"),10)||0)-(parseInt(d(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(g?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(d(i).css("borderTopWidth"),10)||0)-(parseInt(d(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=j}else{a.containment.constructor==Array&&(this.containment=a.containment)}},_convertPositionTo:function(a,l){l||(l=this.position);var k=a=="absolute"?1:-1,j=this.options,i=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(i[0].tagName);return{top:l.top+this.offset.relative.top*k+this.offset.parent.top*k-(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:i.scrollTop())*k),left:l.left+this.offset.relative.left*k+this.offset.parent.left*k-(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:i.scrollLeft())*k)}},_generatePosition:function(t){var s=this.options,r=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,q=/(html|body)/i.test(r[0].tagName),p=t.pageX,o=t.pageY;if(this.originalPosition){var n;if(this.containment){if(this.relative_container){var m=this.relative_container.offset();n=[this.containment[0]+m.left,this.containment[1]+m.top,this.containment[2]+m.left,this.containment[3]+m.top]}else{n=this.containment}t.pageX-this.offset.click.left<n[0]&&(p=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(o=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(p=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(o=n[3]+this.offset.click.top)}if(s.grid){var l=s.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY;o=n?l-this.offset.click.top<n[1]||l-this.offset.click.top>n[3]?l-this.offset.click.top<n[1]?l+s.grid[1]:l-s.grid[1]:l:l;var a=s.grid[0]?this.originalPageX+Math.round((p-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX;p=n?a-this.offset.click.left<n[0]||a-this.offset.click.left>n[2]?a-this.offset.click.left<n[0]?a+s.grid[0]:a-s.grid[0]:a:a}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():q?0:r.scrollTop()),left:p-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(d.browser.safari&&d.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():q?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(a,f,e){e=e||this._uiHash(),d.ui.plugin.call(this,a,[f,e]),a=="drag"&&(this.positionAbs=this._convertPositionTo("absolute"));return d.Widget.prototype._trigger.call(this,a,f,e)},plugins:{},_uiHash:function(b){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),d.extend(d.ui.draggable,{version:"1.8.18"}),d.ui.plugin.add("draggable","connectToSortable",{start:function(a,j){var i=d(this).data("draggable"),h=i.options,g=d.extend({},j,{item:i.element});i.sortables=[],d(h.connectToSortable).each(function(){var b=d.data(this,"sortable");b&&!b.options.disabled&&(i.sortables.push({instance:b,shouldRevert:b.options.revert}),b.refreshPositions(),b._trigger("activate",a,g))})},stop:function(a,h){var g=d(this).data("draggable"),f=d.extend({},h,{item:g.element});d.each(g.sortables,function(){this.instance.isOver?(this.instance.isOver=0,g.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(a),this.instance.options.helper=this.instance.options._helper,g.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",a,f))})},drag:function(a,j){var i=d(this).data("draggable"),h=this,g=function(s){var r=this.offset.click.top,q=this.offset.click.left,p=this.positionAbs.top,o=this.positionAbs.left,n=s.height,m=s.width,l=s.top,k=s.left;return d.ui.isOver(p+r,o+q,l,k,n,m)};d.each(i.sortables,function(b){this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=d(h).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return j.helper[0]},a.target=this.instance.currentItem[0],this.instance._mouseCapture(a,!0),this.instance._mouseStart(a,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",a),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(a)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",a,this.instance._uiHash(this.instance)),this.instance._mouseStop(a,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",a),i.dropped=!1)})}}),d.ui.plugin.add("draggable","cursor",{start:function(a,h){var g=d("body"),f=d(this).data("draggable").options;g.css("cursor")&&(f._cursor=g.css("cursor")),g.css("cursor",f.cursor)},stop:function(a,f){var e=d(this).data("draggable").options;e._cursor&&d("body").css("cursor",e._cursor)}}),d.ui.plugin.add("draggable","opacity",{start:function(a,h){var g=d(h.helper),f=d(this).data("draggable").options;g.css("opacity")&&(f._opacity=g.css("opacity")),g.css("opacity",f.opacity)},stop:function(a,f){var e=d(this).data("draggable").options;e._opacity&&d(f.helper).css("opacity",e._opacity)}}),d.ui.plugin.add("draggable","scroll",{start:function(a,f){var e=d(this).data("draggable");e.scrollParent[0]!=document&&e.scrollParent[0].tagName!="HTML"&&(e.overflowOffset=e.scrollParent.offset())},drag:function(a,j){var i=d(this).data("draggable"),h=i.options,g=!1;if(i.scrollParent[0]!=document&&i.scrollParent[0].tagName!="HTML"){if(!h.axis||h.axis!="x"){i.overflowOffset.top+i.scrollParent[0].offsetHeight-a.pageY<h.scrollSensitivity?i.scrollParent[0].scrollTop=g=i.scrollParent[0].scrollTop+h.scrollSpeed:a.pageY-i.overflowOffset.top<h.scrollSensitivity&&(i.scrollParent[0].scrollTop=g=i.scrollParent[0].scrollTop-h.scrollSpeed)}if(!h.axis||h.axis!="y"){i.overflowOffset.left+i.scrollParent[0].offsetWidth-a.pageX<h.scrollSensitivity?i.scrollParent[0].scrollLeft=g=i.scrollParent[0].scrollLeft+h.scrollSpeed:a.pageX-i.overflowOffset.left<h.scrollSensitivity&&(i.scrollParent[0].scrollLeft=g=i.scrollParent[0].scrollLeft-h.scrollSpeed)}}else{if(!h.axis||h.axis!="x"){a.pageY-d(document).scrollTop()<h.scrollSensitivity?g=d(document).scrollTop(d(document).scrollTop()-h.scrollSpeed):d(window).height()-(a.pageY-d(document).scrollTop())<h.scrollSensitivity&&(g=d(document).scrollTop(d(document).scrollTop()+h.scrollSpeed))}if(!h.axis||h.axis!="y"){a.pageX-d(document).scrollLeft()<h.scrollSensitivity?g=d(document).scrollLeft(d(document).scrollLeft()-h.scrollSpeed):d(window).width()-(a.pageX-d(document).scrollLeft())<h.scrollSensitivity&&(g=d(document).scrollLeft(d(document).scrollLeft()+h.scrollSpeed))}}g!==!1&&d.ui.ddmanager&&!h.dropBehaviour&&d.ui.ddmanager.prepareOffsets(i,a)}}),d.ui.plugin.add("draggable","snap",{start:function(a,h){var g=d(this).data("draggable"),f=g.options;g.snapElements=[],d(f.snap.constructor!=String?f.snap.items||":data(draggable)":f.snap).each(function(){var e=d(this),i=e.offset();this!=g.element[0]&&g.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:i.top,left:i.left})})},drag:function(L,K){var J=d(this).data("draggable"),I=J.options,H=I.snapTolerance,G=K.offset.left,F=G+J.helperProportions.width,E=K.offset.top,D=E+J.helperProportions.height;for(var C=J.snapElements.length-1;C>=0;C--){var B=J.snapElements[C].left,A=B+J.snapElements[C].width,z=J.snapElements[C].top,y=z+J.snapElements[C].height;if(!(B-H<G&&G<A+H&&z-H<E&&E<y+H||B-H<G&&G<A+H&&z-H<D&&D<y+H||B-H<F&&F<A+H&&z-H<E&&E<y+H||B-H<F&&F<A+H&&z-H<D&&D<y+H)){J.snapElements[C].snapping&&J.options.snap.release&&J.options.snap.release.call(J.element,L,d.extend(J._uiHash(),{snapItem:J.snapElements[C].item})),J.snapElements[C].snapping=!1;continue}if(I.snapMode!="inner"){var x=Math.abs(z-D)<=H,w=Math.abs(y-E)<=H,v=Math.abs(B-F)<=H,u=Math.abs(A-G)<=H;x&&(K.position.top=J._convertPositionTo("relative",{top:z-J.helperProportions.height,left:0}).top-J.margins.top),w&&(K.position.top=J._convertPositionTo("relative",{top:y,left:0}).top-J.margins.top),v&&(K.position.left=J._convertPositionTo("relative",{top:0,left:B-J.helperProportions.width}).left-J.margins.left),u&&(K.position.left=J._convertPositionTo("relative",{top:0,left:A}).left-J.margins.left)}var a=x||w||v||u;if(I.snapMode!="outer"){var x=Math.abs(z-E)<=H,w=Math.abs(y-D)<=H,v=Math.abs(B-G)<=H,u=Math.abs(A-F)<=H;x&&(K.position.top=J._convertPositionTo("relative",{top:z,left:0}).top-J.margins.top),w&&(K.position.top=J._convertPositionTo("relative",{top:y-J.helperProportions.height,left:0}).top-J.margins.top),v&&(K.position.left=J._convertPositionTo("relative",{top:0,left:B}).left-J.margins.left),u&&(K.position.left=J._convertPositionTo("relative",{top:0,left:A-J.helperProportions.width}).left-J.margins.left)}!J.snapElements[C].snapping&&(x||w||v||u||a)&&J.options.snap.snap&&J.options.snap.snap.call(J.element,L,d.extend(J._uiHash(),{snapItem:J.snapElements[C].item})),J.snapElements[C].snapping=x||w||v||u||a}}}),d.ui.plugin.add("draggable","stack",{start:function(a,j){var i=d(this).data("draggable").options,h=d.makeArray(d(i.stack)).sort(function(e,f){return(parseInt(d(e).css("zIndex"),10)||0)-(parseInt(d(f).css("zIndex"),10)||0)});if(!!h.length){var g=parseInt(h[0].style.zIndex)||0;d(h).each(function(b){this.style.zIndex=g+b}),this[0].style.zIndex=g+h.length}}}),d.ui.plugin.add("draggable","zIndex",{start:function(a,h){var g=d(h.helper),f=d(this).data("draggable").options;g.css("zIndex")&&(f._zIndex=g.css("zIndex")),g.css("zIndex",f.zIndex)},stop:function(a,f){var e=d(this).data("draggable").options;e._zIndex&&d(f.helper).css("zIndex",e._zIndex)}})})(jQuery);(function(d,c){d.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var a=this.options,e=a.accept;this.isover=0,this.isout=1,this.accept=d.isFunction(e)?e:function(b){return b.is(e)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},d.ui.ddmanager.droppables[a.scope]=d.ui.ddmanager.droppables[a.scope]||[],d.ui.ddmanager.droppables[a.scope].push(this),a.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var a=d.ui.ddmanager.droppables[this.options.scope];for(var e=0;e<a.length;e++){a[e]==this&&a.splice(e,1)}this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable");return this},_setOption:function(a,e){a=="accept"&&(this.accept=d.isFunction(e)?e:function(b){return b.is(e)}),d.Widget.prototype._setOption.apply(this,arguments)},_activate:function(a){var e=d.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),e&&this._trigger("activate",a,this.ui(e))},_deactivate:function(a){var e=d.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),e&&this._trigger("deactivate",a,this.ui(e))},_over:function(a){var e=d.ui.ddmanager.current;!!e&&(e.currentItem||e.element)[0]!=this.element[0]&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",a,this.ui(e)))},_out:function(a){var e=d.ui.ddmanager.current;!!e&&(e.currentItem||e.element)[0]!=this.element[0]&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",a,this.ui(e)))},_drop:function(a,h){var g=h||d.ui.ddmanager.current;if(!g||(g.currentItem||g.element)[0]==this.element[0]){return !1}var f=!1;this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var e=d.data(this,"droppable");if(e.options.greedy&&!e.options.disabled&&e.options.scope==g.options.scope&&e.accept.call(e.element[0],g.currentItem||g.element)&&d.ui.intersect(g,d.extend(e,{offset:e.element.offset()}),e.options.tolerance)){f=!0;return !1}});if(f){return !1}if(this.accept.call(this.element[0],g.currentItem||g.element)){this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",a,this.ui(g));return this.element}return !1},ui:function(b){return{draggable:b.currentItem||b.element,helper:b.helper,position:b.position,offset:b.positionAbs}}}),d.extend(d.ui.droppable,{version:"1.8.18"}),d.ui.intersect=function(B,A,z){if(!A.offset){return !1}var y=(B.positionAbs||B.position.absolute).left,x=y+B.helperProportions.width,w=(B.positionAbs||B.position.absolute).top,v=w+B.helperProportions.height,u=A.offset.left,t=u+A.proportions.width,s=A.offset.top,r=s+A.proportions.height;switch(z){case"fit":return u<=y&&x<=t&&s<=w&&v<=r;case"intersect":return u<y+B.helperProportions.width/2&&x-B.helperProportions.width/2<t&&s<w+B.helperProportions.height/2&&v-B.helperProportions.height/2<r;case"pointer":var q=(B.positionAbs||B.position.absolute).left+(B.clickOffset||B.offset.click).left,p=(B.positionAbs||B.position.absolute).top+(B.clickOffset||B.offset.click).top,a=d.ui.isOver(p,q,s,u,A.proportions.height,A.proportions.width);return a;case"touch":return(w>=s&&w<=r||v>=s&&v<=r||w<s&&v>r)&&(y>=u&&y<=t||x>=u&&x<=t||y<u&&x>t);default:return !1}},d.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(a,n){var m=d.ui.ddmanager.droppables[a.options.scope]||[],l=n?n.type:null,k=(a.currentItem||a.element).find(":data(droppable)").andSelf();droppablesLoop:for(var j=0;j<m.length;j++){if(m[j].options.disabled||a&&!m[j].accept.call(m[j].element[0],a.currentItem||a.element)){continue}for(var i=0;i<k.length;i++){if(k[i]==m[j].element[0]){m[j].proportions.height=0;continue droppablesLoop}}m[j].visible=m[j].element.css("display")!="none";if(!m[j].visible){continue}l=="mousedown"&&m[j]._activate.call(m[j],n),m[j].offset=m[j].element.offset(),m[j].proportions={width:m[j].element[0].offsetWidth,height:m[j].element[0].offsetHeight}}},drop:function(a,f){var e=!1;d.each(d.ui.ddmanager.droppables[a.options.scope]||[],function(){!this.options||(!this.options.disabled&&this.visible&&d.ui.intersect(a,this,this.options.tolerance)&&(e=this._drop.call(this,f)||e),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],a.currentItem||a.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,f)))});return e},dragStart:function(a,e){a.element.parents(":not(body,html)").bind("scroll.droppable",function(){a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,e)})},drag:function(a,e){a.options.refreshPositions&&d.ui.ddmanager.prepareOffsets(a,e),d.each(d.ui.ddmanager.droppables[a.options.scope]||[],function(){if(!(this.options.disabled||this.greedyChild||!this.visible)){var j=d.ui.intersect(a,this,this.options.tolerance),i=!j&&this.isover==1?"isout":j&&this.isover==0?"isover":null;if(!i){return}var h;if(this.options.greedy){var b=this.element.parents(":data(droppable):eq(0)");b.length&&(h=d.data(b[0],"droppable"),h.greedyChild=i=="isover"?1:0)}h&&i=="isover"&&(h.isover=0,h.isout=1,h._out.call(h,e)),this[i]=1,this[i=="isout"?"isover":"isout"]=0,this[i=="isover"?"_over":"_out"].call(this,e),h&&i=="isout"&&(h.isout=0,h.isover=1,h._over.call(h,e))}})},dragStop:function(a,e){a.element.parents(":not(body,html)").unbind("scroll.droppable"),a.options.refreshPositions||d.ui.ddmanager.prepareOffsets(a,e)}}})(jQuery);(function(f,e){f.widget("ui.resizable",f.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var a=this,n=this.options;this.element.addClass("ui-resizable"),f.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(f('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=n.handles||(f(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var m=this.handles.split(",");this.handles={};for(var l=0;l<m.length;l++){var k=f.trim(m[l]),j="ui-resizable-"+k,i=f('<div class="ui-resizable-handle '+j+'"></div>');/sw|se|ne|nw/.test(k)&&i.css({zIndex:++n.zIndex}),"se"==k&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[k]=".ui-resizable-"+k,this.element.append(i)}}this._renderAxis=function(o){o=o||this.element;for(var s in this.handles){this.handles[s].constructor==String&&(this.handles[s]=f(this.handles[s],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var r=f(this.handles[s],this.element),q=0;q=/sw|ne|nw|se|n|s/.test(s)?r.outerHeight():r.outerWidth();var p=["padding",/ne|nw|n/.test(s)?"Top":/se|sw|s/.test(s)?"Bottom":/^e$/.test(s)?"Right":"Left"].join("");o.css(p,q),this._proportionallyResize()}if(!f(this.handles[s]).length){continue}}},this._renderAxis(this.element),this._handles=f(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!a.resizing){if(this.className){var b=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)}a.axis=b&&b[1]?b[1]:"se"}}),n.autoHide&&(this._handles.hide(),f(this.element).addClass("ui-resizable-autohide").hover(function(){n.disabled||(f(this).removeClass("ui-resizable-autohide"),a._handles.show())},function(){n.disabled||a.resizing||(f(this).addClass("ui-resizable-autohide"),a._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var a=function(c){f(c).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){a(this.element);var d=this.element;d.after(this.originalElement.css({position:d.css("position"),width:d.outerWidth(),height:d.outerHeight(),top:d.css("top"),left:d.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle),a(this.originalElement);return this},_mouseCapture:function(a){var j=!1;for(var i in this.handles){f(this.handles[i])[0]==a.target&&(j=!0)}return !this.options.disabled&&j},_mouseStart:function(a){var n=this.options,m=this.element.position(),l=this.element;this.resizing=!0,this.documentScroll={top:f(document).scrollTop(),left:f(document).scrollLeft()},(l.is(".ui-draggable")||/absolute/.test(l.css("position")))&&l.css({position:"absolute",top:m.top,left:m.left}),this._renderProxy();var k=h(this.helper.css("left")),j=h(this.helper.css("top"));n.containment&&(k+=f(n.containment).scrollLeft()||0,j+=f(n.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:k,top:j},this.size=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:k,top:j},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:a.pageX,top:a.pageY},this.aspectRatio=typeof n.aspectRatio=="number"?n.aspectRatio:this.originalSize.width/this.originalSize.height||1;var c=f(".ui-resizable-"+this.axis).css("cursor");f("body").css("cursor",c=="auto"?this.axis+"-resize":c),l.addClass("ui-resizable-resizing"),this._propagate("start",a);return !0},_mouseDrag:function(z){var y=this.helper,x=this.options,w={},v=this,u=this.originalMousePosition,t=this.axis,s=z.pageX-u.left||0,r=z.pageY-u.top||0,q=this._change[t];if(!q){return !1}var p=q.apply(this,[z,s,r]),o=f.browser.msie&&f.browser.version<7,a=this.sizeDiff;this._updateVirtualBoundaries(z.shiftKey);if(this._aspectRatio||z.shiftKey){p=this._updateRatio(p,z)}p=this._respectSize(p,z),this._propagate("resize",z),y.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(p),this._trigger("resize",z,this.ui());return !1},_mouseStop:function(t){this.resizing=!1;var s=this.options,r=this;if(this._helper){var q=this._proportionallyResizeElements,p=q.length&&/textarea/i.test(q[0].nodeName),o=p&&f.ui.hasScroll(q[0],"left")?0:r.sizeDiff.height,n=p?0:r.sizeDiff.width,m={width:r.helper.width()-n,height:r.helper.height()-o},l=parseInt(r.element.css("left"),10)+(r.position.left-r.originalPosition.left)||null,a=parseInt(r.element.css("top"),10)+(r.position.top-r.originalPosition.top)||null;s.animate||this.element.css(f.extend(m,{top:a,left:l})),r.helper.height(r.size.height),r.helper.width(r.size.width),this._helper&&!s.animate&&this._proportionallyResize()}f("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove();return !1},_updateVirtualBoundaries:function(i){var d=this.options,n,m,l,k,j;j={minWidth:g(d.minWidth)?d.minWidth:0,maxWidth:g(d.maxWidth)?d.maxWidth:Infinity,minHeight:g(d.minHeight)?d.minHeight:0,maxHeight:g(d.maxHeight)?d.maxHeight:Infinity};if(this._aspectRatio||i){n=j.minHeight*this.aspectRatio,l=j.minWidth/this.aspectRatio,m=j.maxHeight*this.aspectRatio,k=j.maxWidth/this.aspectRatio,n>j.minWidth&&(j.minWidth=n),l>j.minHeight&&(j.minHeight=l),m<j.maxWidth&&(j.maxWidth=m),k<j.maxHeight&&(j.maxHeight=k)}this._vBoundaries=j},_updateCache:function(d){var c=this.options;this.offset=this.helper.offset(),g(d.left)&&(this.position.left=d.left),g(d.top)&&(this.position.top=d.top),g(d.height)&&(this.size.height=d.height),g(d.width)&&(this.size.width=d.width)},_updateRatio:function(i,d){var m=this.options,l=this.position,k=this.size,j=this.axis;g(i.height)?i.width=i.height*this.aspectRatio:g(i.width)&&(i.height=i.width/this.aspectRatio),j=="sw"&&(i.left=l.left+(k.width-i.width),i.top=null),j=="nw"&&(i.top=l.top+(k.height-i.height),i.left=l.left+(k.width-i.width));return i},_respectSize:function(D,C){var B=this.helper,A=this._vBoundaries,z=this._aspectRatio||C.shiftKey,y=this.axis,x=g(D.width)&&A.maxWidth&&A.maxWidth<D.width,w=g(D.height)&&A.maxHeight&&A.maxHeight<D.height,v=g(D.width)&&A.minWidth&&A.minWidth>D.width,u=g(D.height)&&A.minHeight&&A.minHeight>D.height;v&&(D.width=A.minWidth),u&&(D.height=A.minHeight),x&&(D.width=A.maxWidth),w&&(D.height=A.maxHeight);var t=this.originalPosition.left+this.originalSize.width,s=this.position.top+this.size.height,r=/sw|nw|w/.test(y),q=/nw|ne|n/.test(y);v&&r&&(D.left=t-A.minWidth),x&&r&&(D.left=t-A.maxWidth),u&&q&&(D.top=s-A.minHeight),w&&q&&(D.top=s-A.maxHeight);var d=!D.width&&!D.height;d&&!D.left&&D.top?D.top=null:d&&!D.top&&D.left&&(D.left=null);return D},_proportionallyResize:function(){var a=this.options;if(!!this._proportionallyResizeElements.length){var m=this.helper||this.element;for(var l=0;l<this._proportionallyResizeElements.length;l++){var k=this._proportionallyResizeElements[l];if(!this.borderDif){var j=[k.css("borderTopWidth"),k.css("borderRightWidth"),k.css("borderBottomWidth"),k.css("borderLeftWidth")],i=[k.css("paddingTop"),k.css("paddingRight"),k.css("paddingBottom"),k.css("paddingLeft")];this.borderDif=f.map(j,function(o,n){var q=parseInt(o,10)||0,p=parseInt(i[n],10)||0;return q+p})}if(f.browser.msie&&(!!f(m).is(":hidden")||!!f(m).parents(":hidden").length)){continue}k.css({height:m.height()-this.borderDif[0]-this.borderDif[2]||0,width:m.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var a=this.element,l=this.options;this.elementOffset=a.offset();if(this._helper){this.helper=this.helper||f('<div style="overflow:hidden;"></div>');var k=f.browser.msie&&f.browser.version<7,j=k?1:0,i=k?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+i,height:this.element.outerHeight()+i,position:"absolute",left:this.elementOffset.left-j+"px",top:this.elementOffset.top-j+"px",zIndex:++l.zIndex}),this.helper.appendTo("body").disableSelection()}else{this.helper=this.element}},_change:{e:function(i,d,j){return{width:this.originalSize.width+d}},w:function(j,i,n){var m=this.options,l=this.originalSize,k=this.originalPosition;return{left:k.left+i,width:l.width-i}},n:function(j,i,n){var m=this.options,l=this.originalSize,k=this.originalPosition;return{top:k.top+n,height:l.height-n}},s:function(i,d,j){return{height:this.originalSize.height+j}},se:function(a,j,i){return f.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[a,j,i]))},sw:function(a,j,i){return f.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[a,j,i]))},ne:function(a,j,i){return f.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[a,j,i]))},nw:function(a,j,i){return f.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[a,j,i]))}},_propagate:function(a,d){f.ui.plugin.call(this,a,[d,this.ui()]),a!="resize"&&this._trigger(a,d,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),f.extend(f.ui.resizable,{version:"1.8.18"}),f.ui.plugin.add("resizable","alsoResize",{start:function(a,l){var k=f(this).data("resizable"),j=k.options,i=function(c){f(c).each(function(){var d=f(this);d.data("resizable-alsoresize",{width:parseInt(d.width(),10),height:parseInt(d.height(),10),left:parseInt(d.css("left"),10),top:parseInt(d.css("top"),10)})})};typeof j.alsoResize=="object"&&!j.alsoResize.parentNode?j.alsoResize.length?(j.alsoResize=j.alsoResize[0],i(j.alsoResize)):f.each(j.alsoResize,function(b){i(b)}):i(j.alsoResize)},resize:function(a,p){var o=f(this).data("resizable"),n=o.options,m=o.originalSize,l=o.originalPosition,k={height:o.size.height-m.height||0,width:o.size.width-m.width||0,top:o.position.top-l.top||0,left:o.position.left-l.left||0},j=function(c,i){f(c).each(function(){var d=f(this),s=f(this).data("resizable-alsoresize"),r={},q=i&&i.length?i:d.parents(p.originalElement[0]).length?["width","height"]:["width","height","top","left"];f.each(q,function(u,t){var v=(s[t]||0)+(k[t]||0);v&&v>=0&&(r[t]=v||null)}),d.css(r)})};typeof n.alsoResize=="object"&&!n.alsoResize.nodeType?f.each(n.alsoResize,function(d,c){j(d,c)}):j(n.alsoResize)},stop:function(a,d){f(this).removeData("resizable-alsoresize")}}),f.ui.plugin.add("resizable","animate",{stop:function(v,u){var t=f(this).data("resizable"),s=t.options,r=t._proportionallyResizeElements,q=r.length&&/textarea/i.test(r[0].nodeName),p=q&&f.ui.hasScroll(r[0],"left")?0:t.sizeDiff.height,o=q?0:t.sizeDiff.width,n={width:t.size.width-o,height:t.size.height-p},m=parseInt(t.element.css("left"),10)+(t.position.left-t.originalPosition.left)||null,a=parseInt(t.element.css("top"),10)+(t.position.top-t.originalPosition.top)||null;t.element.animate(f.extend(n,a&&m?{top:a,left:m}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var b={width:parseInt(t.element.css("width"),10),height:parseInt(t.element.css("height"),10),top:parseInt(t.element.css("top"),10),left:parseInt(t.element.css("left"),10)};r&&r.length&&f(r[0]).css({width:b.width,height:b.height}),t._updateCache(b),t._propagate("resize",v)}})}}),f.ui.plugin.add("resizable","containment",{start:function(B,A){var z=f(this).data("resizable"),y=z.options,x=z.element,w=y.containment,v=w instanceof f?w.get(0):/parent/.test(w)?x.parent().get(0):w;if(!!v){z.containerElement=f(v);if(/document/.test(w)||w==document){z.containerOffset={left:0,top:0},z.containerPosition={left:0,top:0},z.parentData={element:f(document),left:0,top:0,width:f(document).width(),height:f(document).height()||document.body.parentNode.scrollHeight}}else{var u=f(v),t=[];f(["Top","Right","Left","Bottom"]).each(function(i,d){t[i]=h(u.css("padding"+d))}),z.containerOffset=u.offset(),z.containerPosition=u.position(),z.containerSize={height:u.innerHeight()-t[3],width:u.innerWidth()-t[1]};var s=z.containerOffset,r=z.containerSize.height,q=z.containerSize.width,c=f.ui.hasScroll(v,"left")?v.scrollWidth:q,a=f.ui.hasScroll(v)?v.scrollHeight:r;z.parentData={element:v,left:s.left,top:s.top,width:c,height:a}}}},resize:function(D,C){var B=f(this).data("resizable"),A=B.options,z=B.containerSize,y=B.containerOffset,x=B.size,w=B.position,v=B._aspectRatio||D.shiftKey,u={top:0,left:0},t=B.containerElement;t[0]!=document&&/static/.test(t.css("position"))&&(u=y),w.left<(B._helper?y.left:0)&&(B.size.width=B.size.width+(B._helper?B.position.left-y.left:B.position.left-u.left),v&&(B.size.height=B.size.width/A.aspectRatio),B.position.left=A.helper?y.left:0),w.top<(B._helper?y.top:0)&&(B.size.height=B.size.height+(B._helper?B.position.top-y.top:B.position.top),v&&(B.size.width=B.size.height*A.aspectRatio),B.position.top=B._helper?y.top:0),B.offset.left=B.parentData.left+B.position.left,B.offset.top=B.parentData.top+B.position.top;var s=Math.abs((B._helper?B.offset.left-u.left:B.offset.left-u.left)+B.sizeDiff.width),r=Math.abs((B._helper?B.offset.top-u.top:B.offset.top-y.top)+B.sizeDiff.height),q=B.containerElement.get(0)==B.element.parent().get(0),a=/relative|absolute/.test(B.containerElement.css("position"));q&&a&&(s-=B.parentData.left),s+B.size.width>=B.parentData.width&&(B.size.width=B.parentData.width-s,v&&(B.size.height=B.size.width/B.aspectRatio)),r+B.size.height>=B.parentData.height&&(B.size.height=B.parentData.height-r,v&&(B.size.width=B.size.height*B.aspectRatio))},stop:function(x,w){var v=f(this).data("resizable"),u=v.options,t=v.position,s=v.containerOffset,r=v.containerPosition,q=v.containerElement,p=f(v.helper),o=p.offset(),n=p.outerWidth()-v.sizeDiff.width,a=p.outerHeight()-v.sizeDiff.height;v._helper&&!u.animate&&/relative/.test(q.css("position"))&&f(this).css({left:o.left-r.left-s.left,width:n,height:a}),v._helper&&!u.animate&&/static/.test(q.css("position"))&&f(this).css({left:o.left-r.left-s.left,width:n,height:a})}}),f.ui.plugin.add("resizable","ghost",{start:function(a,l){var k=f(this).data("resizable"),j=k.options,i=k.size;k.ghost=k.originalElement.clone(),k.ghost.css({opacity:0.25,display:"block",position:"relative",height:i.height,width:i.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof j.ghost=="string"?j.ghost:""),k.ghost.appendTo(k.helper)},resize:function(a,k){var j=f(this).data("resizable"),i=j.options;j.ghost&&j.ghost.css({position:"relative",height:j.size.height,width:j.size.width})},stop:function(a,k){var j=f(this).data("resizable"),i=j.options;j.ghost&&j.helper&&j.helper.get(0).removeChild(j.ghost.get(0))}}),f.ui.plugin.add("resizable","grid",{resize:function(v,u){var t=f(this).data("resizable"),s=t.options,r=t.size,q=t.originalSize,p=t.originalPosition,o=t.axis,n=s._aspectRatio||v.shiftKey;s.grid=typeof s.grid=="number"?[s.grid,s.grid]:s.grid;var m=Math.round((r.width-q.width)/(s.grid[0]||1))*(s.grid[0]||1),a=Math.round((r.height-q.height)/(s.grid[1]||1))*(s.grid[1]||1);/^(se|s|e)$/.test(o)?(t.size.width=q.width+m,t.size.height=q.height+a):/^(ne)$/.test(o)?(t.size.width=q.width+m,t.size.height=q.height+a,t.position.top=p.top-a):/^(sw)$/.test(o)?(t.size.width=q.width+m,t.size.height=q.height+a,t.position.left=p.left-m):(t.size.width=q.width+m,t.size.height=q.height+a,t.position.top=p.top-a,t.position.left=p.left-m)}});var h=function(b){return parseInt(b,10)||0},g=function(b){return !isNaN(parseInt(b,10))}})(jQuery);(function(d,c){d.widget("ui.selectable",d.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var a=this;this.element.addClass("ui-selectable"),this.dragged=!1;var e;this.refresh=function(){e=d(a.options.filter,a.element[0]),e.addClass("ui-selectee"),e.each(function(){var f=d(this),g=f.offset();d.data(this,"selectable-item",{element:this,$element:f,left:g.left,top:g.top,right:g.left+f.outerWidth(),bottom:g.top+f.outerHeight(),startselected:!1,selected:f.hasClass("ui-selected"),selecting:f.hasClass("ui-selecting"),unselecting:f.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=d("<div class='ui-selectable-helper'></div>")},destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy();return this},_mouseStart:function(a){var f=this;this.opos=[a.pageX,a.pageY];if(!this.options.disabled){var e=this.options;this.selectees=d(e.filter,this.element[0]),this._trigger("start",a),d(e.appendTo).append(this.helper),this.helper.css({left:a.clientX,top:a.clientY,width:0,height:0}),e.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var b=d.data(this,"selectable-item");b.startselected=!0,!a.metaKey&&!a.ctrlKey&&(b.$element.removeClass("ui-selected"),b.selected=!1,b.$element.addClass("ui-unselecting"),b.unselecting=!0,f._trigger("unselecting",a,{unselecting:b.element}))}),d(a.target).parents().andSelf().each(function(){var g=d.data(this,"selectable-item");if(g){var b=!a.metaKey&&!a.ctrlKey||!g.$element.hasClass("ui-selected");g.$element.removeClass(b?"ui-unselecting":"ui-selected").addClass(b?"ui-selecting":"ui-unselecting"),g.unselecting=!b,g.selecting=b,g.selected=b,b?f._trigger("selecting",a,{selecting:g.element}):f._trigger("unselecting",a,{unselecting:g.element});return !1}})}},_mouseDrag:function(a){var p=this;this.dragged=!0;if(!this.options.disabled){var o=this.options,n=this.opos[0],m=this.opos[1],l=a.pageX,k=a.pageY;if(n>l){var j=l;l=n,n=j}if(m>k){var j=k;k=m,m=j}this.helper.css({left:n,top:m,width:l-n,height:k-m}),this.selectees.each(function(){var e=d.data(this,"selectable-item");if(!!e&&e.element!=p.element[0]){var b=!1;o.tolerance=="touch"?b=!(e.left>l||e.right<n||e.top>k||e.bottom<m):o.tolerance=="fit"&&(b=e.left>n&&e.right<l&&e.top>m&&e.bottom<k),b?(e.selected&&(e.$element.removeClass("ui-selected"),e.selected=!1),e.unselecting&&(e.$element.removeClass("ui-unselecting"),e.unselecting=!1),e.selecting||(e.$element.addClass("ui-selecting"),e.selecting=!0,p._trigger("selecting",a,{selecting:e.element}))):(e.selecting&&((a.metaKey||a.ctrlKey)&&e.startselected?(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.$element.addClass("ui-selected"),e.selected=!0):(e.$element.removeClass("ui-selecting"),e.selecting=!1,e.startselected&&(e.$element.addClass("ui-unselecting"),e.unselecting=!0),p._trigger("unselecting",a,{unselecting:e.element}))),e.selected&&!a.metaKey&&!a.ctrlKey&&!e.startselected&&(e.$element.removeClass("ui-selected"),e.selected=!1,e.$element.addClass("ui-unselecting"),e.unselecting=!0,p._trigger("unselecting",a,{unselecting:e.element})))}});return !1}},_mouseStop:function(a){var f=this;this.dragged=!1;var e=this.options;d(".ui-unselecting",this.element[0]).each(function(){var b=d.data(this,"selectable-item");b.$element.removeClass("ui-unselecting"),b.unselecting=!1,b.startselected=!1,f._trigger("unselected",a,{unselected:b.element})}),d(".ui-selecting",this.element[0]).each(function(){var b=d.data(this,"selectable-item");b.$element.removeClass("ui-selecting").addClass("ui-selected"),b.selecting=!1,b.selected=!0,b.startselected=!0,f._trigger("selected",a,{selected:b.element})}),this._trigger("stop",a),this.helper.remove();return !1}}),d.extend(d.ui.selectable,{version:"1.8.18"})})(jQuery);(function(d,c){d.widget("ui.sortable",d.ui.mouse,{widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000},_create:function(){var b=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?b.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},destroy:function(){d.Widget.prototype.destroy.call(this),this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--){this.items[a].item.removeData(this.widgetName+"-item")}return this},_setOption:function(a,e){a==="disabled"?(this.options[a]=e,this.widget()[e?"addClass":"removeClass"]("ui-sortable-disabled")):d.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(a,n){var m=this;if(this.reverting){return !1}if(this.options.disabled||this.options.type=="static"){return !1}this._refreshItems(a);var l=null,k=this,j=d(a.target).parents().each(function(){if(d.data(this,m.widgetName+"-item")==k){l=d(this);return !1}});d.data(a.target,m.widgetName+"-item")==k&&(l=d(a.target));if(!l){return !1}if(this.options.handle&&!n){var i=!1;d(this.options.handle,l).find("*").andSelf().each(function(){this==a.target&&(i=!0)});if(!i){return !1}}this.currentItem=l,this._removeCurrentsFromItems();return !0},_mouseStart:function(a,l,k){var j=this.options,i=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(a),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),d.extend(this.offset,{click:{left:a.pageX-this.offset.left,top:a.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(a),this.originalPageX=a.pageX,this.originalPageY=a.pageY,j.cursorAt&&this._adjustOffsetFromHelper(j.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),j.containment&&this._setContainment(),j.cursor&&(d("body").css("cursor")&&(this._storedCursor=d("body").css("cursor")),d("body").css("cursor",j.cursor)),j.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",j.opacity)),j.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",j.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",a,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!k){for(var h=this.containers.length-1;h>=0;h--){this.containers[h]._trigger("activate",a,i._uiHash(this))}}d.ui.ddmanager&&(d.ui.ddmanager.current=this),d.ui.ddmanager&&!j.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(a);return !0},_mouseDrag:function(a){this.position=this._generatePosition(a),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var n=this.options,m=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-a.pageY<n.scrollSensitivity?this.scrollParent[0].scrollTop=m=this.scrollParent[0].scrollTop+n.scrollSpeed:a.pageY-this.overflowOffset.top<n.scrollSensitivity&&(this.scrollParent[0].scrollTop=m=this.scrollParent[0].scrollTop-n.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-a.pageX<n.scrollSensitivity?this.scrollParent[0].scrollLeft=m=this.scrollParent[0].scrollLeft+n.scrollSpeed:a.pageX-this.overflowOffset.left<n.scrollSensitivity&&(this.scrollParent[0].scrollLeft=m=this.scrollParent[0].scrollLeft-n.scrollSpeed)):(a.pageY-d(document).scrollTop()<n.scrollSensitivity?m=d(document).scrollTop(d(document).scrollTop()-n.scrollSpeed):d(window).height()-(a.pageY-d(document).scrollTop())<n.scrollSensitivity&&(m=d(document).scrollTop(d(document).scrollTop()+n.scrollSpeed)),a.pageX-d(document).scrollLeft()<n.scrollSensitivity?m=d(document).scrollLeft(d(document).scrollLeft()-n.scrollSpeed):d(window).width()-(a.pageX-d(document).scrollLeft())<n.scrollSensitivity&&(m=d(document).scrollLeft(d(document).scrollLeft()+n.scrollSpeed))),m!==!1&&d.ui.ddmanager&&!n.dropBehaviour&&d.ui.ddmanager.prepareOffsets(this,a)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px"}for(var l=this.items.length-1;l>=0;l--){var k=this.items[l],j=k.item[0],i=this._intersectsWithPointer(k);if(!i){continue}if(j!=this.currentItem[0]&&this.placeholder[i==1?"next":"prev"]()[0]!=j&&!d.ui.contains(this.placeholder[0],j)&&(this.options.type=="semi-dynamic"?!d.ui.contains(this.element[0],j):!0)){this.direction=i==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(k)){this._rearrange(a,k)}else{break}this._trigger("change",a,this._uiHash());break}}this._contactContainers(a),d.ui.ddmanager&&d.ui.ddmanager.drag(this,a),this._trigger("sort",a,this._uiHash()),this.lastPositionAbs=this.positionAbs;return !1},_mouseStop:function(a,h){if(!!a){d.ui.ddmanager&&!this.options.dropBehaviour&&d.ui.ddmanager.drop(this,a);if(this.options.revert){var g=this,f=g.placeholder.offset();g.reverting=!0,d(this.helper).animate({left:f.left-this.offset.parent.left-g.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:f.top-this.offset.parent.top-g.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){g._clear(a)})}else{this._clear(a,h)}return !1}},cancel:function(){var a=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--){this.containers[e]._trigger("deactivate",null,a._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,a._uiHash(this)),this.containers[e].containerCache.over=0)}}this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),d.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?d(this.domPosition.prev).after(this.currentItem):d(this.domPosition.parent).prepend(this.currentItem));return this},serialize:function(a){var f=this._getItemsAsjQuery(a&&a.connected),e=[];a=a||{},d(f).each(function(){var b=(d(a.item||this).attr(a.attribute||"id")||"").match(a.expression||/(.+)[-=_](.+)/);b&&e.push((a.key||b[1]+"[]")+"="+(a.key&&a.expression?b[1]:b[2]))}),!e.length&&a.key&&e.push(a.key+"=");return e.join("&")},toArray:function(a){var f=this._getItemsAsjQuery(a&&a.connected),e=[];a=a||{},f.each(function(){e.push(d(a.item||this).attr(a.attribute||"id")||"")});return e},_intersectsWith:function(x){var w=this.positionAbs.left,v=w+this.helperProportions.width,u=this.positionAbs.top,t=u+this.helperProportions.height,s=x.left,r=s+x.width,q=x.top,p=q+x.height,o=this.offset.click.top,n=this.offset.click.left,m=u+o>q&&u+o<p&&w+n>s&&w+n<r;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>x[this.floating?"width":"height"]?m:s<w+this.helperProportions.width/2&&v-this.helperProportions.width/2<r&&q<u+this.helperProportions.height/2&&t-this.helperProportions.height/2<p},_intersectsWithPointer:function(a){var l=d.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height),k=d.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width),j=l&&k,i=this._getDragVerticalDirection(),h=this._getDragHorizontalDirection();if(!j){return !1}return this.floating?h&&h=="right"||i=="down"?2:1:i&&(i=="down"?2:1)},_intersectsWithSides:function(a){var j=d.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),i=d.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),h=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return this.floating&&g?g=="right"&&i||g=="left"&&!i:h&&(h=="down"&&j||h=="up"&&!j)},_getDragVerticalDirection:function(){var b=this.positionAbs.top-this.lastPositionAbs.top;return b!=0&&(b>0?"down":"up")},_getDragHorizontalDirection:function(){var b=this.positionAbs.left-this.lastPositionAbs.left;return b!=0&&(b>0?"right":"left")},refresh:function(b){this._refreshItems(b),this.refreshPositions();return this},_connectWith:function(){var b=this.options;return b.connectWith.constructor==String?[b.connectWith]:b.connectWith},_getItemsAsjQuery:function(r){var q=this,p=[],o=[],n=this._connectWith();if(n&&r){for(var m=n.length-1;m>=0;m--){var l=d(n[m]);for(var k=l.length-1;k>=0;k--){var a=d.data(l[k],this.widgetName);a&&a!=this&&!a.options.disabled&&o.push([d.isFunction(a.options.items)?a.options.items.call(a.element):d(a.options.items,a.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),a])}}}o.push([d.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):d(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var m=o.length-1;m>=0;m--){o[m][0].each(function(){p.push(this)})}return d(p)},_removeCurrentsFromItems:function(){var f=this.currentItem.find(":data("+this.widgetName+"-item)");for(var e=0;e<this.items.length;e++){for(var g=0;g<f.length;g++){f[g]==this.items[e].item[0]&&this.items.splice(e,1)}}},_refreshItems:function(z){this.items=[],this.containers=[this];var y=this.items,x=this,w=[[d.isFunction(this.options.items)?this.options.items.call(this.element[0],z,{item:this.currentItem}):d(this.options.items,this.element),this]],v=this._connectWith();if(v&&this.ready){for(var u=v.length-1;u>=0;u--){var t=d(v[u]);for(var s=t.length-1;s>=0;s--){var r=d.data(t[s],this.widgetName);r&&r!=this&&!r.options.disabled&&(w.push([d.isFunction(r.options.items)?r.options.items.call(r.element[0],z,{item:this.currentItem}):d(r.options.items,r.element),r]),this.containers.push(r))}}}for(var u=w.length-1;u>=0;u--){var q=w[u][1],p=w[u][0];for(var s=0,o=p.length;s<o;s++){var a=d(p[s]);a.data(this.widgetName+"-item",q),y.push({item:a,instance:q,width:0,height:0,left:0,top:0})}}},refreshPositions:function(a){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var j=this.items.length-1;j>=0;j--){var i=this.items[j];if(i.instance!=this.currentContainer&&this.currentContainer&&i.item[0]!=this.currentItem[0]){continue}var h=this.options.toleranceElement?d(this.options.toleranceElement,i.item):i.item;a||(i.width=h.outerWidth(),i.height=h.outerHeight());var g=h.offset();i.left=g.left,i.top=g.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(var j=this.containers.length-1;j>=0;j--){var g=this.containers[j].element.offset();this.containers[j].containerCache.left=g.left,this.containers[j].containerCache.top=g.top,this.containers[j].containerCache.width=this.containers[j].element.outerWidth(),this.containers[j].containerCache.height=this.containers[j].element.outerHeight()}}return this},_createPlaceholder:function(a){var h=a||this,g=h.options;if(!g.placeholder||g.placeholder.constructor==String){var f=g.placeholder;g.placeholder={element:function(){var e=d(document.createElement(h.currentItem[0].nodeName)).addClass(f||h.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];f||(e.style.visibility="hidden");return e},update:function(i,e){if(!f||!!g.forcePlaceholderSize){e.height()||e.height(h.currentItem.innerHeight()-parseInt(h.currentItem.css("paddingTop")||0,10)-parseInt(h.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(h.currentItem.innerWidth()-parseInt(h.currentItem.css("paddingLeft")||0,10)-parseInt(h.currentItem.css("paddingRight")||0,10))}}}}h.placeholder=d(g.placeholder.element.call(h.element,h.currentItem)),h.currentItem.after(h.placeholder),g.placeholder.update(h,h.placeholder)},_contactContainers:function(r){var q=null,p=null;for(var o=this.containers.length-1;o>=0;o--){if(d.ui.contains(this.currentItem[0],this.containers[o].element[0])){continue}if(this._intersectsWith(this.containers[o].containerCache)){if(q&&d.ui.contains(this.containers[o].element[0],q.element[0])){continue}q=this.containers[o],p=o}else{this.containers[o].containerCache.over&&(this.containers[o]._trigger("out",r,this._uiHash(this)),this.containers[o].containerCache.over=0)}}if(!!q){if(this.containers.length===1){this.containers[p]._trigger("over",r,this._uiHash(this)),this.containers[p].containerCache.over=1}else{if(this.currentContainer!=this.containers[p]){var n=10000,m=null,l=this.positionAbs[this.containers[p].floating?"left":"top"];for(var k=this.items.length-1;k>=0;k--){if(!d.ui.contains(this.containers[p].element[0],this.items[k].item[0])){continue}var a=this.items[k][this.containers[p].floating?"left":"top"];Math.abs(a-l)<n&&(n=Math.abs(a-l),m=this.items[k])}if(!m&&!this.options.dropOnEmpty){return}this.currentContainer=this.containers[p],m?this._rearrange(r,m,null,!0):this._rearrange(r,null,this.containers[p].element,!0),this._trigger("change",r,this._uiHash()),this.containers[p]._trigger("change",r,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",r,this._uiHash(this)),this.containers[p].containerCache.over=1}}}},_createHelper:function(a){var f=this.options,e=d.isFunction(f.helper)?d(f.helper.apply(this.element[0],[a,this.currentItem])):f.helper=="clone"?this.currentItem.clone():this.currentItem;e.parents("body").length||d(f.appendTo!="parent"?f.appendTo:this.currentItem[0].parentNode)[0].appendChild(e[0]),e[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(e[0].style.width==""||f.forceHelperSize)&&e.width(this.currentItem.width()),(e[0].style.height==""||f.forceHelperSize)&&e.height(this.currentItem.height());return e},_adjustOffsetFromHelper:function(a){typeof a=="string"&&(a=a.split(" ")),d.isArray(a)&&(a={left:+a[0],top:+a[1]||0}),"left" in a&&(this.offset.click.left=a.left+this.margins.left),"right" in a&&(this.offset.click.left=this.helperProportions.width-a.right+this.margins.left),"top" in a&&(this.offset.click.top=a.top+this.margins.top),"bottom" in a&&(this.offset.click.top=this.helperProportions.height-a.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var a=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&d.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(a.left+=this.scrollParent.scrollLeft(),a.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&d.browser.msie){a={top:0,left:0}}return{top:a.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:a.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var b=this.currentItem.position();return{top:b.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:b.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var a=this.options;a.containment=="parent"&&(a.containment=this.helper[0].parentNode);if(a.containment=="document"||a.containment=="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d(a.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(d(a.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!/^(document|window|parent)$/.test(a.containment)){var h=d(a.containment)[0],g=d(a.containment).offset(),f=d(h).css("overflow")!="hidden";this.containment=[g.left+(parseInt(d(h).css("borderLeftWidth"),10)||0)+(parseInt(d(h).css("paddingLeft"),10)||0)-this.margins.left,g.top+(parseInt(d(h).css("borderTopWidth"),10)||0)+(parseInt(d(h).css("paddingTop"),10)||0)-this.margins.top,g.left+(f?Math.max(h.scrollWidth,h.offsetWidth):h.offsetWidth)-(parseInt(d(h).css("borderLeftWidth"),10)||0)-(parseInt(d(h).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,g.top+(f?Math.max(h.scrollHeight,h.offsetHeight):h.offsetHeight)-(parseInt(d(h).css("borderTopWidth"),10)||0)-(parseInt(d(h).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(a,l){l||(l=this.position);var k=a=="absolute"?1:-1,j=this.options,i=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,h=/(html|body)/i.test(i[0].tagName);return{top:l.top+this.offset.relative.top*k+this.offset.parent.top*k-(d.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():h?0:i.scrollTop())*k),left:l.left+this.offset.relative.left*k+this.offset.parent.left*k-(d.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():h?0:i.scrollLeft())*k)}},_generatePosition:function(a){var p=this.options,o=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!d.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,n=/(html|body)/i.test(o[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var m=a.pageX,l=a.pageY;if(this.originalPosition){this.containment&&(a.pageX-this.offset.click.left<this.containment[0]&&(m=this.containment[0]+this.offset.click.left),a.pageY-this.offset.click.top<this.containment[1]&&(l=this.containment[1]+this.offset.click.top),a.pageX-this.offset.click.left>this.containment[2]&&(m=this.containment[2]+this.offset.click.left),a.pageY-this.offset.click.top>this.containment[3]&&(l=this.containment[3]+this.offset.click.top));if(p.grid){var k=this.originalPageY+Math.round((l-this.originalPageY)/p.grid[1])*p.grid[1];l=this.containment?k-this.offset.click.top<this.containment[1]||k-this.offset.click.top>this.containment[3]?k-this.offset.click.top<this.containment[1]?k+p.grid[1]:k-p.grid[1]:k:k;var j=this.originalPageX+Math.round((m-this.originalPageX)/p.grid[0])*p.grid[0];m=this.containment?j-this.offset.click.left<this.containment[0]||j-this.offset.click.left>this.containment[2]?j-this.offset.click.left<this.containment[0]?j+p.grid[0]:j-p.grid[0]:j:j}}return{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(d.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():n?0:o.scrollTop()),left:m-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(d.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():n?0:o.scrollLeft())}},_rearrange:function(h,g,l,k){l?l[0].appendChild(this.placeholder[0]):g.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?g.item[0]:g.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var j=this,i=this.counter;window.setTimeout(function(){i==j.counter&&j.refreshPositions(!k)},0)},_clear:function(a,j){this.reverting=!1;var i=[],h=this;!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var g in this._storedCSS){if(this._storedCSS[g]=="auto"||this._storedCSS[g]=="static"){this._storedCSS[g]=""}}this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else{this.currentItem.show()}this.fromOutside&&!j&&i.push(function(b){this._trigger("receive",b,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!j&&i.push(function(b){this._trigger("update",b,this._uiHash())});if(!d.ui.contains(this.element[0],this.currentItem[0])){j||i.push(function(b){this._trigger("remove",b,this._uiHash())});for(var g=this.containers.length-1;g>=0;g--){d.ui.contains(this.containers[g].element[0],this.currentItem[0])&&!j&&(i.push(function(b){return function(e){b._trigger("receive",e,this._uiHash(this))}}.call(this,this.containers[g])),i.push(function(b){return function(e){b._trigger("update",e,this._uiHash(this))}}.call(this,this.containers[g])))}}for(var g=this.containers.length-1;g>=0;g--){j||i.push(function(b){return function(e){b._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[g])),this.containers[g].containerCache.over&&(i.push(function(b){return function(e){b._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[g])),this.containers[g].containerCache.over=0)}this._storedCursor&&d("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!j){this._trigger("beforeStop",a,this._uiHash());for(var g=0;g<i.length;g++){i[g].call(this,a)}this._trigger("stop",a,this._uiHash())}return !1}j||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!j){for(var g=0;g<i.length;g++){i[g].call(this,a)}this._trigger("stop",a,this._uiHash())}this.fromOutside=!1;return !0},_trigger:function(){d.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(a){var e=a||this;return{helper:e.helper,placeholder:e.placeholder||d([]),position:e.position,originalPosition:e.originalPosition,offset:e.positionAbs,item:e.currentItem,sender:a?a.element:null}}}),d.extend(d.ui.sortable,{version:"1.8.18"})})(jQuery);jQuery.effects||function(x,w){function m(a){if(!a||typeof a=="number"||x.fx.speeds[a]){return !0}if(typeof a=="string"&&!x.effects[a]){return !0}return !1}function n(a,h,g,f){typeof a=="object"&&(f=h,g=null,h=a,a=h.effect),x.isFunction(h)&&(f=h,g=null,h={});if(typeof h=="number"||x.fx.speeds[h]){f=g,g=h,h={}}x.isFunction(g)&&(f=g,g=null),h=h||{},g=g||h.duration,g=x.fx.off?0:typeof g=="number"?g:g in x.fx.speeds?x.fx.speeds[g]:x.fx.speeds._default,f=f||h.complete;return[a,h,g,f]}function o(f,e){var h={_:0},g;for(g in e){f[g]!=e[g]&&(h[g]=e[g])}return h}function p(a){var f,e;for(f in a){e=a[f],(e==null||x.isFunction(e)||f in r||/scrollbar/.test(f)||!/color/i.test(f)&&isNaN(parseFloat(e)))&&delete a[f]}return a}function q(){var g=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,f={},j,i;if(g&&g.length&&g[0]&&g[g[0]]){var h=g.length;while(h--){j=g[h],typeof g[j]=="string"&&(i=j.replace(/\-(\w)/g,function(d,c){return c.toUpperCase()}),f[i]=g[j])}}else{for(j in g){typeof g[j]=="string"&&(f[j]=g[j])}}return f}function u(a,f){var c;do{c=x.curCSS(a,f);if(c!=""&&c!="transparent"||x.nodeName(a,"body")){break}f="backgroundColor"}while(a=a.parentNode);return v(c)}function v(a){var d;if(a&&a.constructor==Array&&a.length==3){return a}if(d=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a)){return[parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)]}if(d=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(a)){return[parseFloat(d[1])*2.55,parseFloat(d[2])*2.55,parseFloat(d[3])*2.55]}if(d=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(a)){return[parseInt(d[1],16),parseInt(d[2],16),parseInt(d[3],16)]}if(d=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(a)){return[parseInt(d[1]+d[1],16),parseInt(d[2]+d[2],16),parseInt(d[3]+d[3],16)]}if(d=/rgba\(0, 0, 0, 0\)/.exec(a)){return t.transparent}return t[x.trim(a).toLowerCase()]}x.effects={},x.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(a,c){x.fx.step[c]=function(b){b.colorInit||(b.start=u(b.elem,c),b.end=v(b.end),b.colorInit=!0),b.elem.style[c]="rgb("+Math.max(Math.min(parseInt(b.pos*(b.end[0]-b.start[0])+b.start[0],10),255),0)+","+Math.max(Math.min(parseInt(b.pos*(b.end[1]-b.start[1])+b.start[1],10),255),0)+","+Math.max(Math.min(parseInt(b.pos*(b.end[2]-b.start[2])+b.start[2],10),255),0)+")"}});var t={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},s=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};x.effects.animateClass=function(a,h,g,f){x.isFunction(g)&&(f=g,g=null);return this.queue(function(){var e=x(this),d=e.attr("style")||" ",c=p(q.call(this)),b,i=e.attr("class");x.each(s,function(j,k){a[k]&&e[k+"Class"](a[k])}),b=p(q.call(this)),e.attr("class",i),e.animate(o(c,b),{queue:!1,duration:h,easing:g,complete:function(){x.each(s,function(j,k){a[k]&&e[k+"Class"](a[k])}),typeof e.attr("style")=="object"?(e.attr("style").cssText="",e.attr("style").cssText=d):e.attr("style",d),f&&f.apply(this,arguments),x.dequeue(this)}})})},x.fn.extend({_addClass:x.fn.addClass,addClass:function(a,h,g,f){return h?x.effects.animateClass.apply(this,[{add:a},h,g,f]):this._addClass(a)},_removeClass:x.fn.removeClass,removeClass:function(a,h,g,f){return h?x.effects.animateClass.apply(this,[{remove:a},h,g,f]):this._removeClass(a)},_toggleClass:x.fn.toggleClass,toggleClass:function(j,i,h,b,a){return typeof i=="boolean"||i===w?h?x.effects.animateClass.apply(this,[i?{add:j}:{remove:j},h,b,a]):this._toggleClass(j,i):x.effects.animateClass.apply(this,[{toggle:j},i,h,b])},switchClass:function(a,j,i,h,g){return x.effects.animateClass.apply(this,[{add:j,remove:a},i,h,g])}}),x.extend(x.effects,{version:"1.8.18",save:function(e,d){for(var f=0;f<d.length;f++){d[f]!==null&&e.data("ec.storage."+d[f],e[0].style[d[f]])}},restore:function(e,d){for(var f=0;f<d.length;f++){d[f]!==null&&e.css(d[f],e.data("ec.storage."+d[f]))}},setMode:function(d,c){c=="toggle"&&(c=d.is(":hidden")?"show":"hide");return c},getBaseline:function(f,e){var h,g;switch(f[0]){case"top":h=0;break;case"middle":h=0.5;break;case"bottom":h=1;break;default:h=f[0]/e.height}switch(f[1]){case"left":g=0;break;case"center":g=0.5;break;case"right":g=1;break;default:g=f[1]/e.width}return{x:g,y:h}},createWrapper:function(a){if(a.parent().is(".ui-effects-wrapper")){return a.parent()}var h={width:a.outerWidth(!0),height:a.outerHeight(!0),"float":a.css("float")},g=x("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),f=document.activeElement;a.wrap(g),(a[0]===f||x.contains(a[0],f))&&x(f).focus(),g=a.parent(),a.css("position")=="static"?(g.css({position:"relative"}),a.css({position:"relative"})):(x.extend(h,{position:a.css("position"),zIndex:a.css("z-index")}),x.each(["top","left","bottom","right"],function(b,c){h[c]=a.css(c),isNaN(parseInt(h[c],10))&&(h[c]="auto")}),a.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"}));return g.css(h).show()},removeWrapper:function(a){var f,e=document.activeElement;if(a.parent().is(".ui-effects-wrapper")){f=a.parent().replaceWith(a),(a[0]===e||x.contains(a[0],e))&&x(e).focus();return f}return a},setTransition:function(a,h,g,f){f=f||{},x.each(h,function(b,d){unit=a.cssUnit(d),unit[0]>0&&(f[d]=unit[0]*g+unit[1])});return f}}),x.fn.extend({effect:function(a,B,A,z){var y=n.apply(this,arguments),l={options:y[1],duration:y[2],callback:y[3]},k=l.options.mode,j=x.effects[a];if(x.fx.off||!j){return k?this[k](l.duration,l.callback):this.each(function(){l.callback&&l.callback.call(this)})}return j.call(this,l)},_show:x.fn.show,show:function(d){if(m(d)){return this._show.apply(this,arguments)}var c=n.apply(this,arguments);c[1].mode="show";return this.effect.apply(this,c)},_hide:x.fn.hide,hide:function(d){if(m(d)){return this._hide.apply(this,arguments)}var c=n.apply(this,arguments);c[1].mode="hide";return this.effect.apply(this,c)},__toggle:x.fn.toggle,toggle:function(a){if(m(a)||typeof a=="boolean"||x.isFunction(a)){return this.__toggle.apply(this,arguments)}var d=n.apply(this,arguments);d[1].mode="toggle";return this.effect.apply(this,d)},cssUnit:function(a){var f=this.css(a),e=[];x.each(["em","px","%","pt"],function(d,c){f.indexOf(c)>0&&(e=[parseFloat(f),c])});return e}}),x.easing.jswing=x.easing.swing,x.extend(x.easing,{def:"easeOutQuad",swing:function(a,j,i,h,g){return x.easing[x.easing.def](a,j,i,h,g)},easeInQuad:function(g,f,j,i,h){return i*(f/=h)*f+j},easeOutQuad:function(g,f,j,i,h){return -i*(f/=h)*(f-2)+j},easeInOutQuad:function(g,f,j,i,h){if((f/=h/2)<1){return i/2*f*f+j}return -i/2*(--f*(f-2)-1)+j},easeInCubic:function(g,f,j,i,h){return i*(f/=h)*f*f+j},easeOutCubic:function(g,f,j,i,h){return i*((f=f/h-1)*f*f+1)+j},easeInOutCubic:function(g,f,j,i,h){if((f/=h/2)<1){return i/2*f*f*f+j}return i/2*((f-=2)*f*f+2)+j},easeInQuart:function(g,f,j,i,h){return i*(f/=h)*f*f*f+j},easeOutQuart:function(g,f,j,i,h){return -i*((f=f/h-1)*f*f*f-1)+j},easeInOutQuart:function(g,f,j,i,h){if((f/=h/2)<1){return i/2*f*f*f*f+j}return -i/2*((f-=2)*f*f*f-2)+j},easeInQuint:function(g,f,j,i,h){return i*(f/=h)*f*f*f*f+j},easeOutQuint:function(g,f,j,i,h){return i*((f=f/h-1)*f*f*f*f+1)+j},easeInOutQuint:function(g,f,j,i,h){if((f/=h/2)<1){return i/2*f*f*f*f*f+j}return i/2*((f-=2)*f*f*f*f+2)+j},easeInSine:function(g,f,j,i,h){return -i*Math.cos(f/h*(Math.PI/2))+i+j},easeOutSine:function(g,f,j,i,h){return i*Math.sin(f/h*(Math.PI/2))+j},easeInOutSine:function(g,f,j,i,h){return -i/2*(Math.cos(Math.PI*f/h)-1)+j},easeInExpo:function(g,f,j,i,h){return f==0?j:i*Math.pow(2,10*(f/h-1))+j},easeOutExpo:function(g,f,j,i,h){return f==h?j+i:i*(-Math.pow(2,-10*f/h)+1)+j},easeInOutExpo:function(g,f,j,i,h){if(f==0){return j}if(f==h){return j+i}if((f/=h/2)<1){return i/2*Math.pow(2,10*(f-1))+j}return i/2*(-Math.pow(2,-10*--f)+2)+j},easeInCirc:function(g,f,j,i,h){return -i*(Math.sqrt(1-(f/=h)*f)-1)+j},easeOutCirc:function(g,f,j,i,h){return i*Math.sqrt(1-(f=f/h-1)*f)+j},easeInOutCirc:function(g,f,j,i,h){if((f/=h/2)<1){return -i/2*(Math.sqrt(1-f*f)-1)+j}return i/2*(Math.sqrt(1-(f-=2)*f)+1)+j},easeInElastic:function(j,i,B,A,z){var y=1.70158,l=0,k=A;if(i==0){return B}if((i/=z)==1){return B+A}l||(l=z*0.3);if(k<Math.abs(A)){k=A;var y=l/4}else{var y=l/(2*Math.PI)*Math.asin(A/k)}return -(k*Math.pow(2,10*(i-=1))*Math.sin((i*z-y)*2*Math.PI/l))+B},easeOutElastic:function(j,i,B,A,z){var y=1.70158,l=0,k=A;if(i==0){return B}if((i/=z)==1){return B+A}l||(l=z*0.3);if(k<Math.abs(A)){k=A;var y=l/4}else{var y=l/(2*Math.PI)*Math.asin(A/k)}return k*Math.pow(2,-10*i)*Math.sin((i*z-y)*2*Math.PI/l)+A+B},easeInOutElastic:function(j,i,B,A,z){var y=1.70158,l=0,k=A;if(i==0){return B}if((i/=z/2)==2){return B+A}l||(l=z*0.3*1.5);if(k<Math.abs(A)){k=A;var y=l/4}else{var y=l/(2*Math.PI)*Math.asin(A/k)}if(i<1){return -0.5*k*Math.pow(2,10*(i-=1))*Math.sin((i*z-y)*2*Math.PI/l)+B}return k*Math.pow(2,-10*(i-=1))*Math.sin((i*z-y)*2*Math.PI/l)*0.5+A+B},easeInBack:function(b,l,k,j,i,h){h==w&&(h=1.70158);return j*(l/=i)*l*((h+1)*l-h)+k},easeOutBack:function(b,l,k,j,i,h){h==w&&(h=1.70158);return j*((l=l/i-1)*l*((h+1)*l+h)+1)+k},easeInOutBack:function(b,l,k,j,i,h){h==w&&(h=1.70158);if((l/=i/2)<1){return j/2*l*l*(((h*=1.525)+1)*l-h)+k}return j/2*((l-=2)*l*(((h*=1.525)+1)*l+h)+2)+k},easeInBounce:function(a,j,i,h,g){return h-x.easing.easeOutBounce(a,g-j,0,h,g)+i},easeOutBounce:function(g,f,j,i,h){return(f/=h)<1/2.75?i*7.5625*f*f+j:f<2/2.75?i*(7.5625*(f-=1.5/2.75)*f+0.75)+j:f<2.5/2.75?i*(7.5625*(f-=2.25/2.75)*f+0.9375)+j:i*(7.5625*(f-=2.625/2.75)*f+0.984375)+j},easeInOutBounce:function(a,j,i,h,g){if(j<g/2){return x.easing.easeInBounce(a,j*2,0,h,g)*0.5+i}return x.easing.easeOutBounce(a,j*2-g,0,h,g)*0.5+h*0.5+i}})}(jQuery);
/*
 * Tiny Scrollbar 1.65
 * http://www.baijs.nl/tinyscrollbar/
 *
 * Copyright 2010, Maarten Baijs
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/gpl-2.0.php
 *
 * Date: 10 / 05 / 2011
 * Depends on library: jQuery
 * 
 */
(function(a){a.tiny=a.tiny||{};a.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,size:"auto",sizethumb:"auto"}};a.fn.tinyscrollbar=function(c){var c=a.extend({},a.tiny.scrollbar.options,c);this.each(function(){a(this).data("tsb",new b(a(this),c))});return this};a.fn.tinyscrollbar_update=function(c){return a(this).data("tsb").update(c)};function b(p,f){var j=this;var s=p;var i={obj:a(".viewport",p)};var g={obj:a(".overview",p)};var d={obj:a(".scrollbar",p)};var l={obj:a(".track",d.obj)};var o={obj:a(".thumb",d.obj)};var k=f.axis=="x",m=k?"left":"top",u=k?"Width":"Height";var q,x={start:0,now:0},n={};function c(){j.update();r();return j}this.update=function(y){i[f.axis]=i.obj[0]["offset"+u];g[f.axis]=g.obj[0]["scroll"+u];g.ratio=i[f.axis]/g[f.axis];d.obj.toggleClass("disable",g.ratio>=1);l[f.axis]=f.size=="auto"?i[f.axis]:f.size;o[f.axis]=Math.min(l[f.axis],Math.max(0,(f.sizethumb=="auto"?(l[f.axis]*g.ratio):f.sizethumb)));d.ratio=f.sizethumb=="auto"?(g[f.axis]/l[f.axis]):(g[f.axis]-i[f.axis])/(l[f.axis]-o[f.axis]);q=(y=="relative"&&g.ratio<=1)?Math.min((g[f.axis]-i[f.axis]),Math.max(0,q)):0;q=(y=="bottom"&&g.ratio<=1)?(g[f.axis]-i[f.axis]):isNaN(parseInt(y))?q:parseInt(y);v()};function v(){window.requestAnimationFrame(function(){o.obj.css(m,q/d.ratio);g.obj.css(m,-q);n["start"]=o.obj.offset()[m];var y=u.toLowerCase();d.obj.css(y,l[f.axis]);l.obj.css(y,l[f.axis]);o.obj.css(y,o[f.axis])})}function r(){o.obj.bind("mousedown",h);o.obj[0].ontouchstart=function(y){y.preventDefault();o.obj.unbind("mousedown");h(y.touches[0]);return false};l.obj.bind("mouseup",t);if(f.scroll&&this.addEventListener){s[0].addEventListener("DOMMouseScroll",w,false);s[0].addEventListener("mousewheel",w,false)}else{if(f.scroll){s[0].onmousewheel=w}}}function h(y){window.requestAnimationFrame(function(){n.start=k?y.pageX:y.pageY;var z=parseInt(o.obj.css(m));x.start=z=="auto"?0:z;a(document).bind("mousemove",t);document.ontouchmove=function(A){a(document).unbind("mousemove");t(A.touches[0])};a(document).bind("mouseup",e);o.obj.bind("mouseup",e);o.obj[0].ontouchend=document.ontouchend=function(A){a(document).unbind("mouseup");o.obj.unbind("mouseup");e(A.touches[0])}});return false}function w(y){window.requestAnimationFrame(function(){if(!(g.ratio>=1)){y=a.event.fix(y||window.event);var A=y.wheelDelta||(y.originalEvent&&y.originalEvent.wheelDelta);var z=A?A/120:-(y.detail||(y.originalEvent&&y.originalEvent.detail))/3;q-=z*f.wheel;q=Math.min((g[f.axis]-i[f.axis]),Math.max(0,q));o.obj.css(m,q/d.ratio);g.obj.css(m,-q);y.preventDefault()}})}function e(y){a(document).unbind("mousemove",t);a(document).unbind("mouseup",e);o.obj.unbind("mouseup",e);document.ontouchmove=o.obj[0].ontouchend=document.ontouchend=null;return false}function t(y){if(!a.tiny.scrollbar.lastDragTime){a.tiny.scrollbar.lastDragTime=new Date().getTime()}window.requestAnimationFrame(function(){if(!(g.ratio>=1)){x.now=Math.min((l[f.axis]-o[f.axis]),Math.max(0,(x.start+((k?y.pageX:y.pageY)-n.start))));q=x.now*d.ratio;g.obj.css(m,-q);o.obj.css(m,x.now)}});return false}return c()}})(jQuery);
/* Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(g){var e=["DOMMouseScroll","mousewheel"];if(g.event.fixHooks){for(var f=e.length;f;){g.event.fixHooks[e[--f]]=g.event.mouseHooks}}g.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var a=e.length;a;){this.addEventListener(e[--a],h,false)}}else{this.onmousewheel=h}},teardown:function(){if(this.removeEventListener){for(var a=e.length;a;){this.removeEventListener(e[--a],h,false)}}else{this.onmousewheel=null}}};g.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});function h(b){var d=b||window.event,l=[].slice.call(arguments,1),a=0,c=true,m=0,n=0;b=g.event.fix(d);b.type="mousewheel";if(d.wheelDelta){a=d.wheelDelta/120}if(d.detail){a=-d.detail/3}n=a;if(d.axis!==undefined&&d.axis===d.HORIZONTAL_AXIS){n=0;m=-1*a}if(d.wheelDeltaY!==undefined){n=d.wheelDeltaY/120}if(d.wheelDeltaX!==undefined){m=-1*d.wheelDeltaX/120}l.unshift(b,a,m,n);return(g.event.dispatch||g.event.handle).apply(this,l)}})(jQuery);(function(a){a.fn.extend({bounce:function(b){var c={size:[0.33,1.33,1,1.12,1,1.05,1],delay:[0,100,80,80,80,80,50],step:function(e){var g=e.data("bounce");if(g&&g.nextStep<g.size.length){var d=0;if(g.nextStep!=0){d=g.delay[g.nextStep]}var h=g.nextStep>0?g.size[g.nextStep-1]:0;var f=g.size[g.nextStep]-h;utils.animateRaf(function(i){e.css({"-webkit-transform":"scale("+(h+f*i)+")","-moz-transform":"scale("+(h+f*i)+")"})},g.delay[g.nextStep],function(){b.step(e)});g.nextStep++}else{e.css({"-webkit-transform":"none","-moz-transform":"none"})}}};var b=a.extend(c,b);return this.each(function(){var d=a(this).data("bounce",{size:b.size,delay:b.delay,nextStep:0}).css({"-webkit-transform":"scale(0.01)","-moz-transform":"scale(0.01)"});b.step(d)})}})})(jQuery);function zoomAction(u,c,t,f,d,a,l,b){var k=$("#canvas"),n=$("#viewport"),s=$("#canvasPages");var j={left:-n.get(0).scrollLeft,top:-n.get(0).scrollTop},r={width:k.width(),height:k.height()},v=1;if($.browser.webkit){v=new WebKitCSSMatrix(s.css("-webkit-transform")).a}else{var p=s.css("-moz-transform");var m=p.match(/scale\s*\(\s*([\d\.]+)\s*\)/)||p.match(/matrix\s*\(\s*([\d\.]+)/);if(m){v=parseFloat(m[1])}}var h=u-j.top,o=c-j.left,g=t-r.width,q=f-r.height,i=d-v;var e=l&&$.isFunction(l);utils.animateRaf(function(w){k.css({width:r.width+g*w+"px",height:r.height+q*w+"px"});n.get(0).scrollTop=-1*(j.top+h*w);n.get(0).scrollLeft=-1*(j.left+o*w);s.css({"-webkit-transform":"scale("+(v+i*w)+")","-moz-transform":"scale("+(v+i*w)+")"});if(e){l(w)}},a,"easeInOutQuad",function(){window.setTimeout(zoomActionCallback,10);if(b&&$.isFunction(b)){b()}});project.set({"currentZoom":d})}function dragZoom(e){$("#addPage").data("position",$("#addPage").css("right")).css({"right":"0px"});$("#hud, #trash").fadeOut(300);$(".template").fadeTo(300,0.2);if(project.get("currentZoom")<1){return}setZoomedOutActions();var b,c;if($(e).hasClass("templateLink")){b=$(e);c="template"}else{if($(e).attr("id")=="cmLink2"){b=$(".zoomedOutSelected");c="ahref"}else{return}}var g=0.25;var d=300;var a=$("#canvas").data("lastOutX");var f=$("#canvas").data("lastOutY");zoomAction(f,a,project.get("canvasWidth")*g,project.get("canvasHeight")*g,g,d,null,function(){link.draw($("#dragCanvas"),b.attr("id"),$(".connectorHelper"),c);$("#dragCanvas").fadeIn(200);canvas2.updatePages();canvas2.updateLinks()});$("#library").hide()}function dragZoomStop(){$("#addPage").css({"right":$("#addPage").data("position")||10});$("#hud").fadeIn(300);$("#trash").fadeIn(300);$("#canvasPages .screen").stop().fadeTo(300,1)}function setZoomedInActions(){if(!project.readOnly()){}$("#canvasPages .pageWidget").draggable("enable");$("#canvasPages .zoomedOutSelected").removeClass("zoomedOutSelected");$("#canvas").draggable("option","distance",50).addClass("canvas100").removeClass("zoomedOut");$("#canvasPages .activeZoomedOut").removeClass("activeZoomedOut");$("#canvasPages .screen").draggable("option","handle",".pageDragHandle");var a=$(".screen.active .selectArea");if(a.length){a.tinyscrollbar_update()}if(!project.readOnly()){project.getActivePage().find(".selectArea").selectable("enable")}}function zoomOutToLastPoint(b,f,c,e){var a=$("#canvas").data("lastOutX");var d=$("#canvas").data("lastOutY");zoomAction(d,a,project.get("canvasWidth")*f,project.get("canvasHeight")*f,f,c,function(g){if(g===1){if(e){e()}}});page.enableSelectableWidgetHolder(false)}function setZoomedOutActions(){var b=$("#canvasPages .screen");b.not(".active, .activeZoomedOut").hide();page.hideOptionsMenu();page.detachFrame();contextMenu.hide();propInspector.resetPropInspector();$("#library").hide();$("#projectView").fadeOut(500);$("#zoomOut").animate({opacity:0},500);$("#zoomOut").css("pointer-events","none");$("#canvasPages .screen.active").selectable("destroy").removeData("initSelectable");var a=$("#canvasPages .active");$("#canvasPages .active").addClass("activeZoomedOut").removeClass("active");$("#canvasPages .pageWidget").draggable("disable");$("#canvas").removeClass("canvas100").addClass("zoomedOut").draggable("option","distance",4);$("#canvasPages .ui-selected").addClass("zoomedOutSelected");b.draggable("option","distance",10);widget.resetSelection();b.draggable("option","handle",false);grid.hideGrid();staticWidgets.hideStaticBoundary();var a=project.get("pages");if((a.length>0)&&(!link.isLinking)){$("#trash").fadeIn(300)}}function zoomActionCallback(){function a(){var d=$(".screen").not(":visible").add("#canvasLinks");d.show().css({"opacity":0});setTimeout(function(){d.css({"-webkit-transition":"opacity 0.3s ease-in-out","-moz-transition":"opacity 0.3s ease-in-out","opacity":1}).bind("webkitTransitionEnd",function(){d.unbind("webkitTransitionEnd").css({"-webkit-transition":"","-moz-transition":""})});canvas2.updateLinks();canvas2.setScreenContainment()},10)}$("#canvas").draggable("option","containment",canvas2.setContainment()).css({"-webkit-transition":"none","-moz-transition":"none"}).data("zooming",false);var c=project.get("currentZoom");var b=false;if(c==1){if(!project.readOnly()){if(!$("#library").is(":visible")){lib.show(a)}b=true}$("#projectView").fadeIn(200);$("#zoomOut").animate({opacity:1},200);$("#zoomOut").css("pointer-events","auto")}if(!b){a()}}function zoomInOnPoint(d,b,c,h,g){var a=parseInt($("#canvas").css("top"));var e=parseInt($("#canvas").css("left"));var f={top:0,left:0};f.top=b-(((b-a)/c)*h);f.left=d-(((d-e)/c)*h);zoomAction(f.top,f.left,project.get("canvasWidth"),project.get("canvasWidth"),h,g)}function zoomOutToAllPages(j,e){var a=10;var c=utils.getTLWH("#viewport");var i=utils.getCenterPoint("#viewport");var m=utils.getTLWH("#canvas");var g=utils.getBoundingArea(".page");var d=g.right-g.left;var o=g.bottom-g.top;var n=(c.width/d);var l=(c.height/o);var h=Math.min(n,l);if(h>0.25){h=0.25}var p=a+m.top*h-g.top*h;var b=a+m.left*h-g.left*h;var k=project.get("canvasWidth")*h;var f=project.get("canvasHeight")*h;zoomAction(p,b,k,f,h,e)}function zoomInAndCenterOnPage(a,e,b,h){var d=utils.getTranslateDistanceToCenter(a,"#viewport");if(e!=b){$("#canvasPages .screen").not(a).hide()}var c=0;if(!project.readOnly()&&$("#library").css("left")=="0px"){c=Math.floor(account.get("libraryWidth")/2)}if(d.top==0&&d.left+c==0&&e==1&&b==1){return false}var g=d.top-parseInt($("#viewport").get(0).scrollTop);var f=d.left+c-parseInt($("#viewport").get(0).scrollLeft);zoomAction(g,f,project.get("canvasWidth"),project.get("canvasHeight"),b,h,function(i){if(i===1){canvas2.updatePages();canvas2.updateLinks()}});page.enableSelectableWidgetHolder();hint.show("library");return true}(function(a){a.fn.extend({zoom:function(c,e){var d={currentZoom:false,newZoom:false,duration:400,centerIn:"#viewport",centerX:false,centerY:false,canvasX:false,canvasY:false,page:false,centering:false,savePosition:true};var c=a.extend(d,c);if(a("#canvas").data("zooming")){return this}var b=project.get("pages");if(b.length==0&&c.newZoom==1){return}if(c.currentZoom==false){c.currentZoom=project.get("currentZoom")}if(c.currentZoom==c.newZoom){return true}if(c.newZoom=="auto"){c.newZoom=0.25}a(".linkToggle").remove();a("#canvas").data("zooming",true);a("#canvasLinks").filter(":visible").hide();if(c.newZoom==1){setZoomedInActions()}else{setZoomedOutActions()}if(c.page!==false&&c.newZoom==1){if(c.currentZoom<c.newZoom&&c.savePosition!=false){a("#canvas").data("lastOutX",-parseInt(a("#viewport").get(0).scrollLeft)).data("lastOutY",-parseInt(a("#viewport").get(0).scrollTop))}zoomInAndCenterOnPage(c.page,c.currentZoom,c.newZoom,c.duration)}else{if(c.centerX!==false&&c.centerY!==false&&c.newZoom==1){zoomInOnPoint(c.centerX,c.centerY,c.currentZoom,c.newZoom,c.duration)}else{if(c.centering!=false){zoomOutToAllPages(c.centering,c.duration)}else{if(c.centerX!==false&&c.centerY!==false){zoomOutToLastPoint(c.currentZoom,c.newZoom,c.duration,e)}}}}return this}})})(jQuery);(function(d){d.tools=d.tools||{version:"@VERSION"};d.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0.5,delay:10,opacity:1,tip:0,position:["top","center"],offset:[0,0],relative:false,cancelDefault:true,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(e,g,f){c[e]=[g,f]}};var c={toggle:[function(e){var f=this.getConf(),g=this.getTip(),h=f.opacity;if(h<1){g.css({opacity:h})}g.show();e.call()},function(e){this.getTip().hide();e.call()}],fade:[function(e){var f=this.getConf();this.getTip().fadeTo(f.fadeInSpeed,f.opacity,e)},function(e){this.getTip().fadeOut(this.getConf().fadeOutSpeed,e)}]};function b(g,i,f){var k=f.relative?g.position().top:g.offset().top,j=f.relative?g.position().left:g.offset().left,l=f.position[0];k-=i.outerHeight()-f.offset[0];j+=g.outerWidth()+f.offset[1];if(/iPad/i.test(navigator.userAgent)){k-=d(window).scrollTop()}var e=i.outerHeight()+g.outerHeight();if(l=="center"){k+=e/2}if(l=="bottom"){k+=e}l=f.position[1];var h=i.outerWidth()+g.outerWidth();if(l=="center"){j-=h/2}if(l=="left"){j-=h}return{top:k,left:j}}function a(h,j){var r=this,g=h.add(r),o,f=0,q=0,m=h.attr("title"),i=h.attr("data-tooltip"),s=c[j.effect],n,l=h.is(":input"),e=l&&h.is(":checkbox, :radio, select, :button, :submit"),k=h.attr("type"),p=j.events[k]||j.events[l?(e?"widget":"input"):"def"];if(!s){throw'Nonexistent effect "'+j.effect+'"'}p=p.split(/,\s*/);if(p.length!=2){throw"Tooltip: bad events configuration for "+k}h.bind(p[0],function(t){clearTimeout(f);if(j.predelay){q=setTimeout(function(){r.show(t)},j.predelay)}else{r.show(t)}}).bind(p[1],function(t){clearTimeout(q);if(j.delay){f=setTimeout(function(){r.hide(t)},j.delay)}else{r.hide(t)}});if(m&&j.cancelDefault){h.removeAttr("title");h.data("title",m)}d.extend(r,{show:function(u){if(!o){if(i){o=d(i)}else{if(j.tip){o=d(j.tip).eq(0)}else{if(m){o=d(j.layout).addClass(j.tipClass).appendTo(document.body).hide().append(m)}else{o=h.next();if(!o.length){o=h.parent().next()}}}}if(!o.length){throw"Cannot find tooltip for "+h}}if(r.isShown()){return r}o.stop(true,true);var v=b(h,o,j);if(j.tip){o.html(h.data("title"))}u=u||d.Event();u.type="onBeforeShow";g.trigger(u,[v]);if(u.isDefaultPrevented()){return r}v=b(h,o,j);o.css({position:"absolute",top:v.top,left:v.left});n=true;s[0].call(r,function(){u.type="onShow";n="full";g.trigger(u)});var t=j.events.tooltip.split(/,\s*/);if(!o.data("__set")){o.bind(t[0],function(){clearTimeout(f);clearTimeout(q)});if(t[1]&&!h.is("input:not(:checkbox, :radio), textarea")){o.bind(t[1],function(w){if(w.relatedTarget!=h[0]){h.trigger(p[1].split(" ")[0])}})}o.data("__set",true)}return r},hide:function(t){if(!o||!r.isShown()){return r}t=t||d.Event();t.type="onBeforeHide";g.trigger(t);if(t.isDefaultPrevented()){return}n=false;c[j.effect][1].call(r,function(){t.type="onHide";g.trigger(t)});return r},isShown:function(t){return t?n=="full":n},getConf:function(){return j},getTip:function(){return o},getTrigger:function(){return h}});d.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(u,t){if(d.isFunction(j[t])){d(r).bind(t,j[t])}r[t]=function(v){if(v){d(r).bind(t,v)}return r}})}d.fn.tooltip=function(e){var f=this.data("tooltip");if(f){return f}e=d.extend(true,{},d.tools.tooltip.conf,e);if(typeof e.position=="string"){e.position=e.position.split(/,?\s/)}this.each(function(){f=new a(d(this),e);d(this).data("tooltip",f)});return e.api?f:this}})(jQuery);var colorPicker={getWidgetForCP:function(){var c={};function b(){var e=$(this);var f=e.attr("id");var d=widget.get(f);if(d.bgc){$.extend(true,c,d);return false}}var a=propInspectorCtrl.shapeWidgets;a.each(b);return c},getTextWidgetCP:function(){var b=propInspectorCtrl.textWidgets.last();var a=widget.get(b.attr("id"));return a},segmentRootId:false,getSelectedOnly:function(d){function b(){var f=$(this);var g=f.attr("id");var e=widget.get(g);if(e.seg){if(e.bgc){a=a.add(f);colorPicker.segmentRootId=g}}else{if(e.segment&&(e.of==colorPicker.segmentRootId)){if(f.hasClass("ui-selected")){a=a.add(f)}else{a=a.not(f)}}else{a=a.add(f)}}}var a=$([]);var c=d||propInspectorCtrl.shapeWidgets;c.each(b);return a},clickOnSelectorEdge:function(d){var a=propInspector.pickerWidth/2;var c=Math.abs(d.offsetX-a);var b=Math.abs(d.offsetY-a);var f=Math.sqrt((c*c)+(b*b));if(f>a){if(d.originalEvent.target.id=="hslSelector"){colorPicker.hslClick(d)}else{if(d.originalEvent.target.id=="rgbSelector"){colorPicker.rgbClick(d)}}}else{return}},tempFontColor:false,getTextColor:function(){var a=colorPicker.getTextWidgetCP();var c=colorPicker.getFontColorFromCSS(a.ts);colorPicker.tempFontColor=c;var b=utils.toHSL(c);colorPicker.updateDisplay(b);colorPicker.updateBackupColor(c);$("#textColor").css("background-color",c)},extractTextColor:function(c){var d=$(c).attr("id");var a=widget.get(d);var b=colorPicker.getFontColorFromCSS(a.ts);return b},getFontColorFromCSS:function(c){var e=c.split(/;/);for(var b=0;b<e.length;b++){if(e[b].match("color")){var f=b}}var a=e[f];var d=a?a.replace(/"/g,"").replace(/color:/,""):"rgb(0,0,0)";return d},rgbClick:function(b){var a=b.target.id;colorPicker.setActivePickerBorder(a);var c=$("#rainbowColorPicker").offset();var d=colorPicker.getRGBAngle(b.pageX,b.pageY,c.top,c.left);$("#rgbSelector").css({top:d.top,left:d.left});colorPicker.rgbSet(d);colorPicker.applyToWidget(null)},hslClick:function(b){var a=b.target.id;colorPicker.setActivePickerBorder(a);var c=$("#rainbowColorPicker").offset();var d=colorPicker.getHSLAngle(b.pageX,b.pageY,c.top,c.left);$("#hslSelector").css({top:d.top,left:d.left});colorPicker.hslSet(d);colorPicker.applyToWidget(null)},setActivePickerBorder:function(a){$("#rgbSelector, #hslSelector").removeClass("inactiveSelector");if(a=="hslSelector"||a=="hslArea"){$("#rgbSelector").addClass("inactiveSelector")}else{if(a=="rgbSelector"||a=="rgbArea"){$("#hslSelector").addClass("inactiveSelector")}else{if(a=="return"){return}}}},setColorStops:function(e){var a=colorPicker.getWidgetForCP();var d=(propInspector.colorStopNumber)?propInspector.colorStopNumber:0;var c=a.bgc[d];var b=utils.toHSL(c);colorPicker.updateDisplay(b);colorPicker.updateBackupColor(c);return false},changeColorStopSlider:function(c){var d=$(c.target);var a=d.attr("data-colorStop");var b=Math.round(d.attr("value"));$("#gradientStop .colorStopIndicator").eq(a).text(b);colorPicker.applyToWidget(c)},getColorBackground:function(){var a=colorPicker.getWidgetForCP();var c=(a.bgc)?a.bgc[0]:"#000000";var b=utils.toHSL(c);colorPicker.updateDisplay(b);colorPicker.updateBackupColor(c)},getBorderColor:function(){var a=colorPicker.getWidgetForCP();var c=(a.b)?a.b[1]:"#000000";var b=utils.toHSL(c);colorPicker.updateDisplay(b);colorPicker.updateBackupColor(c)},inputFocusTime:0,selectHex:function(){if(new Date().getTime()-colorPicker.inputFocusTime<500){this.select()}},inputHex:function(a){var f=a.target,b=f.selectionStart,d=f.value.match(/[^0-9a-f]*/gi).filter(function(j){return j!==""}),g=f.value.replace(/[^0-9a-f]*/gi,""),c=g.length===3?[g[0],g[0],g[1],g[1],g[2],g[2]].join(""):g;f.value=g;b-=d.length;f.setSelectionRange(b,b);if(!(g.length===3||g.length===6)){return false}var i=utils.toHSL("#"+c);var e=propInspectorCtrl.currentSelection;var h=widget.get(e.attr("id"));colorPicker.updateDisplay(i,g);colorPicker.applyToWidget(null)},colorWheelRadius:79,hslWheelRadius:56,grayWheelRadius:81,colorPickerWidth:93,flatColorArc:20,numDegrees:360,numColors:6,hslLimit:100,currentHSL:{h:false,s:false,l:false},updateDisplay:function(e,d){function r(t){var u=colorPicker.numDegrees/colorPicker.numColors;var w=u-colorPicker.flatColorArc;var v=Math.floor(t.h/u);var x=v*u;if(t.h>x){var x=(t.h*(w/u))+((colorPicker.flatColorArc*v)+(colorPicker.flatColorArc/2))}return x}function q(u){function y(){var I=C/(C-E);var H=(B-E)*I;var G=colorPicker.hslLimit/C;var J=colorPicker.hslLimit-(G*H);return J}function z(){var H=colorPicker.hslLimit/C;var G=(colorPicker.hslLimit-e.s)/H;var I=C/(C-E);var J=(G/I)+E;return J}var E=propInspector.pickerWidth/2;var B=propInspector.pickerWidth;var C=colorPicker.hslWheelRadius-(propInspector.pickerWidth/5);var y=y();if(e.s==0){if(u==0){var x=colorPicker.flatColorArc/2}else{if(u>0&&u<colorPicker.numDegrees){var v=(colorPicker.numDegrees+(2*colorPicker.flatColorArc))/colorPicker.numDegrees;var x=colorPicker.flatColorArc+u/v}else{if(u==colorPicker.numDegrees){var x=colorPicker.numDegrees-(colorPicker.flatColorArc/2)}}}}else{if(e.s>0&&e.s<=y){var x=u}else{if(e.s>y&&e.s<colorPicker.hslLimit){var F=B-E;var D=colorPicker.hslLimit/2;var t=z();var A=(e.l-D)/(t-E);var w=A*F+D;var x=(w*colorPicker.numDegrees)/colorPicker.hslLimit}else{if(e.s==colorPicker.hslLimit){var x=0}}}}return x}function o(){var w=propInspector.pickerWidth/2;var v=colorPicker.hslWheelRadius-(propInspector.pickerWidth/5);if(e.s==0){var z=colorPicker.hslWheelRadius}else{if(e.s>0&&e.s<colorPicker.hslLimit){var u=colorPicker.hslLimit/v;var t=(colorPicker.hslLimit-e.s)/u;var y=v/(v-w);var z=(t/y)+w}else{if(e.s==colorPicker.hslLimit){var z=0}}}return z}var c=0;var f=0;colorPicker.currentHSL.h=(e.h!==false)?e.h:colorPicker.currentHSL.h;colorPicker.currentHSL.s=(e.s!==false)?e.s:colorPicker.currentHSL.s;colorPicker.currentHSL.l=(e.l!==false)?e.l:colorPicker.currentHSL.l;e=colorPicker.currentHSL;var j={top:0,left:0};var m=parseInt($("#rgbSelector").css("width"));var s=parseInt($("#rgbSelector").css("height"));var b=r(e)*2*Math.PI/colorPicker.numDegrees;var i=-(colorPicker.colorWheelRadius*Math.cos(b));var a=colorPicker.colorWheelRadius*Math.sin(b);i=colorPicker.colorPickerWidth+c-(s/2)+i;a=colorPicker.colorPickerWidth+f-(m/2)+a;var h=e.l*colorPicker.numDegrees/colorPicker.hslLimit;var l=q(h);var k=(l*(Math.PI*2))/colorPicker.numDegrees;var p=o();var n=-(p*Math.cos(k));var g=p*Math.sin(k);n=colorPicker.colorPickerWidth+c-(s/2)+n;g=colorPicker.colorPickerWidth+f-(m/2)+g;$("#rgbSelector").css({top:i,left:a});$("#hslSelector").css({top:n,left:g});$("#colorHexValue").val(d||utils.hslToHex(e));$("#bgColorDisplay").css("background-color","hsl("+e.h+","+e.s+"%,"+e.l+"%)");$("#hueSaturationBase").css("background-image","-webkit-radial-gradient(center center, hsl("+e.h+", 100%, 50%),hsl(0,0%,50%) 80%, hsl(0,0%,50%) 100%)").css("background-image","-moz-radial-gradient(center center, hsl("+e.h+", 100%, 50%),hsl("+e.h+", 100%, 50%) 20%, hsl(0,0%,50%) 80%, hsl(0,0%,50%) 100%)")},updateBackupColor:function(a){$("#bgColorOriginal").css("background-color",a)},dragEl:false,pickerWidth:false,pickerRadius:false,cpCenter:false,activeWidget:false,rainbowColorDivPosition:false,dragStart:function(b){colorPicker.cpCenter=colorPicker.cpCenter||$("#rainbowColorPicker").offset();colorPicker.dragEl=colorPicker.dragEl||$(this);var a=b.target.id;colorPicker.setActivePickerBorder(a)},getRGBAngle:function(a,l,g,h){var b=a-h-(propInspector.pickerWidth/2)-colorPicker.colorWheelRadius;var k=l-g-(propInspector.pickerWidth/2)-colorPicker.colorWheelRadius;var c=Math.sqrt(b*b+k*k);var i=colorPicker.colorWheelRadius/c;var e=propInspector.pickerRadius+(b*i)-(propInspector.pickerWidth/2);var f=propInspector.pickerRadius+(k*i)+propInspector.rainbowColorDivPosition.top-(propInspector.pickerWidth/2);var j=Math.asin(b/c);var d=(180/Math.PI)*j;if(l>g+colorPicker.colorWheelRadius+(propInspector.pickerWidth/2)){d=180-d}else{if(a<h+colorPicker.colorWheelRadius+(propInspector.pickerWidth/2)){d=360+d}}if(d>360){var d=d-colorPicker.numDegrees}return{top:f,left:e,angle:d}},rgbDrag:function(a){var b=colorPicker.getRGBAngle(a.pageX,a.pageY,colorPicker.cpCenter.top,colorPicker.cpCenter.left);colorPicker.dragEl.data().draggable.position.top=b.top;colorPicker.dragEl.data().draggable.position.left=b.left;colorPicker.rgbSet(b);$("#colorPicker, #lightDarkOverlay").css("cursor","none")},rgbSet:function(d){var b=a(d.angle);function a(l){var h=colorPicker.numDegrees/colorPicker.numColors;var k=h-colorPicker.flatColorArc;var i=Math.floor(l/h)*h;var e=i+h-(colorPicker.flatColorArc/2);var j=i+(colorPicker.flatColorArc/2);if(l>e&&l<(i+h)){var g=i+h}else{if(l>i&&l<j){var g=i}else{var f=((h/k)*(colorPicker.flatColorArc/2))+(i/2);var g=(h/k)*l-f}}return g}var c=lValue=false;if(colorPicker.currentHSL.s===0){c=colorPicker.hslLimit;lValue=50}colorPicker.updateDisplay({h:b,s:c,l:lValue})},rgbDragStop:function(a){colorPicker.rgbDrag(a);colorPicker.dragEl=false;colorPicker.cpCenter=false;colorPicker.applyToWidget(null);$("#colorPicker, #lightDarkOverlay").css("cursor","default")},hslDrag:function(a){var b=colorPicker.getHSLAngle(a.pageX,a.pageY,colorPicker.cpCenter.top,colorPicker.cpCenter.left);colorPicker.dragEl.data().draggable.position.top=b.top;colorPicker.dragEl.data().draggable.position.left=b.left;colorPicker.hslSet(b);$("#colorPicker, #lightDarkOverlay").css("cursor","none")},getHSLAngle:function(a,l,g,h){var b=a-h-colorPicker.hslWheelRadius-(3*propInspector.pickerWidth/2)+0.01;var k=l-g-colorPicker.hslWheelRadius-(3*propInspector.pickerWidth/2)+0.01;var c=Math.sqrt(b*b+k*k);var i=colorPicker.hslWheelRadius/c;var j=Math.asin(b/c);var d=Math.round((180/Math.PI)*j);var e=propInspector.pickerRadius+(b*i)+$("#rainbowColorPicker").position().left-(propInspector.pickerWidth/2);var f=propInspector.pickerRadius+(k*i)+$("#rainbowColorPicker").position().top-(propInspector.pickerWidth/2);if(c<colorPicker.hslWheelRadius){var f=propInspector.pickerRadius+k-(propInspector.pickerWidth/2);var e=propInspector.pickerRadius+b-(propInspector.pickerWidth/2)}if(l>(g+colorPicker.hslWheelRadius+(3/2*propInspector.pickerWidth))){d=(colorPicker.numDegrees/2)-d}else{if(a<(h+colorPicker.hslWheelRadius+(3/2*propInspector.pickerWidth))){d=colorPicker.numDegrees+d}}if(d>360){var d=d-colorPicker.numDegrees}var d=Math.abs(d);return{top:f,left:e,angle:d,hypot:c}},hslSet:function(h){function a(){if(h.hypot<c){var m=colorPicker.hslLimit/2}else{if(h.hypot>=c&&h.hypot<g){var l=colorPicker.hslLimit/2;var j=h.angle*colorPicker.hslLimit/colorPicker.numDegrees;var i=(j-l)/(g-c);var m=(i*(h.hypot-c))+l}else{if(h.hypot>=g&&h.hypot<b){var m=h.angle*colorPicker.hslLimit/colorPicker.numDegrees}else{if(h.hypot>=b){if(h.angle<colorPicker.flatColorArc){var m=0}else{if(h.angle>=colorPicker.flatColorArc&&h.angle<=(colorPicker.numDegrees-colorPicker.flatColorArc)){var n=(colorPicker.numDegrees+(2*colorPicker.flatColorArc))/colorPicker.numDegrees;var k=(h.angle-colorPicker.flatColorArc)*n;var m=colorPicker.hslLimit*k/colorPicker.numDegrees}else{if(h.angle>(colorPicker.numDegrees-colorPicker.flatColorArc)){var m=colorPicker.hslLimit}}}}}}}return m}function e(){l=colorPicker.hslLimit;if(h.hypot>=c&&h.hypot<b){var k=b/(b-c);var j=(h.hypot-c)*k;var i=colorPicker.hslLimit/b;var l=colorPicker.hslLimit-(i*j)}if(h.hypot>=b){var l=0}return l}var c=propInspector.pickerWidth/2;var g=propInspector.pickerWidth;var b=colorPicker.hslWheelRadius-(propInspector.pickerWidth/5);var d=a();var f=e();colorPicker.updateDisplay({h:false,s:f,l:d})},hslDragStop:function(a){colorPicker.hslDrag(a);colorPicker.dragEl=false;colorPicker.cpCenter=false;colorPicker.applyToWidget(null);$("#colorPicker, #lightDarkOverlay").css("cursor","default")},populateAdvancedGradient:function(){var b=colorPicker.getWidgetForCP();if(b.bg=="s"){colorPicker.colorStopNumber=1;return false}else{if(b.bgc[0]==="rgba(0,0,0,0.0)"&&b.bgc[1]=="rgba(0,0,0,0.0)"){colorPicker.colorStopNumber=1;return false}else{var a=(b["bgd"])?$.merge([],b["bgd"]):[1];var c=(b["bgc"])?$.merge([],b["bgc"]):["#fff"]}}$("#gradientTypeSelector").val(b.bg);colorPicker.removeColorStop(null,"all",true);colorPicker.addColorStops(null,c,a,true);return false},redraw:function(d){var a=widget.get(d);var c=$("#"+d);var b=widget._setTMPLVars(d,a,false,false);b.absTLWH=[parseInt(c.css("top")),parseInt(c.css("left")),c.outerWidth(),c.outerHeight()];widget._drawCanvasOrImage(c,b)},sortApplyColors:function(b){var a=$(b.target).css("background-color");colorPicker.applyToWidget(null,false,a)},getCurrentColor:"rgb(0,0,0)",applyToWidget:function(g,i,h){function b(){c=fluid.command.create("setBackgroundColor",{id:j(colorPicker.getSelectedOnly(a)),color:d,event:$.extend({},g)})}var a=colorPicker.getSelectedOnly();var d=(h)?h:$("#bgColorDisplay").css("background-color");var c;function j(e){return e.map(function(){return $(this).attr("id")}).get()}if(propInspector.lastAction=="showTextColor"){var a=propInspectorCtrl.textWidgets;c=fluid.command.create("setColor",{id:j(a),color:d})}else{if(propInspector.lastAction=="showFlatColor"||propInspector.lastAction=="showGradientGallery"||propInspector.lastAction=="showColorStopEditor"){b()}else{if(propInspector.lastAction=="showAdvancedGradientEditor"){var l=a.first().attr("id");var f=widget.get(l);if(f.bgc){if(f.bgc.length>0){colorPicker.getCurrentColor=f.bgc[0]}}d=colorPicker.getCurrentColor;if(g){var k=$(g.target);if(k.hasClass("gradientStopSlider")){if(g.type=="mouseup"){b()}else{colorPicker.applyToBackground(g,d,a,d)}}else{b()}}else{b()}}else{if(propInspector.lastAction=="showBorder"){c=fluid.command.create("setBorderColor",{id:j(colorPicker.getSelectedOnly(a)),color:d})}}}}if(c){c.dispatchTo("fluid.controllers.widget",!i)}},applyToBackground:function(h,g,c,f){function b(){var y=$(this).attr("id");var u=$.extend(true,{},widget.get(y));if($(this).hasClass("rootWidget")&&!u.bg&&u.seg){return true}if(!u.bg&&u.tc){return}if(propInspector.lastAction=="showFlatColor"){var w=(u.bgc)?u.bgc[0]:"rgba(0,0,0,0.50)";var n=colorPicker.addAlpha(w,a,d);var l=n.split();delete u["bgd"];widget.set({bg:"c",bgc:l},y)}else{if(propInspector.lastAction=="showAdvancedGradientEditor"){var o=$("#gradientTypeSelector").val();var k=new Array(colorPicker.colorStopAmount);var x=new Array(colorPicker.colorStopAmount);var w=f;for(var q=0;q<colorPicker.colorStopAmount;q++){var t=$("#gradientStop .colorPickerTrigger").eq(q).css("background-color");k[q]=colorPicker.addAlpha(w,t,d);x[q]=$("#gradientStop .gradientStopSlider").eq(q).attr("value")/100}widget.set({bg:o,bgc:k,bgd:x},y)}else{if(propInspector.lastAction=="showGradientGallery"){var v=$.parseJSON($(h.originalEvent.target).attr("data-color"));var r=$.extend(true,{},v);var w=(u.bgc)?u.bgc[0]:"rgb(0,0,0)";if(v.bgc[0]=="rgba(0,0,0,0.0)"){r=r}else{for(var p=0;p<v.bgc.length;p++){var s=v.bgc[p];var e=utils.hex2rgba(s);r.bgc[p]=colorPicker.addAlpha(w,e,d)}}widget.set(r,y);var m=widget.get(y)}else{if(propInspector.lastAction=="showColorStopEditor"){var l=$.merge([],u.bgc);var w=l[propInspector.colorStopNumber];var n=colorPicker.addAlpha(w,a);l[propInspector.colorStopNumber]=n;widget.set({bgc:l},y)}}}}colorPicker.redraw(y)}c=c||colorPicker.getSelectedOnly();var a=g||$("#bgColorDisplay").css("background-color");var d=true;c.each(b);propInspectorCtrl.updateBackgroundBorderInfo();return false},applyToBorder:function(e,d){function c(g,f,k){var i=g[1];var j=colorPicker.addAlpha(i,a);g[1]=j;var h={};h[k]=g;widget.set(h,f);return j}function b(){var h=$(this).attr("id");var g=widget.get(h);if($(this).hasClass("rootWidget")&&!g.b){return true}var j=$.extend(true,{},g);if(j.b||j.bbs||j.bts||j.bms||j.bls||j.brs||j.bs){var i=["b","bs","bts","bls","bms","bbs","brs"];for(var l=0;l<i.length;l++){if(j[i[l]]){var f=j[i[l]];var k=c(f,h,i[l])}}}else{var f=[0,"#000",0];var k=c(f,h)}colorPicker.redraw(h)}var a=e||$("#bgColorDisplay").css("background-color");d=d||colorPicker.getSelectedOnly();d.each(b);propInspectorCtrl.updateBackgroundBorderInfo();return false},addAlpha:function(g,d,b){var g=(g)?g:"rgba(0,0,0,1.0)";var a=g.match(/rgba/gi);if(a==null){var c=d}else{var i=d.match(/\d+/g);var h=g.match(/\d+/g);var f=h.length;var e=1;if(f==4){e=h[3]}else{if(f==5){e=h[3]+"."+h[4]}}if(b){e=(parseFloat(e)==0)?1:e}var c="rgba("+i[0]+","+i[1]+","+i[2]+","+e+")"}return c},tempTextId:false,applyToText:function(b,f){function d(i,h,k){var l=i.ts;var j=g(l);widget.set({ts:j},h);$(k).find(".widgetText").attr("style",j);c.css("background-color",e)}function g(o){var n=o.split(/;/);for(var l=0;l<n.length-1;l++){if(n[l].match("color")){var q=l;n[q]="color:"+e}}var k=new Array();for(var m=0;m<n.length-1;m++){k[m]=n[m]+";"}var h=k.toString();var p=h.replace(/;,/gi,";");return p}function a(){var i=$(this).attr("id");var h=widget.get(i);var j=this;if("ts" in h){d(h,i,j)}}var c=$("#textColor");var e=b||$("#bgColorDisplay").css("background-color");f.each(a);var f=f||propInspectorCtrl.textWidgets;c.css("background-color",e);return false},removeColorStop:function(b,a,c){if(a=="all"){a=$("#gradientStop .colorStopOption")}a.remove();colorPicker.setColorStopProperties(b,c)},addColorStops:function(d,a,g,f){if(!a){a=["#000"]}if(!g){g=[1]}for(var b=0;b<a.length;b++){var c=Math.round(g[b]*100);$("#tmplGradientColorStop").tmpl({bgColor:a[b],bgIndex:g[b],val:c}).appendTo("#gradientStop")}colorPicker.setColorStopProperties(d,f)},colorStopAmount:1,setColorStopProperties:function(i,l){var c=$("#gradientStop .colorStopOption");var m=c.index();var h=m+1;colorPicker.colorStopAmount=h;var d=$("#gradientStop .colorStopButton");var a=$("#gradientStop .gradientStopSlider");var k=$("#gradientStop .colorStopDelete");if(!l&&(h==2)){var b=parseInt(a.eq(0).val());if(b==100){var f=50;a.eq(0).val(f);$("#gradientStop .colorStopIndicator").eq(0).text(f)}}for(var g=0;g<h;g++){c.eq(g).attr("data-colorStop",g);d.eq(g).attr("data-colorStop",g);a.eq(g).attr("data-colorStop",g);k.eq(g).attr("data-colorStop",g)}colorPicker.applyToWidget(null,l)},extractBorderColor:function(c){var a=widget.get(c);var b=a.b[1]||"#333";return b}};(function(a){a.fn.extend({simulate:function(c,b){return this.each(function(){var d=a.extend({},a.simulate.defaults,b||{});new a.simulate(this,c,d)})}});a.simulate=function(d,c,b){this.target=d;this.options=b;if(/^drag$/.test(c)){this[c].apply(this,[this.target,b])}else{this.simulateEvent(d,c,b)}};a.extend(a.simulate.prototype,{simulateEvent:function(e,d,c){var b=this.createEvent(d,c);this.dispatchEvent(e,d,b,c);return b},createEvent:function(c,b){if(/^mouse(over|out|down|up|move)|(dbl)?click$/.test(c)){return this.mouseEvent(c,b)}else{if(/^key(up|down|press)$/.test(c)){return this.keyboardEvent(c,b)}}},mouseEvent:function(f,d){var c;var g=a.extend({bubbles:true,cancelable:(f!="mousemove"),view:window,detail:0,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,button:0,relatedTarget:undefined},d);var b=a(g.relatedTarget)[0];if(a.isFunction(document.createEvent)){c=document.createEvent("MouseEvents");c.initMouseEvent(f,g.bubbles,g.cancelable,g.view,g.detail,g.screenX,g.screenY,g.clientX,g.clientY,g.ctrlKey,g.altKey,g.shiftKey,g.metaKey,g.button,g.relatedTarget||document.body.parentNode)}else{if(document.createEventObject){c=document.createEventObject();a.extend(c,g);c.button={0:1,1:4,2:2}[c.button]||c.button}}return c},keyboardEvent:function(d,c){var b;var g=a.extend({bubbles:true,cancelable:true,view:window,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:0,charCode:0},c);if(a.isFunction(document.createEvent)){try{b=document.createEvent("KeyEvents");b.initKeyEvent(d,g.bubbles,g.cancelable,g.view,g.ctrlKey,g.altKey,g.shiftKey,g.metaKey,g.keyCode,g.charCode)}catch(f){b=document.createEvent("Events");b.initEvent(d,g.bubbles,g.cancelable);a.extend(b,{view:g.view,ctrlKey:g.ctrlKey,altKey:g.altKey,shiftKey:g.shiftKey,metaKey:g.metaKey,keyCode:g.keyCode,charCode:g.charCode})}}else{if(document.createEventObject){b=document.createEventObject();a.extend(b,g)}}if(a.browser.msie||a.browser.opera){b.keyCode=(g.charCode>0)?g.charCode:g.keyCode;b.charCode=undefined}return b},dispatchEvent:function(d,c,b){if(d.dispatchEvent){d.dispatchEvent(b)}else{if(d.fireEvent){d.fireEvent("on"+c,b)}}return b},drag:function(c){var h=this,b=this.findCenter(this.target),j=this.options,g=Math.floor(b.x),f=Math.floor(b.y),k=j.dx||0,i=j.dy||0,e=this.target;var d={clientX:g,clientY:f};this.simulateEvent(e,"mousedown",d);d={clientX:g+1,clientY:f+1};this.simulateEvent(document,"mousemove",d);d={clientX:g+k,clientY:f+i};this.simulateEvent(document,"mousemove",d);this.simulateEvent(document,"mousemove",d);this.simulateEvent(e,"mouseup",d)},findCenter:function(b){var b=a(this.target),c=b.offset();return{x:c.left+b.outerWidth()/2,y:c.top+b.outerHeight()/2}}});a.extend(a.simulate,{defaults:{speed:"sync"},VK_TAB:9,VK_ENTER:13,VK_ESC:27,VK_PGUP:33,VK_PGDN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40})})(jQuery);var propInspector={init:function(){$("#tmplColorWheel").tmpl().appendTo($("#flatEditorView"));propInspector.masterElements=$(".masterElementsHidable");propInspector.hidablePropertyInspector=$(".piHidable");propInspector.shapeProps=$(".shapeProps");propInspector.textProps=$(".textProps");propInspector.backgroundBorderHolder=$("#backgroundBorder");propInspector.backgroundContainers=$("#captionBackground,#shapeBackground");propInspector.borderContainers=$("#captionBorder,#shapeBorder");propInspector.borderContainers.css({"pointer-events":"auto","opacity":1});propInspector.shapeBorderControl=$("#shapeBorderControl");propInspector.increaseBorderSize=$("#shapeBorderControl .increaseNumber").filter(".shapeBorderBtn");propInspector.increaseRadiusSize=$("#shapeBorderControl .increaseNumber").filter(".shapeRadiusBtn");propInspector.shapeSizeProperties=$("#shapeSizeProperties");propInspector.shapeOpacityControl=$("#shapeOpacityControl");propInspector.heightProps=$("#widgetHeight");propInspector.heightProps.css({"pointer-events":"auto","opacity":1});propInspector.widthProps=$("#widgetWidth");propInspector.widthProps.css({"pointer-events":"auto","opacity":1});propInspector.widgetBorderRadius=$("#widgetBorderRadius");propInspector.widgetBorderRadius.css({"pointer-events":"auto","opacity":1});propInspector.flatColorView=$(".flatColorView");propInspector.gradientGallery=$(".gradientGallery");propInspector.colorStopEditor=$(".colorStopEditor");propInspector.advancedGradientEditor=$(".advancedGradientEditor");propInspector.textColorPicker=$(".textColorPicker");propInspector.borderColor=$(".borderColor");propInspector.defaultColorFill="-linear-gradient(45deg, transparent,transparent 44%,#f00 45%,#f00 55%,transparent 56%,transparent)";propInspector.defaultColor="background:-webkit"+propInspector.defaultColorFill+";background:-moz"+propInspector.defaultColorFill+";";$(".piClickable").click(propInspector.toggle);propInspector.initGradientGallery();propInspector.pickerWidth=parseInt($("#rgbSelector").css("width"));propInspector.pickerRadius=parseInt($("#rainbowColorPicker").css("width"))/2;propInspector.rainbowColorDivPosition=$("#rainbowColorPicker").position();$("#rgbSelector").draggable({start:colorPicker.dragStart,drag:colorPicker.rgbDrag,stop:colorPicker.rgbDragStop});$("#hslSelector").draggable({start:colorPicker.dragStart,drag:colorPicker.hslDrag,stop:colorPicker.hslDragStop});$("#rgbSelector, #hslSelector").click(colorPicker.clickOnSelectorEdge);$("#colorHexValue").on("focus",function(a){this.select();colorPicker.inputFocusTime=a.timeStamp}).click(colorPicker.selectHex).on("input",colorPicker.inputHex);$("#rgbArea").click(colorPicker.rgbClick);$("#hslArea").click(colorPicker.hslClick);$("#cPickerOptions").click(colorPicker.applyToWidget);$("#gradientTypeSelector").change(colorPicker.applyToWidget);$("#addColorStop").click(colorPicker.addColorStops);$("#gradientStop").click(propInspector.gradientStopClick);$("#bgColorDisplay, #bgColorOriginal").click(colorPicker.sortApplyColors);$(".gradientStopSlider").live("change",colorPicker.changeColorStopSlider);$(".gradientStopSlider").live("mouseup",colorPicker.changeColorStopSlider)},colorStopNumber:false,gradientStopClick:function(d){var f=$(d.originalEvent.target);var c=f.parent(".colorStopOption");if(f.hasClass("colorStopButton")){propInspector.colorStopNumber=f.attr("data-colorStop");var a="colorStopButton";propInspector.toggle(null,a)}else{if(f.hasClass("colorStopDelete")){var b=$("#gradientStop .colorStopOption").index();if(b>0){colorPicker.removeColorStop(null,c)}}}},initGradientGallery:function(){var b=$([]);var f=["(rgba 0,0,0,0.0),(rgba 0,0,0,0.0))","radial-gradient(circle, #e6e6e6,#fafafa)","linear-gradient(#FBFBFB,#B9B9B9)","radial-gradient(circle, #F0F0F9,#A8A8B1)","linear-gradient(rgb(221,221,223),rgb(221,221,223) 15%,rgb(206,207,209) 49%,rgb(184,186,188) 50%,rgb(188,190,193))","radial-gradient(circle, #ABABAB,#7B7B7B)","linear-gradient(#A4A4A4,#848484)","linear-gradient(rgb(85,89,96),rgb(38,44,53) 49%,rgb(20,29,38) 50%,rgb(39,45,55))","linear-gradient(rgb(217,130,136),rgb(207,86,96) 49%,rgb(188,19,32) 50%,rgb(188,19,32))","linear-gradient(left, #B03247,#CB3157)","linear-gradient(left, #C55746,#E45D40)","linear-gradient(-45deg, #EF7165,#E94C3D,#E31E27)","linear-gradient(-45deg, #F9A665,#F68C3E,#F26D20)","linear-gradient(#E4D0A0,#EFCD64 49%,#EFBD22 50%,#F6DC23)","linear-gradient(-45deg, #BBD87D,#8EBF3F)","linear-gradient(#79BE80,#31AB3B 49%,#009E10 50%,#008F0B)","linear-gradient(+45deg, #84C185,#369946)","linear-gradient(left, #3E91A3,#49A9B9)","linear-gradient(left, #277EDF,#3691EC)","radial-gradient(circle, #0298DB,#065A9D)","linear-gradient(rgb(116,153,232),rgb(54,110,223) 49%,rgb(34,96,221) 50%,rgb(35,98,221))","linear-gradient(rgb(130,158,188),rgb(90,125,166) 49%,rgb(70,103,151) 50%,rgb(71,104,153))","radial-gradient(circle, #9CBDD3,#657E8F)","linear-gradient(-45deg, #6D90B3,#306393,#12477F)","linear-gradient(left, #6031B1,#6F3CBD)"];var e=[{bg:"l",bgc:["rgba(0,0,0,0.0)","rgba(0,0,0,0.0)"],bgd:[0,1]},{bg:"r",bgc:["#e6e6e6","#fafafa"],bgd:[0,1]},{bg:"l",bgc:["#FBFBFB","#B9B9B9"],bgd:[0,1]},{bg:"r",bgc:["#F0F0F9","#A8A8B1"],bgd:[0,1]},{bg:"l",bgc:["rgb(221,221,223)","rgb(221,221,223)","rgb(206,207,209)","rgb(184,186,188)","rgb(188,190,193)"],bgd:[0,0.15,0.49,0.5,1]},{bg:"r",bgc:["#ABABAB","#7B7B7B"],bgd:[0,1]},{bg:"l",bgc:["#A4A4A4","#848484"],bgd:[0,1]},{bg:"l",bgc:["rgb(85,89,96)","rgb(38,44,53)","rgb(20,29,38)","rgb(39,45,55)"],bgd:[0,0.49,0.5,1]},{bg:"l",bgc:["rgb(217,130,136)","rgb(207,86,96)","rgb(188,19,32)","rgb(188,19,32)"],bgd:[0,0.49,0.5,1]},{bg:"ld2",bgc:["#EF7165","#E94C3D","#E31E27"],bgd:[0,0.5,1]},{bg:"lrl",bgc:["#C55746","#E45D40"],bgd:[0,1]},{bg:"ld2",bgc:["#EF7165","#E94C3D","#E31E27"],bgd:[0,0.5,1]},{bg:"ld2",bgc:["#F9A665","#F68C3E","#F26D20"],bgd:[0,0.5,1]},{bg:"l",bgc:["#E4D0A0","#EFCD64","#EFBD22","#F6DC23"],bgd:[0,0.49,0.5,1]},{bg:"ld2",bgc:["#BBD87D","#8EBF3F"],bgd:[0,1]},{bg:"l",bgc:["#79BE80","#31AB3B","#009E10","#008F0B"],bgd:[0,0.49,0.5,1]},{bg:"ld",bgc:["#84C185","#369946"],bgd:[0,1]},{bg:"lrl",bgc:["#3E91A3","#49A9B9"],bgd:[0,1]},{bg:"lrl",bgc:["#277EDF","#3691EC"],bgd:[0,1]},{bg:"r",bgc:["#0298DB","#065A9D"],bgd:[0,1]},{bg:"l",bgc:["rgb(116,153,232)","rgb(54,110,223)","rgb(34,96,221)","rgb(35,98,221)"],bgd:[0,0.49,0.5,1]},{bg:"l",bgc:["rgb(130,158,188)","rgb(90,125,166)","rgb(70,103,151)","rgb(71,104,153)"],bgd:[0,0.49,0.5,1]},{bg:"r",bgc:["#9CBDD3","#657E8F"],bgd:[0,1]},{bg:"ld",bgc:["#6D90B3","#306393","#12477F"],bgd:[0,0.5,1]},{bg:"lrl",bgc:["#6031B1","#6F3CBD"],bgd:[0,1]}];for(var c=0;c<f.length;c++){var a=JSON.stringify(e[c]);var d={color:"-webkit-"+f[c],color3:"-moz-"+f[c],color2:a,size:36};b=b.add($("#tmplSwatchBox").tmpl(d))}b.appendTo($("#gradientColorPicker"))},removeInputFocus:function(){$("#colorHexValue").blur();propInspector.masterElements.find(".numberInput").blur()},lastAction:false,menuButtonActions:{menuExpander:{to:"showShapeInspector",alsoFrom:["showGradientGallery","showBorder","showFlatColor","showColorStopEditor","showAdvancedGradientEditor","showBackground"],from:"hideInspectors"},textMenuExpander:{to:"showTextInspector",from:"hideInspectors"},shapeBackground:{to:"showBackground",alsoFrom:["showGradientGallery","showFlatColor","showColorStopEditor","showAdvancedGradientEditor"],from:"showShapeInspector"},shapeBorder:{to:"showBorder",from:"showShapeInspector"},textColor:{to:"showTextColor",from:"showTextInspector"},cgpButton:{to:"showGradientGallery",alsoFrom:["showAdvancedGradientEditor"],from:"showFlatColor"},swatchEdit:{to:"showAdvancedGradientEditor"},backButton:{to:"showGradientGallery",alsoFrom:["showColorStopEditor"],from:"showAdvancedGradientEditor"},captionBackground:{to:"showShapeInspector"},captionBorder:{to:"showShapeInspector"},colorStopButton:{to:"showColorStopEditor"}},toggle:function(f,a){if(f){var c=(f.target.id)?f.target.id:$(f.target).parent().attr("id")}else{var c=a}if(!propInspector.menuButtonActions[c]){return}var b=$.inArray(propInspector.lastAction,propInspector.menuButtonActions[c].alsoFrom);var d=propInspector.menuButtonActions[c].to;if((d==propInspector.lastAction||b>-1)&&propInspector.menuButtonActions[c].from){d=propInspector.menuButtonActions[c].from}propInspector.showCorrectScreen(d);contextMenu.removeOtherCmMenus(["staticWidgets"])},showCorrectScreen:function(a){propInspector.lastAction=a;propInspector.hidablePropertyInspector.hide();(propInspector[a])();propInspector.position();propInspector.removeInputFocus()},resetPropInspector:function(){propInspector.lastAction="hideInspectors";propInspector.removeInputFocus()},hideInspectors:function(){propInspector.masterElements.hide();propInspector.hidablePropertyInspector.hide()},showTextColor:function(){propInspector.masterElements.show();propInspector.textColorPicker.show();$("#textColor").addClass("pickerOpen");colorPicker.getTextColor()},showBorder:function(){propInspector.masterElements.show();propInspector.removePickerHighlight();$("#shapeBorder").addClass("pickerOpen");propInspector.borderColor.show();propInspectorCtrl.updateBackgroundBorderInfo();colorPicker.getBorderColor()},showBackground:function(){propInspector.masterElements.show();propInspector.removePickerHighlight();$("#shapeBackground").addClass("pickerOpen");var a=propInspectorCtrl.filterBackgroundTypes();propInspector.showCorrectScreen(a)},showFlatColor:function(){propInspector.flatColorView.show();$("#cgpButton").text("Gradient");propInspectorCtrl.updateBackgroundBorderInfo();colorPicker.getColorBackground()},showGradientGallery:function(){propInspector.gradientGallery.show();$("#cgpButton").text("Color");propInspectorCtrl.updateBackgroundBorderInfo()},showAdvancedGradientEditor:function(){propInspector.advancedGradientEditor.show();colorPicker.populateAdvancedGradient()},showColorStopEditor:function(){propInspector.colorStopEditor.show();colorPicker.setColorStops()},showShapeInspector:function(){propInspector.removePickerHighlight();propInspector.masterElements.show();propInspector.shapeProps.show();propInspectorCtrl.updateShapeProps();var a=true;propInspectorCtrl.updateBackgroundBorderInfo(a)},showTextInspector:function(){propInspector.removePickerHighlight();propInspector.masterElements.show();propInspector.textProps.show();propInspectorCtrl.updateTextProps()},removePickerHighlight:function(){$("#textColor, #shapeBorder, #shapeBackground").removeClass("pickerOpen")},position:function(){var b=$("#propInspectors");var a=$("#propertyInspectorBtn, #propertyInspectorBtn2").not(":hidden").position();if(a&&a.left){b.css({top:45,left:a.left-168})}},update:function(d){propInspectorCtrl.saveSelection();var d=d||propInspectorCtrl.currentSelection;if(propInspector.lastAction=="hideInspectors"||d.length==0){return}var c=propInspectorCtrl.filterTextOrShape();if(!c){return}else{var h=$.inArray(propInspector.lastAction,c.showDefaults);if(h>-1){var f=c.showDefaults[h]}else{var f=c.showDefaults[0]}var g=["showGradientGallery","showFlatColor","showBackground","showAdvancedGradientEditor","showColorStopEditor","showTextColor","showBorder"];var b=$.inArray(propInspector.lastAction,g);if(b>-1){if(c.showColorPicker==false){var f=c.showDefaults[0]}else{var a=g[b];var e=$.inArray(a,c.showColorPicker);if(e>-1){var f=c.showColorPicker[e]}else{var f=c.showColorPicker[0]}}}}propInspector.showCorrectScreen(f)}};var contextMenu={buttonCollapsedSize:32,buttonExpandedSize:68,dragStart:function(){$("#contextMenuItems").toggleClass("locked").data("preventClick",true)},dragStop:function(){setTimeout(function(){$("#contextMenuItems").data("preventClick",false)},1)},linkClickDragStart:function(b){var a=$("#cmLink").data("lastClicked")||0;if((new Date()).getTime()>a+600){$("#cmLink2").simulate("mousedown").simulate("mousemove",{clientX:b.clientX,clientY:b.clientY})}$("#cmLink").data("lastClicked",(new Date()).getTime());return false},toggleReplace:function(){},place:function(d){var i=$("#canvasPages .ui-selected");if(d=="hide"||i.length==0){contextMenu.hide();return true}if($("#contextMenuItems").data("open")!==false){contextMenu.open()}if($("#contextMenuItems").hasClass("locked")||d=="dontMovePosition"){var a=parseFloat($("#contextMenu2").css("left"));var h=parseFloat($("#contextMenu2").css("top"));var e=parseFloat($("#contextMenuItems").css("left"))+a;var f=parseFloat($("#contextMenuItems").css("top"))+h;var b=utils.getTLWH("#viewport");if(e<b.width-100&&f<b.height-100){$("#contextMenu2").show();return true}}var c=contextMenu.getCmCoords(i);$("#contextMenu2").show().find("#contextMenuItems").addClass("trans150").css({top:c.top,left:c.left});function g(){$("#contextMenuItems").removeClass("trans150");propInspector.position();staticWidgets.positionMenu();page.displayMenu(false)}setTimeout(g,160)},getCmCoords:function(b){var c=widget.getRoots(b);var f=utils.getBoundingArea(c);var e,d,a=$("#library");e=f.left+170;d=f.top-47;if(f.top<90){d=60;if(f.bottom<$("#viewport").height()/2){d=f.bottom+70}}if(f.left<400){e=550}if(parseInt(a.css("left"))===0){e=a.width()+550}return{left:e,top:d}},hide:function(){$("#contextMenu2").hide();propInspector.hideInspectors();page.displayMenu()},open:function(){function b(q){var p=0;q.each(function(){var s=$(this).attr("id");var r=widget.get(s);if(r.seg||r.segment){p+=1}});return p}page.displayMenu(false);var o=widget.getRoots("#canvasPages .ui-selected");var i=o.length;var n=3;var a={up:-41,left:-44,down:0,right:47};$(".subExpander").not(".open").css({"top":""}).hide();var m=$("#canvasPages .ui-selected");var f=b(o);var k;var j=group.enableGroupBtns(o);$("#contextMenuItems .cm").hide().each(function(){$this=$(this);if(i<2&&$this.hasClass("multiSelectOnly")){return true}if(i>1&&$this.hasClass("singleWidgetOnly")){return true}if($this.hasClass("multiSelectOnly")&&j=="ungroup"){return true}if($this.hasClass("widgGroupOnly")){if(j){if(j==false||j=="ungroup"){return true}}else{return true}}if($this.hasClass("widgUngroupOnly")&&j!="ungroup"){return true}if($this.hasClass("multiSegmentOnly")&&f>1){return true}if($this.hasClass("multiSegmentOnly")){if(j&&j=="ungroup"){return true}}if($this.hasClass("multiSegmentOnly")&&(!widget._isMultiSegment(m.attr("id")))){return true}if($this.hasClass("zAlignOnly")&&(!m.hasClass("rootWidget")||m.hasClass("backgroundWidget"))){return true}if($this.hasClass("replaceGroupOnly")){return true}if($this.hasClass("duplicatableOnly")&&m.hasClass("backgroundWidget")){return true}var q=widget.get(m.attr("id"));if(q.tc&&$this.hasClass("backgroundBorderOnly")){return true}if(!q.bgc&&!q.b&&!q.seg&&!q.upload&&$this.hasClass("backgroundBorderOnly")){return true}if($this.hasClass("uploadOnly")&&q.upload!=="y"){return true}if(q.st=="b"&&$this.hasClass("staticWidgetsOnly")){return true}if((!widget.containsText(m))&&($this.hasClass("textOnly"))){return true}$this.show();var p=$this.find(".icon2");var s;if(p.find(".buttonText").text()==""){s=k||(k=p.width())}else{s=p.width()}var r=n+s+9;var t=s-contextMenu.buttonCollapsedSize;if($this.hasClass("up")){$this.css({top:a.up});a.up-=r}if($this.hasClass("left")){$this.css({left:a.left-t});a.left-=r}if($this.hasClass("down")){$this.css({top:a.down});a.down+=r}if($this.hasClass("right")){$this.css({left:a.right});a.right+=r}});$("#contextMenuItems").data("open",true);propInspector.update();staticWidgets.updateMenu();hint.show("link");var d=document.getElementById("cmAutofitButtons");if(o[0]){var e=storage.get(o[0].id);if(e.upload==="y"){var h=storage.get(document.querySelector(".canvasObject.active").id),g=widgets.summary[e.data].wh,c=document.getElementById("cmFitToPage"),l;if(g[0]<h.width&&g[1]<h.height){c.classList.add("expand");l="Expand to Fit"}else{c.classList.remove("expand");l="Shrink to Fit"}c.setAttribute("title",l);c.setAttribute("alt",l)}}},close:function(){propInspector.resetPropInspector();propInspector.hideInspectors();$("#contextMenuItems div, #contextMenuItems a").not(".up, #hint").css({left:0,top:0});$("#contextMenuItems").data("open",false);$(".subExpander").removeClass("open");contextMenu.closeSubmenu($(".subExpander"));contextMenu.resetButtonsToOriginal(true);page.displayMenu()},markAsLastClicked:function(){if($(this).hasClass("subExpander")){$(this).siblings().not(".subExpander, .lastClicked").removeClass("lastClicked")}else{$(this).siblings().not(this).not(".subExpander").removeClass("lastClicked")}$(this).addClass("lastClicked")},toggleSubmenu:function(){contextMenu.eraseSubmenu(this);if($(this).hasClass("open")){contextMenu.closeSubmenu(this)}else{contextMenu.openSubmenu(this)}return false},openSubmenu:function(b){$(b).addClass("open");var a=0;$(b).parent().children().removeClass("hidden").each(function(){$(this).css("top",a);a+=40});$(b).parent().css("height",a-29);$(b).siblings().show()},closeSubmenu:function(a){var b=$(a).siblings();$(a).removeClass("open").css("top","");b.css("top",0);$(a).parent().css("height","");setTimeout(function(){b.not(".lastClicked").addClass("hidden")},250)},eraseSubmenu:function(a){var b=$(".cm").filter(".left");var c=$([]);b.each(function(){var e=$(this);var g=parseInt(e.css("height"));var f=44;if(g>f){var d=e.children().not(a);c=c.add(d);e.css({height:f})}});c.each(function(){var e=$(this);if(e.hasClass("subExpander")){var d=e.siblings();e.removeClass("open").css("top","");d.css("top",0);e.parent().not(".lastClicked").css("height","");setTimeout(function(){d.not(".lastClicked").addClass("hidden")},250)}})},toggle:function(a){if($("#contextMenuItems").data("preventClick")==true){return false}if($("#contextMenuItems").data("open")){contextMenu.close()}else{contextMenu.open()}},cmZAlign:function(b,a){fluid.command.create("setZOrder",{id:widget.getRoots(".ui-selected").map(function(){return $(this).attr("id")}).get(),dir:a}).dispatchTo("fluid.controllers.widget")},cmZAlign2:function(d,a,c){c=c||$(d.target).parent().attr("id");a=a||widget.getRoots(".ui-selected");var b=null;a.each(function(){obj=$(this);var e=$('[data-lockto="'+obj.attr("id")+'"]');b=obj.parent();if(c=="cmFront"){e.detach().appendTo(b)}else{if(c=="cmBack"){if(b.find(".backgroundWidget").length>0){e.detach().insertAfter(b.find(".backgroundWidget"))}else{var i=account.get("gridStatus");if(i=="on"){e.detach().insertAfter("#gridSquares")}else{if(i=="off"){e.detach().prependTo(b)}}}}else{if(c=="cmFrontOne"){var f=obj.nextAll(".rootWidget").not(".ui-selected").first();if(f.length==0){return false}var h=$('[data-lockto="'+f.attr("id")+'"]').last();e.detach().insertAfter(h)}else{if(c=="cmBackOne"){var g=obj.prevAll(".rootWidget").not(".ui-selected").not("#canvasPages .backgroundWidget").first();if(g.length==0){return false}var h=$('[data-lockto="'+g.attr("id")+'"]').first();e.detach().insertBefore(h)}}}}});if(b!=null){page.orderWidgets(b)}return false},cmAlign:function(b,a){fluid.command.create("align",{id:widget.getRoots(".ui-selected").not(".backgroundWidget").map(function(){return $(this).attr("id")}).get(),dir:a}).dispatchTo("fluid.controllers.widget")},cmAlign2:function(d,a,c){var c=c||$(d.target).parent().attr("id");var a=a||widget.getRoots("#canvasPages .ui-selected").not(".backgroundWidget");var b=utils.getBoundingAreaRelative(a);a.each(function(){var g=null,i=null;var h=$(this);var k=h.attr("id");var f=group.calculateAlign(k,h);switch(c){case"cmAlignLeft":g=parseFloat(h.css("left"))-b.left-f.left;break;case"cmAlignCenter":g=parseFloat(h.css("left"))+(parseFloat(h.outerWidth()))/2-(b.left+b.right)/2;if(f.width>0){g=f.groupLeft+(f.width/2)-(b.right+b.left)/2}break;case"cmAlignRight":g=parseFloat(h.css("left"))+h.outerWidth()-b.right+f.right;break;case"cmAlignTop":i=parseFloat(h.css("top"))-b.top-f.top;break;case"cmAlignMiddle":i=parseFloat(h.css("top"))+(parseFloat(h.outerHeight()))/2-(b.bottom+b.top)/2;if(f.height>0){i=f.groupTop+(f.height/2)-(b.top+b.bottom)/2}break;case"cmAlignBottom":i=parseFloat(h.css("top"))+h.outerHeight()-b.bottom+f.top;break;default:return false}if(g===0&&i===0){return true}var e=$('[data-lockto="'+$(this).attr("id")+'"]');var j=widget.get($(this).attr("id"));e.each(function(){var p=$(this).attr("id");var o=widget.get(p);var l=$.extend([],o.tlwh);if(g!=null){var n=parseFloat($(this).css("left"))-g;$(this).addClass("trans150").css("left",n);if(l[1].toString().indexOf("%")==-1&&$(this).attr("id")==$(this).attr("data-lockto")){l[1]=n;widget.set({tlwh:l},$(this).attr("id"))}}if(i!=null){var m=parseFloat($(this).css("top"))-i;$(this).addClass("trans150").css("top",m);if(l[0].toString().indexOf("%")==-1&&$(this).attr("id")==$(this).attr("data-lockto")){l[0]=m;widget.set({tlwh:l},$(this).attr("id"))}}})});setTimeout(function(e){$(".trans150").removeClass("trans150");contextMenu.changeSelSize(a)},160);return false},changeSelSize:function(a){var b=propInspectorCtrl.currentSelection;var a=a||widget.getRoots(b).not(".backgroundWidget");var c=utils.getBoundingAreaRelative(a);updateTLWH(c);widget.addResizeSettings()},setButtonStyle:function(g,d,f){var a=d?0:1;var c=f==undefined?true:f;var b=$(g).hasClass("cm")?$(g):$(g).parent();var h=$(g).hasClass("icon2")?$(g):$(g).children("a");var j=$(".buttonText",h);if(a==0){if(h.hasClass("cmButtonExpanded")){contextMenu.resetButtonsToOriginal(false,b);contextMenu.adjustButtonsPosition(b,false,false)}}else{if(!h.hasClass("cmButtonExpanded")){contextMenu.adjustButtonsPosition(b,true,c);h.addClass("cmButtonExpanded");var i=h.attr("data-text-alt");if(c){function e(){j.text(i);h.animate({width:contextMenu.buttonExpandedSize+"px"},500,"swing")}h.css({width:contextMenu.buttonCollapsedSize+"px"});setTimeout(e,500)}else{h.css({width:contextMenu.buttonExpandedSize+"px"});j.text(i)}}}},resetButtonsToOriginal:function(a,b){var c=b==undefined?$(".cm"):b;if(a){c.css({left:"0px"})}$.each(c,function(e,d){var f=$(d).children("a");$(".buttonText",f).text("");f.css({width:contextMenu.buttonCollapsedSize+"px"}).removeClass("cmButtonExpanded")})},adjustButtonsPosition:function(a,d,b){if(a==null){contextMenu.open();return}var h=contextMenu.buttonExpandedSize-contextMenu.buttonCollapsedSize;var f=$(a);var i=f.hasClass("left")?"left":"right";var e=$(".cm."+i);var g=d?h:h;var c=parseInt($(f).css("left"));c=i=="left"?c:c+1;$.each(e,function(k,l){var m=parseInt($(l).css("left"));if((m!=0)&&(Math.abs(m)>=Math.abs(c))){var j=i=="left"?-1:1;var n=m+(g*j);if(b){$(l).animate({left:n+"px"},1000,"swing")}else{$(l).css({left:n+"px"})}}})},removeOtherCmMenus:function(b){for(var a=0;a<b.length;a++){if(b[a]){switch(b[a]){case"staticWidgets":staticWidgets.hideMenu();break;case"propertyInspector":propInspector.hideInspectors();propInspector.resetPropInspector();break}}}}};var canvas2={mousewheel:function(c,d){if($("#canvas").data("zooming")){return}if(d<0){if((project.get("currentZoom")==1)&&(widget._dragSelection==null)){canvas2.zoom({newZoom:"auto",centerY:c.pageY,centerX:c.pageX})}return false}var b=project.get("currentZoom");if(b!=1){var a=getHoverPage(c);if(a!=""){$("#"+a).trigger("click")}}},zoom:function(b,c){if(b.newZoom==="auto"){var a=project.getActivePage();page.draw(a.attr("id"),"init")}$("#canvasPages").zoom(b,c);$(".linkMenu").hide()},zoomOut:function(b){var a=utils.getCenterPoint("#viewport");canvas2.zoom({newZoom:"auto",centerY:a.left,centerX:a.top})},setContainment:function(){var b=utils.getTLWH("#viewport");var a=utils.getTLWH("#canvas");var c=10;var d=[b.left+b.width-a.width-c,b.top+b.height-a.height-c,b.left+c,b.top+c];return d},setScreenContainment:function(){var c=$("#canvasPages .screen");if(c.length==0){return}var b=utils.getTLWH("#canvas");var a=project.get("currentZoom");c.each(function(){canvas2.setPageContainment(this,b,a)})},setPageContainment:function(d,b,a){if(!$(d).data("initDraggable")){return}b=b||utils.getTLWH("#canvas");a=a||project.get("currentZoom");var c=utils.getTLWH(d);var e=[b.left,b.top,b.left+Math.floor((b.width))-(c.width*a),b.top+Math.floor((b.height))-(c.height*a)];$(d).draggable("option","containment",e)},dragStart:function(c){if($("#canvas").data("zooming")){return false}contextMenu.place("hide");var b=project.get("currentZoom");if(b==1){$("#canvasLinks").hide()}var a=document.getElementById("canvas");a.style.cursor="-webkit-grabbing";a.style.cursor="-moz-grabbing";a.style.cursor="grabbing"},updatePages:function(e){var d=$(".screen");var c=project.getPagesInViewport();var b=d.filter(function(){if(c.indexOf($(this).attr("id"))!==-1){return false}else{return true}});var a;requestAnimationFrame(function(){for(var f=0;f<c.length;f++){a=d.filter("#"+c[f]);if(a.length===0){page.draw(c[f],"useCache")}else{if(!a.is(":visible")){a.show()}}}if(e){e()}b.hide()})},updateLinks:function(){var b=$(".link");var a=project.getLinksInViewport();var d=b.filter(function(){if(a.linkCanvId.indexOf($(this).attr("id"))!==-1){return false}else{return true}});var c;requestAnimationFrame(function(){var e=project.get("links");var g=g={linkCanvId:[],linkDest:[],linkOrigin:[],linkType:[],transType:[],triggerType:[]};for(var f=0;f<a.linkCanvId.length;f++){c=b.filter("#"+a.linkCanvId[f]);if(c.length===0){g.linkCanvId.push(a.linkCanvId[f]);g.linkDest.push(a.linkDest[f]);g.linkOrigin.push(a.linkOrigin[f]);g.linkType.push(a.linkType[f]);g.transType.push(a.transType[f]);g.triggerType.push(a.triggerType[f])}else{if(!c.is(":visible")){c.show()}}}link.load(g);link.drawSome(a);d.hide()})},drag:function(a){canvas2.updatePages()},dragStop:function(b){var a=project.get("currentZoom");if(a!=1){project.set({canvasPosY:-parseInt($("#viewport").get(0).scrollTop),canvasPosX:-parseInt($("#viewport").get(0).scrollLeft)})}canvas2.setScreenContainment();$("#canvasLinks").fadeIn(200);canvas2.updatePages();canvas2.updateLinks();contextMenu.place();document.getElementById("canvas").style.cursor=""},isZoomedOut:function(){return $("#canvas").hasClass("zoomedOut")},isEditorVisible:function(){return $("#canvas").hasClass("editing")},setEditorVisibility:function(a){if(a){$("#canvas").addClass("editing");fluidMenu.setCanvasFirstPage();fluid.controllers.bin.show();grid.selectBackground()}else{$("#canvas").removeClass("editing");fluid.controllers.bin.hide()}}};var account={syncPending:{},lastActivity:new Date().getTime(),safetyInterval:60000,loadingTimeout:null,alerts:{projectLimitHit:{onAddActive:$("#tmplAlertProjectLimit_OnAddActive").tmpl({}),onDropToInactive:$("#tmplAlertProjectLimit_OnDropToInactive").tmpl({}),onOpenInactive:$("#tmplAlertProjectLimit_OnOpenInactive").tmpl({}),onExportNonSignedIn:$("#tmplAlertExportNonPremium").tmpl({}),onExportNonStandard:$("#tmplAlertExportNonStandard").tmpl({}),onFeaturePremium:$("#tmplAlertFeaturePremium").tmpl({}),onFeatureStandard:$("#tmplAlertFeatureStandard").tmpl({})},pageLimitHit:{onAddActive:$("#tmplAlertPageLimit_OnAddActive").tmpl({}),onNonSignedIn:$("#tmplAlertPageLimit_OnNonSignedIn").tmpl({})},uploadLimitHit:{onNonSignedIn:$("#tmplAlertUploadNonSignedIn").tmpl({})},projectAction:{onDelete:$("#tmplProjectAction_OnDelete").tmpl({})}},checkIntegrity:function(){var c=account.get("id");var a=storage.get(c);if(!a){return}if(account.get("loggedIn")==null){var e=(account.get("accType")=="New")?"no":"yes";account.set({loggedIn:e})}var b=a.lastOpenProject;var d=a.projectIds;if(!d||d.length==0){return}if($.inArray(b,d)==-1){account.set({lastOpenProject:d[0]})}if(!account.get("maxActiveProjects")){account.set({maxActiveProjects:1})}if(!account.get("maxPages")){account.set({maxPages:10})}if(!account.get("upgradeDate")){account.set({upgradeDate:"0000-00-00 00:00:00"})}if(!account.get("lastPaymentDate")){account.set({lastPaymentDate:"0000-00-00 00:00:00"})}if(!account.get("nextPaymentDate")){account.set({nextPaymentDate:"0000-00-00 00:00:00"})}if(!account.get("lastPaymentResult")){account.set({lastPaymentResult:"s"})}if(!account.get("gridStatus")){account.set({gridStatus:"off"})}if(!account.get("gridSpacing")){account.set({gridSpacing:10})}if(!account.get("snapToWidget")){account.set({snapToWidget:"on"})}},get:function(c){var b=storage.get("accounts");if(!b){if(!localStorage){return null}}var d=storage.get("accounts");if(!d){return null}var a=d.last;if(c=="currentUserId"||c=="id"){return a}var d=storage.get(a);if(d==null||d[c]==null){return null}return d[c]},set:function(c){var a=account.get("currentUserId");var b=storage.get(a);if(b==null){throw ("No set account object for "+c+"Caller:"+arguments.callee.caller+" Second level:"+arguments.callee.caller.caller+"loadSate"+loading_Stage_Check)}for(var d in c){b[d]=c[d]}storage.set(a,b)},changeAccountId:function(d,c){var a=storage.get("accounts");var b=storage.get(d);a.user[0].id=c;if(a.last==d){a.last=c}storage.set("accounts",a);storage.set(c,b);storage.remove(d)},setup:function(){var a={last:null,user:[]};storage.set("accounts",a)},createUser:function(c){var a={email:"New",accType:"New",name:"",recurrance:"never",libraryWidth:423,loggedIn:"no",maxActiveProjects:1,maxPages:10,projectIds:account.get("projectIds")||[],uploads:account.get("uploads")||[],lastOpenProject:account.get("lastOpenProject")||"",createDate:account.get("lastOpenProject")||new Date().getTime()};if(arguments.length==0){var e=utils.guid("u")}else{var e=c.accountId;a.accName=c.accName;a.accType=c.accType;a.recurrance=c.recurrance;a.email=c.email;a.loggedIn="yes"}var b={id:e};var d=storage.get("accounts");if(d==null){return}d.user.push(b);d.last=e;storage.set("accounts",d);storage.set(e,a);return e},login:function(b){var a=storage.get("accounts");account.beforeLoginId=a?a.last:null;if(b.a!="login"||b.r!="s"){account.drawSignup(b);return false}$("body").addClass("signed-in");account.createUser(b);var d=storage.get("accounts");if(d.user.length==2&&d.user[0].id==account.beforeLoginId){d.user.splice(0,1);storage.set("accounts",d)}var c=account.get("lastOpenProject");account.set({loggedIn:"yes",accName:b.accName,accType:b.accType,recurrance:b.recurrance,maxActiveProjects:b.maxActiveProjects,maxPages:b.maxPages,upgradeDate:b.upgradeDate,lastPaymentDate:b.lastPaymentDate,lastPaymentResult:b.lastPaymentResult,nextPaymentDate:b.nextPaymentDate,createDate:b.createDate});if(b.discount){account.set({discount:{amount:b.discount,bundleMonths:b.bundleMonths,code:b.discountCode,accType:b.discountAccType,recurrance:b.discountRecurrance,endDate:b.discountEndDate,message:b.discountMessage}})}else{account.set({discount:null})}if(b.settings!=""){var e=JSON.parse(b.settings);if(project.get("pages").length!==0){e.lastOpenProject=c}account.set(e);if(e["hint"]=="end"){hint.cleanup()}}account.draw(b);if(b.objects&&b.objects.length>0){$("#msgLoadingAfterLogin").show()}setTimeout(function(){account.sync(b.objects,true,c)},500);$("#previewSignup").hide();preview.displaySharePanel();preview.updateScrollbar();fluid.command.create("showButton").dispatchTo("fluid.controllers.timeline");tracker.record("login",10,"","");localStorage.setItem("intercomUserHash",b.intercomUserHash);fluid.main.fire("editor.afterLogin")},sync:function(i,k,b){account.setLoadingStep(1);var h=[];var j=[];for(var g=0;g<i.length;g++){var f=i[g];var a=f.id.substr(0,1);switch(a){case"p":h.push(f.id);break;case"i":j.push(f.id);break}}if(h.length>0){var d=1;function c(){if(d<3){d++;ajax.syncDown(h,k,e,c)}else{var l=storage.get("accounts");l.last=account.beforeLoginId;storage.set("accounts",l);localStorage.setItem("postloadMessage","loginSyncFailed");location.reload()}}function e(p,l,w){var n=JSON.parse(p);if(n.r!=="s"){c();return}var s={};var o;var v=n.t;if(!$.isArray(v)){v=[v]}var m=0;for(var u=0;u<v.length;u++){try{var r=JSON.parse(v[u])}catch(q){continue}if(typeof r.uploads!="undefined"){o=jQuery.extend(true,{},r.uploads);delete r.uploads}else{o=false}for(var t in r){var A=r[t];var z=t.substr(0,1);switch(z){case"p":account.addProjectId(t);m++;break}storage.set(t,A,false)}if(t&&typeof o==="object"){for(var y in o){if(o.hasOwnProperty(y)){s[y]=s[y]||[];s[y].push(t)}}}}if(m>0){if(project.isEmpty()){var x=account.get("lastOpenProject");project.sort();if(b){var B=account.get("projectIds");B.splice($.inArray(b,B),1);storage.remove(b);if(b==x){account.set({lastOpenProject:""})}}}project.load()}account.syncUploads(j,function(){storage.remove(account.beforeLoginId);var C=account.get("lastOpenProject");var D=account.get("projectIds");if(D.length>0){fluid.command.create("open",{id:(($.inArray(C,D)>-1&&C)||project.getLatestActiveProject()||D[D.length-1])}).dispatchTo("fluid.controllers.project")}},s);signup.loggingIn=false}ajax.syncDown(h,k,e,c)}else{project.setNumber()}},syncUploads:function(f,h,d){account.syncingUploads=true;account.setLoadingStep(4);if((!f)||(f.length==0)){c();account.syncedUploads=true;h();return true}function c(){$("#msgLoadingAfterLogin").hide();var i=$("#widgetGroupTitle").text();if(i=="Uploads"){lib.draw(i)}account.setLoadingStep(5);$("#msgLoadingAfterLoginSuccess").fadeIn(500,function(){setTimeout(e,3000)})}function e(){$(".messageError").hide();$("#msgLoadingAfterLoginSuccess").fadeOut(1000)}var b=1;function g(){if(b<3){b++;ajax.syncDown(f,a,g)}else{var i=storage.get("accounts");i.last=account.beforeLoginId;storage.set("accounts",i);localStorage.setItem("postloadMessage","loginSyncFailed");location.reload()}}function a(l,i,p){var k=JSON.parse(l);if(k.r!=="s"){g();return}var j=JSON.parse(p.responseText).t;var n=0;if(!$.isArray(j)){j=[j]}for(var q=0;q<j.length;q++){try{var r=JSON.parse(j[q])}catch(m){continue}if(typeof r.groups!=="object"&&d[r.id]){r.groups=d[r.id]}account.addUploadId(r.id,true);try{var o=$.extend({font:"",color:"",upload:"y",g:["Uploads"],t:["Uploads"],data:r.id,wh:[r.width,r.height],title:r.name},r);delete o.name;delete o.width;delete o.height;storage.set(r.id,o);widgets.summary[r.id]=o;n++}catch(m){}}c();account.syncingUploads=false;if(n>1){account.syncedUploads=true}h()}ajax.syncDown(f,a,g)},register:function(a){if(a&&a.r=="s"){account.set({email:a.email,accType:a.accType,accName:a.accName,recurrance:a.recurrance,loggedIn:"yes",maxActiveProjects:a.maxActiveProjects,maxPages:a.maxPages,upgradeDate:a.upgradeDate,lastPaymentDate:a.lastPaymentDate,nextPaymentDate:a.nextPaymentDate,lastPaymentResult:a.lastPaymentResult});if(a.accountId!=account.get("id")){account.changeAccountId(account.get("id"),a.accountId)}account.draw(a);project.updateOnSignup();localStorage.setItem("intercomUserHash",a.intercomUserHash);fluid.main.fire("editor.afterAccountRegister")}else{return false}if($("#previewSignup").is(":visible")){preview.signupComplete()}},isAccountForever:function(){if((account.get("loggedIn")=="yes")&&(account.get("accType")=="premium1")){return true}return false},draw:function(a){$("#profile .createForm").hide();$("#profile #account-wrapper").remove();$("#tmplAccount").tmpl(a).appendTo("#profile");fluid.main.fire("account.formDrawn");account.setUpgradeLinkStatus();$("#fluidDropdownSubmenu").hide()},drawSignup:function(a){var c={index:1,uid:account.get("currentUserId"),email:"",instanceId:g_instanceId};if(a){c.email=a.email;c.error=a.t;c.checked="checked"}$("#fluidDropdownSubmenu").hide();$("#profile .createForm").show();$("#previewSignupForm").empty();$("#profile input[name=uid]").val(c.uid);$("#profile input[name=instanceId]").val(c.instanceId);$("#profile input[name=email]").val(c.email);$("#profile input[name=tandc]").attr("id",c.index);$("#profile #createPassword").val("");c.index=2;$("#tmplCreate").tmpl(c).appendTo("#previewSignupForm");if(a){var b=$("#profile");setValid(b.find("[type=email]"));setValid(b.find("[type=checkbox]"));setFocus(b.find("[type=password]"))}$("#account-wrapper").remove()},isBrandNewUser:function(){var b=storage.get("accounts");if(!b){return true}var a=account.get("id");if(!a){return true}var c=storage.get(a);if(!c){return true}return false},checkEmailExists:function(a){var b=$("form.createForm");ajax.syncUp({email:a},"emailRegd",null)},emailChecked:function(c){var b=$("form.createForm");var c=JSON.parse(c);var a=false;if(c.t===true||c.t==="true"){a=true;b.data("existing",true).find("input[type=submit]").attr("value","Welcome back - Sign In").attr("data-label","Welcome back - Sign In").removeClass("newAccount")}else{b.data("existing",false).find("input[type=submit]").attr("value","Create Account").attr("data-label","Create Account").addClass("newAccount")}if(userSettings.isOpen){fluidEvent.triggerEditor("emailChecked",{exists:a},true);return}},addProjectId:function(c){var a=account.get("projectIds");try{a.push(c)}catch(b){}account.set({projectIds:a})},addUploadId:function(c,b){var a=account.get("uploads");a.push({id:c,s:Boolean(b)});account.set({"uploads":a})},uploadSynced:function(f,e){var c=account.get("uploads");for(var b=0,a=c.length;b<a;b++){var d=c[b];if(d.id==f){d.s=Boolean(e);account.set({"uploads":c});break}}},findUpload:function(d){var c;var a=account.get("uploads");for(var b=0;b<a.length;b++){if(d==a[b].id){c={index:b,upload:a[b]};break}}return c},removeUpload:function(e,d){var b=this.findUpload(e);if(b){var c=$.extend({},b);c.upload=storage.get(e);var a=account.get("uploads");ajax.apiCall("img","delete",e,{},function(){if(d){d.call(null,c)}});c.upload.removed=1;storage.set(e,c.upload);$("#libraryWidgetDragging").remove();$("[data-id='"+e+"']").remove();fluid.main.trigger("updateUploadCounters");if(a.length<=0){lib.draw("Uploads")}}$("#trash").removeClass("droppableStyle")},startCreate:function(b,a){tracker.record("openUpgradePanelViaOffer",1);account.displayAccountFrame("upgrade/","create",a||null)},startUpgrade:function(f,b,a){var c=typeof a!="undefined"?"Offer":"fluidMenu";var d=$(this).parents(".messages");if(d.length>0){c="Notification"}tracker.record("openUpgradePanelVia"+c,1);account.displayAccountFrame("upgrade/",null,b,a)},upgradeSuccess:function(b){if(b.a.indexOf("upgrade")==0&&b.r=="s"){account.set({accName:b.accName,accType:b.accType,recurrance:b.recurrance,maxActiveProjects:b.maxActiveProjects,maxPages:b.maxPages,upgradeDate:b.upgradeDate,lastPaymentDate:b.lastPaymentDate,lastPaymentResult:b.lastPaymentResult,nextPaymentDate:b.nextPaymentDate,billingCompany:b.billingCompany,billingAddress:b.billingAddress,billingVAT:b.billingVAT});account.set({discount:b.discount?{amount:b.discount,bundleMonths:b.bundleMonths,code:b.discountCode,accType:b.discountAccType,recurrance:b.discountRecurrance,endDate:b.discountEndDate,message:b.discountMessage}:null});var a=account.get("id");var c=storage.get(a);account.draw(c);tracker.record("UpgradeSucces",1);if(project.activeProjectCount()>b.maxActiveProjects){project.load()}else{project.setNumber();projectSettings.resetFilter()}}},recoverPassword:function(){account.displayAccountFrame("recoverPassword/")},displayAccountFrame:function(c,h,b,a){function d(){g.show();g[0].contentWindow.focus();fluidEvent.triggerEditor("iFrameLoaded",{},true);canvas2.setEditorVisibility(false);g.unbind("load")}fluid.main.deferReload=true;var g=$("#accountFrame");account.resetAccountFrame();g.load(d);var f={mode:h,type:b,offer:a};for(var e in f){if(typeof f[e]!="undefined"&&f[e]!==null){c+=(c.indexOf("?")==-1?"?":"&")+e+"="+window.encodeURIComponent(f[e])}}g.attr("src",c);return false},resetAccountFrame:function(){var b=document.getElementById("accountFrame");var a=b.contentDocument||b.contentWindow.document;a.documentElement.innerHTML=""},logout:function(g){page.detachFrame();var b=account.get("email");var a=account.get("uploads");var f=account.get("gridStatus");var c=account.get("gridSpacing");var d=account.get("snapToWidget");$("#msgSyncOnLogout").show();account.syncUp();project.sync(null,function(h){$("#msgSyncOnLogout").fadeOut(300);if(h.synced&&h.data){h=JSON.parse(h.data);if(h.r=="f"){notification.add("alert","Unable to save your data. Please try to sign out again.");return}}project.close();for(var e=0;e<a.length;e++){delete widgets.summary[a[e].id]}storage.clear();localStorage.setItem("instanceId",g_instanceId);fluid.controllers.bin.clear();account.setup();account.createUser();account.set({"currentUserId":null,"projectIds":[],"uploads":[],"gridStatus":f,"gridSpacing":c,"snapToWidget":d});var i=project.add(g,"Project 1");account.drawSignup();project.load();fluid.command.create("open",{id:i}).dispatchTo("fluid.controllers.project");preview.displaySharePanel(false);$("#previewHolder").hide();account.set({"loggedIn":"no"});account.set("uploads",[]);lib.draw($("#widgetGroupTitle").text());notification.removeAll();tracker.record("closeSession",10,b,g);hint.resetIndicators();account.setLoadingStep(5);account.resetAccountFrame();$("body").removeClass("signed-in");fluid.main.fire("editor.afterLogout")});return false},recordActivity:function(d,c){var a=new Date().getTime();var b=a-account.lastActivity;if(b>account.safetyInterval){account.validateState()}account.lastActivity=a},validateState:function(){if((account.get("loggedIn")!="yes")||(g_imgFullCanvas=="true")){return}ajax.syncUp({instanceId:g_instanceId},"accountState",account.get("id"));return true},requireRefresh:function(a){if(a.a!="accountState"||a.r!="s"){return false}if(a.clientAction=="refresh"){}else{if(a.clientAction=="logout"){account.logout();localStorage.setItem("restoreMyInstanceId","true");utils.reloadWithMessage("serverLogout")}else{if(a.clientAction=="warnClose"){utils.reloadWithMessage("tab")}}}},setLoadingStep:function(b){var c=(g_imgFullCanvas=="true")||($("#previewHolder:visible").size()>0);if(c){return}var a=$(".fluidFillingContainer");var d=5;if(b==0){if($("#loadingScreen").hasClass("close")){account.showLoadingScreen()}return}a.removeClass("loadingStep1 loadingStep2 loadingStep3 loadingStep4 loadingStep5");a.addClass("loadingStep"+b);if(b==d){account.loadingTimeout=setTimeout(account.hideLoadingScreen,200);account.autoOpenFluidMenu()}else{clearTimeout(account.loadingTimeout)}},autoOpenFluidMenu:function(){var a=document.referrer;var b=false;if(a.indexOf("recoverPassword")>-1){b=true}if(b){setTimeout(fluidMenu.show,1000)}},showLoadingScreen:function(){$("#loadingScreen").show().removeClass("close");$("#canvas").hide();hint.hide()},hideLoadingScreen:function(){canvas2.setEditorVisibility(true);$("#loadingScreen").addClass("close").fadeOut(250).delay(200);$("#canvas").fadeIn(200,account.afterLoading);var a=account.get("loggedIn")=="yes"?false:true;if(a){fluidMenu.setButtonStyle($("#startMenu"),a)}},afterLoading:function(){$(".fluidFillingContainer").removeClass("loadingStep1 loadingStep2 loadingStep3 loadingStep4 loadingStep5");clearTimeout(account.loadingTimeout)},bundleSettings:function(){var a={hint:account.get("hint"),tutorialLevel:account.get("tutorialLevel"),billingCompany:account.get("billingCompany"),billingAddress:account.get("billingAddress"),billingVAT:account.get("billingVAT"),gridStatus:account.get("gridStatus"),gridSpacing:account.get("gridSpacing"),snapToWidget:account.get("snapToWidget"),receiptEmails:account.get("receiptEmails"),emailReceiptEnabled:account.get("emailReceiptEnabled"),lastOpenProject:account.get("lastOpenProject")};return a},syncUp:function(b){if(account.get("loggedIn")!="yes"){return}var a=account.bundleSettings();ajax.syncUp(a,"accountSettingsSync",null,b)},needHints:function(){return account.get("hint")=="end"?false:true},setUpgradeLinkStatus:function(){var b=account.get("accName");var c=account.get("accType");var a=c=="Free"||b==""||b==undefined?"Go Premium":b;$(".currentAccType").text(b);$("#upgradeLink").val(a);if(account.isAccountForever()){$("#upgradeLink, #userSettingsChangeAccount").hide()}else{$("#upgradeLink, #userSettingsChangeAccount").show()}},canAddProjects:function(){return true},isFreeAccount:function(){return account.get("accType")=="Free"},isStandard:function(){return account.get("loggedIn")==="yes"&&!/^Free$|lite$/.test(account.get("accType"))},hasUpload:function(c){if(!c){return false}var a=account.get("uploads");if(!a){return true}for(var b=0;b<a.length;b++){if(a[b].id===c){return true}}return false}};var upload={w:null,h:null,hide:function(){$("#dropzone").fadeOut(200)},create:function(b,a,d){tracker.record("ImageUploaded",1);var c=new Image();c.onload=function(){a.width=this.width;a.height=this.height;a.src=this.src;var e=upload.saveFile(a,upload.saveFileCallback,upload.saveFileCallback)};c.src=b},init:function(){var a=document.getElementById("viewport"),b=document.getElementById("hud");a.addEventListener("dragenter",upload.enter,false);a.addEventListener("dragover",upload.over,false);b.addEventListener("dragenter",upload.enter,false);b.addEventListener("dragover",upload.over,false);document.addEventListener("dragleave",upload.leave,false);document.addEventListener("drop",upload.drop,false)},enter:function(d){if(account.get("loggedIn")!="yes"){return false}var c=d.dataTransfer;var a=c.files;var b=c.files;if(((c.files)&&(c.files.length>0))||(c.types=="Files")){if($("#dropzone").not(":visible")&&$(".pageWidget textarea").length==0){$("#dropzone").fadeIn(200)}}return false},over:function(a){utils.prevent(a)},leave:function(a){utils.prevent(a);if(a.pageX!=0){return}upload.hide()},drop:function(d){if(d.preventDefault){d.preventDefault()}var c=d.dataTransfer.files;for(var b=0,a;a=c[b];b++){upload.readFile(a)}upload.hide();return false},readFile:function(b){if(account.get("loggedIn")!="yes"){notification.add("alert",account.alerts.uploadLimitHit.onNonSignedIn,{scope:"uploadLimit",stopBuggingCallBack:function(){}});return false}if(!upload.isValid(b)){return}if(window.FileReader){var a=new FileReader();a.onerror=function(c){var d="Error "+c.target.error.code;switch(c.target.error.code){case FileError.NOT_READABLE_ERR:d+=": NOT_READABLE_ERR";break}};a.onload=(function(c){return function(d){if(d.target.readyState==FileReader.DONE){upload.create(d.target.result,c)}}})(b);a.readAsDataURL(b)}else{upload.uploadFile(b)}},uploadFile:function(a){if(upload.isValid(a)){upload.saveFile(a,upload.saveFileCallback,upload.saveFileCallback)}return true},saveFileCallback:function(c,b){var a=$("#widgetGroupTitle").text()==="Uploads";if(a){lib.redrawUpdates();lib.scrollBottom();$("#searchBox").val("")}},uploadByClick:function(c){upload.uploadsPending={};for(var b=0,a=this.files.length;b<a;b++){upload.uploadsPending[this.files[b].name]=true}for(var b=0,a=this.files.length;b<a;b++){upload.uploadFile(this.files[b])}document.querySelector("[name=uploadForm1]").reset();c.preventDefault()},saveFile:function(f,e,i){if(account.get("loggedIn")!="yes"){notification.add("alert","Please log in to upload images");return false}var k=f.name;var c=utils.guid("i");var d=f.width;var h={title:k,font:"",color:"",type:f.type,upload:"y",r:"y",g:["Uploads"],t:["Uploads"],wh:[f.width,f.height],storage:"db",groups:[]};var l=account.get("lastOpenProject");storage.set(c,h);widget.saveTempFile(c,f);if(account.get("accType")!="New"){function j(m){account.addUploadId(c);widgets.summary[c]=h;if(d!=m.width){h.wh=[m.width,m.height];storage.set(c,h)}widget.removeTempFile(c);if($.isFunction(e)){e(f.name,c)}}function g(m){if(m.size>8000000){notification.add("alert","Unable to upload the file [ "+f.name+" ].  Please use smaller image files.")}else{notification.add("alert","Unable to upload the file [ "+f.name+" ].  Please only upload image files.")}if($.isFunction(i)){i(c)}}ajax.apiCall("img","post",c,f,j,g)}upload.uploadsPending[f.name]=false;var b=true;for(var a in upload.uploadsPending){if(upload.uploadsPending.hasOwnProperty(a)){if(upload.uploadsPending[a]){b=false;break}}}if(b){document.querySelector("[name=uploadForm1]").reset()}return c},bundle:function(b){var a={};a[b]=storage.get(b)},isValid:function(b){var a=true;var c=/image.*/;if(!b.type.match(c)){a=false;notification.add("alert","The file [ "+b.name+" ] is not an image.  Please only upload image files.")}return a}};var link={mouseTimeoutForHover:false,isLinking:false,showahrefs:function(a){if(a){var b=(new Date).getTime();if(b-link.mouseTimeoutForHover<a){setTimeout(link.showahrefs,300,[a]);return}}$(".linkTemplate").stop(true,true).delay(500).fadeOut(400)},hoverIn:function(p){if(project.readOnly()){return}var j=$(this).attr("id");$(this).addClass("front");var v=$(this).find(".linkToggle");if(!link.toggleRemoveTimeout){link.toggleRemoveTimeout={}}if(link.toggleRemoveTimeout[j]){clearTimeout(link.toggleRemoveTimeout[j]);delete link.toggleRemoveTimeout[j]}if(v.length===0){v=$('<a class="linkToggle tooltip4" title="Gestures and transitions" alt="Gestures and transitions"></a>');$(this).append(v)}v.stop(true,true).delay(200).fadeTo(10,1,link.showLinkMenuIntro);v.tooltip({effect:"fade",delay:0,offset:[-10,0],opacity:0.8,tipClass:"tooltip4Text",predelay:50});var y=link.comesFrom($(this).attr("id"));var n=link.goesTo($(this).attr("id"));var l=$("#"+y);var t=widget.getPageOf(y);if(project.get("currentZoom")==1){l.css("outline","3px solid rgba(25,163,255,1.0)");var s=$("#"+t);var c=s.hasClass("active");var e=$("#"+n);var x=s.find(".page");var m=parseInt(s.css("top"))+parseInt(l.css("top"))+parseInt(l.css("height"))/2;var w=parseInt(s.css("left"))+parseInt(l.css("left"))+parseInt(l.css("width"))/2;var u=(parseInt(e.css("top"))+parseInt(e.css("height"))/2);var f=(parseInt(e.css("left"))+parseInt(e.css("width"))/2);var g=13;var i=60;if(!c){i=0}var b=0;if(w<f){b=parseInt(s.css("left"))+parseInt(x.css("width"))+i}else{b=parseInt(s.css("left"))-i}var h=(((u-m)/(f-w))*(b-w))+m;var d=parseInt(s.css("top"))-i;var k=parseInt(s.css("top"))+parseInt(x.css("height"))+i;if((h<=d)||(h>=k)){if(m<u){h=parseInt(s.css("top"))+parseInt(x.css("height"))+i}else{h=parseInt(s.css("top"))-i-20;if(w<f){g=-20}}b=(((h-m)/(u-m))*(f-w))+w}var r=h-m;var o=b-w;var q=Math.sqrt(r*r+o*o)+25;$(this).find(".linkToggle").css({"margin-left":q+"px","margin-top":g+"px"})}else{var a=page.isLinked(n,t);if(a&&p){link.hoverIn.apply(document.getElementById(a),[false])}}},hoverOut:function(c){$(".tooltip4Text").hide();if(!$("#canvas").hasClass("loaded")){return}var e=link.goesTo($(this).attr("id"));if(c){link.draw($(this),d,e,"ahref")}var f=$(this).attr("id");var a=$(".link").not(".open-link-menu").find(".linkToggle");if(!c||!($(c.target).hasClass("open-link-menu")||$(c.target).hasClass("openLinkMenu"))){a.stop(true,true).delay(2000).fadeTo(200,0,link.hideLinkMenuIntro);if(!link.toggleRemoveTimeout){link.toggleRemoveTimeout={}}link.toggleRemoveTimeout[f]=setTimeout(function(){$(this).find("*").remove();$(".link").removeClass("front")}.bind(this),2000)}var d=link.comesFrom($(this).attr("id"));$("#"+d).css("outline","");var e=link.goesTo($(this).attr("id"));link.draw($(this),d,e,"ahref");var b=widget.getPageOf(d);var g=page.isLinked(e,b);if(g&&c){link.hoverOut.apply(document.getElementById(g),[false])}return false},closeMenu:function(){$(".openLinkMenu").removeClass("openLinkMenu");$(".open-link-menu").removeClass("open-link-menu");$(".linkMenu").hide();return false},setLinkMenuText:function(){var c=project.get("currentZoom");$("#smallRemoveLink, #zoomedOutLinks, #linkAmount").hide();if(c<1){$("#zoomedOutLinks").show();var b=project.get("links")["linkCanvId"].length;$("#linkAmount").show().text(b);var a=(b>1)?("remove "+b+" links"):("remove 1 link");$("#removeLinkTxt").text(a)}else{$("#smallRemoveLink").show()}},toggleMenu:function(c){if($(this).hasClass("openLinkMenu")){link.closeMenu()}$(".openLinkMenu").removeClass("openLinkMenu");$(this).addClass("openLinkMenu");$(this).parents(".link").addClass("open-link-menu");$("body").bind("click.linkToggle",function(h){if($(h.target).parents(".linkMenu").length>0){return}var g=$(".openLinkMenu");if(h.target!=g.get(0)){g.removeClass("openLinkMenu").parent(".link").removeClass("open-link-menu");$(h.target).addClass("openLinkMenu").parent(".link").addClass("open-link-menu")}else{$(".openLinkMenu").removeClass("openLinkMenu");$(".open-link-menu").removeClass("open-link-menu")}link.hoverOut();$(".linkMenu").hide();$("body").unbind("click.linkToggle");if(h.target!=g.get(0)){$(h.target).click()}return utils.prevent(h)});var d=$(this).parents(".link").attr("id");var a=project.get("links");var b=$.inArray(d,a.linkCanvId);if(b>-1){var f=$(this).offset();$(".linkMenu .transitionSelector").find("[value='"+a.transType[b]+"']").attr("selected","selected");$(".linkMenu .linkTriggerSelector").find("[value='"+a.triggerType[b]+"']").attr("selected","selected");$(".linkMenu").css({top:f.top,left:f.left}).show()}return false},follow:function(f){var d=project.get("currentZoom");if(d==1&&$(".connectorHelper").length==0){$(this).find(".linkToggle").hide(10,link.hideLinkMenuIntro);var b=link.goesTo($(this).attr("id"));var c=project.getActivePageId();if(c==b){b=link.comesFromPage($(this).attr("id"))}var a=$("#"+b);if(a.length===0){page.drawDetailed(b,"init");a=$("#"+b)}page.activate(a);zoomInAndCenterOnPage(a,1,1,300)}},template:function(d,a,c){$("#"+d).remove();var b=$("#tmplLinkNew").tmpl({id:d}).appendTo("#canvasLinks");if(a=="ahref"){b.fadeIn(400)}else{b.addClass("linkTemplate")}return b},dragStart:function(c,a){page.calculateWdgPositions($(".screen.active").attr("id"));hint.show("draggingLink");link.isLinking=true;if((typeof a=="boolean"&&a)||!$(this).data("dragOnClickStarted")){contextMenu.hide();propInspector.resetPropInspector();var b=project.get("currentZoom");$("#canvas").data("revertZoom",b);if($(this).attr("id")=="cmLink2"){link.remove(".ui-selected")}dragZoom($(this))}if(a){$(this).data("dragOnClickStarted",true);$(".ui-draggable").not(this).not(".pageWidget").draggable("disable")}},drag:function(b){if(!link.$dragCanvas){link.$dragCanvas=$("#dragCanvas");link.$dragCanvas.add($(".connectorHelper"))}var a=getHoverPage(b,link.$dragCanvas);if(a!=""){if(a!=$(".pageLinkableCandidate").attr("id")){link.removeHighlightedPage(b);if(a!=$(".activeZoomedOut").attr("id")){$("#"+a).addClass("pageLinkableCandidate")}}}else{link.removeHighlightedPage(b)}link.draw($("#dragCanvas"),$(".zoomedOutSelected").attr("id"),$(".connectorHelper"),"ahref")},dragStop:function(b){var a=widgetsCache[$(".zoomedOutSelected").attr("id")].pageId;link.draw($("#dragCanvas"),$(".zoomedOutSelected"),$(".connectorHelper"),"ahref");dragZoomStop();page.draw(a,"init");$(this).data("dragOnClickStarted",false);$(".ui-draggable").not(this).not(".pageWidget").draggable("enable");$(".screen").removeClass("pageLinkable pageLinkableCandidate");page.activate($("#"+a));link.isLinking=false;hint.show("droppedLink")},drawSome:function(a){for(var b=0;b<a.linkOrigin.length;b++){if(a.linkDest[b]!==widgetsCache[a.linkOrigin[b]].pageId){link.draw($("#"+a.linkCanvId[b]),a.linkOrigin[b],a.linkDest[b],a.linkType[b])}}},drawAll:function(c){var a=project.get("links");for(var b in a.linkOrigin){if(c=="all"||a.linkType[b]==c){link.draw($("#"+a.linkCanvId[b]),a.linkOrigin[b],a.linkDest[b],a.linkType[b])}}},update:function(a){var b=project.get("links");var d=[];a.each(function(){var h=$(this).attr("id");for(var g in b.linkOrigin){if(widgetsCache[b.linkOrigin[g]]===undefined){continue}var f=widgetsCache[b.linkOrigin[g]].pageId;if(f==h||b.linkDest[g]==h){d.push(g)}}});for(var c in d){var e=d[c];link.draw($("#"+b.linkCanvId[e]),b.linkOrigin[e],b.linkDest[e],b.linkType[e])}},overlapCheck:function(a,d){var c={left:a[0],right:a[0]+a[2],top:a[1],bottom:a[1]+a[3]};var b={left:d[0],right:d[0]+d[2],top:d[1],bottom:d[1]+d[3]};if((b.left>=c.left&&b.left<=c.right&&b.top>=c.top&&b.top<=c.bottom)||(b.right>=c.left&&b.right<=c.right&&b.top>=c.top&&b.top<=c.bottom)||(b.left>=c.left&&b.left<=c.right&&b.bottom>=c.top&&b.bottom<=c.bottom)||(b.right>=c.left&&b.right<=c.right&&b.bottom>=c.top&&b.bottom<=c.bottom)){return true}else{return false}},drawPageToPage:function(A,l,g,a){if(link.overlapCheck(l,g)){A.hide();return}var s;var b=15;var h,z,q,e;var v=0,t=0,d=0,c=0;var n,r,k;if(l[1]<g[1]){n=l;r=g;k=true}else{n=g;r=l;k=false}var i,x,f;if(l[0]<g[0]){i=l;x=g;f=true}else{i=g;x=l;f=false}if(r[1]-n[1]<n[3]){var j="";if(n[1]+n[3]>r[1]+r[3]){t=r[1]+r[3]/2}else{t=r[1]+(n[1]+n[3]-r[1])/2}if(f){v=l[0]+l[2];s=g[0]-l[0]-l[2];j="right"}else{v=g[0]+g[2];s=l[0]-g[0]-g[2];j="left"}A.css({top:t*a,left:v*a,width:s*a>b?s*a-b:0,height:"4px","-webkit-transform-origin":"0px "+"2px","-moz-transform-origin":"0px "+"2px","-webkit-transform":"none","-moz-transform":"none"}).removeClass("right up left down").addClass(j).show();return}else{if(x[0]-i[0]<i[2]){var j="";v=x[0]+(i[0]+i[2]-x[0])/2;if(k){t=l[1]+l[3];s=g[1]-l[1]-l[3];j="down"}else{t=g[1]+g[3];s=l[1]-g[1]-g[3];j="up"}A.css({top:k?t*a:t*a+b,left:v*a,height:s*a>b?s*a-b:0,"-webkit-transform-origin":"0px "+"2px","-moz-transform-origin":"0px "+"2px","-webkit-transform":"none","-moz-transform":"none"}).removeClass("right up left down").addClass(j).show();return}else{h=(l[1]+l[3]/2);z=(l[0]+l[2]/2);q=(g[1]+g[3]/2);e=(g[0]+g[2]/2);var y=e-z;var w=q-h;var p=w/y;if(Math.abs(p)>l[3]/l[2]){if(q<h){t=-l[3]/2}else{t=l[3]/2}v=t/p}else{if(e<z){v=-l[2]/2}else{v=l[2]/2}t=v*p}if(Math.abs(p)>g[3]/g[2]){if(q<h){c=w+g[3]/2}else{c=w-g[3]/2}d=c/p}else{if(e<z){d=y+g[2]/2}else{d=y-g[2]/2}c=p*d}v=(z+v)*a;t=(h+t)*a;d=(z+d)*a;c=(h+c)*a;var o=(d-v);var m=(c-t);var s=Math.sqrt(o*o+m*m);var u=o<0?(180/Math.PI)*Math.atan(-m/o):(180/Math.PI)*Math.atan(m/o);if(o<0){u=180-u}A.css({top:t,left:v,width:s>b?s-b:0,height:4,"-webkit-transform-origin":"0px "+"2px","-moz-transform-origin":"0px "+"2px","-webkit-transform":"rotate("+u+"deg)","-moz-transform":"rotate("+u+"deg)"}).removeClass("right up left down").show()}}},drawWdgToPage:function(u,e,h,q,a){if(link.overlapCheck(h,q)){u.hide();return}var m;var b=15;var g,t,l,f;var p=0,n=0,d=0,c=0;g=h[1]+e[1]+e[3]/2-5;t=h[0]+e[0]+e[2]/2-5;l=(q[1]+q[3]/2);f=(q[0]+q[2]/2);var s=f-t;var r=l-g;var k=r/s;if(Math.abs(k)>q[3]/q[2]){if(l>g){d=s-q[3]/(2*k)}else{d=s+q[3]/(2*k)}c=d*k}else{if(f>t){d=s-q[2]/2}else{d=s+q[2]/2}c=k*d}p=(t+p);n=(g+n);d=(t+d);c=(g+c);var j=(d-p);var i=(c-n);var o=j<0?(180/Math.PI)*Math.atan(-i/j):(180/Math.PI)*Math.atan(i/j);if(j<0){o=180-o}m=Math.sqrt(j*j+i*i);u.css({top:n,left:p,width:m-b,height:4,"-webkit-transform-origin":"0px "+"2px","-moz-transform-origin":"0px "+"2px","-webkit-transform":"rotate("+o+"deg)","-moz-transform":"rotate("+o+"deg)"}).removeClass("right up left down").show()},drawDragged:function(n,c,g,d,l){var b;var i=15;var f,k,e,h;f=Math.floor(g[1]+c[1]+c[3]/2)*l-5;k=Math.floor(g[0]+c[0]+c[2]/2)*l-5;e=Math.floor(d[1]+document.getElementById("viewport").scrollTop+d[3]/2)-5;h=Math.floor(d[0]+document.getElementById("viewport").scrollLeft+d[2]/2)-5;var m=(h-k);var j=(e-f);var a=m<0?(180/Math.PI)*Math.atan(-j/m):(180/Math.PI)*Math.atan(j/m);if(m<0){a=180-a}b=Math.sqrt(m*m+j*j);n.css({top:f,left:k,width:b-i,height:4,"-webkit-transform-origin":"0px "+"2px","-moz-transform-origin":"0px "+"2px","-webkit-transform":"rotate("+a+"deg)","-moz-transform":"rotate("+a+"deg)"})},draw:function(c,k,j,f,o){o=o||project.get("currentZoom")||1;var l,p,g,n;var d=[];var m=[];var e=[];var a=(j.hasClass&&j.hasClass("connectorHelper"))?true:false;if(widgetsCache[k]&&widgetsCache[k].pageId===j){c.remove();return}if(typeof(k)==="string"&&window.widgetsCache&&widgetsCache[k]){d=widgetsCache[k].box;m=pagesCache[widgetsCache[k].pageId].box;if(!d||!m){return}if(pagesCache[j]&&pagesCache[j].box){e=pagesCache[j].box}else{if(pagesCache[j]){page.calculateWdgPositions(j);e=pagesCache[j].box}else{if(a){e=[parseInt(j.css("left")),parseInt(j.css("top")),parseInt(j.css("width")),parseInt(j.css("height"))]}else{var b=$(k).closest(".screen");var i=$(".page",$(b));e=[parseInt($(j).css("left")),parseInt($(j).css("top")),parseInt(i.css("width")),parseInt(i.css("height"))]}}}}else{var b=$(k).closest(".screen");var i=$(".page",$(b));var h=$(".page",$(j));d=[parseInt($(k).css("left")),parseInt($(k).css("top")),parseInt($(k).css("width")),parseInt($(k).css("height"))];m=[parseInt(b.css("left")),parseInt(b.css("top")),parseInt(i.css("width")),parseInt(i.css("height"))];e=[parseInt($(j).css("left")),parseInt($(j).css("top")),parseInt(h.css("width")),parseInt(h.css("height"))]}if(f=="ahref"&&a){link.drawDragged(c,d,m,e,o);return}else{if(o!=1){link.drawPageToPage(c,m,e,o);return}else{if(o==1){link.drawWdgToPage(c,d,m,e,o);return}else{return null}}}if(window.intercom){intercom.updateIfNotSet("everUsedLink",true)}},from:function(c){var a=project.get("links");for(var b in a.linkOrigin){if(a.linkOrigin[b]==c){return a.linkCanvId[b]}}return false},goesTo:function(c){var a=project.get("links");for(var b in a.linkDest){if(a.linkCanvId[b]==c){return a.linkDest[b]}}return false},comesFrom:function(c){var a=project.get("links");if(a==undefined){return false}for(var b in a.linkOrigin){if(a.linkCanvId[b]==c){return a.linkOrigin[b]}}return false},comesFromPage:function(e){var a=project.get("links");if(a==undefined){return false}for(var c in a.linkOrigin){if(a.linkCanvId[c]==e){var d=a.linkOrigin[c];var b=$("#"+d);if(b.size()>0){return b.parents(".screen").attr("id")}else{return widget.getPageOf(d)}}}return false},add:function(k,m,i,a,h,c){var o=project.get("links");var b=h!=undefined?h:project.get("defaultTransition");var g=c!=undefined?c:project.get("defaultGesture");for(var f in o.linkOrigin){if(o.linkType[f]=="template"&&o.linkOrigin[f]==k&&o.linkDest[f]==m){return false}}$(".page","#"+m).addClass("linkDropSuccess");setTimeout(function(){$(".page","#"+m).removeClass("linkDropSuccess")},500);var e=project.hasLinks()?false:true;var j=a||utils.guid("l");o.linkOrigin.push(k);o.linkDest.push(m);o.linkCanvId.push(j);o.linkType.push(i);o.transType.push(b);o.triggerType.push(g);if(e){var d=$("#"+widget.getPageOf(k));page.makeHome(null,d)}project.save();var n=link.template(j,i,b);n.find(".linkToggle").stop(true,true).fadeTo(300,1,link.showLinkMenuIntro);return n},target:function(c){var a=project.get("links");for(var b=0;b<a.linkCanvId.length;b++){if(a.linkCanvId[b]==c){return a.linkDest[b]}}return false},load:function(a,d){if(d){var b="";for(var c=0;c<a.linkOrigin.length;c++){if(a.linkDest[c]===widgetsCache[a.linkOrigin[c]].pageId){continue}b+='<div id="'+a.linkCanvId[c]+'" class="link link-new"></div>'}document.getElementById("canvasLinks").innerHTML=b}else{for(var c=0;c<a.linkOrigin.length;c++){if(a.linkDest[c]===widgetsCache[a.linkOrigin[c]].pageId){continue}link.template(a.linkCanvId[c],a.linkType[c],a.transType[c])}}},linkArrayIndex:false,del:function(g){function f(h){$(h).remove()}function c(h){$(h).find(".templateContent").empty().show()}if(typeof g==="object"){g=$(".openLinkMenu").closest(".link").attr("id")}if(g==undefined){return false}var a=project.get("links");for(var b in a.linkCanvId){if(a.linkCanvId[b]==g){var d="#"+a.linkCanvId[b];$(d).fadeOut(450,f(d));if(a.linkType[b]=="template"){var e="#"+a.linkDest[b];$(e).find(".templateContent").fadeOut(450,c(e))}link.spliceOut(a,b);break}}link.closeMenu();hint.show("selectWidget");$("#canvas").click()},remove:function(b){var a=project.get("links");$(b).each(function(){var g=$(this).attr("id");function f(h){h.remove()}for(var d in a.linkOrigin){if(widgetsCache[a.linkOrigin[d]]===undefined){continue}var c=widgetsCache[a.linkOrigin[d]].pageId;if(a.linkOrigin[d]==g||c==g||a.linkDest[d]==g){var e=$("#"+a.linkCanvId[d]);e.fadeOut(450,f(e));link.spliceOut(a,d);link.remove(b);break}}})},spliceOut:function(a,b){a.linkOrigin.splice(b,1);a.linkDest.splice(b,1);a.linkCanvId.splice(b,1);a.linkType.splice(b,1);a.transType.splice(b,1);a.triggerType.splice(b,1);project.save()},getCanvasHeight:function(){var a=18;return a/link.getCanvasScale()},getHeadHeight:function(){var a=14;return a/link.getCanvasScale()},getPadding:function(){var a=7;return a/link.getCanvasScale()},getCanvasScale:function(){return fullCanvas.currentScale},removeHighlightedPage:function(a){$(".screen").removeClass("pageLinkableCandidate")},hideLinkMenuIntro:function(){$(this).removeClass("linkToggleIntro")},showLinkMenuIntro:function(){$(this).addClass("linkToggleIntro")},serialize:function(a){return JSON.stringify(project.get("links"))},deserialize:function(c){var a=project.get("links");var b=JSON.parse(c);a.linkCanvId=b.linkCanvId;a.linkDest=b.linkDest;a.linkOrigin=b.linkOrigin;a.linkType=b.linkType;a.transType=b.transType;a.triggerType=b.triggerType;project.save();link.load(a);link.drawAll("all")}};var lib={cached:{},fadeInSpeed:300,thumbPos:{},currentDisplay:"",drawTimeout:null,defaultGroup:0,allDefinitions:["common","android","wireframe","android4","ios","ios7","windows8","desktop","googleGlass"],loadedDefinitions:[],defaultDefinition:"wireframe",loadDefinition:function(c){var d=new XMLHttpRequest();d.open("GET","js/fluid/data/widgets/"+c+".json",false);try{d.send(null);var a=JSON.parse(d.responseText);dbStorage.set("wdgDefinitions",{id:c,data:a});return a}catch(b){d.responseType="json";try{d.send(null)}catch(f){}dbStorage.set("wdgDefinitions",{id:c,data:d.response});return d.response}},loadWdgDefinitions:function(a){if(!a){dbStorage.onReady(function(){var b=["groups","categories","common"].concat(lib.allDefinitions);dbStorage.get("wdgDefinitions",b,function(g){var h,d,e,c=g.resultsObj,f;if(!(c.groups||c.categories||c[lib.defaultDefinition])){window.widgets={g:lib.loadDefinition("groups"),t:lib.loadDefinition("categories"),summary:{}};h=lib.loadDefinition(lib.defaultDefinition);for(e in h){if(h.hasOwnProperty(e)){window.widgets.summary[e]=h[e]}}d=lib.loadDefinition("common");for(e in d){if(d.hasOwnProperty(e)){window.widgets.summary[e]=d[e]}}lib.loadedDefinitions.push(lib.defaultDefinition)}else{window.widgets={g:c.groups.data,t:c.categories.data,summary:{}};for(f=0;f<g.fetched.length;f++){if(g.fetched[f]!=="groups"&&g.fetched[f]!=="categories"){for(e in c[g.fetched[f]].data){if(c[g.fetched[f]].data.hasOwnProperty(e)){window.widgets.summary[e]=c[g.fetched[f]].data[e]}}lib.loadedDefinitions.push(g.fetched[f])}}}lib.preloadBgImages();lib.init();lib.ready=true;fluid.main.trigger("libready")})})}},preloadBgImages:function(c){if(c>widgets.g.length-1){return}var a=widgets.g[(c!==undefined?c:this.defaultGroup)].n.replace(".","_").toLowerCase();var b=new Image();b.onload=function(f){var d;if(c===undefined){d=0}else{d=c+1}if(d==lib.defaultGroup){d++}setTimeout(function(){lib.preloadBgImages(d)},300)};b.src="img/libBg/libBg-"+a+".png"},closed:function(){return $("#library").find("#tabLibrary").hasClass("closed")},toggle:function(){var f=$("#library");function b(){zoomInAndCenterOnPage(project.getActivePage(),1,1,300)}var a=f.find("#tabLibrary");var e=f.outerWidth();var c=(a.hasClass("open"))?-e:0;f.animate({left:c},e/3,b);f.find("#tabLibrary").toggleClass("closed open");var d=(a.hasClass("open"))?"Open Library":"Close Library";a.attr("title",d)},show:function(a){var c=$("#library");if(lib.closed()){c.show();if(a&&$.isFunction(a)){a()}}else{if(c.position().left!=0||!c.is(":visible")){var b=account.get("libraryWidth");c.css({left:"-"+b+"px",display:"block",width:b});utils.animateRaf(function(d){c.css({left:(b*(d-1))+"px"})},lib.fadeInSpeed,"easeOutCubic",function(){if(c.children("#widgets").find(".thumb").height()===0||(lib.currentDisplay==="Uploads"&&(!lib.lastAccount||lib.lastAccount!==account.get("id")))){lib.lastAccount=account.get("id");lib.updateScrollbar()}if(a&&$.isFunction(a)){a();lib.updateScrollbarRelative()}})}}},resize:function(d,b){var a=b.size.width;account.set({libraryWidth:a});var c=$("#canvasPages .active");if(c.length==1){zoomInAndCenterOnPage(c,1,1,300)}lib.updateScrollbar();lib.updateUploadsButton()},setHeaderHoverIn:function(a){$(this).find("h6").stop(true,true).delay(300).fadeTo(200,1);setTimeout(function(){$(this).css("background","#ccc")},600)},setHeaderHoverOut:function(a){$(this).find("h6").stop(true,true).hide();setTimeout(function(){$(this).css("background","rgba(205,205,205,0.0)")},600)},collapseSection:function(h){var c=$(this).parents(".basicBG").attr("id");var d=$("#"+c);var i=d.children(".scrollbar");var a=i.children(".track");var b=a.children(".thumb");var g=parseFloat(b.css("top"));if($(this).hasClass("closed")){$(this).removeClass("closed").html("Hide")}else{$(this).addClass("closed").html("Show")}$(this).parent("header").siblings("ol").toggleClass("hidden");$(this).parent("header").siblings(".hideButton").toggleClass("hidden");$(d).tinyscrollbar();var f=(g+b.height())-a.height();if(f<0){f=0}d.tinyscrollbar_update(g-f)},updateScrollbar:function(){$("#widgets").tinyscrollbar()},updateScrollbarRelative:function(){$("#widgets").tinyscrollbar_update("relative")},scrollBottom:function(){$("#widgets").tinyscrollbar_update("bottom")},init:function(){var a={};for(var h=0;h<widgets.g.length;h++){var j=widgets.g[h];var g=a[j.s];if(!g){a[j.s]=g=[]}g.push(j)}var c=false;for(var b in a){$("#tmplGroupSection").tmpl({n:b,d:c}).appendTo("#widgetGroupSelect");var g=a[b];for(var h=0;h<g.length;h++){$("#tmplGroupSelect").tmpl(g[h]).appendTo("#widgetGroupSelect")}c=true}lib.draw(widgets.g[this.defaultGroup].n);lib.currentDisplay=widgets.g[this.defaultGroup].n;widget.addUploads();var f=[];var e=account.get("uploads");if(e){for(var d=0;d<e.length;d++){f.push(e[d].id)}}dbStorage.onReady(function(){dbStorage.get("uploadThumbs",f,function(l){if(!window.uploadThumbsCache){window.uploadThumbsCache={}}for(var k=0;k<l.fetched.length;k++){uploadThumbsCache[l.fetched[k]]=l.resultsObj[l.fetched[k]].data}})});fluid.main.on("projectNameChanged,libraryUpdateUploads",function(k,i){var l=$("#library .viewport");i=i||{forceAllUploadsOpened:false};lib.cache("Uploads",i);if($("#widgetGroupTitle").text()==="Uploads"){l.find(".overview").hide().remove();lib.cached["Uploads"].appendTo(l);l.find(".overview").show();lib.updateScrollbar()}});fluid.main.on("updateUploadCounters",function(l,k){function i(n){var m=n.find(".libraryWidget").length;if(m===0){n.find(".tab-count").hide();n.addClass("empty")}else{n.removeClass("empty");n.find(".tab-count").text(m).show()}}if(k&&k.projectIds){k.projectIds.forEach(function(m){i($("#project-"+m))})}else{$(".projectTab").each(function(n,m){i($(m))})}lib.updateEmptyTabs()});fluid.main.on("projectCloned, projectOpened, projectCreated, projectRemoved",function(){lib.redrawUpdates()});fluid.main.on("widgetDropped",function(i,r){var s=r.widgetId;var l=$('[data-id="'+s+'-thumb"]');var t=account.get("lastOpenProject");var v,w,p,n,u;var m,k,q;if(s&&s.length&&s.slice(0,1)==="i"&&t.length){v=$("#project-"+t);w=v.find(".uploadTabs-project");$widget=$('#library [data-id="'+s+'"]').first()}else{return false}var o=v.find('[data-id="'+s+'"]').length;if(!o){m=storage.get(s);m.groups=m.groups||[];if($.inArray(t,m.groups)===-1){m.groups.push(t);storage.set(s,JSON.stringify(m))}p=$widget.clone();p.attr("id","");p.attr("data-id",s);w.parent().removeClass("empty");w.append(p);p[0].style.backgroundImage="url(img/ajax-loader.gif)";p[0].style.backgroundSize="100%";q=new Image();q.onload=lib.onUploadLoad;q.onerror=lib.onUploadError;if(m&&m.storage!=="db"){q.src=imgCloudUrl+(widgets.summary[s].data||s)+".png"}else{q.src="data/img/"+s}n=$("#project-notInAnyProject");u=$("#project-notInAnyProject").find('[data-id="'+s+'"]');if(u.length){if(n.find(".libraryWidget").length===1){n.removeClass("active")}u.remove();lib.updateScrollbarRelative()}fluid.main.trigger("updateUploadCounters")}})},_createDragHelper:function(g){var d=$(this).attr("id");if(!d){d=$(this).attr("data-id")}var a=$.extend(true,{isHelperWidget:true},widget.get(d));a.wh=a.wh||[80,120];a.wh[0]=(a.wh[0]=="a")?"100%":a.wh[0];a.wh[1]=(a.wh[1]=="a")?"100%":a.wh[1];if(a.upload==="y"){var f=storage.get(document.querySelector(".canvasObject.active").id),c=utils.getFitSize({object:{width:a.wh[0],height:a.wh[1]},frame:{width:f.width,height:f.height}});a.wh=[c.width,c.height]}a.wh[0]=(typeof a.wh[0]==="string")?$("#canvasPages .active .widgetHolder").width()*parseInt(a.wh[0])/100:a.wh[0];a.wh[1]=(typeof a.wh[1]==="string")?$("#canvasPages .active .widgetHolder").height()*parseInt(a.wh[1])/100:a.wh[1];var b=(a.st&&a.st=="b")?[0,0,80,120]:[0,0,a.wh[0],a.wh[1]];var h=$("#tmplDraggingWidgetContainer").tmpl(a);if(a.upload=="y"){h.addClass("upload")}widget._drawFromRoot($(this).attr("id")||$(this).attr("data-id"),h.find(".widgetParts"),b,a);return h},dropdownChangeSet:function(c){var b=parseFloat($("#widgets").children(".scrollbar").find(".thumb").css("top"));lib.thumbPos[lib.currentDisplay]=b;var a=$(c.target).text();setTimeout(function(){lib.draw(a);$("#widgets").tinyscrollbar_update(lib.thumbPos[a]);lib.currentDisplay=a;tracker.record("LibarySetChange"+a,1)},10);c.preventDefault();return false},adjustToCssClass:function(a){a=a.replace(".","_").toLowerCase();return a},draw:function(i){var d={"Wireframe":"wireframe","Desktop":"desktop","iOS7":"ios7","iPad":"ios","iPhone":"ios","Android-4.4":"android4","Android-Tablet":"android4","Android":"android","Google-Glass":"googleGlass","Windows-8":"windows8"};if(d[i]&&lib.loadedDefinitions.indexOf(d[i])===-1){var b=lib.loadDefinition(d[i]),e;for(e in b){if(b.hasOwnProperty(e)){window.widgets.summary[e]=b[e]}}lib.loadedDefinitions.push(d[i])}if(i===undefined||i===null){i=lib.currentDisplay}$("#widgetGroupTitle").text(i);var a=lib.currentDisplay;var h=$("#library").removeClass(this.adjustToCssClass(a)).addClass(this.adjustToCssClass(i));var c=i.toLowerCase()=="uploads";var g=c&&a.toLowerCase()=="uploads";var k=$("#library .viewport");k.find(".overview").hide().remove();if(c){if(lib.cached.hasOwnProperty(i)){delete lib.cached[i]}}var f=lib.cached.hasOwnProperty(i);if(!f&&!g){$("#libraryLoading").show()}function j(){$("#libraryLoading").hide();if(!f){lib.cache(i)}lib.cached[i].appendTo(k);if(g){lib.cached[i].show()}else{lib.cached[i].fadeIn(this.fadeInSpeed)}search.filter();lib.drawTimeout=null;lib.updateUploadsButton()}if(g){j()}else{if(lib.drawTimeout){window.clearTimeout(lib.drawTimeout)}lib.drawTimeout=window.setTimeout(j,10)}return false},drawSingleUpload:function(h,g){var f=$("#widgetGroupUploads");if(f.length){var a=$("<li id="+h+' class="libraryWidget" title="Click or drag-and-drop to add" style="background-image: none;">');var b=$('<div class="pageWidget" style="top:2px;left:2px;width:50px;height:50px;">');a.append(b);b.append('<canvas width="50" height="50" id="'+h+"-thumb"+'"></canvas>');b.append('<div class="widgetTitle">'+g+"</div>");var d=b[0].querySelector("canvas");d.style.backgroundImage="url(img/ajax-loader.gif)";d.style.backgroundSize="100%";f.append(a);var c=new Image(),e=storage.get(h);c.onload=lib.onUploadLoad;c.onerror=lib.onUploadError;if(e&&e.storage!=="db"){c.src=imgCloudUrl+(widgets.summary[h].data||h)+".png"}else{c.src="data/img/"+h}}else{lib.draw("Uploads")}},onUploadLoad:function(b){var a=this;var d=this.src.split("/");d=d[d.length-1].replace(".png","");var c=document.querySelectorAll('canvas[data-id="'+d+'-thumb"]');if(!widgets.summary[d].wh[0]){widgets.summary[d].wh[0]=this.width}if(!widgets.summary[d].wh[1]){widgets.summary[d].wh[1]=this.height}if(!widgets.summary[d].groups){widgets.summary[d].groups=[]}if(c.length){Array.prototype.forEach.call(c,function(f){f.style.backgroundImage="none";var e=f.getContext("2d");e.fillStyle="#cccccc";e.fillRect(0,0,50,50);if(a.width===0&&a.height===0){e.drawImage(a,0,0)}else{if(a.width<=50&&a.height<=50){e.drawImage(a,25-a.width/2,25-a.height/2-Math.max((34-a.height)/2,0))}else{if(a.width<a.height){e.drawImage(a,0,0,50*a.width/a.height,50)}else{e.drawImage(a,0,0,50,50*a.height/a.width)}}}});dbStorage.set("uploadThumbs",{id:d,data:c[0].toDataURL("image/jpeg",0.9)})}},onUploadError:function(){if(this.src.indexOf("/data/img")===-1){urlArr=this.src.split("/");urlArr=urlArr[urlArr.length-1].split(".");var a=new Image();a.src="data/img/"+urlArr[0];a.onload=lib.onUploadLoad}},createLibOrder:function(f){var e=[];var c=$.extend(true,{},widgets.summary);for(var a in c){if(c.hasOwnProperty(a)){e.push(a)}}var b=e;if(f=="Desktop"){var d=widgetLibOrder.createOrder();if(d.length>0){b=d}}return b},cache:function(f,a){var e=$('<nav class="overview" style="display:none;"></nav>');var k=[];var t;var j=$("#uploadTabs > .allUploads");var s="";var c=account.get("lastOpenProject");var g={};var b=false;if(!j.length||j.hasClass("active")){b=true}var m={name:"Not in any project",activeProject:true,projectElements:"",id:"notInAnyProject",count:0,empty:true,notInAny:true};var p=function(n,w){var i="";i+="<li data-id="+w+' class="libraryWidget" title="Click or drag-and-drop to add" style="background-image: none;">';i+='<div class="pageWidget" style="top:2px;left:2px;width:50px;height:50px;">';if(uploadThumbsCache[w]){i+='<img width="50" height="50" data-id="'+w+"-thumb"+'" src="'+uploadThumbsCache[w]+'"/>'}else{i+='<canvas class="toLoad" width="50" height="50" data-id="'+w+"-thumb"+'"></canvas>'}i+='<div class="widgetTitle">'+n.title+"</div></li>";return i};for(var q=0;q<widgets.t.length;q++){k[q]=""}if(f==="Uploads"){account.get("projectIds").forEach(function(i){var n=storage.get(i);if(n){g[i]={name:n.name,id:i,projectElements:"",count:0,lastUpdate:n.updated,empty:true}}})}var v=lib.createLibOrder(f);for(var h=0;h<v.length;h++){var y=v[h];var d=widgets.summary[y];if(d&&d.g&&d.g.indexOf(f)!=-1){var o=d["t"];t=widgets.t.indexOf(o[0]);if(widgets.summary[y].removed){continue}if(widgets.summary[y].upload){s=p(d,y);if(widgets.summary[y].groups&&widgets.summary[y].groups.length){widgets.summary[y].groups.forEach(function(n){var i=storage.get(n);if(i){g[n]=g[n]||{projectElements:"",id:n,name:i.name,lastUpdate:i.updated,count:0};g[n].projectElements+=s;g[n].count+=1;g[n].empty=false}else{widgets.summary[y].groups=[];m.projectElements+=s;m.count+=1;m.empty=false}})}else{m.projectElements+=s;m.count+=1;m.empty=false}k[t]+=s}else{k[t]+='<li id="'+y+'" class="libraryWidget" title="Click or drag-and-drop to add"><div class="widgetTitle">'+d.title+"</div></li>"}}}var x="";var r=[];for(q=0;q<k.length;q++){if(k[q]!=""){if(widgets.t[q]==="Uploads"){if(g[c]){g[c].currentProject=true;g[c].activeProject=true}else{b=true}r.push(m);var l;for(l in g){r.push(g[l])}r.sort(function u(n,i){return i.lastUpdate-n.lastUpdate});if(m.count===0){m.activeProject=false}x+=fluid.util.tpl("uploadTabs",{projects:r,allUploads:k[q],openAllUploads:b})}else{x+='<section class="setHeader"><header><h2>'+widgets.t[q]+"</h2><h6>Hide</h6></header>";x+='<ol id="widgetGroup'+widgets.t[q]+'">';x+=k[q];x+="</ol></section>"}}}e.get(0).innerHTML=x;if(f=="Uploads"){if(account.get("loggedIn")=="yes"){$("#tmplUpload").tmpl().prependTo(e)}else{$("#tmplUploadDisabled").tmpl().prependTo(e)}e.find("#widgetGroupUploads img").load(function(){var w=$(this);var i=w.closest(".libraryWidget");var z=i.attr("id")||i.attr("data-id");var n=widgets.summary[z];if(!n.wh[0]||!n.wh[1]){w.css({"height":"auto","width":"auto"});n.wh=[w.width(),w.height()];w.closest(".pageWidget").css({width:n.wh[0],height:n.wh[1]});widget.scale(w.closest(".widgetParts"),n);w.css({"height":"100%","width":"100%"})}});e.find("canvas.toLoad").each(function(){var w=$(this);var z=w.attr("data-id").replace("-thumb","");var i=new Image();var n=storage.get(z);i.onload=lib.onUploadLoad;i.onerror=lib.onUploadError;if(!n||!n.storage||n.storage==="cloud"){i.crossOrigin="Anonymous";i.src=imgCloudUrl+(widgets.summary[z].data||z)+".png"}else{i.src="data/img/"+(widgets.summary[z].data||z)}w.removeClass("toLoad")})}lib.cached[f]=e},showUploads:function(){$("#widgetGroupSelect a:last").click()},updateUploadsButton:function(g){var b=document.querySelector(".btnUpload"),c=document.getElementById("uploadShortcutForm"),e=g==undefined?account.get("libraryWidth"):g;e=e==undefined?500:e;if((e>360)&&(lib.currentDisplay!="Uploads")){var a=account.get("uploads"),f=false;for(var d=0;d<a.length;d++){if(!widgets.summary[a[d].id].removed){f=true;break}}if(account.get("loggedIn")==="yes"&&!f){c.style.display="";b.classList.add("hide")}else{c.style.display="none";b.classList.remove("hide")}}else{b.classList.add("hide");c.style.display="none"}},resizeSteps:function(c,b){var a=b.size.width;lib.updateUploadsButton(a)},esc:function(){if(canvas2.isEditorVisible()){if(!canvas2.isZoomedOut()){canvas2.zoomOut()}}else{if($("#previewHolder").hasClass("open")){preview.close()}else{$("#accountFrame").fadeOut();fluidMenu.show()}}},handleUploadsRemovedFromPage:function(b,a,c){if(a&&c){fluid.util._.each(b,function(e){if(e&&e[0]==="i"){var d=storage.get(e);d.groups=fluid.util._.without(d.groups,a);widgets.summary[e].groups=d.groups;storage.set(e,d)}});fluid.main.trigger("updateUploadCounters")}lib.redrawUpdates()},updateEmptyTabs:function(){$(".uploadTabs-project").filter(function(){return $(this).find("li").length===0}).parent().addClass("empty");$(".uploadTabs-project").filter(function(){return $(this).find("li").length!==0}).parent().removeClass("empty")},redrawUpdates:function(){lib.redrawUpdates=fluid.util._.debounce(function(){fluid.main.trigger("libraryUpdateUploads",{forceAllUploadsOpened:!!$(".tabTrigger.allUploads.active").length})},500);lib.redrawUpdates()}};var hint={hints:{"createPage":"Double-click to add pages","createAnotherPage":"Add another page","editPage":"Click page to edit","library":"Drag widgets here","selectWidget":"Select a widget","libraryDoubleClick":"Click widgets in the library to place here","Zoomout":"Click to zoom out","link":"Click link button to link pages","draggingLink":"Link to new page","stoppedPreview":"Sign in to store online"},startedPreview:false,stoppedPreview:false,readyToSignIn:false,restart:function(){hint.cleanup();if(project.readOnly()){return}if(!canvas2.isZoomedOut()){return}var a=project.get("pages");if(a.length==0){hint.hide();hint.show("createPage");return}if(!account.needHints()){return}if(project.hasLinks()){if(hint.startedPreview){hint.show("stoppedPreview")}else{if(account.get("hint")){hint.show(account.get("hint"));return}hint.show("droppedLink")}return}if(a.length==1){hint.show("createAnotherPage")}else{hint.show("editPage")}},show:function(k,o){function m(){hint.cleanup();setTimeout(function(){hint.show("editPage")},200)}function c(h){if(canvas2.isZoomedOut()){i(h);$("#viewport").unbind(".msg")}}function i(h){hint.hide();setTimeout(hint.restart,500)}if(((project.readOnly())||(!account.needHints()))&&(k!="createPage")&&(k!="library")&&(k!="selectWidget")){hint.cleanup();return}if((project.readOnly())&&(k=="library")){hint.cleanup();return}var d=$("#hint");if(d.size()==0){d=$("#tmplHint").tmpl()}if(k=="createPage"){function l(p){hint.resetIndicators();d.detach().html(p).prependTo("#canvas").fadeIn(1500);hint.position("center");$("#createNewPage, #createNewPageButton").animate({opacity:0},200);$("#createNewPage, #createNewPageButton").css("pointer-events","none");$("#canvas").bind("dblclick.msg",f);$("#createNewPageButton").bind("click.msg",f)}function f(){hint.cleanup();setTimeout(function(){hint.show("createAnotherPage")},200)}$("#hint").fadeOut(300);setTimeout(l,310,hint.hints[k])}else{if(k=="createAnotherPage"){hint.resetIndicators();d.hide().detach().html(this.hints[k]).prependTo("#canvas").fadeIn(300);hint.position("page");$("#createNewPageButton").bind("click.msg",m);$("#canvas").bind("dblclick.msg",m);if(project.hasWidgets()){fluidMenu.setButtonStyle($("#previewView, #preview"),false)}}else{if(k=="editPage"){if(!project.hasLinks()){hint.resetIndicators();d.hide().detach().html(this.hints[k]).prependTo("#canvas").fadeIn(300);hint.position("page");$("#createNewPageButton").bind("click.msg",m);$("#canvas").bind("dblclick.msg",m)}else{hint.cleanup()}}else{if(k=="library"){function j(){var q=$(".screen.active");var h=q.attr("id");var p=page.get(h,"widgets");if(p.length>0){hint.hide();return}if($("#hint",q).size()==0){d.hide().detach().html(hint.hints[k]).prependTo(q).fadeIn(600)}hint.position("library")}setTimeout(j,500);hint.cleanup();$("#zoomOut").bind("click.msg",i);$("#viewport").bind("mousewheel.msg",c)}else{if(k=="selectWidget"){return}else{if(k=="link"){$("#hint").html("").hide();if(!project.hasLinks()){hint.resetIndicators();contextMenu.setButtonStyle($("#cmLink"),false,false)}else{contextMenu.setButtonStyle($("#cmLink"),true,false)}}else{if(k=="draggingLink"){$(".screen").not(".active, .activeZooomedOut").addClass("pageLinkable");var b=project.get("pages");if(b.length==1){hint.resetIndicators();d.hide().detach().html(this.hints[k]).prependTo("#canvas").fadeIn(300);hint.position("newPage")}else{return}}else{if(k=="droppedLink"){hint.hide();function n(){if(project.hasLinks()){contextMenu.setButtonStyle($("#cmLink"),true,false);if(!hint.startedPreview){fluidMenu.setButtonStyle($("#previewView, #preview"),true)}else{hint.show("stoppedPreview");return}}else{fluidMenu.setButtonStyle($("#previewView, #preview"),true);hint.resetIndicators();return}}setTimeout(n,500)}else{if(k=="startedPreview"){if(!hint.startedPreview){function e(){fluidMenu.setButtonStyle($("#closePreview"),true)}fluidMenu.setButtonStyle($("#previewView, #preview"),false,false);hint.resetIndicators();hint.startedPreview=true;setTimeout(e,200)}else{return}}else{if(k=="stoppedPreview"){hint.startedPreview=true;hint.stoppedPreview=true;hint.readyToSignIn=true;fluidMenu.setButtonStyle($("#closePreview"),false,false);if(account.get("loggedIn")=="yes"){hint.endTutorial();k="end"}else{function g(){fluidMenu.highlightButton($("#startMenu"));d.hide().detach().html(hint.hints[k]).prependTo("#canvas").fadeIn(600);hint.position("hud")}setTimeout(g,500)}}else{if(k=="end"){if(hint.readyToSignIn){hint.endTutorial()}}}}}}}}}}}}if((k!="createPage")&&(k!="library")&&(account.get("loggedIn")==="yes")&&(k!=account.get("hint"))){var a=k=="end"?"1":"0";account.set({tutorialLevel:a,hint:k})}},resetIndicators:function(){hint.startedPreview=false;hint.stoppedPreview=false;hint.readyToSignIn=false},endTutorial:function(){hint.cleanup();$("#hint").hide()},position:function(l){if(l=="center"){var c=800;var f=$("#canvas").offset();var d=utils.getTLWH("#viewport");var g=$("#hint").outerHeight();var k=d.height/2-f.top-g/2-20;var a=d.width/2-f.left-c/2;$("#hint").css({top:k,left:a,width:c,"text-align":"center","z-index":""})}else{if(l=="page"){function o(){var u=utils.getTLWH($(".screen:last"));var v=500;var r=$("#canvas").offset();var s=utils.getTLWH("#viewport");var t=0-r.top+u.top-110;var q=0-r.left+u.left-220;if(t<50-r.top){t+=240}if(q<0-r.left){q+=160}if(q>s.width-r.left-v){q-=v}$("#hint").css({top:t,left:q,width:v,"text-align":"center","z-index":""})}if($("#canvas").hasClass("zoomedOut")){o()}else{setTimeout(o,500)}}else{if(l=="newPage"){function p(){var u=320;var r=$("#canvas").offset();var s=utils.getTLWH("#viewport");var t=0-r.top+(s.height/2)-50;var q=0-r.left+s.width-u-100;$("#hint").css({top:t,left:q,width:u,"text-align":"center","z-index":""})}if($("#canvas").hasClass("zoomedOut")){p()}setTimeout(p,500)}else{if(l=="library"){var i=$(".screen.active");var j=i.attr("id");var n=page.get(j,"widgets");var m=10;var c=320-(2*m);var b=utils.getTLWH($("#hint"));var h=(page.get(j,"height")-b.height-(2*m)-30)/2;var e=(page.get(j,"width")-c)/2;$("#hint").css({top:h,left:e,width:c,"text-align":"left",padding:m,"z-index":2})}else{if(l=="hud"){var c=450;var f=$("#canvas").offset();var d=utils.getTLWH("#viewport");var k=0-f.top+60;var a=0-f.left+d.width-c;$("#hint").css({top:k,left:a,width:c,"text-align":"center","z-index":""})}else{if(l=="default"){$("#hint").css({top:"",left:"",width:"","text-align":"",padding:"","z-index":""})}}}}}}},hide:function(){$("#hint").html("").hide();fluidMenu.setButtonStyle($("#previewView, #previewCloseView"),false,false);contextMenu.setButtonStyle($("#cmLink"),true,false)},cleanup:function(){hint.hide();$(document).unbind(".msg");$("#canvas").unbind(".msg");$("#createNewPageButton").unbind(".msg");$(".libraryWidget").unbind(".msg");$("#zoomOut").unbind(".msg");$("body").unbind(".msg");$("#contextMenuItems .main").unbind(".msg");$("#viewport").unbind(".msg")}};var notification={config:{displayDuration:4500,alertDisplayDuration:9000,alertTypes:["alert","testAlert"],alertResumeThreshold:1000,messageExpiration:2000,pageSize:3,expandMessageDelay:30,fadeInDuration:300,fadeOutDuration:150,openDuration:300,closeDuration:150,moveDuration:300,summaryOrientation:"horizontal",summaryShowDuration:1000,summaryFadeInDuration:150},messages:[],alerts:[],summaries:{total:{count:0}},expandedType:null,expandedPage:0,currentMessage:null,currentPage:0,messageTimeout:null,summaryTimeout:null,interrupted:false,init:function(){$("#tmplNotifications").tmpl({}).appendTo("body");var a=$("#notifications > .summaries");a.mouseover(function(){notification._stopSummaries()}).mouseout(function(){if(!notification.expandedType){notification._hideSummariesDelayed()}})},add:function(b,c,d,a){if($.isPlainObject(d)){a=d;d=undefined}else{a|={}}var e={type:b,message:c,scope:a.scope,permanent:Boolean(a.permanent),stopBuggingCallBack:a.stopBuggingCallBack};if(e.stopBuggingCallBack!=undefined){notification.removeAll(b,e.scope)}if($.inArray(b,this.config.alertTypes)>-1){this.alerts.push(e);this._drawAlerts()}else{this._stopSummaries();this.messages.push($.extend(e,{info:d||a.info}));if(this.summaries.hasOwnProperty(b)){this.summaries[b].count++}else{this.summaries[b]={count:1}}this._updateTotal();this._drawMessages();this._drawSummaries()}},remove:function(c){if(!c.removed){if(this.currentMessage&&this.currentMessage===c){this._stopMessages()}this._stopMessageExpiration(c);var a=$.inArray(c.type,notification.config.alertTypes)>-1;if(a){this.alerts.splice($.inArray(c,this.alerts),1)}else{this.messages.splice($.inArray(c,this.messages),1);this.summaries[c.type].count--}this._updateTotal();c.removed=true;if(c.element.is(":visible")){c.element.fadeOut(this.config.fadeOutDuration,function(){c.element.remove();if(a){if(notification.alerts.length==0){notification._continueInterrupted()}}else{if(!notification.expandedType){notification._drawNextCollapsed()}}});if(this.alerts.length>0){notification._drawAlerts()}}else{c.element.remove()}if(!a){if(this.expandedType&&this.alerts.length==0){var b=this._pageOfType(this.expandedType,this.currentPage);$(b).map(function(){return this.element}).not(":visible").fadeIn(this.config.fadeInDuration);this._drawMessages()}this._drawSummaries();if(this.expandedType&&this.summaries[this.expandedType].count==0){this.expandedType=null;this._hideSummariesDelayed()}}}},removeAll:function(e,d){if(d&&!$.isArray(d)){d=[d]}var b;if(e){b=[$.inArray(e,this.config.alertTypes)>-1?this.alerts:this.messages]}else{b=[this.messages,this.alerts]}for(var c=0;c<b.length;c++){var f=b[c];for(var a=f.length-1;a>=0;a--){var g=f[a];if(!d||$.inArray(g.scope,d)>-1){this.remove(g)}}}},expand:function(b){if(this.alerts.length==0){this._stopMessages();this._stopSummaries();if(this.expandedType){this.collapse(function(){notification.expand(b)})}else{this.expandedType=b;this.currentPage=0;if(this.currentMessage){function a(){notification.currentMessage=null;window.setTimeout(function(){notification._showMessages(b)},10)}if(this.currentMessage.element.data("stopped")){this.currentMessage.element.queue(a)}else{this.currentMessage.element.fadeOut(this.config.fadeOutDuration,a)}}else{this._showMessages(b)}}}},_showMessages:function(d,e,c,a){if(!e){this._drawPager();var b=this._pageCount();a=b>1?-1*$("#notifications .pager").outerHeight(true):0;if(this.currentPage>=b){this.currentPage=b-1}e=this._pageOfType(d,this.currentPage);c=0}var f=e[c];this._drawMessage(f,a);a-=f.element.outerHeight();this.messageTimeout=new Timeout(this.config.expandMessageDelay,function(){if(c<e.length-1){notification._showMessages(d,e,c+1,a)}})},_pageOfType:function(e,a){var c=[];var d=a*this.config.pageSize;var g=d+this.config.pageSize-1;if(!e||e=="total"){var f=this.messages.length-g-1;c=this.messages.slice(Math.max(f,0),f+this.config.pageSize)}else{var h=0;for(var i=this.messages.length-1;i>=0;i--){var b=this.messages[i];if(b.type==e){if(h>=d){c.unshift(b)}if(h==g){break}h++}}}return c},collapse:function(a){this._stopMessages();this.expandedType=null;this._hideMessages(a);this._hideSummariesDelayed()},_hideMessages:function(e,d,c){if(c===undefined&&typeof d=="boolean"){c=d;d=undefined}if(!d){d=this._prevVisible()}var a=$(d.element);var b=notification._prevVisible(d);if(!b&&!c){a=a.add("#notifications .pager")}$.when(a.fadeOut(this.config.fadeOutDuration)).then(function(){if(d.expanded){notification._toggleInfo(d)}if(!b&&e){d.element.queue(function(){d.element.dequeue();e.call(notification)})}});if(b){this.messageTimeout=new Timeout(this.config.expandMessageDelay,function(){notification._hideMessages(e,b,c)})}},_prevVisible:function(c){var d;var b=c?$.inArray(c,this.messages):this.messages.length;for(var a=b-1;a>=0;a--){var e=this.messages[a];if(e.element&&e.element.is(":visible")){d=e;break}}return d},_drawMessages:function(){if(this.alerts.length==0){if(this.expandedType){this._drawExpanded()}else{this._drawCollapsed()}}},_drawExpanded:function(a,g){var e;if(g){e={idx:0,next:function(){return this.idx<notification.alerts.length?notification.alerts[this.idx++]:null}}}else{e={page:this._pageOfType(this.expandedType,this.currentPage),idx:0,next:function(){return this.idx<this.page.length?this.page[this.idx++]:null}}}var i=0;var h=a||0;this._drawPager();if(this._pageCount()>1){h-=$("#notifications .pager").outerHeight(true)}var b,f;while((i<this.config.pageSize)&&(b=e.next())){if(!f){f=b}if(!b.removed){if(b.shown){var d=h-b.element.outerHeight();var c=b.element.is(":visible");if(d!=b.element.position().top){if(c){b.element.animate({top:d},this.config.moveDuration)}else{b.element.css({top:d}).fadeIn(this.config.fadeInDuration)}}else{if(!c){b.element.fadeIn(this.config.fadeInDuration)}}h=d}else{this._drawMessage(b,h);if(g&&!b.permanent){b.timeout=new Timeout(this.config.alertDisplayDuration,(function(j){return function(){notification.remove(j)}})(b))}h-=b.element.outerHeight()}}i++}if(!g){b=f;while(b=this._prevVisible(b)){b.element.fadeOut(this.config.fadeOutDuration)}}},_drawCollapsed:function(){if(!this.currentMessage&&(!this.messageTimeout||this.messageTimeout.complete())){for(var b=0,a=this.messages.length;b<a;b++){var c=this.messages[b];if(!c.removed&&!c.shown){this.currentMessage=c;break}}if(this.currentMessage){this._drawMessage(this.currentMessage,0);this.messageTimeout=new Timeout(this.config.displayDuration,function(){notification._drawNextCollapsed()})}else{this._hideSummariesDelayed()}}},_drawNextCollapsed:function(){if(this.currentMessage&&this.currentMessage.element&&!this.interrupted){if(this.currentMessage.element.is(":visible")){this.currentMessage.element.fadeOut(this.config.fadeOutDuration,function(){var a=notification.currentMessage;notification.currentMessage=null;if(!a||!a.element||!a.element.data("stopped")){notification._drawCollapsed()}})}else{notification.currentMessage=null;notification._drawCollapsed()}}},_drawAlerts:function(){var a=0;var b=this._expandedMessage();if(b){a=-1*b.element.outerHeight();if(b.element.position().top!=a){b.element.animate({top:a+"px"},this.config.moveDuration)}}this._interrupt(function(){notification._drawExpanded(a,true)})},_drawMessage:function(c,a){var b=$("#notifications .messages ul");if(!c.element){c.element=$("#tmplNotification").tmpl({type:c.type,text:typeof c.message=="string"?c.message:$(c.message).html(),info:typeof c.info=="string"?c.info:$(c.info).html(),stopBugging:false}).addClass("collapsed").click((function(d){if($.inArray(d.type,notification.config.alertTypes)==-1){return function(f){notification._toggleInfo(d)}}else{return function(){}}})(c)).prependTo(b);c.element.find(".close").click((function(d){return function(f){notification.remove(d)}})(c));c.element.find("input[type=submit], input[type=button], button").click((function(d){return function(f){notification.remove(d)}})(c))}else{c.element.show()}c.element.stop(true,true).dequeue().css({width:c.element.closest("div").width()-c.element.outerWidth()+c.element.width()}).css({top:a-c.element.outerHeight()}).hide().fadeIn(this.config.fadeInDuration);c.shown=true},_pageCount:function(){return this.expandedType?Math.ceil(this.summaries[this.expandedType].count/this.config.pageSize):1},_drawPager:function(){var c=$("#notifications .pager");var b=c.find(".pager-page");var d=this._pageCount();if(b.size()!=d){c.empty();for(var a=0;a<d;a++){var e=$("#tmplNotificationPage").tmpl({}).click((function(f){return function(){notification._toPage(f)}})(a)).appendTo(c);if(a==this.currentPage){e.addClass("active")}}}else{b.filter(".active").removeClass("active");b.eq(this.currentPage).addClass("active")}if(d>1){c.fadeIn(this.config.fadeInDuration)}else{c.fadeOut(this.config.fadeOutDuration)}},_toPage:function(a){this._hideMessages(function(){this.currentPage=a;this._showMessages(this.expandedType)},true)},_updateTotal:function(){this.summaries["total"].count=0;for(var a in this.summaries){if(a!="total"){this.summaries["total"].count+=this.summaries[a].count}}},_drawSummaries:function(){var f=$("#notifications .summaries ul");var g=0;var h=this.config.summaryOrientation!="vertical";for(var e in this.summaries){var d=this.summaries[e];if(d.element){if(d.count>0){d.element.children(".summary").text(d.count.toString());var a=d.element.is(":visible");var b=d.element.position();if(g!=(h?b.left:b.top)){var c=h?{left:g}:{top:g};if(!a){d.element.css({opacity:0.001}).show();c.opacity=1}d.element.animate(c,this.config.moveDuration)}else{if(!a){d.element.fadeIn(this.config.fadeInDuration)}}if(e=="total"&&d.element.hasClass("totalHidden")){d.element.switchClass("totalHidden","",this.config.fadeInDuration)}}else{d.element.fadeOut(this.config.fadeOutDuration)}}else{if(d.count>0){d.element=$("#tmplNotificationSummary").tmpl({type:e,text:d.count.toString()}).css(h?{left:g}:{top:g}).click((function(j,i){return function(k){if(i=="total"&&j.element.hasClass("totalHidden")){notification._showSummaries()}else{if(notification.expandedType==i){notification.collapse()}else{notification.expand(i)}}}})(d,e)).hide().appendTo(f).fadeIn(this.config.fadeInDuration)}}if(d.count>0&&d.element){g+=h?d.element.outerWidth():d.element.outerHeight()}}},_toggleInfo:function(g){this._stopMessages();var d=g.element.find(".message .content");var e;if(this.expandedType&&!this.interrupted){var f=this._pageOfType(this.expandedType,this.currentPage);e=$(f).map(function(){return this.element[0]}).not(g.element)}if(g.expanded){if(g.element.is(":visible")){if(e){e.fadeIn(this.config.fadeInDuration)}var b=g.element.outerHeight()-d.height();d.animate({height:g.height},{duration:this.config.closeDuration,complete:function(){notification._hideInfo(g);if(!notification.expandedType){notification._drawNextCollapsed()}}});g.element.animate({top:this.alerts.length>0?-1*(g.height+b):g.top},this.config.closeDuration)}else{notification._hideInfo(g)}g.expanded=false;notification._startMessageExpiration(g)}else{if(e){e.fadeOut(this.config.fadeOutDuration)}g.top=g.element.position().top;g.height=d.height();g.element.removeClass("collapsed").addClass("expanded");d.find(".info").show();var a=-1*g.element.outerHeight();if(this._pageCount()>0){a-=$("#notifications .pager").outerHeight(true)}if(a<g.top){g.element.animate({top:a},this.config.openDuration)}var c=d.height();d.css({height:g.height+"px"}).animate({height:c},this.config.openDuration);g.expanded=true}if(this.alerts.length>0){g.element.fadeOut(this.config.fadeOutDuration);this._drawAlerts()}},_interrupt:function(e){var c=this.interrupted;if(!c){this.interrupted=true;if(this.messageTimeout&&!this.messageTimeout.complete()&&!this.messageTimeout.paused()){this.messageTimeout.pause();for(var b=0,a=this.messages.length;b<a;b++){var d=this.messages[b];if(d.expirationTimeout){d.expirationTimeout.pause()}}}if(this.expandedType){c=Boolean(this._expandedMessage());if(!c){this._hideMessages(function(){e.call()})}}else{if(this.currentMessage&&!this.currentMessage.expanded&&!this.currentMessage.removed){this.currentMessage.element.fadeOut(this.config.fadeOutDuration,function(){e.call()})}else{c=true}}}if(c){e.call()}},_continueInterrupted:function(){var c=true;this.interrupted=false;if(this.messageTimeout&&!this.messageTimeout.complete()&&this.messageTimeout.paused()){if(this.messageTimeout.timeRemaining()>=this.config.alertResumeThreshold){this.messageTimeout.resume()}else{this.messageTimeout.exec();c=false}}for(var b=0,a=this.messages.length;b<a;b++){var d=this.messages[b];if(d.expirationTimeout&&d.expirationTimeout.paused()){d.expirationTimeout.resume()}}if(this.expandedType){if(!this._expandedMessage()){this._showMessages(this.expandedType)}}else{if(this.currentMessage&&c){if(this.currentMessage.removed){this._drawNextCollapsed()}else{this.currentMessage.element.fadeIn(this.config.fadeInDuration)}}}},_startMessageExpiration:function(a){this._stopMessageExpiration(a);a.expirationTimeout=new Timeout(this.config.messageExpiration,function(){a.element.addClass("expired")})},_stopMessageExpiration:function(a){if(a.expirationTimeout){a.expirationTimeout.stop();a.expirationTimeout=null}},_hideInfo:function(b){var a=b.element.find(".message .content");a.find(".info").hide();a.css({height:""});b.element.removeClass("expanded").addClass("collapsed")},_expandedMessage:function(){var c;for(var b=0,a=this.messages.length;b<a;b++){var d=this.messages[b];if(d.expanded&&!d.removed){c=d;break}}return c},_stopMessages:function(){if(this.messageTimeout&&!this.messageTimeout.complete()){this.messageTimeout.stop()}else{if(this.currentMessage&&this.currentMessage.element&&this.currentMessage.element.is(":animated")){this.currentMessage.element.data("stopped",true)}}},_showSummaries:function(){this._stopSummaries();for(var b in this.summaries){var a=this.summaries[b];if(a.element){if(b=="total"){a.element.switchClass("totalHidden","",this.config.summaryFadeInDuration)}else{if(a.count>0){a.element.fadeIn(this.config.summaryFadeInDuration)}}}}},_hideSummaries:function(){this._stopSummaries();var a=$("#notifications > .summaries");a.find("li.total").switchClass("visible","totalHidden",this.config.fadeOutDuration);a.find("li").filter(":not(.total)").fadeOut(this.config.fadeOutDuration)},_hideSummariesDelayed:function(){this._stopSummaries();this.summaryTimeout=new Timeout(this.config.summaryShowDuration,function(){notification._hideSummaries();notification.summaryTimeout=null})},_stopSummaries:function(){if(this.summaryTimeout){this.summaryTimeout.stop();this.summaryTimeout=null}}};var search={filter:function(){var b=$("#searchBox").val().trim();var a=0;$("#library .libraryWidget").each(function(){var g=widget.get($(this).attr("id"));var e=false;var d=g.x?(g.x).slice():[];if(g.title){d.push(g.title)}var f=$(this).closest("ol").attr("id");if(f){d.push(f)}for(var c in d){if(d[c].search(new RegExp(b,"i"))>-1){a++;e=true;break}}if(e){$(this).removeClass("hidden")}else{$(this).addClass("hidden")}});$("#library .overview .setHeader").not(".libraryUploads").each(function(){if($(this).find(".libraryWidget").not(".hidden").length>0){$(this).show()}else{$(this).hide()}});if($("#widgetGroupTitle").text()=="Uploads"){a++;$("#widgetGroupUploads").parent().show()}if(a==0){$(".emptyLibDisplay").show()}else{$(".emptyLibDisplay").hide()}setTimeout(lib.updateScrollbar,10)},focus:function(){$("#searchBox").focus().select()}};var fluidDropdownScrollbar=null;var color=["orange","red","lightBlue","green","darkBlue","yellow"];var fluidMenu={openDuration:300,closeDuration:300,click:function(b){var a=$(b.target);if(b.target.id=="tsandcsLabel"||b.target.id=="tsandcs1"||a.hasClass("createAccount")||a.parent().hasClass("GSWidget")||a.parent().hasClass("helpButton")||a.hasClass("projectSettingsButton")||a.parent().hasClass("projectSettingsButton")){return true}if(b.target.tagName=="INPUT"&&a.hasClass("title")){a.focus();a.select();return false}if((b.target.id=="upgradeLink")||(b.target.id.indexOf("userSettingsLink")>-1)){return true}if(((a.parent().attr("id")=="logout")||(a.attr("id")=="logout"))){account.logout();fluidMenu.watchSignupForm()}if(b.target.tagName=="A"&&!a.hasClass("submenuLink")){return true}return false},toggle:function(){if($("#fluidDropdown").is(":visible")){contextMenu.place();fluidMenu.hide()}else{contextMenu.place("hide");tracker.record("FluidMenuClicked",5,"");fluidMenu.show(this)}widget._stopEditingText();return false},feedbackAjaxResponse:function(a){$("#feedbackForm").empty()},setupFeedback:function(c){$("#feedbackForm").empty();var b=account.get("email");if(b==null||b=="New"){b=""}var a=account.get("name");if(a==null){a=""}$("#tmplFeedback").tmpl({name:a,email:b}).appendTo("#feedbackForm");$("#feedbackForm input").not("[type=hidden]").each(function(){validateInput(c,this)})},hide:function(){if($("#startMenu").hasClass("open")){$("#hud").data("openMenu",false);$("#startMenu").removeClass("open");var a=$("#fluidDropdown");utils.animateRaf(function(b){a.css({"-webkit-transform":"scale("+(1-b)+")","-moz-transform":"scale("+(1-b)+")"})},fluidMenu.closeDuration,"easeInOutQuad",function(){a.removeAttr("style").hide()});$(".messageError").hide();fluidMenu.resetSelectedMenu()}},show:function(d){var a=arguments[0];closePopups($("#fluidDropdown"));$("#fluidDropdown .overview article").hide();if($("#fluidDropdown .fluidSubmenuActive").length>0){var d=$("#fluidDropdown .fluidSubmenuActive").attr("data-for")}$(".loginMessage").hide();$("#"+d).show();$("#startMenu").addClass("open");var c=$("#fluidDropdown").css({"-webkit-transform":"scale(0.05)","-moz-transform":"scale(0.05)"}).show();utils.animateRaf(function(e){c.css({"-webkit-transform":"scale("+e+")","-moz-transform":"scale("+e+")"})},fluidMenu.openDuration,"easeOutBack",function(){c.removeAttr("style").show();if(a){project.renderPreview(account.get("lastOpenProject"))}});tracker.record("openFluidMenu",5,d);var b=account.get("accType");if(!b||b=="New"){fluidMenu.watchSignupForm()}if(document.getElementById("createEmail")){document.getElementById("createEmail").focus()}},watchSignupForm:function(){var e=$("#createEmail");var b=$("#createPassword");var c=e.add(b);function a(f){if(f.which){$(this).data("keyDown",true)}}c.on("keydown",a);function d(){if(!$("#fluidDropdown").is(":visible")){c.off("keydown",a);return}if(e.data("lastVal")!=e.val()){e.data("lastVal",e.val());if(!e.data("keyDown")){validateInput.call(e.get(0));account.checkEmailExists(e.val())}}if(b.data("lastVal")!=b.val()){b.data("lastVal",b.val());if(!b.data("keyDown")){validateInput.call(b.get(0))}}c.data("keyDown",false);window.setTimeout(d,300)}d()},openDropdown:function(c){$(".loginMessage").hide();var b=$(this);var d=b.attr("data-for");var a=$("#"+d);$("#fluidDropdownSubmenu a").removeClass("fluidSubmenuActive").filter("[data-for="+d+"]").addClass("fluidSubmenuActive");$("#fluidDropdown article").not("#"+b.attr("data-for")).hide();a.fadeIn(200);tracker.record("changeFluidMenu"+d,5,d,c)},resetSelectedMenu:function(a){var c=$(".fluidSubmenuActive").attr("data-for");var b=a||false;if(!b){if((account.get("loggedIn")=="no")&&(c!="profile")){b=true}else{if(c=="help"){b=true}}}if(b){$(".submenuLink").removeClass("fluidSubmenuActive");$(".submenuLink[data-for='profile']").addClass("fluidSubmenuActive")}},setButtonStyle:function(d,c,f){var e=c?0:1;var a=f==undefined?true:f;var g=e==0?"data-style-ori":"data-style-alt";var b=e==0?"data-text-ori":"data-text-alt";$.each(d,function(l,o){if($(o).hasClass("hud-button")){var i=$(o);if(c){i.addClass("expanded")}else{i.removeClass("expanded")}return}var h=$(".icon",$(o));var k=$(o).parent();var m=h.attr(g);var j=h.attr(b);if((m)&&(m!="")){var n=$(".iconAvatarContainer",h);n.attr("class","iconAvatarContainer "+m)}var p=$(".buttonText",h);if((j)&&(j!="")&&k.hasClass("hudButtonPlaceHolderCollapsed")){k.removeClass("hudButtonPlaceHolderCollapsed");h.removeClass("iconCollapsed");$(o).removeClass("buttonCollapsed");k.addClass(a?"hudButtonPlaceHolderExpanding":"hudButtonPlaceHolderExpanded");h.addClass(a?"iconExpanding":"iconExpanded");$(o).addClass(a?"buttonExpanding":"buttonExpanded");p.text(j);p.addClass("textVisible")}else{if((!(k.hasClass("hudButtonPlaceHolderCollapsed")))&&(e==0)){k.addClass(a?"hudButtonPlaceHolderCollapsing":"hudButtonPlaceHolderCollapsed");h.addClass(a?"iconCollapsing":"iconCollapsed");$(o).addClass(a?"buttonCollapsing":"buttonCollapsed");p.text("");p.removeClass("textVisible")}}})},removeButtonAnimation:function(a){$(this).parent().hasClass("hudButtonPlaceHolderExpanding")?$(this).parent().removeClass("hudButtonPlaceHolderExpanding").addClass("hudButtonPlaceHolderExpanded"):null;$(this).parent().hasClass("hudButtonPlaceHolderCollapsing")?$(this).parent().removeClass("hudButtonPlaceHolderCollapsing").addClass("hudButtonPlaceHolderCollapsed"):null;$(this).hasClass("buttonExpanding")?$(this).removeClass("buttonExpanding").addClass("buttonExpanded"):null;$(this).hasClass("buttonCollapsing")?$(this).removeClass("buttonCollapsing").addClass("buttonCollapsed"):null;$(this).hasClass("iconExpanding")?$(this).removeClass("iconExpanding").addClass("iconExpanded"):null;$(this).hasClass("iconCollapsing")?$(this).removeClass("iconCollapsing").addClass("iconCollapsed"):null;if($(this).hasClass("shiningLight")){$(this).remove()}$(".buttonText").removeClass("textVisible")},highlightButton:function(a){$.each(a,function(b,c){$(".shiningLight",$(c)).remove();$("<div class='shiningLight'></div>").appendTo($(c));$(".shiningLight").addClass("start")})},setCanvasNoPages:function(b){var a=$("#createNewPage, #previewView, #createNewPageButton, #preview, #pagePreview");if(fluid.controllers.bin.isEmpty()){a=a.add($("#trash"))}a.animate({opacity:0},300);a.css("pointer-events","none");if(b){setTimeout(hint.restart,300)}},setCanvasFirstPage:function(){if(!project.readOnly()&&project.get("pages")&&project.get("pages").length){$("#createNewPage, #trash, #createNewPageButton").animate({opacity:1},300);$("#createNewPage, #trash, #createNewPageButton").css("pointer-events","auto")}else{$("#createNewPage, #createNewPageButton").animate({opacity:0},300);$("#createNewPage, #createNewPageButton").css("pointer-events","none");$("#trash").fadeIn(300)}if(project.hasWidgets()){$("#previewView, #preview, #pagePreview").animate({opacity:1},300);$("#preview, #pagePreview").css("pointer-events","auto")}else{$("#previewView, #preview, #pagePreview").animate({opacity:0},300).removeClass("expanded");$("#preview, #pagePreview").css("pointer-events","none")}}};var adminConsole={resetAll:function(){var a=confirm("ARE YOU SURE YOU WANT TO RESET?\nAll your projects and information will be lost!");if(a==true){dbStorage.clear();localStorage.clear();window.location.reload();return}$("#console").fadeOut(200)},resetCanvas:function(){project.resetCanvas();$("#console").fadeOut(200)},logPerformanceData:function(c){console.log("document Events");console.log("Storage:",storage.tempStorage);console.log("Total dom elements:  ",$("*").size());var b={};var a=0;$("*").each(function(){var e=$(this).data("events");if(typeof e!="undefined"){for(var d in e){if(typeof b[d]!="undefined"){b[d]++}else{b[d]=1}a++}}});console.log("EventCount: ",b);console.log("Total events: ",a)}};var signup={hide:function(){$("#signup").hide()},show:function(){signup.toggleTabMessage();$("#signup").delay(500).fadeIn(500)},toggleTab:function(){widget.resetSelection();contextMenu.hide();propInspector.resetPropInspector();link.closeMenu();var b=$("#signup").hasClass("open");if(b){var e=-460;var f="Save";var a="";var d="";if($("#library").hasClass("signingUpHidden")){$("#library").removeClass("signingUpHidden").show()}if($("#previewHolder").hasClass("open")){$("#previewHolder").fadeIn(400,function(){$("#hud, #canvas, #trash").show()})}else{$("#hud, #canvas, #trash").fadeIn()}}else{var e=0;var f="Not Yet";var d="Create account or sign in or to save";var c=project.get("currentZoom");if(c==1){$("#library").addClass("signingUpHidden").hide()}$("#projectName").hide();if($("#previewHolder").hasClass("open")){$("#hud, #canvas, #trash").hide();$("#previewHolder").fadeOut()}else{$("#hud, #canvas, #trash").fadeOut()}}signup.toggleTabMessage();return false},toggleTabMessage:function(){var a="Later";if(!$("#signup").hasClass("open")){if($("#previewHolder").hasClass("open")){a="View on Mobile"}else{a="Save"}}},submit:function(f){$("#canvas").removeClass("loaded");var b=$(this).find("input").not("[type=hidden], [type=submit]").length;var a=$(this).find(".formCorrect").length;var c=$(".createAccount");if((a<b)||(c.hasClass("inactive"))){return false}var d=$(this).serialize();signup.ajaxProcessing();$.ajax({url:"./index.php",type:"POST",data:d,timeout:15000,success:signup.ajaxSuccess,error:signup.ajaxError,timeOut:signup.ajaxProcessingTimeout,})},ajaxProcessing:function(){var b=$(".createAccount");var a="Signing in...";if(b.val().indexOf("Create")>-1){a="Creating new account..."}b.val(a).addClass("inactive");$(".messageError").hide();signup.loggingIn=true},ajaxSuccess:function(f,i,c){var b=$(".createAccount");var h=b.attr("data-label");try{var a=JSON.parse(c.responseText)}catch(g){$(".loginErrorUnknown").fadeIn(1000);b.removeClass("inactive").val(h);return false}if(a.r!="s"){if(a.r=="passwordFail"){$(".loginErrorWrongPass").fadeIn(1000)}else{$(".loginErrorUnknown").fadeIn(1000)}b.removeClass("inactive").val(h);return false}fluidMenu.setButtonStyle($("#startMenu"),false);$(".createAccount").removeClass("inactive").val("Loading elements...");var d="FluidMenu";if($("#previewSignupForm:visible").size()>0){d="Preview"}switch(a.a){case"create":signup.handleSuccess(a);tracker.record("signUpVia"+d,1,a.Email,"");notification.add("alert","Your account was created successfully. Your work will be automatically saved from now on.");break;case"login":tracker.record("login",1,a.Email,"");account.login(a);break}fluid.util._.each(document.querySelectorAll("form.createForm"),function(e){e.reset()});return false},ajaxProcessingTimeout:function(){signup.loggingIn=false;account.setLoadingStep(5)},ajaxError:function(a,c,b){signup.loggingIn=false;account.setLoadingStep(5);if(!c=="timeout"&&!c=="abort"&&!c=="No Transport"){c="Error"}},handleSuccess:function(a){account.register(a);$("#canvas").addClass("loaded");var b=account.get("lastOpenProject");project.sync(b);project.drawThumbnail(b);$("body").addClass("signed-in");fluidMenu.setButtonStyle($("#startMenu"),false);$("#previewSignup").hide();preview.displaySharePanel()},closeAfterCompleting:function(){signup.toggleTab();$("#signup").fadeOut();$("#startMenu").fadeIn()}};function userActionsInit2(){$("#pageFrame").click(function(a){widget.resetSelection();contextMenu.hide();propInspector.resetPropInspector();widget._stopEditingText();snap.closeSnapSettings();if(a.target.className=="pageBackground"){page.hideOptionsMenu();if($("#fluidDropdown").is(":visible")){fluidMenu.hide()}}return false});$(".icon","#pageSettingsMenuContainer").click(page.pageMenuClick);$("#pageMenus").click(page.pageMenuClick).mousedown(function(a){a.stopPropagation()});$("input","#pageMenus").click(function(){return false});$("#pageNote textarea").blur(function(a){page.saveNotesInput()});$("#pageMenuToggle").click(page.toggleOptionsMenu);$("#pageAddNote").click(page.toggleNotes);$("#pageDuplicate").click(fluid.command.helper.createEventHandler("fluid.controllers.page","clone"));$("#pageDelete").click(fluid.command.helper.createEventHandler("fluid.controllers.page","delete"));$("#snapSettings").click(page.toggleSnapSettings);$("#DeviceSizeTmpl").bind("change",fluid.command.helper.createEventHandler("fluid.controllers.page","settingDevice"));$("#deviceSettingsLink").on("click",fluid.util.debounce(function(){userSettings.openMenuAfterExit=false;projectSettings.actionSelectProject(projectSettings.getItemById(project.get("id")));projectSettings.goToValues();userSettings.open(null,$("#projectSettingsPanelMain"));setTimeout(function(){userSettings._fixCloseButton(false)},500)},500));$(".inputPageTitle").live("blur",page.updatePageName);$(".makeHomepage").click(fluid.command.helper.createEventHandler("fluid.controllers.page","settingHomePage"));$(".orientationSelector2").change(project.orient);$(".buttonSwitchContainer.pageMenu .buttonSwitch").click(fluid.command.helper.createEventHandler("fluid.controllers.page","settingOrientation"));$(".screenSize").bind("change",project.changeScreenSize);$(".pageSize.rangeWidget").on("change",fluid.command.helper.createEventHandler("fluid.controllers.page","settingCustomPageSize"));$(".customDeviceSize.rangeWidget").on("change",fluid.command.helper.createEventHandler("fluid.controllers.page","settingDevice"));$(".btnUpload").click(lib.showUploads);$("#gridSwitchOn, #gridSwitchOff").click(fluid.command.helper.createEventHandler("fluid.controllers.page","settingGridToggle"));$("#gridSpaceSlider").draggable({axis:"x",drag:grid.changeGridSpacing,containment:"parent"});$("#gridSliderArea").click(grid.sliderPosClick);$("#snapSwitchOn, #snapSwitchOff").click(snap.toggle)}function userActionsInit(){$(".shareSend").attr("disabled","");$(document).on("input",".shareSendMailReceipients",function(b){var a=/[-!#$%&'*+/=?^_`{|}~a-z0-9]+@[-_.a-z0-9]+[.][a-z][a-z]+\s*$/i.test($(this).val())&&b.target.validity.valid;if(a){$(".shareSend").removeAttr("disabled")}else{$(".shareSend").attr("disabled","")}});$(".form input").live("change",validateInput).live("blur",validateInput);$(".createForm [type=email]").live("change",function(a){account.checkEmailExists($(a.target).val())});$(".recoverPassword").live("click",function(){account.recoverPassword();return false});$("#trash, #trashIcon").droppable({accept:function(a){return(a.hasClass("project")||a.hasClass("screen")||a.hasClass("pageWidget"))&&$(this).hasClass("droppableStyle")},greedy:true,tolerance:"touch",drop:deleteObject}).click(function(a){fluid.command.create("toggle").dispatchTo("fluid.controllers.bin");a.stopPropagation()});$("#zoomOut").click(canvas2.zoomOut);$("#closeDropzone").click(upload.hide);$(".createForm").live("submit",signup.submit);$(".shareSendMail").live("submit",ajax.submit);$(".sharePreviewExternal").live({click:share.actionPreviewExternal});$("#continueProject").live("click",signup.closeAfterCompleting);$("#startMenu").click(fluidMenu.toggle);$("#resetEmail").live("click",fluidMenu.setupFeedback);$("#fluidDropdownSubmenu > a, #projects a").click(fluidMenu.openDropdown);$("#fluidDropdown").click(fluidMenu.click);$("#upgradeLink").live({click:userSettings.goToUpgrade});$("#uploadSignUpLink").live({click:function(a){fluidMenu.show();a.stopPropagation()}});$(document.body).on("click",".alertLinkToSettings",fluid.util._.debounce(function(a){projectSettings.lastSelectedId=project.get("id");project.sync();projectSettings.goToSettingsUpdate();userSettings.open(null,$("#projectSettingsPanelSettings"))},300,true));$("#contextMenuItems").draggable({handle:".drag-handler",distance:5,containment:"#viewport",start:contextMenu.dragStart,stop:contextMenu.dragStop});$("#cmLink2").draggable({helper:cmLink2Helper,distance:5,cursorAt:{left:0,top:0},cursor:"url(img/cursorGrabbing.gif), crosshair",containment:"#viewport",start:link.dragStart,drag:link.drag,stop:link.dragStop,appendTo:"body"});$(".subExpander").parent().hover(function(){$(this).find(".subExpander").stop().fadeTo(50,1)},function(){$(this).find(".subExpander").show().stop().fadeTo(800,0)});$("#propInspectors").click(function(a){widget._stopEditingText();return false});$("#textOpacitySlider").draggable({axis:"x",start:propInspectorCtrl.initSliders,drag:propInspectorCtrl.sliderChanged,stop:propInspectorCtrl.sliderStopped,containment:"parent"});$("#textOpacityArea").click(propInspectorCtrl.sliderClicked);$("#shapeOpacitySlider").draggable({axis:"x",start:propInspectorCtrl.initSliders,drag:propInspectorCtrl.sliderChanged,stop:propInspectorCtrl.sliderStopped,containment:"parent"});$("#shapeOpacityArea").click(propInspectorCtrl.sliderClicked);$("#propInspectors .rangeWidget").on("change",function(a){propInspectorCtrl.applyChangedField($(a.target))});$(".customDeviceSize .rangeWidget").on("change",function(a){});$(".rangeWidget .decreaseNumber, .rangeWidget .increaseNumber").on("mousedown",rangeWidget.mouseDown).on("mouseup",rangeWidget.mouseUp).on("mouseleave",rangeWidget.mouseUp);$(".numberInput").live("keyup",propInspectorCtrl.changeShapeProps).click(propInspectorCtrl.selectNumberValue);$("#textSize").change(propInspectorCtrl.selectChanged);$("#textFont").change(propInspectorCtrl.selectChanged);$("#propContainer .checkbox").click(propInspectorCtrl.toggleCheckboxStyle);$("#propContainer .radio").click(propInspectorCtrl.toggleRadioStyle);$("#propContainer .hozontalAlignment").click(propInspectorCtrl.togglehozontalAlignment);$(".inspectorInner input[type=number], .inspectorInner input[type=range]").keydown(function(a){if((a.ctrlKey||a.metaKey)&&(a.keyCode==89||a.keyCode==90)){a.currentTarget.blur();a.target=document.body;$(document.body).trigger(a);a.preventDefault();return false}});$("#textTop").change(propInspector.sliderChanged);$("#contextMenu2").click(function(d){if($(this).hasClass("cm-inactive")){return false}$(this).addClass("cm-inactive");function f(e){var m=new Date().getTime();if(userActionsInit.lastAction){var o=userActionsInit.lastAction.oldTime;var l=userActionsInit.lastAction.clickedButton}else{var o=m;var l=e}var k=m-o;var n=(k<1000)?l:e;return n}var i=d.originalEvent;var j=$(d.target).hasClass("icon2")?$(d.target).attr("id"):$(d.target).parent().attr("id");var h=(j==="fixedWidgMenuHolder")?setTimeout(f(j),10):f(j);var b=new Date().getTime();userActionsInit.lastAction={clickedButton:j,oldTime:b};var g;var c;switch(h){case"cmAlignLeft":contextMenu.cmAlign(i,"left");break;case"cmAlignRight":contextMenu.cmAlign(i,"right");break;case"cmAlignTop":contextMenu.cmAlign(i,"top");break;case"cmAlignBottom":contextMenu.cmAlign(i,"bottom");break;case"cmAlignMiddle":contextMenu.cmAlign(i,"middle");break;case"cmAlignCenter":contextMenu.cmAlign(i,"center");break;case"cmFront":contextMenu.cmZAlign(i,"toFront");break;case"cmBack":contextMenu.cmZAlign(i,"toBack");break;case"cmFrontOne":contextMenu.cmZAlign(i,"frontOne");break;case"cmBackOne":contextMenu.cmZAlign(i,"backOne");break;case"cmCut":g="cut";break;case"cmCopy":g="copy";break;case"cmPaste":g="paste";break;case"cmDelete":deleteObject("delete");break;case"cmDuplicate":g="clone";break;case"cmAddSegment":g="addSegment";break;case"cmDeleteSegment":g="deleteSegment";break;case"cmLink":contextMenu.linkClickDragStart(i);break;case"cmReplaceToggle":contextMenu.toggleReplace(i);break;case"cmFit100":widget.fit100();break;case"cmFitToPage":widget.fitExpand();break;case"unfixedWidget":staticWidgets.toggleStaticWidgetMenu();break;case"fixedWidget":staticWidgets.toggleStaticWidgetMenu();break;case"menuExpander":propInspector.toggle(i);break;case"textMenuExpander":propInspector.toggle(i);break;case"cmWidgGroups":c="groupWidgets";break;case"cmUngroupWidgets":c="ungroupWidgets";break}if(g){fluid.command.create(g,{event:i}).dispatchTo("fluid.controllers.widget")}if(c){var a=$("#canvasPages .ui-selected");fluid.command.create(c,{sel:a}).dispatchTo("fluid.controllers.widget")}widget._stopEditingText();setTimeout(function(){$(this).removeClass("cm-inactive")}.bind(this),100);return false});$("#contextMenuItems .main").click(contextMenu.toggle);$(".subExpander").click(contextMenu.toggleSubmenu);$(".subExpander, .icon2").click(contextMenu.markAsLastClicked);$("#pinnedBtn").click(staticWidgets.pushToForeground);$("#unpinnedBtn").click(staticWidgets.removeStaticProperty);$(".screen").live("click",page.click).liveDraggable({cancel:":input, option, .icon",start:page.dragStart,drag:page.drag,stop:page.dragStop,distance:4});$(".screen").liveSelectable({distance:10,filter:".rootWidget:not(.backgroundWidget)",tolerance:"touch",start:page.selectStart,stop:page.selectStop,cancel:":input, option, .icon, .pageDragHandle"});$("#canvasPages .pageWidget").live("click",widget.click).live("mouseover mouseleave",widget.hover).liveDraggable({distance:4,appendTo:"body",snap:"#canvasPages .widgetHolder",disabled:false,grid:false,cancel:":input,option,.backgroundWidget",snapTolerance:4,create:widget.dragWidgetCreate,start:widget.dragWidgetStart,drag:widget.dragWidget,stop:widget.dragWidgetStop}).draggable("disable");$("#canvasPages .pageWidget .widgetText").live("dblclick",widget.editText);$("#canvas.loaded #canvasLinks .link").live({mouseenter:link.hoverIn,mouseleave:link.hoverOut,click:link.follow});$(".linkToggle").live("click",link.toggleMenu);$(".linkMenu").draggable({handle:".linkMenu h4"}).click(false);$(".removeLink").click(fluid.command.helper.createEventHandler("fluid.controllers.link","delete"));$(".transitionSelector").live("change",fluid.command.helper.createEventHandler("fluid.controllers.link","changeProperty"));$(".linkTriggerSelector").live("change",fluid.command.helper.createEventHandler("fluid.controllers.link","changeProperty"));$("#createNewPageButton").click(fluid.command.helper.createEventHandler("fluid.controllers.page","create",{mode:"button"}));$("#preview").click(function(a){preview.open(a);tracker.record("clickPreview",1,"",a);fluid.main.fire("preview")});$("#pagePreview").click(function(a){preview.startPage=document.querySelector(".canvasObject.active").id;preview.open(a);tracker.record("clickPagePreview",1,"",a);fluid.main.fire("preview")});$("#closePreview").click(preview.close);document.getElementById("togglePreviewMenu").addEventListener("click",previewMenu.toggle);$(".shareLink").live("click",share.actionLink);$(".previewLinkLong, #embedCode").live({click:share.actionCopyLinkOrCode});$(".shareIconSocial").live({click:share.actionLogSharedProject});$(document).keyup(keyU).keydown(keyD);$("#viewport").bind("mousewheel",canvas2.mousewheel);$("#library").resizable({handles:"e",minWidth:230,maxWidth:700,resize:lib.resizeSteps,stop:lib.resize});$("#library .libraryWidget").live("click",fluid.util.debounce(fluid.command.helper.createEventHandler("fluid.controllers.widget","create"),300)).liveDraggable({distance:3,cursorAt:{left:12,top:12},appendTo:"body",snap:"#canvasPages .widgetHolder, #canvasPages  .pageWidget",snapTolerance:5,grid:false,helper:lib._createDragHelper,start:widget.libraryDragStart,drag:widget.libraryDrag,cursor:"pointer"});$("#libDropDown .dropdown-fluid").live("click",function(){$("#widgetGroupSelect").toggle()});$("#widgetGroupSelect a").live("click",function(){$("#widgetGroupSelect").hide()});$("body").on("keydown",function(a){if(!/(38|40|27)/.test(a.keyCode)){return}$("#widgetGroupSelect").hide()});$("html").on("click",function(b){var a=$(b.target);if(!a.parents("#libDropDown").length){$("#widgetGroupSelect").hide()}});$("#searchBox").mouseover(function(){this.placeholder=""}).mouseleave(function(){this.placeholder="Search Library"}).focus(function(){$(this).css("border-color","#FFF")}).blur(function(){$(this).css("border-color","")}).click(search.filter).keyup(search.filter).click(search.focus);$("#uploadTabs .tabTrigger").live("click",function(){var c=$(this);var b=$("#widgets");var a=c.find(".childContainer");$("#uploadTabs .childContainer").hide();$("#uploadTabs .tabTrigger").removeClass("active");c.addClass("active");a.show();b.tinyscrollbar_update("relative")});$("#uploadTabs .projectTab").live("click",function(){if($(this).find(".pageWidget").length){$(this).toggleClass("active")}});$("#tabLibrary").click(lib.toggle);$("#tabPreview").click(function(){preview.hideNotes();previewMenu.debouncePositionNotes();preview.toggleShare()});$("#widgets h6").live("click",lib.collapseSection);$("#Preveiw h6").live("click",lib.collapseSection);$("#widgetGroupSelect a").live("click",lib.dropdownChangeSet);$("#library header").live({mouseenter:lib.setHeaderHoverIn,mouseleave:lib.setHeaderHoverOut});$("#Preveiw header").live({mouseenter:lib.setHeaderHoverIn,mouseleave:lib.setHeaderHoverOut});$("#uploadChooseFile").live("change",upload.uploadByClick);$("#shortcutUploadChooseFile").click(function(a){a.preventDefault();lib.showUploads()}).change(function(a){upload.uploadByClick.call(this,a)});$("#linkLoggedOut").live("click",fluidMenu.show);$("#console").click(function(a){var b=a.originalEvent;switch(a.target.id){case"pleaseUndo":if(fluid.command.history.canUndo()){fluid.command.history.undo()}else{alert("Nothing to undo")}break;case"pleaseRedo":if(fluid.command.history.canRedo()){fluid.command.history.redo()}else{alert("Nothing to redo")}break;case"resetAll":adminConsole.resetAll(b);break;case"resetCanvas":adminConsole.resetCanvas(b);break;case"consoleClose":$("#console").fadeOut(200);break;case"logData":adminConsole.logPerformanceData(b);break;case"profileStart":console.profile();break;case"profileEnd":console.profileEnd();break}return false});$("#viewport, #addPage").droppable({drop:dropInViewport,tolerance:"pointer"});$("#canvas.loaded").live("dblclick",fluid.command.helper.createEventHandler("fluid.controllers.page","create"));drag.makeDraggable({el:document.getElementById("canvas"),beforeDrag:function(a){if(!$(a.target).hasClass("loaded")){return false}return true},start:canvas2.dragStart,drag:canvas2.drag,stop:canvas2.dragStop});$(window).unload(function(){localStorage.setItem("refreshing",g_instanceId)});window.addEventListener("resize",fluid.util._.throttle(function(a){redraw(a)},500));$(window).unload(project.windowClose);$(window).blur(project.windowClose);$(window).focus(account.recordActivity);$(window).click(tidyUp);$("#hint").live("click",function(){return false});$(".icon").bind("webkitAnimationEnd",fluidMenu.removeButtonAnimation).bind("animationend",fluidMenu.removeButtonAnimation);$(".hudContainer").bind("webkitAnimationEnd",fluidMenu.removeButtonAnimation).bind("animationend",fluidMenu.removeButtonAnimation);$(".shiningLight").live("webkitAnimationEnd",fluidMenu.removeButtonAnimation).live("animationend",fluidMenu.removeButtonAnimation);$("#addPage").live("mouseenter",link.removeHighlightedPage);$(".export-link").live("click",share.downloadExport);userSettings.init();projectSettings.init();fluidEvent.bindEditor("storageChanged",account.recordActivity);fluidEvent.bindEditor("storageChanged",project.storageChangeProjectHandler);fluidEvent.bindEditor("closeModalWindow",userSettings.reStartFromOutside);fluidEvent.bindEditor("emailChecked",userSettings.actionCheckedEmail);fluidEvent.bindEditor("iFrameLoaded",userSettings.hide);document.body.oncopy=function(b){var a=$(b.target);if(a.hasClass("previewLinkLong")){share.actionAlertCopyLink(b)}else{if(a.attr("id")=="embedCode"){preview.alertCopyEmbedCode(b)}}}}var screensize={width:0,height:0};widget._selectionTLWH=false;widget._selectionBoxCoord=false;function updateTLWH(a){var b=(a)?a:utils.getBoundingAreaRelative($("#canvasPages .ui-selected").not(".backgroundWidget"));$("#TLindicatorX").text(parseInt(b.left));$("#TLindicatorY").text(parseInt(b.top));$("#WHindicatorX").text(parseInt(b.right-b.left));$("#WHindicatorY").text(parseInt(b.bottom-b.top));widget._selectionTLWH={width:b.right-b.left,height:b.bottom-b.top,top:b.top,left:b.left};widget._selectionBoxCoord={top:b.top,left:b.left}}function showPostLoadMessage(){if(!localStorage){return}var b=localStorage.getItem("postloadMessage");var a={"tab":"Project updated. Please close other tabs or windows where the project may be open.","serverRefresh":"A newer version of a project has been found. Updated.","serverLogout":"This account appears to be open elsewhere and has been logged out to protect your changes.","loginAgain":"Something went wrong. Please log in again.","updateLogout":"The application was updated and needed to log you out. Please log in again.","loginSyncFailed":"Application failed to log in and sync all user data properly. Try to log in again."};a[b]&&notification.add("alert",a[b]);localStorage.removeItem("postloadMessage")}function cmLink2Helper(b){var a=$(this).data("clickDragHelper");return a||$("#tmplDragHelper").tmpl()}function setFocus(a){a.bounce().focus()}function keyD(d){if(d.ctrlKey&&d.altKey&&d.shiftKey&&d.keyCode==48){$("#console").toggle();return false}if(d.keyCode==17||d.keyCode==91){var c=$("#multiSelBox");if(c.is(":visible")){$("#canvasPages .backgroundWidget").css("z-index",-2);c.css("z-index",-1)}widget.selectMulti=true;return true}if((d.metaKey||d.ctrlKey)&&d.keyCode==65){if($("#searchBox").is(":focus")){return true}if($("#colorHexValue").is(":focus")){return true}if($("#canvasPages .pageWidget textarea").length>0){utils.selectText("control+a");return true}if(!$("#canvas").hasClass("zoomedOut")){widget.select(null,$(".canvasObject.active").find(".pageWidget"));return true}}if(d.keyCode==27){lib.esc();userSettings.esc(d)}var b=d.target.nodeName.toLowerCase();if(b=="input"||b=="textarea"){if((b=="input")&&(d.keyCode==13)){var g=$(d.target).parents("form").size()==0?false:true;if(!g){$(d.target).blur()}}return true}if(d.keyCode==13){if(userSettings.isOpen){projectSettings.navigateWithKeys(d)}}if(d.keyCode>=37&&d.keyCode<=40){widget.nudge(d);contextMenu.place();return false}else{if(d.keyCode==46||d.keyCode==8){if(d.keyCode==8){$(".userSettingsDone:visible").click()}$("#searchBox").blur();deleteObject(d.keyCode);return false}else{if(d.metaKey||d.ctrlKey){var a,f=true;switch(d.keyCode){case 67:a="copy";f=false;break;case 68:a="clone";break;case 86:a="paste";break;case 88:a="cut";break;case 89:fluid.command.history.redo();break;case 90:if(d.shiftKey){fluid.command.history.redo()}else{fluid.command.history.undo()}break;default:return true}if(a){fluid.command.create(a,{event:d}).dispatchTo("fluid.controllers.widget",f)}return false}}}return true}function keyU(b){if(b.keyCode>=37&&b.keyCode<=40){if(b){var a=b.target.nodeName.toLowerCase();if((a=="input")||(a=="textarea")||(a=="select")){return false}}if(canvas2.isEditorVisible()){contextMenu.place();page.navigateWithKeys(b)}else{if(userSettings.isOpen){projectSettings.navigateWithKeys(b)}else{preview.navigateWithKeys(b)}}return false}$("#canvasPages .backgroundWidget").css("z-index","");$("#multiSelBox").css("z-index","");widget.selectMulti=false}function load(){var a=window.open("terms.html","","scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,location=no,status=yes")}function closePopups(a){if(!$("#fluidDropdown").is(a)){fluidMenu.hide()}if(!$("#trashContents").is(a)){fluid.controllers.bin.close()}}function tidyUp(c){var b=$(c.target);if(c.target.type=="textarea"||c.target.type=="input"||c.target.id=="tsandcsLabel"||c.target.id=="tsandcs1"||b.hasClass("projectOptionsFrame")||b.hasClass("modalWindowContentFrame")||b.closest(".modalWindowContentFrame").length>0){return true}if($(c.target).hasClass("createAccount")||($(c.target).hasClass("libraryWidget"))||($(c.target).hasClass("libraryWidgetDisabled"))){return true}var a;if($(c.target).closest("#fluidDropdown").length>0||c.target.tagName=="A"){a=$("#fluidDropdown")}if($(c.target).closest("#trashContents").length>0){a=(a||$([])).add("#trashContents")}closePopups(a);widget._stopEditingText();propInspector.resetPropInspector();staticWidgets.hideMenu();page.hideOptionsMenu();link.hoverOut();if(project.get("currentZoom")==1){widget.resetSelection();contextMenu.place("hide")}if(window.g_window_print&&!window.g_window_print.closed&&!$(c.target).hasClass("shareLinkPrint")){window.g_window_print.close();window.g_window_print=null}group.deselect()}function setValid(b){var a=b.next("aside");if(!a.hasClass("formCorrect")){a.fadeTo(0,1).addClass("formCorrect").bounce()}}function validateInput(d,f){var c=$(f);if(f==null||f==undefined){f=this;c=$(this)}$form=c.parents(".form").eq(0);if($form.hasClass("shareSendMail")){return}if(((f.validity.valid&&c.is(":checkbox")==false)||(c.attr("type")=="checkbox"&&c.prop("checked"))==true)&&c.attr("type")!="submit"){setValid(c)}else{c.next("aside").fadeTo(200,0).removeClass("formCorrect")}if(!$form.hasClass("createForm")){var b=$form.find("input").not("[type=hidden], [type=submit]").length;var a=$form.find(".formCorrect").length;setSubmitStyle($form,b==a)}}function intersectTrash(e,d){if($("#trash").css("display")!="none"){var b=utils.getTLWH(e);if($(e).hasClass("screen")){var c=project.get("currentZoom"),a=$(".page",$(e));if(c===1){return false}if(a.size()>0){b=utils.getTLWH(a)}b.width=b.width*c;b.height=b.height*c}var f=$("#libraryWidgetDragging");if(f.size()>0){if(f.hasClass("upload")){b.width=24;b.height=24}else{b=utils.getTLWH(f.find(".pageWidget"))}}var g=utils.getTLWH("#trash");if(d&&(b.width>200||b.height>200)){b.top=d.pageY;b.left=d.pageX;b.width=0;b.height=0}if((b.top+b.height>=g.top)&&(b.left+b.width>=g.left)){$("#trash").addClass("droppableStyle");return true}}$("#trash").removeClass("droppableStyle");return false}function dropInViewport(q,o){if(q.isPropagationStopped()||(q.originalEvent&&q.originalEvent.isPropagationStopped())){return}var i=$(o.draggable);var r=i.attr("id")||i.attr("data-id");if($(o.draggable).hasClass("project")){project.open(r);return}if($("#trash").hasClass("droppableStyle")){var d=o.draggable;var g=d.attr("id")||d.attr("data-id");fluid.command.create("drop",{id:g,title:storage.get(g).title}).dispatchTo("fluid.controllers.bin");return}if(r=="canvas"){return true}if(i.hasClass("libraryWidget")&&q.pageX<account.get("libraryWidth")){return false}if(r=="cmLink2"){utils.prevent(q);$("#dragCanvas").fadeOut(200);var f=$("#addPage").offset();var n=$("#addPage").outerHeight();if(q.pageX>f.left&&q.pageY>f.top&&q.pageY<f.top+n){fluid.command.create("create",{event:q,mode:"link"}).dispatchTo("fluid.controllers.page");widget.resetSelection();return false}var a=null;var s=1;if(i.hasClass("templateLink")){var a=i.parents(".page");var s=$("#canvas").data("revertZoom");if(s==undefined){s=1}}else{var a=$(".zoomedOutSelected").closest(".screen")}page.enableSelectableWidgetHolder(false)}var m=o.draggable.add(o.helper).add($("#dragCanvas")).add(".pageWidget.ui-selected");var c=false;var l=getHoverPage(q,m);var h=o.draggable.attr("id")||o.draggable.attr("data-id");if(l!=""){var j=$("#"+l);if(i.hasClass("libraryWidget")){fluid.command.create("create",{event:q,widgetId:h,pageId:l}).dispatchTo("fluid.controllers.widget");tracker.record("addWidget",1,o.draggable[0].id,q)}else{if(r=="cmLink2"){var a=j;$(".zoomedOutSelected").each(function(){fluid.command.create("create",{originId:$(this).attr("id"),destinationId:a.attr("id"),$wigdet:$(this),pageObj:a}).dispatchTo("fluid.controllers.link");tracker.record("addLink",1,"",q)});c=true}else{if(i.hasClass("pageWidget")){var k=j.attr("id");var b=i.closest(".screen").attr("id");if(b!=k){var p=$("#canvasPages .ui-selected");widget._changePage(p,b,k)}}}}}if($(o.draggable).attr("id")=="cmLink2"){if(c){widget.resetSelection()}else{setTimeout(function(){canvas2.zoom({newZoom:s,page:a,savePosition:false})},300)}}}function setSubmitStyle(c,b){var d=c.find(":submit");if(b===undefined){b=!d.hasClass("inactive")}if(b||c.attr("id")=="upgradeForm"){var a=c.data("existing")?"accept-existing":"accept";d.removeClass("inactive accept accept-existing").addClass(a).bounce()}else{d.removeClass("accept accept-existing").addClass("inactive")}}function deleteObject(a,c){function d(){var l=$(".ui-selected");if(l.length==0){return false}var k=[],i=[],h=[];var f,j,g=account.get("lastOpenProject"),m=$("#project-"+g);$(l).each(function(){var n=$(this).attr("id");h.push(storage.get(n).data);if(n==$(this).attr("data-segment")){i.push(n)}else{k.push(n)}});if(k.length>0){fluid.command.create("delete",{id:k}).dispatchTo("fluid.controllers.widget")}if(i.length>0){fluid.command.create("deleteSegment",{id:i}).dispatchTo("fluid.controllers.widget")}contextMenu.hide();propInspector.resetPropInspector();f=project.bundle(g).uploads;j=fluid.util._.filter(h,function(n){return f[n]===undefined});lib.handleUploadsRemovedFromPage(j,g,m)}if((a==46||a==8||a=="delete")&&widget.editing==false){return d()}if(!c||!c.draggable){return false}var e=$(c.helper);if(intersectTrash(e)==true){if(e.hasClass("pageWidget")){d();widget._dragSelection=null}else{if(e.hasClass("screen")){fluid.command.create("delete",{id:e.attr("id")}).dispatchTo("fluid.controllers.page")}else{if(e.hasClass("project")){var b=account.get("projectIds");if(b.length>1){fluid.command.create("drop",{id:$(c.draggable).attr("id")}).dispatchTo("fluid.controllers.bin")}else{notification.add("info","Sorry, the currently open project cannot be deleted. Please create another project before deleting this one.")}}}}$("#trash").removeClass("droppableStyle");return true}return false}function redraw(b){preview.multiOrientations=project.isMultiOrientation();if(preview.isOpen){preview.scaleFrame()}$("#canvas").draggable("option","containment",canvas2.setContainment());var a=project.getActivePage();if(a.size()>0&&a.hasClass("screen")&&!$(b.target).hasClass("pageWidget")){zoomInAndCenterOnPage(project.getActivePage(),1,1,200)}}function Timeout(a,b){this.ms=a;this.callback=b;this.start()}function getHoverPage(b,c){if(c){c=c.filter(function(){if($(this).is(":visible")){return true}else{if($(this).width()===0){return true}else{return false}}});c.hide()}var a=$(document.elementFromPoint(b.pageX,b.pageY)).closest(".screen");if(a.length){selectedPageId=a.attr("id")}else{selectedPageId=""}if(c){c.show()}return selectedPageId}Timeout.prototype={start:function(){if(!this.timeout){this.msRemaining=this.ms;this.startTime=new Date().valueOf();this.isPaused=false;this.isComplete=false;this._setTimeout(this.ms)}},started:function(){return Boolean(this.timeout)},stop:function(){if(this.timeout){window.clearTimeout(this.timeout);this.timeout=null;this.isPaused=false}},pause:function(){if(this.timeout){window.clearTimeout(this.timeout);this.timeout=null;this.msRemaining-=new Date().valueOf()-this.startTime;this.isPaused=true}},paused:function(){return Boolean(this.isPaused)},resume:function(){if(this.isPaused&&!this.timeout){this.startTime=new Date().valueOf();this._setTimeout(this.msRemaining);this.isPaused=false}},timeRemaining:function(){if(this.isPaused){return this.msRemaining}else{return this.msRemaining-new Date().valueOf()+this.startTime}},exec:function(){this.stop();this.callback.call();this.isComplete=true},complete:function(){return Boolean(this.isComplete)},_setTimeout:function(a){this.timeout=window.setTimeout((function(b){return function(){if($.isFunction(b.callback)){b.isComplete=true;b.callback.call();b.timeout=null}}})(this),a)}};function checkUserSession(a){if(!localStorage){return}var c=account.get("accType");if(!c||account.get("accType")=="New"){return}var d,b="session";var h=document.cookie.split(/;\s*/);for(var g=0,e=h.length;g<e;g++){var i=h[g].split("=");if(i[0]==b){d=i[1];break}}var f=localStorage.getItem(b);if(f){if(f!=d){account.logout();if(a){localStorage.setItem("postloadMessage","loginAgain")}location.reload()}}else{localStorage.setItem(b,d)}}function watchUserSession(a){if(!localStorage){return}window.setTimeout(function(){checkUserSession(a);watchUserSession(a)},5000)}function rgb2hex(a){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function b(c){return("0"+parseInt(c).toString(16)).slice(-2)}return"#"+b(a[1])+b(a[2])+b(a[3])}function fetchSvgIcons(){var a=new XMLHttpRequest();a.open("GET","img/all_icons.svg",true);a.onload=function(c){var b=new XMLSerializer();var d=b.serializeToString(c.target.responseXML.documentElement);document.head.appendChild(c.target.responseXML.documentElement);dbStorage.onReady(function(){dbStorage.set("uiIcons",{id:"svgIcons",data:d})})};a.send(null)}var fluid=fluid||{};fluid.module=fluid.module||{};(function(a){a.define=function(e,d,h){var i;if(e){var f=e.split(".");i=window;for(var c=0,b=f.length;c<b;c++){var g=f[c];i=i[g]||(i[g]={})}}if(d){d.call(h,i)}return i};a.resolve=function(d){var f;if(d){var e=d.split(".");f=window;for(var c=0,b=e.length;c<b;c++){f=f[e[c]];if(!f){break}}}return f}})(fluid.module);fluid.module.define("fluid.util",function(a){a.debounce=function(c,b){var d;return function(){var f=new Date().getTime();var e;if(!d||f-d>b){e=c.apply(this,arguments);d=f}return e||false}};a.dataUrlToBlob=function(d,c){var f=atob(d.split(",")[1]),e=[];for(var b=0;b<f.length;b++){e.push(f.charCodeAt(b))}return new Blob([new Uint8Array(e)],c)};a.resizeImage=function(f,b,j,h,g,i,e){var d=document.createElement("canvas"),k=d.getContext("2d");d.width=b;d.height=j;if(typeof f==="string"){var c=document.createElement("img");c.src=f;f=c}if(f instanceof Element){if(typeof h==="number"&&typeof g==="number"){k.drawImage(f,h,g,i,e,0,0,b,j)}else{k.drawImage(f,0,0,b,j)}return d.toDataURL()}}});fluid.module.define("fluid.event",function(b){b.mixinTo=function(e){var f={};var c=typeof e=="object";function d(i,j){var i=i.split(/,\s*|\s+/);for(var h=0,g=i.length;h<g;h++){j.call(e,i[h])}}e.bind=e.on=function(i,h,g){d(i,function(k){var j=f[k]||(f[k]=[]);if(a(j,h)==-1){j.push({h:h,c:g||this})}});return this};e.unbind=e.off=function(g,h){d(names,function(k){var j=f[k];if(j){var i=a(j,h);if(i>-1){j.splice(i,1)}}});return this};e.trigger=e.fire=function(){var k=arguments[0],i=f[k];if(i){var j=Array.prototype.slice.call(arguments,1);if(c){j.unshift(this)}for(var h=0,g=i.length;h<g;h++){var l=i[h];if(l.h.apply(l.c,j)===false){return false}}}return true}};function a(e,f){for(var d=0,c=e.length;d<c;d++){if(e[d].h===f){return d}}return -1}});fluid.command=fluid.command||{};fluid.command.history=fluid.command.history||{};fluid.command.helper=fluid.command.helper||{};(function(e){var b={};function c(f,g){return(f in b)&&b[f][g]||undefined}function d(g,f){this.name=g;this.context=$.isPlainObject(f)?f:{}}d.prototype.dispatchTo=function(f,h){if(typeof h=="undefined"){var g=c(f,this.name);h=g&&"revert" in g}a(f,this,"execute",h)};d.prototype.dispatchReverseTo=function(f){a(f,this,"revert",false)};function a(l,i,h,j){var k=c(l,i.name);if(!k){return}if(h in k){try{var p=k[h].call(k,i.context)}catch(m){if("message" in m){var g=(m.sourceURL||m.fileName)&&(" at "+(m.sourceURL||m.fileName))||"";var o=g&&(m.line||m.lineNumber)&&(":"+(m.line||m.lineNumber))||"";var n=m.stack&&("\nStack:\n\t"+m.stack.replace(/\n/g,"\n\t"));var f='"'+m.message+'"'+g+o+n}else{var f=$.isPlainObject(m)?JSON.stringify(m):m}throw l+":"+i.name+":"+h+": "+f}if(p===false){e.history.remove()}}else{}if(j){e.history.add(i,l)}}e.create=function(g,f){return new d(g,f)};e.registerHandler=function(f,g,h){if(f&&g&&h){if($.isFunction(h)){h={execute:h}}if("execute" in h){(b[f]||(b[f]={}))[g]=h}}}})(fluid.command);(function(g){var a=100;var e=[{}];var f=1;var d=0;function c(j,h,i){this.command=j;this.receiverName=h;this.branchId=i;this.timestamp=new Date().getTime();this.user=account.get("id");this.synced=false}function b(){d++;return d}g.add=function(i,h){if(f<e.length){e.splice(f)}e.push(new c(i,h,d));if(e.length>a){e.shift();g.fire("")}else{f++}g.fire("add")};g.remove=function(){if(e.length>1){f--;e.splice(f,1)}};g.canUndo=function(){return f>2};g.undo=function(i){if(!g.canUndo()){return}var h=e[--f];h.command.dispatchReverseTo(h.receiverName);if(i!==false){g.fire("undo",g.currentPosition())}};g.canRedo=function(){return f<e.length};g.redo=function(i){if(!g.canRedo()){return}var h=e[f++];h.command.dispatchTo(h.receiverName,false);if(i!==false){g.fire("redo",g.currentPosition())}};g.switchBranch=function(j){j--;if(j>-1){var h=e[f-1];if("branches" in h&&j<h.branches.length){var k=e.splice(f);var i=h.branches.splice(j,1)[0];h.branches.unshift(k);$.merge(e,i);g.fire("branch.switch",i[0].branchId)}}};g.reset=function(){e=[{}];f=1;g.fire("reset")};g.length=function(){return e.length-1};g.currentPosition=function(){return f-e.length};fluid.event.mixinTo(g);g.traverse=function(p){var o=true;var h={point:e[0],branch:0,parentBranch:[],stop:function(){o=false}};var m=[];var i=e;var k=1;while(o){if(k<i.length){if(h.point&&"branches" in h.point){m.push({parent:i,pointIndex:k-1,branches:h.point.branches,branchIndex:0});h.parentBranch=i}h.point=i[k++];h.offset=1;if("next" in p){p.next.call(null,h)}}else{var l=true,n=false;h.offset=0;k--;while(l){if(k>0){h.point=i[--k];h.offset--}if(m.length==0){o=l=false;h.offset-=k-1;n=true}else{if(k==0||("branches" in h.point)){var j=m[m.length-1];if(!("branches" in h.point)){h.offset--}if(j.branchIndex<j.branches.length){i=j.branches[j.branchIndex++];h.branch=j.branchIndex;h.point=null;k=0;l=false}else{m.pop();i=j.parent;k=j.pointIndex}n=true}}if(n&&"back" in p){p.back.call(null,h);h.offset=0;n=false}}}}}})(fluid.command.history);(function(a){a.createEventHandler=function(b,c,d){return function(f){var e=$.extend({},d||{});e.event=f;fluid.command.create(c,e).dispatchTo(b)}}})(fluid.command.helper);fluid.module.define("fluid.i18n",function(a){var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function b(i,h){var g=i.toString();var j="";if(!h||g.length<h){for(var f=0,e=h-g.length;f<e;f++){j+="0"}}return j+g}function d(e){if(typeof e=="number"){return new Date(e)}else{return e||new Date(0)}}a.formatDate=function(f){f=d(f);var e=f.getDate()+" "+c[f.getMonth()];var g=f.getFullYear();if(g!=new Date().getFullYear()){e+=", "+g}return e};a.formatTime=function(e){e=d(e);return e.getHours()+":"+b(e.getMinutes(),2)};a.formatDateTime=function(e){e=d(e);return a.formatDate(e)+", "+a.formatTime(e)};a.formatDateTimeRelative=function(g){g=d(g);var e;var f=new Date();var h=Math.floor((f.getTime()-g.getTime())/1000);if(h<60){e="just now"}else{if(h<120){e="a minute ago"}else{if(h<600){e=Math.floor(h/60).toString()+" minutes ago"}else{if(f.getDate()==g.getDate()){e="at "+a.formatTime(g)}else{if(f.getDate()-1==g.getDate()){e="yesterday, "+a.formatTime(g)}else{if(h<604800){e=a.formatDateTime(g)}else{e=a.formatDate(g)}}}}}}return e}});fluid.module.define("fluid.model",function(c){var a={storage:window.storage};var d="fluid.models";var b={};b.store=function(e){e=e||this.id;if(e){a.storage.set(e,this);this.trigger("change")}return this};b.fetch=function(g){g=g||this.id;var e=a.storage.get(g);if(e){for(var f in e){this[f]=e[f]}}return this};b.remove=function(e){e=e||this.id;a.storage.remove(e);return this};b.validate=function(){};fluid.event.mixinTo(b);c.define=function(f,e){if(!e){e=function(){}}e.prototype=b;fluid.module.define(d)[f]=e;e.fetch=function(g){return new e().fetch(g)};e.remove=function(g){e.prototype.remove.call(null,g)};fluid.event.mixinTo(e)}});fluid.module.define("fluid.view",function(c){var d="fluid.views";var a;var b={};c.define=function(f,e){a=f;if(!e){e=function(){}}fluid.module.define(d)[f]=e}});fluid.module.define("fluid.controller",function(a){var b="fluid.controllers.";function c(d){return{name:d,handleCommand:function(e,f){fluid.command.registerHandler(d,e,f)}}}a.define=function(e,d){if(e.substr(0,b.length)!=b){e=b+e}$(document).ready(function(){fluid.module.define(e,d,c(e))})}});fluid.model.define("bin",function(a){this.items=a&&a.items||[];this.add=function(b){this.items.unshift(b)};this.remove=function(d){for(var c=0,b=this.items.length;c<b;c++){if(this.items[c]===d){this.items.splice(c,1)}}};this.clear=function(){this.items=[]};this.isEmpty=function(){return this.items.length==0}});fluid.view.define("bin",function(){var h=300,e=300;var c=200,d=200;var g;function b(k){var i=g;if(g){$("#"+g).closest(".binItem").find(".restore").fadeOut(d);g=null}if(k){var j=k.attr("data-itemid");if(i!=j){k.find(".restore").fadeIn(c);g=j}}}function f(i){fluid.command.create("restore",{id:$(i.currentTarget).closest(".binItem").attr("data-itemid")}).dispatchTo("fluid.controllers.bin");i.stopPropagation()}function a(j){var i=j.data("ts");if(i){j.find(".timestamp").text(fluid.i18n.formatDateTimeRelative(i))}}this.isOpen=false;this.dropAreaElem=$("#trash");this.contentsElem=$("#trashContents").hide().bind("mousewheel",function(i){i.stopPropagation()});this.open=function(){if(this.isOpen){return}closePopups(this.contentsElem);this.contentsElem.find(".binItem").each(function(){a($(this))});var i=this.contentsElem.css({"-webkit-transform":"scale(0.05)","-moz-transform":"scale(0.05)"}).show();this.updateScrollbar();var j=this;utils.animateRaf(function(k){j.contentsElem.css({"-webkit-transform":"scale("+k+")","-moz-transform":"scale("+k+")"})},h,"easeOutBack",function(){j.contentsElem.removeAttr("style").show()});this.isOpen=true};this.close=function(){if(!this.isOpen){return}var i=this;utils.animateRaf(function(j){i.contentsElem.css({"-webkit-transform":"scale("+(1-j)+")","-moz-transform":"scale("+(1-j)+")"})},e,"easeInOutQuad",function(){i.contentsElem.removeAttr("style").hide()});b();this.isOpen=false};this.toggle=function(){if(this.isOpen){this.close()}else{this.open()}};this.hide=function(){this.dropAreaElem.fadeOut(d);this.contentsElem.fadeOut(d)};this.show=function(){this.dropAreaElem.fadeIn(c)};this.updateScrollbar=function(i){$(".scrollHolder",this.contentsElem).tinyscrollbar_update(i||"relative")};this.update=function(r){var l=this.contentsElem.find(".overview").empty();var m=r&&r.items;if(!m||r.isEmpty()){$("#tmplBinEmpty").tmpl().appendTo(l)}else{for(var o=0,k=m.length;o<k;o++){var q=m[o];var n=q.obj.id.charAt(0);var i;switch(n){case"p":var j=new Date(q.obj["created"]);var p=$.extend(q.obj,{readonly:true,date:fluid.i18n.formatDate(j)});i=$("#tmplBinnedProject").tmpl(p).appendTo(l);i.find(".project").addClass("inactiveProject");break;case"i":i=$("#tmplBinnedUpload").tmpl(q.obj).appendTo(l);break;default:continue}$("#tmplBinRestore").tmpl().on("click",f).appendTo(i);i.data("ts",q.ts).on("click",function(s){b($(s.currentTarget))})}this.dropAreaElem.removeClass("shown").show()}this.updateScrollbar()};$(".scrollHolder",this.contentsElem).tinyscrollbar()});fluid.controller.define("page",function(a){a.legacy={page:window.page,link:window.link,project:window.project};this.handleCommand("create",{execute:function(b){if("obj" in b){a.legacy.page.deserialize(b.obj,"actionHistory");if("link" in b){a.legacy.link.deserialize(b.link)}}else{if("x" in b&&"y" in b){b.id=a.legacy.page.create(b.x,b.y,b.mode)}else{if("mode" in b){switch(b.mode){case"link":b.id=a.legacy.page.addViaLinkDrop(0,0,b.event,null);b.link=a.legacy.link.serialize(b.id);break;case"button":b.id=a.legacy.page.createNew(b.event);break}}else{b.id=a.legacy.page.add(b.event)}}}if(b.id){fluid.controllers.page.selectPage(b.id)}if(!b.id){return false}},revert:function(c){c.obj=c.obj||a.legacy.page.serialize(c.id);a.legacy.page.detachFrame();a.legacy.page.del($("#"+c.id));var b=project.get("pages");if(b.length>=1){fluid.controllers.page.selectPage(b[b.length-1])}else{canvas2.zoomOut()}}});this.handleCommand("delete",{execute:function(b){function c(){if(!("links" in b)){var d=a.legacy.page.get(b.id,"widgets");d.unshift(b.id);b.links=a.legacy.link.serialize(d)}}if(b.id){b.obj=b.obj||a.legacy.page.serialize(b.id);c();a.legacy.page.detachFrame();a.legacy.page.del($("#"+b.id))}else{if(b.event){b.id=$(".screen.active").attr("id");b.obj=a.legacy.page.serialize(b.id);c();a.legacy.page.deleteManual(b.event)}}},revert:function(b){a.legacy.page.deserialize(b.obj,"actionHistory");a.legacy.link.deserialize(b.links);fluid.controllers.page.selectPage(b.id)}});this.handleCommand("clone",{execute:function(b){if("obj" in b){a.legacy.page.deserialize(b.obj)}else{b.id=a.legacy.page.duplicate(b.event)}},revert:function(b){b.obj=b.obj||a.legacy.page.serialize(b.id);a.legacy.page.detachFrame();a.legacy.page.del($("#"+b.id))}});this.handleCommand("move",{execute:function(c){if(!("fromX" in c)){var b=storage.get(c.id);c.fromX=b.x;c.fromY=b.y}a.legacy.page.move(c.id,c.x,c.y);fluid.controllers.page.selectPage(c.id)},revert:function(b){a.legacy.page.move(b.id,b.fromX,b.fromY);fluid.controllers.page.selectPage(b.id)}});this.handleCommand("settingHomePage",{execute:function(b){var c=$(b.event.currentTarget).closest(".screen");b.newHomeId=b.newHomeId||c.attr("id");b.oldHomeId=b.oldHomeId||project.get("homepage");if(!c.length){c=$("#"+b.newHomeId)}project.set({homepage:b.newHomeId});page.updateOptionsMenu();$("#"+b.oldHomeId).removeClass("homePage");c.addClass("homePage")},revert:function(b){project.set({homepage:b.oldHomeId});page.updateOptionsMenu();$("#"+b.newHomeId).removeClass("homePage");$("#"+b.oldHomeId).addClass("homePage")}});this.handleCommand("settingGridToggle",{execute:function(b){grid.toggle()},revert:function(b){grid.toggle()}});this.handleCommand("settingDevice",{execute:function(e){var f=$(".deviceTypes.projectSettingsDevice");e.newDevice=e.newDevice||f.find("option:selected").data("type");e.oldDevice=e.oldDevice||project.get("deviceModel");var d=f.find("option:selected").val().split(",");if(e.newDevice==="Custom"){var c=$(".customDeviceSize.width input").val()|0,i=$(".customDeviceSize.height input").val()|0,b=$(".customDeviceSize.width input").attr("min"),g=$(".customDeviceSize.height input").attr("min");d[0]=c<b?b:c;d[1]=i<g?g:i}d[0]=d[0]|0;d[1]=d[1]|0;if(e.newDevice==="Custom"){$(".customDeviceSize").show()}else{$(".customDeviceSize").hide()}e.newSize=e.newSize||d;e.oldSize=e.newSize||project.get("pageWH");if(e.newDevice==="Custom"){var j=$(".projectSettingsDevice").children().filter("[data-type=Custom]");j.text("Custom Display Size ("+d.join("x")+")")}project.set({"deviceModel":e.newDevice});project.changeScreenSize(null,e.newSize)},revert:function(b){project.set({"deviceModel":b.oldDevice});project.changeScreenSize(null,b.oldSize)}});this.handleCommand("settingOrientation",{execute:function(b){var d=$(b.event.currentTarget);if(d.hasClass("activeOption")){return}var e=$(".screen.active");b.pageId=b.pageId||e.attr("id");b.newOrientation=b.newOrientation||d.attr("data-for");b.oldOrientation=b.oldOrientation||a.legacy.page.get(b.pageId,"orientation");page.update({orientation:b.newOrientation},b.pageId);var c=$("#"+b.pageId);c.each(page.resizeAfterOrient);page.updateOptionsMenu();hint.show("library");staticWidgets.zoomInBoundary()},revert:function(b){page.update({orientation:b.oldOrientation},b.pageId);var c=$("#"+b.pageId);c.each(page.resizeAfterOrient);page.updateOptionsMenu();hint.show("library");staticWidgets.zoomInBoundary()}});this.handleCommand("settingCustomPageSize",{execute:function(c){var d=project.getActivePage();c.pageId=c.pageId||d.attr("id");var b=storage.get(c.pageId);c.newWidth=c.newWidth||parseInt($(".pageSize.rangeWidget.width>input").val(),10);c.newHeight=c.newHeight||parseInt($(".pageSize.rangeWidget.height>input").val(),10);c.oldWidth=c.oldWidth||b.width;c.oldHeight=c.oldHeight||b.height;if(b.width!=c.newWidth||b.height!=c.newHeight){a.legacy.page.resize(c.pageId,c.newWidth,c.newHeight);staticWidgets.showStaticBoundary(c.pageId);page.updateOptionsMenu()}},revert:function(c){a.legacy.page.resize(c.pageId,c.oldWidth,c.oldHeight);staticWidgets.showStaticBoundary(c.pageId);var b=$("#"+c.pageId+" .pageSize.rangeWidget.width>input");if(b.length&&b.val()!=c.oldWidth){b.val(c.oldWidth)}var d=$("#"+c.pageId+" .pageSize.rangeWidget.height>input");if(d.length&&d.val()!=c.oldHeight){d.val(c.oldHeight)}page.updateOptionsMenu()}});a.getActivePageId=function(){var c=null;var b=project.getActivePage();if(b.length>0){c=b[0].id}return c};a.selectPage=function(c){if(!c||c===a.getActivePageId()){return}var d=$("#"+c);var b=d.closest(".screen");var f=200;var e=a.legacy.project.get("currentZoom");a.legacy.page.activate(d,true,"actionHistory");if(e==1){zoomInAndCenterOnPage(b,1,1,f)}}});fluid.controller.define("widget",function(j){j.legacy={project:window.project,page:window.page,widget:window.widget,link:window.link,propInspector:window.propInspector,propInspectorCtrl:window.propInspectorCtrl,colorPicker:window.colorPicker,contextMenu:window.contextMenu,group:window.group,staticWidgets:window.staticWidgets};function f(p){return $($.map(p,function(q){return document.getElementById(q)}))}this.handleCommand("create",{execute:function(p){p.pageId=p.pageId||$("#canvasPages .active").attr("id");page.hideOptionsMenu();propInspector.hideInspectors();propInspector.resetPropInspector();if("obj" in p){j.legacy.widget.deserialize(p.obj,p.pageId);o()}else{if("widgetId" in p){p.id=j.legacy.widget.add(p.event,{top:0,left:0},p.widgetId,$("#"+p.pageId).find(".widgetHolder"))}else{p.id=j.legacy.widget.addDefault.call(p.event.currentTarget,p.event)}}if(p.obj){page.updateView(p.pageId)}p.obj=p.obj||j.legacy.widget.serialize(p.id);fluid.controllers.page.selectPage(p.pageId);j.legacy.group.drawExisting();j.legacy.staticWidgets.alignAll();fluid.main.trigger("widgetDropped",{widgetId:p.widgetId||p.event.target.getAttribute("data-id")})},revert:function(q){if($("#"+q.id).length){j.legacy.widget.remove(q.id);contextMenu.hide();propInspector.hideInspectors();propInspector.resetPropInspector();o()}else{var r=JSON.parse(q.obj);var t=[];for(var s in r){if(r.hasOwnProperty(s)&&s!=="id"){t.push(s)}}for(var p=0;p<t.length;p++){storage.remove(t[p])}page.updateView(q.pageId)}fluid.controllers.page.selectPage(q.pageId);j.legacy.group.drawExisting()}});function a(p){p.links=[];var q=f(p.id);j.legacy.widget.getLockTos(q).each(function(){p.links.push(j.legacy.link.serialize($(this).attr("id")))})}function i(r){for(var q=0,p=r.links.length;q<p;q++){var s=j.legacy.link.deserialize(r.links[q]);g(r)}}function g(q){var r=$("#canvasPages .ui-selected");var p=$("#multiSelBox");p.remove();if(r.length>1){j.legacy.widget.drawMultiSelBox(r)}}this.handleCommand("delete",{execute:function(r){r.pageId=r.pageId||$("#canvasPages .active").attr("id");r.widgetGroups=j.legacy.group.store();if(!$.isArray(r.id)){r.id=[r.id]}if("obj" in r){j.legacy.group.removeOnDelete(r.id);j.legacy.widget.del(r.id)}else{r.obj=[];a(r);j.legacy.group.removeOnDelete(r.id);for(var q=0,p=r.id.length;q<p;q++){r.obj.push(j.legacy.widget.serialize(r.id[q]));j.legacy.widget.del($("#"+r.id[q]))}}fluid.controllers.page.selectPage(r.pageId);j.legacy.page.renderBlurs(r.pageId);j.legacy.page.updateView(r.pageId)},revert:function(r){for(var q=0,p=r.id.length;q<p;q++){j.legacy.widget.deserialize(r.obj[q],r.pageId)}j.legacy.group.restore(r);i(r);o();fluid.controllers.page.selectPage(r.pageId);j.legacy.page.renderBlurs(r.pageId);j.legacy.page.updateView(r.pageId)}});function o(){if(j.legacy.project.hasWidgets()){$("#previewView, #preview, #pagePreview").show().css({opacity:1})}else{$("#previewView, #preview, #pagePreview").hide().css({opacity:0})}}this.handleCommand("clone",{execute:function(r){$("#contextMenuItems").addClass("locked");r.pageId=r.pageId||$("#canvasPages .active").attr("id");if("obj" in r){for(var q=0,p=r.id.length;q<p;q++){j.legacy.widget.deserialize(r.obj[q],r.pageId)}}else{if(j.legacy.widget.editing){return false}j.legacy.widget.duplicate(r.event);r.id=$("#canvasPages .ui-selected").map(function(){return $(this).attr("id")}).get()}try{j.legacy.page.renderBlurs(r.pageId)}catch(s){}j.legacy.page.updateView(r.pageId,{zoomOutOnly:true});j.legacy.staticWidgets.alignAll()},revert:function(r){if(!("obj" in r)){r.obj=[];for(var q=0,p=r.id.length;q<p;q++){r.obj[q]=j.legacy.widget.serialize(r.id[q])}}j.legacy.widget.del(r.id);contextMenu.hide();propInspector.resetPropInspector();j.legacy.page.renderBlurs(r.pageId);j.legacy.page.updateView(r.pageId,{zoomOutOnly:true})}});this.handleCommand("copy",{execute:function(p){j.legacy.widget.copy(p.event)}});this.handleCommand("cut",{execute:function(r){r.pageId=r.pageId||$("#canvasPages .active").attr("id");if(!("obj" in r)){r.id=$("#canvasPages .ui-selected").map(function(){return $(this).attr("id")}).get();r.obj=[];a(r);for(var q=0,p=r.id.length;q<p;q++){r.obj[q]=j.legacy.widget.serialize(r.id[q])}}j.legacy.widget.cut(r.event,$($.map(r.id,function(s){return document.getElementById(s)})));j.legacy.page.renderBlurs(r.pageId)},revert:function(r){for(var q=0,p=r.id.length;q<p;q++){j.legacy.widget.deserialize(r.obj[q],r.pageId)}i(r);j.legacy.page.renderBlurs(r.pageId)}});this.handleCommand("paste",{execute:function(r){r.pageId=r.pageId||$("#canvasPages .active").attr("id");if("obj" in r){for(var q=0,p=r.id.length;q<p;q++){j.legacy.widget.deserialize(r.obj[q],r.pageId)}}else{j.legacy.widget.paste(r.event);r.id=$("#canvasPages .ui-selected").map(function(){return $(this).attr("id")}).get();fluid.controllers.page.selectPage(r.pageId)}j.legacy.page.renderBlurs(r.pageId);j.legacy.staticWidgets.alignAll()},revert:function(r){if(!("obj" in r)){r.obj=[];for(var q=0,p=r.id.length;q<p;q++){r.obj[q]=j.legacy.widget.serialize(r.id[q])}}for(var q=0,p=r.id.length;q<p;q++){j.legacy.widget.del($("#"+r.id[q]))}contextMenu.hide();propInspector.resetPropInspector();j.legacy.page.renderBlurs(r.pageId)}});this.handleCommand("move",{execute:function(u){if(!u.skipViewAdjustment){c(u,function(){var x=$($.map(u.id,function(y){return document.getElementById(y)}));j.legacy.widget._savePosition(x)})}else{var r=$($.map(u.id,function(x){return document.getElementById(x)}));j.legacy.widget._savePosition(r);delete u.skipViewAdjustment}var v=storage.get(u.fromPage);var w=storage.get(u.toPage);var s;for(var q=0,p=u.id.length;q<p;q++){if(u.fromPage!==u.toPage){for(var t=0;t<v.widgets.length;t++){s=storage.get(v.widgets[t]);if(s.lockTo===u.id[q]){w.widgets.push(v.widgets[t]);v.widgets.splice(t,1);t--}}storage.set(u.toPage,w);storage.set(u.fromPage,v)}}if(u.fromPage!==u.toPage&&u.needViewUpdate){j.legacy.page.updateView(u.toPage);j.legacy.page.updateView(u.fromPage);j.legacy.link.update($("#"+u.toPage));j.legacy.link.update($("#"+u.fromPage))}else{if(u.needViewUpdate){page.updateView(u.toPage)}}u.needViewUpdate=true;fluid.controllers.page.selectPage(u.toPage);j.legacy.group.drawExisting();j.legacy.page.renderBlurs(u.toPage)},revert:function(t){var u=storage.get(t.toPage);var v=storage.get(t.fromPage);var r;for(var q=0,p=t.id.length;q<p;q++){j.legacy.widget.moveTo(t.id[q],t.fromPos[q]);if(t.fromPage!==t.toPage){for(var s=0;s<u.widgets.length;s++){r=storage.get(u.widgets[s]);if(r.lockTo===t.id[q]){v.widgets.push(u.widgets[s]);u.widgets.splice(s,1);s--}}storage.set(t.toPage,u);storage.set(t.fromPage,v)}}if(t.fromPage!==t.toPage){j.legacy.page.updateView(t.toPage);j.legacy.page.updateView(t.fromPage);j.legacy.link.update($("#"+t.toPage));j.legacy.link.update($("#"+t.fromPage))}else{page.updateView(t.toPage)}updateTLWH();g(t);fluid.controllers.page.selectPage(t.toPage);j.legacy.group.drawExisting();j.legacy.page.renderBlurs(t.toPage);j.legacy.contextMenu.place()}});this.handleCommand("groupWidgets",{execute:function(p){j.legacy.group.create(p.sel);j.legacy.group.select(p.sel);$(".groupWidgetHolder").removeClass("groupWithoutBorder")},revert:function(p){j.legacy.group.ungroup(p.sel)}});this.handleCommand("ungroupWidgets",{execute:function(p){j.legacy.group.ungroup(p.sel)},revert:function(p){j.legacy.group.create(p.sel);j.legacy.group.select(p.sel);$(".groupWidgetHolder").removeClass("groupWithoutBorder")}});this.handleCommand("staticToForeground",{execute:function(p){j.legacy.staticWidgets.create(p.sel,p.direction);j.legacy.staticWidgets.zAlignWidgets(p.sel)},revert:function(p){j.legacy.staticWidgets.destroy(p.sel);j.legacy.staticWidgets.undoZalign(p.order)}});this.handleCommand("removeStaticWidgets",{execute:function(p){j.legacy.staticWidgets.destroy(p.sel)},revert:function(p){j.legacy.staticWidgets.create(p.sel)}});function c(t,r){if("toPos" in t){for(var q=0,p=t.id.length;q<p;q++){j.legacy.widget.moveTo(t.id[q],t.toPos[q])}updateTLWH()}else{t.fromPos=[];t.toPos=[];for(var q=0,p=t.id.length;q<p;q++){var s=j.legacy.widget.get(t.id[q]).tlwh;t.fromPos[q]=[s[0],s[1]]}if(r.call()===false){return false}for(var q=0,p=t.id.length;q<p;q++){var s=j.legacy.widget.get(t.id[q]).tlwh;t.toPos[q]=[s[0],s[1]]}}}this.handleCommand("resize",{execute:function(q){if(q.propertyId){m("shape",q.propertyId,q.to,q.id,q.executed);q.executed=true}else{var r=$("#"+q.id);if(q.toTLWH){if(r&&r.length){l(r,q.pageId,q.toTLWH)}else{var p=storage.get(q.id);p.tlwh=q.toTLWH;storage.set(q.id,p);page.updateView(q.pageId)}}else{widget._resize(r,q.pageId);widget._resizeTextContainer(r)}q.toTLWH=[parseInt(r.css("top")),parseInt(r.css("left")),r.width(),r.height()];j.legacy.propInspector.update()}j.legacy.contextMenu.place();j.legacy.page.renderBlurs(q.pageId)},revert:function(q){if(q.propertyId){m("shape",q.propertyId,q.from,q.id,true)}else{var r=$("#"+q.id);if(r&&r.length){l(r,q.pageId,q.fromTLWH);j.legacy.propInspector.update()}else{var p=storage.get(q.id);p.tlwh=q.fromTLWH;storage.set(q.id,p);page.updateView(q.pageId)}}j.legacy.contextMenu.place();j.legacy.page.renderBlurs(q.pageId)}});function l(r,q,p){r.css({top:p[0]+"px",left:p[1]+"px",width:p[2]+"px",height:p[3]+"px"});j.legacy.widget._resize(r,q,p)}this.handleCommand("setBackgroundColor",{execute:function(p){p.pageId=p.pageId||$("#canvasPages .active").attr("id");if(!$.isArray(p.id)){p.id=[p.id]}var q=f(p.id);if("fromColor" in p){e(p.id,p.color);b(q)}else{p.fromColor=n(p.id);j.legacy.colorPicker.applyToBackground(p.event,p.color,q,p.color);p.color=n(p.id)}fluid.controllers.page.selectPage(p.pageId);j.legacy.page.renderBlurs(p.pageId)},revert:function(p){var q=f(p.id);e(p.id,p.fromColor);b(q);fluid.controllers.page.selectPage(p.pageId);j.legacy.page.renderBlurs(p.pageId)}});function n(s){var r=[];for(var q=0,p=s.length;q<p;q++){var t=storage.get(s[q]);if(t){r[q]={bg:t.bg,bgc:t.bgc,bgd:t.bgd}}}return r}function e(s,r){for(var q=0,p=s.length;q<p;q++){j.legacy.widget.set(r[q],s[q]);j.legacy.colorPicker.redraw(s[q])}}function b(q){var p=j.legacy.colorPicker;if($("#colorPicker").is(":visible")){var r=storage.get(q.attr("id"));var s=true;if($.inArray(r.bg,["l","r","ld","ld2","lrl"])>-1){switch(propInspector.lastAction){case"showAdvancedGradientEditor":j.legacy.propInspector.showCorrectScreen("showAdvancedGradientEditor");s=false;break;case"showColorStopEditor":j.legacy.propInspector.showCorrectScreen("showColorStopEditor");s=false;break}}if(s){j.legacy.propInspector.showBackground()}}}this.handleCommand("setBorderColor",{execute:function(p){p.pageId=p.pageId||$("#canvasPages .active").attr("id");if(!$.isArray(p.id)){p.id=[p.id]}var q=f(p.id);q=$(q).not(".backgroundWidget");p.fromColor=p.fromColor||d(j.legacy.colorPicker.extractBorderColor(q.attr("id")));j.legacy.colorPicker.applyToBorder(p.color,q);if(!p.executed){p.executed=true}else{j.legacy.propInspector.update(q.attr("id"))}fluid.controllers.page.selectPage(p.pageId);j.legacy.page.renderBlurs(p.pageId)},revert:function(p){var q=f(p.id);j.legacy.colorPicker.applyToBorder(p.fromColor,q);j.legacy.propInspector.update(q.attr("id"));fluid.controllers.page.selectPage(p.pageId);j.legacy.page.renderBlurs(p.pageId)}});this.handleCommand("setColor",{execute:function(r){r.pageId=r.pageId||$("#canvasPages .active").attr("id");if(!$.isArray(r.id)){r.id=[r.id]}if(r.property=="opacity"){for(var q=0,p=r.id.length;q<p;q++){m(r.mode,r.propertyId,r.to,r.id[q],r.executed)}r.executed=true}else{var s=f(r.id);r.fromColor=r.fromColor||d(j.legacy.colorPicker.extractTextColor(s));j.legacy.colorPicker.applyToText(r.color,s);if(!r.executed){r.executed=true}else{j.legacy.propInspector.update()}}fluid.controllers.page.selectPage(r.pageId);j.legacy.page.renderBlurs(r.pageId)},revert:function(r){if(r.property=="opacity"){for(var q=0,p=r.id.length;q<p;q++){m(r.mode,r.propertyId,r.from[q],r.id[q],true)}j.legacy.propInspector.update()}else{var s=f(r.id);j.legacy.colorPicker.applyToText(r.fromColor,s);j.legacy.propInspector.update()}fluid.controllers.page.selectPage(r.pageId);j.legacy.page.renderBlurs(r.pageId)}});function d(p){var q=p&&p.match(/rgba\s*\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+(?:\.\d+)?)\s*\)/);if(q){p="rgb("+q[1]+","+q[2]+","+q[3]+")"}return p}var h=[{name:"setBorder",mode:"shape"},{name:"setFont",mode:"text"},{name:"setTextProperty",mode:"text"}];for(var k=0;k<h.length;k++){this.handleCommand(h[k].name,(function(p){return{execute:function(s){if(!$.isArray(s.id)){s.id=[s.id]}for(var r=0,q=s.id.length;r<q;r++){m(p,s.propertyId,s.to,s.id[r],s.executed)}s.executed=true},revert:function(s){for(var r=0,q=s.id.length;r<q;r++){m(p,s.propertyId,s.from[r],s.id[r],true)}}}})(h[k].mode))}function m(t,s,r,q,p){j.legacy.propInspectorCtrl.exportProps(t,s,r,q);if(p&&(j.legacy.propInspectorCtrl.lastAction=="showTextInspector")){j.legacy.propInspectorCtrl.updateTextProps()}if(p&&(j.legacy.propInspectorCtrl.lastAction=="showShapeInspector")){j.legacy.propInspectorCtrl.updateShapeProps()}}this.handleCommand("addSegment",{execute:function(r){r.pageId=r.pageId||$("#canvasPages .active").attr("id");if("obj" in r){for(var q=0,p=r.obj.length;q<p;q++){var t=r.obj[q];j.legacy.widget.deserialize(t.seg,r.pageId,t.rootId,t.pos)}}else{var s=$("#canvasPages .ui-selected").map(function(){return $(this).attr("id")}).get();r.id=j.legacy.widget._addSegment(r.event);j.legacy.widget.select(null,f(s))}fluid.controllers.page.selectPage(r.pageId);j.legacy.staticWidgets.alignAll();j.legacy.page.renderBlurs(r.pageId)},revert:function(s){s.obj=[];for(var q=0,p=s.id.length;q<p;q++){var t=s.id[q];var r=$("#"+t);s.obj.push({id:t,rootId:r.attr("data-lockto"),seg:j.legacy.widget.serialize(t),pos:j.legacy.widget._getSegmentPosition(r)});j.legacy.widget._deleteSegment(null,s.id[q])}fluid.controllers.page.selectPage(s.pageId);j.legacy.page.renderBlurs(s.pageId)}});this.handleCommand("deleteSegment",{execute:function(r){r.pageId=r.pageId||$("#canvasPages .active").attr("id");if("obj" in r){for(var q=0,p=r.obj.length;q<p;q++){j.legacy.widget._deleteSegment(null,r.obj[q].id)}}else{r.obj=[];j.legacy.widget.getSegmentsFromSelection(".ui-selected").each(function(){var u=$(this);var v=u.attr("id");var s=u.attr("data-lockto");function t(x){var w=[];j.legacy.widget.getLockTos($("#"+x)).each(function(){w.push(j.legacy.link.serialize($(this).attr("id")))});return w}if(storage.get(s).sc==1){r.obj.push({id:v,rootId:s,rootObj:j.legacy.widget.serialize(s),links:t(s)})}else{r.obj.push({id:v,rootId:s,seg:j.legacy.widget.serialize(v),pos:j.legacy.widget._getSegmentPosition(u),links:t(v)})}});j.legacy.widget._deleteSegment(r.event);fluid.controllers.page.selectPage(r.pageId)}j.legacy.page.renderBlurs(r.pageId)},revert:function(r){for(var q=0,p=r.obj.length;q<p;q++){var s=r.obj[q];if("rootObj" in s){j.legacy.widget.deserialize(s.rootObj,r.pageId)}else{j.legacy.widget.deserialize(s.seg,r.pageId,s.rootId,s.pos)}i(s)}o();fluid.controllers.page.selectPage(r.pageId);j.legacy.page.renderBlurs(r.pageId)}});this.handleCommand("setText",{execute:function(p){p.pageId=p.pageId||$("#canvasPages .active").attr("id");if(!("fromText" in p)){var q=storage.get(p.id);p.fromText=q&&q.tc}j.legacy.widget.set({tc:p.text},p.id);$("#"+p.id+" .widgetText").text(p.text);fluid.controllers.page.selectPage(p.pageId);j.legacy.page.renderBlurs(p.pageId);j.legacy.page.updateView(p.pageId)},revert:function(p){j.legacy.widget.set({tc:p.fromText},p.id);$("#"+p.id+" .widgetText").text(p.fromText);fluid.controllers.page.selectPage(p.pageId);j.legacy.page.renderBlurs(p.pageId);j.legacy.page.updateView(p.pageId)}});this.handleCommand("setZOrder",{execute:function(s){s.pageId=s.pageId||$("#canvasPages .active").attr("id");if("order" in s){var t=f(s.id)}else{s.order=[];var t=$([]);for(var q=0,p=s.id.length;q<p;q++){var r=$("#"+s.id[q]);t=t.add(r);var v=r.nextAll(".rootWidget").first().attr("id");s.order.push({id:s.id[q],fromNextId:v})}}function u(w){j.legacy.contextMenu.cmZAlign2(s.event,$(w),({toFront:"cmFront",toBack:"cmBack",frontOne:"cmFrontOne",backOne:"cmBackOne"})[s.dir])}if(s.dir=="toFront"||s.dir=="backOne"){for(var q=0,p=s.order.length;q<p;q++){u(t.get(q))}}else{for(var q=s.order.length-1;q>=0;q--){u(t.get(q))}}j.legacy.page.renderBlurs(s.pageId);j.legacy.staticWidgets.alignAll()},revert:function(q){for(var p=q.order.length-1;p>=0;p--){var t=q.order[p];var s=$('[data-lockto="'+t.id+'"]');if(t.fromNextId){s.detach().insertBefore("#"+t.fromNextId)}else{var r=s.parent();s.detach().appendTo(r)}}j.legacy.page.renderBlurs(q.pageId)}});this.handleCommand("align",{execute:function(s){s.pageId=s.pageId||$("#canvasPages .active").attr("id");if(!("fromPos" in s)){s.fromPos=[];for(var q=0,p=s.id.length;q<p;q++){var r=j.legacy.widget.get(s.id[q]).tlwh;s.fromPos[q]=[r[0],r[1]]}}j.legacy.contextMenu.cmAlign2(s.event,f(s.id),({left:"cmAlignLeft",right:"cmAlignRight",top:"cmAlignTop",bottom:"cmAlignBottom",middle:"cmAlignMiddle",center:"cmAlignCenter"})[s.dir]);fluid.controllers.page.selectPage(s.pageId);j.legacy.page.renderBlurs(s.pageId)},revert:function(r){for(var q=0,p=r.id.length;q<p;q++){j.legacy.widget.moveTo(r.id[q],r.fromPos[q])}updateTLWH();g(r);fluid.controllers.page.selectPage(r.pageId);j.legacy.page.renderBlurs(r.pageId)}})});fluid.controller.define("link",function(a){a.legacy=window.link;this.handleCommand("create",{execute:function(b){if(!b.linkId){b.linkId=utils.guid("l")}var c=a.legacy.add(b.originId,b.destinationId,"ahref",b.linkId);a.legacy.draw(c,b.originId,b.destinationId,"ahref")},revert:function(b){a.legacy.del(b.linkId)}});this.handleCommand("delete",{execute:function(c){c.linkId=c.linkId||$(".openLinkMenu").closest(".link").attr("id");var b=project.get("links");var d=b.linkCanvId.indexOf(c.linkId);c.allLinks=false;if(!c.allLinks){c.originId=b.linkOrigin[d];c.destinationId=b.linkDest[d];c.transition=b.transType[d];c.trigger=b.triggerType[d];a.legacy.del(c.linkId)}else{c.oldLinks=a.legacy.serialize();$("#canvasLinks .link").remove();b.linkOrigin=[];b.linkDest=[];b.linkCanvId=[];b.linkType=[];b.transType=[];b.triggerType=[];project.save();$("#canvas").click()}},revert:function(b){if(!b.allLinks){var c=a.legacy.add(b.originId,b.destinationId,"ahref",b.linkId,b.transition,b.trigger);a.legacy.draw(c,b.originId,b.destinationId,"ahref")}else{a.legacy.deserialize(b.oldLinks)}}});this.handleCommand("changeProperty",{execute:function(e){var d=$(e.event.target),b=project.get("links"),c;e.property=e.property||d.eq(0).hasClass("transitionSelector")?"transType":"triggerType";e.newVal=e.newVal||d.val();e.linkId=e.linkId||$(".openLinkMenu").parents(".link").attr("id");c=$.inArray(e.linkId,b.linkCanvId);if(c===-1){return}e.oldVal=e.oldVal||b[e.property][c];b[e.property][c]=e.newVal;if($(".openLinkMenu").parents(".link").attr("id")===e.linkId){$(e.property==="transType"?".transitionSelector":".linkTriggerSelector").val(e.newVal)}project.save()},revert:function(d){var b=project.get("links"),c=$.inArray(d.linkId,b.linkCanvId);if(c===-1){return}b[d.property][c]=d.oldVal;if($(".openLinkMenu").parents(".link").attr("id")===d.linkId){$(d.property==="transType"?".transitionSelector":".linkTriggerSelector").val(d.oldVal)}project.save()}})});fluid.controller.define("bin",function(d){var f={project:window.project,account:window.account,lib:window.lib,storage:window.storage,ajax:window.ajax,widgets:window.widgets};var g="bin";var i=fluid.models.bin.fetch(g);var e=new fluid.views.bin();d.init=function(){i.bind("change",e.update,e).trigger("change")};d.open=function(){e.open()};d.close=function(){e.close()};d.clear=function(){i.clear();i.store(g)};d.isEmpty=function(){return i.items.length==0};d.hide=function(){e.hide()};d.show=function(){e.show()};d.showNonEmpty=function(){if(!this.isEmpty()){this.show()}};function c(j){if(j){i.add({obj:j,ts:new Date().valueOf()});i.store(g);d.show()}}function a(j){j=JSON.parse(j);var k=h(j.id);if(k){delete k.obj.id;f.storage.set(j.id,k.obj);f.account.addProjectId(j.id);f.project.load();i.remove(k);i.store(g)}if(i.items.length==0){e.close()}}function b(k){var l=h(k.id);if(l){l.obj.upload.removed=0;f.storage.set(k.id,l.obj.upload);var j=f.account.get("uploads");j.splice(l.obj.index,0,{id:k.id,s:true});f.account.set({"uploads":j});f.lib.draw("Uploads");i.remove(l);i.store(g,i)}if(i.items.length==0){e.close()}}function h(m){var l;for(var k=0,j=i.items.length;k<j;k++){if(i.items[k].obj.id==m){l=i.items[k];break}}return l}this.handleCommand("drop",function(j){var l=j.id.charAt(0);var k;switch(l){case"w":return;case"x":return;case"p":f.project.del(j.id,function(m){m.id=j.id;c(m);fluid.main.trigger("projectRemoved")});break;case"i":f.account.removeUpload(j.id,function(m){m.id=j.id;c(m)});break;default:throw"Unexpected object id: "+j.id}});this.handleCommand("restore",function(j){var l=j.id.charAt(0);var k;switch(l){case"p":ajax.restore(j.id,a);break;case"i":ajax.apiCall("img/bin","post",j.id,{restore:true},b);break;default:throw"Unexpected object id: "+j.id}});this.handleCommand("toggle",function(j){if(e.isOpen||i.items.length>0){e.toggle()}})});fluid.view.define("timeline",function(){var A=34,z=28,x=19,w=19,C=9,j=C*2,b=200,D=600,h=300,k=30;var e=false,c=false,a=false;currentBranch=0;var y=$("#actionTimeline svg.timeline");var o=y.attr("xmlns");$("#actionTimeline").css({left:$("body").width()-150+"px",display:"none"});$("#toggleExpand").hide();$("#toggleTimeline").on("click",function(){fluid.command.create("showToggle").dispatchTo("fluid.controllers.timeline")});$("#toggleExpand").on("click",function(){fluid.command.create("expandToggle").dispatchTo("fluid.controllers.timeline")});this.$=function(){return y};this.toggleDisplay=function(){if(e){this.hide()}else{this.show()}};this.show=function(){var F=$("#actionTimeline, #graphContainer");if(!e){F.fadeIn().animate({left:"460px"},{queue:false});this.scrollToCurrent();if(!a){F.children().not("#toggleExpand").fadeIn()}else{F.children().fadeIn()}e=true}};this.hide=function(){var F=$("#actionTimeline, #graphContainer");if(c){this.toggleExpand()}if(e){i();F.animate({left:$("body").width()-150+"px"},{queue:false}).fadeOut();F.children().fadeOut();e=false}};this.showButton=function(){$("#toggleTimeline").fadeIn(300)};this.hideButton=function(){$("#actionTimeline, #toggleTimeline").fadeOut(300)};this.toggleExpand=function(){var F=$("#actionTimeline, #graphContainer");var G=$("#expandThumb");if(e){if(!c){F.animate({height:b+"px"},{queue:false});G.animate({"margin-top":"0px"},{queue:false});c=true}else{F.animate({height:"60px"},{queue:false});G.animate({"margin-top":"20px"},{queue:false});c=false}}};this.update=function(I){if(!y.is(":visible")){return}y.empty();var H=[];var M=[];var L,G=0,J=0,F=0,K=0;var O=0,N=14;I.traverse({next:function(P){var R=Math.max(H[G]||0,J);var Q=0;if(P.point!==null){Q=P.point.branchId}else{Q=P.branch}O=Q;if(Q<currentBranch&&!B(y,"zoomedOut")){return}var S=$(document.createElementNS(o,"circle")).attr({"class":(P.point.branchId!==currentBranch?"zoomedOut ":"")+"node color-"+O+" ","cx":x+G*A,"cy":w+R*z,"r":C}).data({"point":P.point,"colorSet":O}).mouseover(v).mouseout(g).click(q).appendTo(y);M.push({point:P.point,elem:S});J=R;H[G++]=++R;F=Math.max(G,F);K=Math.max(R,K)}.bind(this),back:function(S){if(M.length==0){return}var W=M.pop().elem;var R=W.data("colorSet");var V=W.attr("cx");var U=W.attr("cy");var Q=H[--G];var T=0;if(S.point!==null){T=S.point.branchId}else{T=W.data("point").branchId}for(var P=S.offset;P<0&&M.length>0;P++){M.pop().elem.attr("cy",U);H[--G]=Q;r({type:"arch",colorSet:R,x1:x+G*A+C+1,x2:x+(G+1)*A-C-1,y1:U,y2:U}).prependTo(y)}J=0}.bind(this)});$("#graph").animate({width:Math.max(F-1,0)*A+x*3,height:Math.max(K-1,0)*z+w*2},300);this.setCurrent(I,I.currentPosition())};this.setCurrent=function(K,F){var L=y.find(".node.color-"+currentBranch);if(L){p(L,"current");l(L.eq(F===undefined?-1:F-1),"current");var H=document.querySelector(".current-outline");if(H){H.parentNode.removeChild(H)}if(!B(y,"zoomedOut")){$(".current").before($(document.createElementNS(o,"circle")).attr({"class":"current-outline","cx":$(".current").attr("cx"),"cy":$(".current").attr("cy"),"r":0}));H=document.querySelector(".current-outline");var J=0;var I=0;var G=setInterval(function(){J++;I=j*(k*J)/h;if(H){H.setAttribute("r",I)}},k);setTimeout(function(){clearInterval(G);if(H){H.setAttribute("r",j)}},h)}this.scrollToCurrent()}};this.scrollToCurrent=function(F){$("#graphContainer").animate({scrollLeft:($(".current-outline").attr("cx")-$("#graphContainer").width()/2)},D)};this.switchToParent=function(F){F.traverse({next:function(G){if(G.point===$(".node.current").data("point")){var I=G.parentBranch;var H=I[0];fluid.command.create("switch",{point:H}).dispatchTo("fluid.controllers.timeline");this.update(F);G.stop()}}.bind(this),back:function(G){}})};this.zoomOut=function(F){l(y,"zoomedOut");this.update(F)};this.zoomIn=function(F){p(y,"zoomedOut");this.update(F)};this.onBranchCreate=function(){a=true;$("#toggleExpand").show();if(e){$("#toggleExpand").show()}};this.setCurrentBranch=function(G,F){currentBranch=F};function r(F){return $(document.createElementNS(o,"path")).attr({"class":F.type+" color-"+F.colorSet,"stroke-linecap":F.rounded?"round":"","d":"M"+F.x1+" "+F.y1+" "+"L"+F.x2+" "+F.y2})}function f(G,F,H){fluid.controllers.ui.tooltip.show({message:G,x:F,y:H})}function i(){fluid.controllers.ui.tooltip.hide()}var E=[];function t(F){var M=project.get("widgetGroups");var L=[];var G=$.merge([],F);if(M){var L=[];for(var N=0;N<G.length;N++){var J=G[N];for(var K in M){var O=M[K];var P=K;var H=O.indexOf(J);if(H>-1){L.push(J);G.push(P)}}}var I=fluid.util._.difference(G,L);var G=fluid.util._.uniq(I)}return G}function n(G,F){if(!G){return}if(typeof G=="string"){G=[G]}else{if(!$.isArray(G)){G=$.makeArray(G)}}$("#"+G.join(",#")).not("#multiSelBox").not(".groupWidgetHolder").css("outline",F?"3px solid rgba(25,163,255,1.0)":"")}var v=function(H){var G=$(H.currentTarget).data("point");var J=fluid.command.names[G.receiverName][G.command.name];var I=$(H.currentTarget).offset(),F=I.left,K=I.top;f(J,F,K);n(G.command.context.id,true)};var g=function(G){var F=$(G.currentTarget).data("point");i();n(F.command.context.id,false)};var m=fluid.util._.debounce(function(I){var H="Branch "+$(I.currentTarget).data("branch");var F,L;var G=$(".branch.color-"+$(I.currentTarget).data("branch"));var K=G[G.length>>2];var J=$(K).offset(),F=J.left,L=J.top;f(H,F,L)},500,true);var s=fluid.util.debounce(function(F){i()},200,true);function q(F){if(!B($(F.currentTarget),"current")){fluid.command.create("switch",{point:$(F.currentTarget).data("point")}).dispatchTo("fluid.controllers.timeline")}}function d(G){var F=$(".node.color-"+$(G.currentTarget).data("branch")).last().data("point");fluid.command.create("switch",{point:F}).dispatchTo("fluid.controllers.timeline")}function u(F){return F.attr("class").split(/\s+/)}function B(H,I){var G=u(H);for(var F in G){if(G[F]===I){return true}}return false}function l(F,G){F.each(function(){var I=$(this);var H=u(I);if($.inArray(G,H)==-1){H.push(G);I.attr("class",H.join(" "))}})}function p(F,G){F.each(function(){var J=$(this);var I=u(J);var H=$.inArray(G,I);if(H>-1){I.splice(H,1);J.attr("class",I.join(" "))}})}});fluid.controller.define("timeline",function(b){var a=new fluid.views.timeline();var c=fluid.command.history;c.on("add",a.update,a);c.on("add",function(){fluid.command.create("showButton").dispatchTo("fluid.controllers.timeline")},a);c.on("reset",a.update,a);c.on("undo, redo",a.setCurrent,a);c.on("branch.create",a.onBranchCreate,a);c.on("branch.switch, branch.create",a.setCurrentBranch,a);this.handleCommand("showToggle",function(){a.toggleDisplay();a.update(c)});this.handleCommand("show",a.show);this.handleCommand("hide",a.hide);this.handleCommand("showButton",function(){if(account.get("loggedIn")=="yes"){if(c.length()>1){a.showButton()}}});this.handleCommand("hideButton",a.hideButton);this.handleCommand("expandToggle",a.toggleExpand);this.handleCommand("zoomOut",function(){a.zoomOut(c)});this.handleCommand("zoomIn",function(){a.zoomIn(c)});this.handleCommand("switch",function(e){var l=[],d=true;var h=c.length()+c.currentPosition();c.traverse({next:function(m){if(d){h--}else{l.push({branch:m.branch})}if(e.point===m.point){m.stop()}},back:function(n){d=false;for(var m=n.offset;m<0;m++){if(l.length>0){l.pop()}else{h++}}}});if(h>0){for(var j=0;j<h-1;j++){c.undo(false)}c.undo()}else{for(var j=h;j<-1;j++){c.redo(false)}c.redo()}var f=0,g=false;for(var j=0,i=l.length;j<i;j++){var k=l[j];if(k.branch>f){c.switchBranch(e.branch);g=true;f=0}c.redo()}if(g){a.update(c)}})});fluid.module.define("fluid.command.names",function(a){a["fluid.controllers.page"]={"create":"Page created","delete":"Page deleted","clone":"Page cloned","move":"Page moved","settingHomePage":"Start page set","settingGridToggle":"Page grid toggled","settingDevice":"Device type set","settingOrientation":"Page orientation set","settingCustomPageSize":"Page size set"};a["fluid.controllers.widget"]={"create":"Widget created","delete":"Widget deleted","clone":"Widget cloned","cut":"Widget cut","paste":"Widget pasted","move":"Widget moved","nudge":"Widget nudged","resize":"Widget resized","setBorder":"Widget border changed","setBackgroundColor":"Widget background color set","setBorderColor":"Widget border color set","setColor":"Widget color set","addSegment":"Widget segment added","deleteSegment":"Widget segment deleted","setText":"Widget text changed","setZOrder":"Widget order changed","align":"Widgets aligned","groupWidgets":"Widgets grouped","ungroupWidgets":"Widgets ungrouped","staticToForeground":"Pin widgets to front","removeStaticWidgets":"Unpin widgets"};a["fluid.controllers.link"]={"create":"Link created","delete":"Link deleted","changeProperty":"Link property changed"};a["fluid.controllers.project"]={"open":"Project loaded"}});var widgProps={};var widgGroup={toggle:function(){console.log("widgGroup.toggle");if(widgGroup.groupThem==true){widgGroup.groupWidgets()}else{if(widgGroup.groupThem=="ungroup"){widgGroup.ungroupWidgets()}else{return}}},grouped:[],groupId:false,getGroupMembershipStats:function(c){console.log("widgGroup.getGroupMembershipStats");var a=widget.getRoots(c);var b=a.length;a.each(function(){var e=$(this);var j=e.attr("id");var f=project.get("widgetGroups");for(var d in f){var h=f[d];var g=h.indexOf(j);if(g>-1){widgGroup.grouped.push(j);widgGroup.groupId=d}else{widgGroup.groupId=false}}});return b},detectGroups:function(d){console.log("widgGroup.detectGroups");widgGroup.grouped=[];var a=$("#cmWidgGroups .iconCmGroupWidgets");var c=widgGroup.getGroupMembershipStats(d);groupedWidgAmount=widgGroup.grouped;if((c==groupedWidgAmount.length)&&(groupedWidgAmount.length>0)){widgGroup.groupThem="ungroup";var b="Ungroup"}else{if(c<2){widgGroup.groupThem=false}else{widgGroup.groupThem=true;var b="Group"}}a.text(b)},addToGroup:function(){},groupWidgets:function(){console.log("widgGroup.groupWidgets");function f(j){function l(){var m=$(this);var n=m.attr("id");k.push(n)}var k=new Array;j.each(l);return k}function h(){for(var m in d){var l=m}var k=l;var n=k.replace("g","");var j=parseInt(n);j=new String("g"+(j+1));return j}var c=$("#canvasPages .ui-selected");var i=widget.getRoots(c);var d=project.get("widgetGroups");var b=f(i);if(!d||jQuery.isEmptyObject(d)==true){var e="g1";var g={g1:b}}else{var e=h();var a=$.extend({},d);a[e]=b;var g=a}project.set({widgetGroups:g});widgGroup.detectGroups(c);widgGroup.selectGroup(c)},ungroupWidgets:function(){console.log("widgGroup.ungroupWidgets");var b=$("#canvasPages .ui-selected");var a=widgGroup.groupId;console.log(a);var d=project.get("widgetGroups");var c=$.extend({},d);delete c[a];project.set({widgetGroups:c});widgGroup.detectGroups(b);contextMenu.open();$("#"+a).remove();widget.addResizeSettings(b)},updatedGroup:false,deleteWidg:function(b){console.log("widgGroup.deleteWidg");function a(){var d=$(this).attr("id");var j=project.get("widgetGroups");var f=$.extend({},j);for(var e in j){var h=j[e];if(!widgGroup.updatedGroup){widgGroup.updatedGroup=$.extend([],h)}var g=h.indexOf(d);if(g>-1){var h=widgGroup.updatedGroup;delete h[g];console.log(h)}}console.log(f);return f}var c=b.each(a)},getSelFromGroupId:function(c){console.log("widgGroup.getSelFromGroupId");var f=project.get("widgetGroups");var a=f[c];var e=$([]);for(var b=0;b<a.length;b++){var d=$("#"+a[b]);e=e.add(d)}return e},getNestedGroups:function(d){console.log("widgGroup.getNestedGroups");var b=new Array;var c=project.get("widgetGroups");var f=c[widgGroup.groupStats.openedGroup];var h=f.length;for(var e in c){var g=c[e];if(g.length<h){var j=g[0];var a=f.indexOf(j);if(a>-1){b.push(e)}}}},allLockTos:false,roots:false,selectGroup:function(e){console.log("widgGroup.selectGroup");if(widgGroup.openLargeGroup==true){widgGroup.groupStats.openLargeGroup=false;return}var d=widgGroup.groupId;if(d){var g=project.get("widgetGroups");var f=g[d];for(var c=0;c<f.length;c++){$("#"+f[c]).addClass("ui-selected")}var a=$("#canvasPages .ui-selected");var b=widget.getLockTos(a);b.addClass("ui-selected");widgGroup.allLockTos=b;widgGroup.roots=a;e.resizable("option","disabled",true);widgGroup.draw()}else{return}},draw:function(){console.log("widgGroup.draw");if(widgGroup.groupId){$("#multiSelBox").addClass("multiSelForGroup");var f=widgGroup.allLockTos;var c=widgGroup.groupId;var j=widgGroup.roots;$(".groupWidgetHolder").remove();var b=f.last();var a=utils.getBoundingAreaRelative(j);var d=a.right-a.left;var h=a.bottom-a.top;var g=parseInt(b.css("top"));var i=parseInt(b.css("left"));var e=(g-a.top)*-1;var l=(i-a.left)*-1;var k={top:e,left:l,width:d,height:h,groupId:c};$("#tmplWidgGroup").tmpl(k).appendTo("#"+b.attr("id"))}else{return}},resizeOpenGroup:false,groupDragStart:function(a){console.log("widgGroup.groupDragStart");if(widgGroup.groupStats.openedGroup){$("#"+widgGroup.groupStats.openedGroup).addClass("dragOpenGroup")}else{return}},resizeGroupElement:function(d){console.log("widgGroup.resizeGroupElement");function a(v,q,h,j){var r=v.sort(function(w,i){return i-w});var k=q.sort(function(w,i){return i-w});var u=h.sort(function(w,i){return i-w});var g=j.sort(function(w,i){return i-w});var s=((r[0]<widgGroup.groupStats.top)||(r[0]>widgGroup.groupStats.top)||(k[0]<widgGroup.groupStats.left)||(k[0]>widgGroup.groupStats.left)||(u[0]>widgGroup.groupStats.right)||(u[0]<widgGroup.groupStats.right)||(g[0]>widgGroup.groupStats.bottom)||(g[0]<widgGroup.groupStats.bottom))?true:false;if(s==true){var l=widgGroup.groupStats.openedGroup;var p=project.get("widgetGroups");var t=p[l];var o=$([]);for(var m=0;m<t.length;m++){var n=$("#"+t[m]);o=o.add(n)}widgGroup.drawOpenGroupBackground(r,k,u,g)}else{return}}if(widgGroup.groupStats.openedGroup){var c=[];var e=[];var f=[];var b=[];d.each(function(){var j=$(this);var m=j.attr("id");var g=widget.get(m);var l=g.tlwh[0];var k=g.tlwh[1];var h=l+g.tlwh[3];var i=k+g.tlwh[2];c.push(l);e.push(k);f.push(i);b.push(h)});a(c,e,f,b);$("#"+widgGroup.groupStats.openedGroup).removeClass("dragOpenGroup")}else{return}},clearGroup:function(){console.log("widgGroup.clearGroup");$("#"+groupId).remove()},drawOpenGroupBackground:function(){function h(){var i=$("#"+g);i.addClass("openGroup");i.find(".manageGroupBtn").text("Close Group")}$(".widgGroupBg").remove();var g=widgGroup.groupStats.openedGroup;$("#"+g).remove();var f=project.get("widgetGroups");var o=f[g];var d=$([]);for(var j=0;j<o.length;j++){d=d.add($("#"+o[j]))}var k=utils.getBoundingArea(d);var b=project.getActivePage();var m=b.find(".widgetHolder");var e=k.left;var l=k.top;var a=k.right-e;var n=k.bottom-k.top;var c={top:l,left:e,width:a,height:n};var p={top:l,left:e,width:a,height:n,groupId:g};$("#tmplGroupBg").tmpl(c).prependTo(m);$("#tmplWidgGroup").tmpl(p).appendTo(m);h()},openLargeGroup:false,groupStats:false,openGroup:function(c){function b(){var e=$("#canvasPages .active").offset();var i=$("#"+c).offset();var h=i.top-e.top;var g=i.left-e.left;var f=parseInt($("#"+c).css("width"))+g;var d=parseInt($("#"+c).css("height"))+h;widgGroup.groupStats={top:h,left:g,bottom:d,right:f,openedGroup:c};widgGroup.openLargeGroup=true}b();var a=$("#"+c);a.remove();widgGroup.drawOpenGroupBackground()},closeGroups:function(f){return;$("#"+f).remove();$(".widgGroupBg").remove();var e=project.get("widgetGroups");var a=e[f];widget.resetSelection();var d=$([]);for(var b=0;b<a.length;b++){var c=$("#"+a[b]);c.addClass("ui-selected");d=d.add(c)}if(widgGroup.openLargeGroup==true){widgGroup.openLargeGroup=false}widgGroup.groupStats={top:false,left:false,bottom:false,right:false,openedGroup:false};widget.drawMultiSelBox(d);widgGroup.selectGroup(d)},openCloseGroup:function(){var b=this;var c=$(this).attr("data-parentGroup");var a=$("#"+c);a.hasClass("openGroup")?widgGroup.closeGroups(c):widgGroup.openGroup(c)}};var tracker={enabled:false,defaultLevel:10,level:10,record:function(d,f,a,b,e){if(!tracker.enabled){return}f=f?f:tracker.defaultLevel;if(tracker.level<f){return false}var c={action:d,userId:account.get("id")};ajax.syncUp(c,"tracker","",e);return true},setLevel:function(a){a=a?a:tracker.defaultLevel;tracker.level=a},disable:function(){tracker.setLevel(0)}};var fullCanvas={pid:"",project:"",currentScale:1,init:function(a){fullCanvas.pid=a;ajax.syncDown(a,fullCanvas.parseDownload)},parseDownload:function(a,g,c){try{var b=JSON.parse(c.responseText)}catch(f){$("body").html("Unable to parse download - unknown error (1)")}if(b.r!="s"){$("body").html("Couldn't download correctly (has it been deleted/made inactive?)");return false}try{var d=JSON.parse(b.t.toString())}catch(f){$("body").html("Unable to download the mockup - download was interrupted.")}fullCanvas.runDraw(d)},runDraw:function(a){var c=a;if(typeof(a)=="string"){a=project.bundle(a);var b=storage.get(a[g_preview].pages[0]);if(b==null){ajax.syncDown(c,preview.parseDownload);return}}fullCanvas.draw(a)},draw:function(e){if(!e){return false}for(var c in e){storage.setTempItem(c,e[c])}var f=e[fullCanvas.pid];fullCanvas.project=f;var b=f.canvasPosX;var g=f.canvasPosY;var d=f.canvasWidth;var a=f.canvasHeight;$("#canvas").data("lastOutX",b).data("lastOutY",g).css({top:g,left:b,width:d,height:a}).delay(200).fadeIn(500);setTimeout(function(){var l=new Date().getTime();for(var k in f.pages){var j=page.draw(f.pages[k],"init")}if(!window.callPhantom){var m=$("#viewport");var i=storage.get(f.homepage)||storage.get(f.pages[0]);m.css("overflow","scroll");setTimeout(function(){m.get(0).scrollLeft=i.x-1500;m.get(0).scrollTop=i.y-1000},500)}fullCanvas.drawLinks();var h=new Date().getTime()},10)},drawLinks:function(){var a=fullCanvas.project.links;link.load(a);for(var b in a.linkOrigin){link.draw($("#"+a.linkCanvId[b]),a.linkOrigin[b],a.linkDest[b],a.linkType[b],1)}}};var panels={isWorking:false,lastSubmitButton:null,hideTimeOut:null,errors:{"default":"Something went wrong... Please try again!","defaultShort":"ERROR!","emailUsed":"Your new email is already being used.","passInvalid":"The password is not valid.","oldPassInvalid":"The old password is not valid.","passNotChanged":"The new password cannot be equal to the old one.","upgradeFreeWrongPass":"Your password is not valid.  Please try again.","resetNoEmail":"We were unable to match that email address to an account. Please try again...","resetCantSendEmail":"Error sending email. Please try again...","resetPasswordMatch":"The two passwords you entered don't match. Please try again...","resetLinkExpired":"This link has expired (for security reasons, password recovery attempts expire after 1 hour)."},messages:{"default":"Your changes have been applied successfully.","defaultShort":"Changes applied!","resetPass":"We have sent an e-mail to your account with your password","promoCode":"The code has been applied to your account!","contact":"Thanks!  We will contact you soon!","recoverySuccess":"Please check your email. You will have a link to reset your password there.","resetSuccess":"Your password has been updated successfully. You can now log in.","projectClone":"Project Cloned Successfully","projectTransfer":"Project Teleported Successfully","projectRestore":"Project Restore Successful","projectBranding":"Project Branding Changed"},processingMessages:{"default":"Processing...","projectClone":"Cloning...","projectTransfer":"Teleporting..."},setWorkArea:function(){$(".modalWindowContentArea").css({width:$(window).width()-50})},hideMessages:function(){panels.hideErrors();panels.hideSuccessMessage()},hideErrors:function(){clearTimeout(panels.hideTimeOut);$(".messageError").fadeOut(250,panels.placeMessageReset);panels.enableLastButton(true)},displayError:function(b){var c=panels.errors["default"];if(b!=undefined){c=panels.errors[b]!=undefined?panels.errors[b]:b}function a(){$(".userSettingsMessageContainer.messageError").text(c).fadeIn(250)}panels.placeMessage(panels.lastSubmitButton,a);panels.enableLastButton(true);panels.hideTimeOut=setTimeout(panels.hideErrors,3000)},enableLastButton:function(c,a){if(!panels.lastSubmitButton){return}var d=$(panels.lastSubmitButton);if((c)||(c==undefined)){if(d.attr("data-label")!=undefined){panels.changeButtonLabel(d,d.attr("data-label"))}d.removeAttr("disabled");return}else{d.attr("disabled","disabled");var b=d.prop("tagName")=="INPUT"?d.val():d.text();var f=a==undefined?"default":a;var e=panels.processingMessages[f]?panels.processingMessages[f]:panels.processingMessages["default"];d.attr("data-label",b);panels.changeButtonLabel(d,e)}},isLastButtonDisabled:function(){if(panels.lastSubmitButton==null){return false}var a=$(panels.lastSubmitButton);return a.attr("disabled")=="disabled"},hideSuccessMessage:function(){$(".userSettingsMessageContainer.messageSuccess").fadeOut(250,panels.placeMessageReset);panels.setSuccessMessage()},setSuccessMessage:function(d,b){var a=$(".userSettingsMessageContainer.messageSuccess");if(d==undefined){a.text("").fadeOut(250,panels.placeMessageReset);return}var c=panels.messages[d]!=undefined?panels.messages[d]:d;a.text(c);panels.placeMessage(b);setTimeout(panels.displaySuccessMessage,400)},displaySuccessMessage:function(){clearTimeout(panels.hideTimeOut);if($(".userSettingsMessageContainer.messageSuccess").text()!=""){$(".userSettingsMessageContainer.messageSuccess").fadeIn(250);panels.hideTimeOut=setTimeout(panels.hideSuccessMessage,3000);try{setTimeout(closeAccountFrame,8000)}catch(a){}}else{panels.hideSuccessMessage()}},placeMessage:function(i,g){if(i==undefined){$(".userSettingsMessageWrapper").css({top:10,left:0,height:30,width:499});return}var d=i.attr("type")=="submit"||i.hasClass("toAlert")?0:30;var e=i.offset().top+d-3;var c=i.offset().left-2;var h=i.innerHeight()+8;var b=i.innerWidth()+7;var f=i.css("padding");f=i.attr("type")=="text"?"6px":f;f=isNaN(parseInt(f,10))?"6px":parseInt(f,10)<6?"6px":f;var a=$(".userSettingsMessageWrapper");a.css({top:e,left:c,height:h,width:b});a.children().css({padding:f});if($.isFunction(g)){g()}},placeMessageReset:function(){$(".userSettingsMessageWrapper").children().hide();$(".userSettingsMessageWrapper").css({height:0,width:0})},changeButtonLabel:function(b,a){if(b.prop("tagName")=="INPUT"){b.val(a)}else{b.text(a)}},getCloseExternalWindowButtonLabel:function(){var a="Close";if(top!=self){a=window.parent.userSettings.isOpen?"Back":a}return a},display:function(a,b,d){if(panels.isWorking){return}panels.isWorking=true;function c(){a.parent().transition({width:a.innerWidth(),height:"auto",complete:function(){a.css({"height":"auto"}).slideDown((b/2)+100);a.children().transition({opacity:1},b/4);panels.isWorking=false;var e=$(".scrollbar",a);if(e.size()>0){panels.adjustScroll(e.parent())}if($.isFunction(d)){d()}}},b*3/4)}if(a.parent().hasClass("hiding")){setTimeout(c,b*1.3)}else{setTimeout(c,100)}return},hide:function(a,b,c){if(a.size()>0){a.parent().addClass("hiding");a.children().transition({opacity:0},b/4);a.parent().css({height:a.innerHeight(),width:a.innerWidth()});a.parent().delay(b/4).transition({height:0,width:0,complete:function(){a.hide();$(this).removeClass("hiding");if($.isFunction(c)){c()}}},b*3/4)}else{if($.isFunction(c)){c()}}},adjustScroll:function(a){function c(){a.tinyscrollbar();setTimeout(b,300)}function b(){a.tinyscrollbar_update("top")}setTimeout(c,100)}};var userSettings={isOpen:false,panelStack:new Array(),startPanel:null,helpLoaded:false,openMenuAfterExit:true,placeHolders:{"feedbackFix":"Tell us a little more so we can fix the bug","feedbackNew":"Tell us a little more so we add more awesome features!","feedbackOther":"Tell us a little more so we can be more Fluid!"},init:function(){$("#userSettingsLink").live({click:userSettings.open});$(".socialLinks .feedback").live({click:userSettings.goToContact});$(".helpButton").live({click:userSettings.goToHelp});$("#userSettingsChangeAccount").live({click:userSettings.goToUpgrade});$("#userSettingsChangeEmail").live({click:userSettings.goToChangeEmail});$("#userSettingsChangePassword").live({click:userSettings.goToChangePassword});$("#userSettingsContact").live({click:userSettings.goToContact});$("#userSettingsBilling").live({click:userSettings.goToBilling});$("#userSettingsBillingHistory").live({click:userSettings.goToReceipts});$("#userSettingsCode").live({click:userSettings.goToCode});$("#userSettingsRemoveAccount").live({click:userSettings.goToRemoveAccount});$("#userSettingsRemoveAccountCancel, #userSettingsRemoveAccountConfirmCancel").live({click:userSettings.reStart});$(".recoverPasswordSettings").live({click:userSettings.goToResetPassword});$("#userSettingsChangeEmailForm").live({submit:userSettings.actionChangeEmail});$("#userSettingsChangePasswordForm").live({submit:userSettings.actionChangePassword});$("#userSettingsBillingForm").live({submit:userSettings.actionBilling});$("#userSettingsContactForm").on("submit",userSettings.actionContact).on("input",function(d){var c=document.getElementById("userSettingsContactMessage").value,b=document.getElementById("userSettincsContactSubmit");if(/(\s*\S\s*){3,}/.test(c)){b.removeAttribute("disabled")}else{b.setAttribute("disabled","")}});$("#userSettingsCodeForm").live({submit:userSettings.actionCode});$("#userSettingsRemoveAccountForm").live({submit:userSettings.actionRemoveAccount});$("#userSettingsRemoveAccountConfirmForm").live({submit:userSettings.actionRemoveAccountConfirm});$("#userSettingsFeedbackForm").live({submit:userSettings.actionFeedback});$("#userSettingsResetPasswordButton").live({click:userSettings.actionResetPassword});$(".userSettingsFeedbackSetType").live({click:userSettings.actionFeedbackSetType});$(".userSettingsMessageContainer").live({click:panels.hideMessages});$("#userSettingsToggleMore").live({click:userSettings.toggleMore});$("#updateBillingInfo").live("click",userSettings.goToBilling);$("#userSettingsCardDetails").live("click",userSettings.goToCardUpdate);$("#userSettingsCardSubmit").live("click",userSettings.actionCardUpdate);$("#monthlyEmailReceipt").live("click",function(){if(!account.get("emailReceiptEnabled")){account.set({emailReceiptEnabled:true})}else{account.set({emailReceiptEnabled:false})}userSettings.toggeEmailReceiptmentForm.apply(this,arguments)});var a=$("#updateCardForm");payments.validation.init({elem:{form:a,name:$("#userSettingsCardName"),number:$("#userSettingsCardNumber"),type:$("#userSettingsCardType"),logo:$("#userSettingsCardTypeLogo"),month:$("#userSettingsCardMonth"),year:$("#userSettingsCardYear"),cvv:$("#userSettingsCardCvv")},handler:{errorPlacement:function(b,c){switch(c.attr("id")){case"userSettingsCardNumber":b.insertAfter($("#userSettingsCardTypeLogo"));break;case"userSettingsCardMonth":b.insertAfter($("#userSettingsCardYear"));break;default:b.insertAfter(c)}}}});payments.populateCardYears($("#userSettingsCardYear"),11);$(window).resize(userSettings._resizeScreen);fluid.main.fire("userSettings.afterInit")},setInitialState:function(){if(!account.isFreeAccount()||account.get("lastPaymentDate")!="0000-00-00 00:00:00"){$("#userSettingsBillingHistory, #userSettingsCardDetails").show()}else{$("#userSettingsBillingHistory, #userSettingsCardDetails").hide()}},reStartFromOutside:function(d,c){canvas2.setEditorVisibility(true);tracker.record("closedAccountPanel",1);var f=c!=undefined&&c.successMsg?c.successMsg:"";var a=c!=undefined&&c.successMsg!=undefined;if((a)||(userSettings.isOpen)){userSettings.isOpen=true;var b=userSettings.startPanel==null?$("#userSettingsMain"):userSettings.startPanel;userSettings.reStart(d,f,$(".backFromUpgradeContainer",b))}else{fluidMenu.show()}},reStart:function(d,f,b){if(!userSettings.isOpen){return}userSettings.setInitialState();var c=userSettings.startPanel==null?$("#userSettingsMain"):userSettings.startPanel;if(c.is(":visible")){userSettings.close();return}function a(){panels.setSuccessMessage(f,b)}$(".currentEmail").text(account.get("email"));if(!$("#userSettingsContainer").is(":visible")){$("#userSettingsContainer").fadeIn(100)}$(".modalWindowContentWrapper").show();userSettings._panelDisplay(c,true,a);userSettings.panelStack=new Array()},open:function(c,b){account.setUpgradeLinkStatus();canvas2.setEditorVisibility(false);notification.removeAll("projectLimit");panels.hideMessages();panels.setWorkArea();var a=$(".modalWindowContentFrame:visible, "+".modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, "+".modalWindowContentFrameSmall:visible");a.hide();$("#userSettingsContainer").fadeIn(100);$(".modalWindowContentWrapper").show();if(!userSettings.isOpen){userSettings.isOpen=true;userSettings.resetMore();userSettings.panelStack=new Array();if((b!=undefined)&&(b.size()>0)){userSettings.startPanel=b}else{userSettings.startPanel=null}}if((b!=undefined)&&(b.size()>0)){userSettings._panelDisplay(b,true)}else{userSettings.reStart()}},close:function(c,a){userSettings.openMenuAfterExit=userSettings.openMenuAfterExit||a?true:false;canvas2.setEditorVisibility(true);$(".getSatisfactionContainer").hide();var b=$(".modalWindowContentFrame:visible, "+".modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, "+".modalWindowContentFrameSmall:visible");userSettings._panelDisplay(b,false,userSettings.hide);userSettings.startPanel=null;userSettings.isOpen=false;if(!storage.get(project.get("id"))){project.open("last")}fluid.main.fire("userSettings.closePanels")},goBack:function(f,g,b){if(userSettings.panelStack.length>1){var d=userSettings.panelStack.pop();var c=userSettings.panelStack.pop();function a(){fluidEvent.triggerEditor("panelGoBack",{panelId:c.attr("id")},true);panels.setSuccessMessage(g,b)}userSettings._panelDisplay(c,true,a);return}userSettings.reStart(f,g,b)},hide:function(){$(".modalWindowContentWrapper").hide();$("#userSettingsContainer").fadeOut(200);if(userSettings.openMenuAfterExit){fluidMenu.show()}else{fluidMenu.hide()}userSettings.openMenuAfterExit=true},hideCurrentPanel:function(d,c){panels.hideMessages();var a=$(".modalWindowContentFrame:visible, "+".modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, "+".modalWindowContentFrameSmall:visible");if(a.size()>0){userSettings._panelDisplay(a,false,d)}else{var b=c==undefined?false:c;if(b){userSettings.close()}d()}},resetMore:function(){$("#userSettingsBottomButtons").hide();$("#userSettingsToggleMore").text("More...")},toggleMore:function(){$("#userSettingsBottomButtons").slideToggle(400);var a=$("#userSettingsToggleMore");var b=a.text().indexOf("More")>-1?"...Less":"More...";a.text(b)},goToCreateAccount:function(b,a){if(userSettings.isOpen){userSettings.hideCurrentPanel(function(){account.startCreate(b,a)})}else{account.startCreate(b,a)}},goToUpgrade:function(c,b,a){if(userSettings.isOpen){userSettings.hideCurrentPanel(function(){account.startUpgrade(c,b,a)})}else{account.startUpgrade(c,b,a)}},goToResetPassword:function(){userSettings._panelDisplay($("#userSettingsPanelResetPassword"),true)},actionResetPassword:function(a){userSettings.reStart(a,"resetPass");return false},goToChangeEmail:function(){$("#userSettingsChangeEmailNew").val("");$("#userSettingsChangeEmailPass").val("");userSettings._panelDisplay($("#userSettingsPanelChangeEmail"),true)},actionChangeEmail:function(b){panels.hideErrors();panels.lastSubmitButton=$("#userSettingsChangeEmailSubmit");var a=$.trim($("#userSettingsChangeEmailNew").val());ajax.syncUp({email:a},"emailRegd",null);return false},actionCheckedEmail:function(d,c){if(c.exists){panels.displayError("emailUsed");return}var a=$.trim($("#userSettingsChangeEmailNew").val());var b=$.trim($("#userSettingsChangeEmailPass").val());if((a!="")&&(b!="")){ajax.userSettingsRequest({info:a,validation:b},"changeEmail",userSettings.actionChangeEmailCallback)}return false},actionChangeEmailCallback:function(c,a){if(c==null){if(a!=""){panels.displayError(a);return false}panels.displayError();return false}var d=JSON.parse(c);if(d.t===true||d.t==="true"){var b=$.trim($("#userSettingsChangeEmailNew").val());account.set({email:b});account.resetAccountFrame();userSettings.reStart(null,"default",$("#userSettingsChangeEmail"))}else{if(d.t.indexOf("Unknown error")>-1){panels.displayError()}else{panels.displayError("passInvalid")}}return false},goToChangePassword:function(){$("#userSettingsChangePasswordOld").val("");$("#userSettingsChangePasswordNew").val("");userSettings._panelDisplay($("#userSettingsPanelChangePassword"),true)},actionChangePassword:function(b){panels.hideErrors();panels.lastSubmitButton=$("#userSettingsChangePasswordSubmit");var a=$("#userSettingsChangePasswordOld").val();var c=$("#userSettingsChangePasswordNew").val();if(a==c){panels.displayError("passNotChanged");return false}ajax.userSettingsRequest({old:a,"new":c},"changePass",userSettings.actionChangePasswordCallback);return false},actionChangePasswordCallback:function(b,a){if(b==null){if(a!=""){panels.displayError(a);return false}panels.displayError();return false}var c=JSON.parse(b);if(c.t===true||c.t==="true"){userSettings.reStart(null,"default",$("#userSettingsChangePassword"))}else{panels.displayError("oldPassInvalid")}return false},goToCardUpdate:function(a){$("#userSettingsCardName, #userSettingsCardNumber, #userSettingsCardCvv, #userSettingsCardType").val("");$("#userSettingsCardTypeLogo").removeClass("ccTypeLogoVISA ccTypeLogoMC ccTypeLogoAMEX");$("#userSettingsCardSubmit").removeAttr("disabled");payments.validation.reset($("#updateCardForm"));userSettings._panelDisplay($("#userSettingsPanelCard"),true);return false},actionCardUpdate:function(a){panels.hideErrors();panels.lastSubmitButton=$("#userSettingsCardSubmit");ajax.userSettingsRequest({name:$("#userSettingsCardName").val(),number:$("#userSettingsCardNumber").val(),month:$("#userSettingsCardMonth").val(),year:$("#userSettingsCardYear").val(),type:$("#userSettingsCardType").val(),cvv:$("#userSettingsCardCvv").val()},"updateCard",userSettings.actionCardUpdateCallback,true);$("#userSettingsCardSubmit").attr("disabled","disabled");return false},actionCardUpdateCallback:function(b,a){if(b==null){if(a!=""){panels.displayError(a);return false}panels.displayError();return false}var c=JSON.parse(b);if(c.t===true||c.t==="true"){userSettings.reStart(null,"default",$("#userSettingsCardDetails"))}else{panels.displayError()}return false},goToBilling:function(){$("#userSettingsBillingCompany").val(account.get("billingCompany"));$("#userSettingsBillingAddress").val(account.get("billingAddress"));$("#userSettingsBillingVAT").val(account.get("billingVAT"));userSettings._panelDisplay($("#userSettingsPanelBilling"),true);return false},toggeEmailReceiptmentForm:function(){$(this).toggleClass("pressed");$("#emailReceiptsForm").toggle()},goToReceipts:function(){$.ajax({url:"./index.php",type:"POST",data:{t:"getPayments",userId:window.invoiceUser},success:function(f){f=JSON.parse(f);$("#userSettingsReceiptEmail").val(account.get("receiptEmails"));if(account.get("emailReceiptEnabled")){userSettings.toggeEmailReceiptmentForm()}if(!f.receiptAvailable){$("#downloadAllReceipts").removeClass("active")}else{$("#downloadAllReceipts").addClass("active")}var e=f.t;var j=$("#receiptList .overview");j.find(".receiptListItem, .receiptEmptyMsg").remove();if(e.length===0){j.append('<div class="receiptEmptyMsg">No payments found...</div>');$("#downloadAllReceipts").removeClass("active")}if(f.msg){j.append('<div class="receiptEmptyMsg">'+f.msg+"</div>")}var b=["January","February","March","April","May","June","July","August","September","October","November","December"];var h,k,c;for(var g=0;g<e.length;g++){h=new Date(e[g].date*1000);c=h.getDate();if(c>3){k="th"}else{if(c==3){k="rd"}else{if(c==2){k="nd"}else{if(c==1){k="st"}}}}e[g].amount=e[g].amount/100;e[g].date=h.getFullYear()+" "+b[h.getMonth()]+" "+c+k;if(!f.receiptAvailable){e[g].hiddenClass="not-available"}if(e[g].status==="SUCCESS"){$("#tmplPaymentListItem").tmpl(e[g]).appendTo(j)}}panels.adjustScroll($("#receiptList"));$(".pdfReceipt").live("click",function(){if(window.invoiceUser){window.open(window.location.href+"invoice/"+$(this).parent(".receiptListItem").attr("id").split("-")[1]+"/userId/"+window.invoiceUser,"invoice")}else{window.open(window.location.href+"invoice/"+$(this).parent(".receiptListItem").attr("id").split("-")[1],"invoice")}});$("#downloadAllReceipts").on("click",function(){if(!$(this).hasClass("active")){notification.add("alert","No receipts to download!",{stopBuggingCallBack:true})}});$("#downloadAllReceipts.active").live("click",function(){window.open(window.location.href+"invoice/all","invoice")});function d(){var n=$("#userSettingsReceiptEmail").val().split(",");var m=true;for(var l=0;l<n.length;l++){n[l]=n[l].trim();if(!a(n[l])){m=false;break}}if(m){$("#updateReceiptEmails").val("Saving...");account.set({"receiptEmails":n.join(", ")});account.syncUp(function(){$("#updateReceiptEmails").val("Saved")})}}function a(l){var i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return i.test(l)}$("#updateReceiptEmails").live("click",d);$("#userSettingsReceiptEmail").live("keyup",function(i){if(i.keyCode===13){d()}});$("#updateBillingInfo").live("click",function(){userSettings.goBack(null,"",$(this))});userSettings._panelDisplay($("#userSettingsPanelReceipts"),true)},error:function(){var a=$("#receiptList .overview");a.find(".receiptListItem, .receiptEmptyMsg").remove();a.append('<div class="receiptEmptyMsg">No payments found...</div>');$("#downloadAllReceipts").removeClass("active")}})},actionBilling:function(d){panels.hideErrors();panels.lastSubmitButton=$("#userSettingsBillingSubmit");var c=$("#userSettingsBillingCompany").val();var b=$("#userSettingsBillingAddress").val();var a=$("#userSettingsBillingVAT").val();ajax.userSettingsRequest({company:c,address:b,vat:a},"changeBilling",userSettings.actionBillingCallback);return false},actionBillingCallback:function(b,a){if(b==null){if(a!=""){panels.displayError(a);return false}panels.displayError();return false}var c=JSON.parse(b);if(c.t===true||c.t==="true"){account.set({billingCompany:c.billingCompany,billingAddress:c.billingAddress,billingVAT:c.billingVAT});userSettings.reStart(null,"default",$("#userSettingsBillingHistory"))}else{panels.displayError()}return false},goToContact:function(){if(!userSettings.isOpen){userSettings.open(null,$("#userSettingsPanelContact"))}var b=$("#userSettingsContactEmailContainer");var a=$("#userSettingsContactEmail");if(account.get("loggedIn")=="yes"){b.hide();a.val(account.get("email"))}else{b.show();a.val("")}$("#userSettingsContactMessage").val("");userSettings._panelDisplay($("#userSettingsPanelContact"),true)},actionContact:function(c){panels.hideErrors();var b=$("#userSettingsContactMessage").val();var a=$("#userSettingsContactEmail").val();ajax.sendMessage(a,"Message from Contact Form",b,userSettings.actionContactCallback)},actionContactCallback:function(){userSettings.close();return false},goToCode:function(){$("#userSettingsCodeCode").val("");userSettings._panelDisplay($("#userSettingsPanelCode"),true)},actionCode:function(a){panels.hideErrors();userSettings.reStart(a,"promoCode");return false},goToRemoveAccount:function(){$("#userSettingsRemoveAccountPassword").val("");userSettings._panelDisplay($("#userSettingsPanelRemoveAccount"),true)},actionRemoveAccount:function(b){panels.hideErrors();panels.lastSubmitButton=$("#userSettingsRemoveAccountSubmit");var a=$.trim($("#userSettingsRemoveAccountPassword").val());ajax.userSettingsRequest({info:a},"validatePass",userSettings.actionRemoveAccountPassValidated);return false},actionRemoveAccountPassValidated:function(a){if(a==null){panels.displayError();return false}var b=JSON.parse(a);if(b.t===true||b.t==="true"){userSettings._panelDisplay($("#userSettingsPanelRemoveAccount"),false);userSettings._panelDisplay($("#userSettingsPanelRemoveAccountConfirm"),true)}else{panels.displayError("passInvalid")}return false},actionRemoveAccountConfirm:function(b){panels.lastSubmitButton=$("#userSettingsRemoveAccountConfirmSubmit");var a=$("#userSettingsRemoveAccountPassword").val();ajax.userSettingsRequest({info:account.get("email"),validation:a},"removeAccount",userSettings.actionRemoveAccountConfirmCallback);return false},actionRemoveAccountConfirmCallback:function(b,a){if(b==null){if(a!=""){panels.displayError(a);return false}panels.displayError();return false}var c=JSON.parse(b);if(c.t===true||c.t==="true"){account.logout();setTimeout(userSettings.goToFeedback,500)}else{panels.displayError()}return false},goToFeedback:function(a){$("#userSettingsFeedbackMessage").val("");userSettings.actionFeedbackSetType();userSettings._panelDisplay($("#userSettingsPanelFeedback"),true,null,false)},actionFeedback:function(d){panels.hideErrors();var c=$("#userSettingsFeedbackType").val();var b=$("#userSettingsFeedbackMessage").val();var a="Feedback Message After Account removal - "+c;ajax.sendMessage("",a,b,userSettings.actionFeedbackCallback)},actionFeedbackCallback:function(){userSettings.close();return false},actionFeedbackSetType:function(c){var b=$("#userSettingsFeedbackOther");if(c!=undefined){b=$(c.target)}var d="";var a="";switch(b.attr("id")){case"userSettingsFeedbackFix":d=userSettings.placeHolders["feedbackFix"];a="Bug";break;case"userSettingsFeedbackNew":d=userSettings.placeHolders["feedbackNew"];a="Required Feature";break;default:d=userSettings.placeHolders["feedbackOther"];var a="Other";break}$("#userSettingsFeedbackMessage").attr("placeholder",d);$("#userSettingsFeedbackType").val(a);return false},goToHelp:function(b){var a=$(window).height()-220;$("#userSettingsHelpTop").css({height:a+"px"});if(!userSettings.helpLoaded){$("#userSettingsHelpContent").html($("#help").html());userSettings.helpLoaded=true}userSettings.open(null,$("#userSettingsPanelHelp"))},esc:function(a){if(a.target.tagName.toLowerCase()=="input"){$(a.target).blur();a.stopPropagation();return false}$(".userSettingsDone:visible").click()},_fixCloseButton:function(b){var e=userSettings.startPanel==null?$("#userSettingsMain"):userSettings.startPanel;var g=b==undefined?true:b;var c=e.is(":visible")||!g?"Close":"Back";var a=c=="Close"?"close":"back";var f=c=="Close"?userSettings.close:userSettings.goBack;var d=$("#userSettingsContainer .hud-button");$("#userSettingsContainer .hud-button span").text(c);d.removeClass("close back");d.addClass(a);d.attr("title",c);$(".userSettingsDone").unbind().bind("click",fluid.util.debounce(f,500))},_panelDisplay:function(c,b,e,a){function d(){if(b){function f(){userSettings._fixCloseButton(a);if($.isFunction(e)){e()}}userSettings.panelStack.push(c);panels.display(c,350,f);return}panels.hideSuccessMessage();panels.hide(c,400,e)}if(b){userSettings.hideCurrentPanel(d)}else{d()}},_resizeScreen:function(){if(!userSettings.isOpen){return}panels.setWorkArea();if($("#userSettingsPanelHelp").is(":visible")){setTimeout(userSettings.goToHelp,1000);return}}};var projectSettings={hasScroll:false,lastSelectedId:null,lastView:"Thumb",lastVersions:new Array(),mainDashTitles:{"all":"All Projects","activePrj":"Active Projects","inactivePrj":"Inactive Projects","todayPrj":"Today's Projects","recentPrj":"Recent Projects"},hiddingElements:0,init:function(){$(".projectSettingsButton").live({click:fluid.util._.debounce(projectSettings.open,500,true)});$("#projectSettingsFilter li").live({click:fluid.util._.debounce(projectSettings.selectFilter,500,true)});$("#projectSettingsSearchBoxInput").live({focus:fluid.util._.debounce(projectSettings.displayFilters,500,true),blur:fluid.util._.debounce(projectSettings.displayFilters,500,true)});$("#projectSettingsPanelMain").live({click:fluid.util._.debounce(projectSettings.unselectProject,500,true)});$("#projectSettingsPanelMain .projectThumb").live({click:projectSettings.selectProject});$("#projectAdd").live({click:fluid.util.debounce(projectSettings.actionAdd,500,true)});$(".actionOpenProject").live({click:fluid.util._.debounce(projectSettings.actionOpen,500,true)});$("#selectedProjectNameEdit").live({blur:fluid.util._.debounce(projectSettings.actionRename,500,true)});$(".buttonSwitch","#projectSettingsSettingsTop").live({click:fluid.util._.debounce(projectSettings.actionChangeStatus,500,true)});$("#projectSettingsTransferForm").live({submit:fluid.util._.debounce(projectSettings.actionTransfer,500,true)});$(".dropDownStyled select").live({"change":fluid.util._.debounce(projectSettings.actionChangeValue,500,true)});$(".buttonSwitch","#projectSettingsValuesTop").live({click:fluid.util._.debounce(projectSettings.actionChangeOrientation,500,true)});$(".projectSettingsButtonClone").live({click:fluid.util._.debounce(projectSettings.actionClone,500,true)});$(".projectSettingsButtonDelete").live({click:fluid.util._.debounce(projectSettings.actionDelete,500,true)});$(".projectSettingsVersionRestore").live({click:fluid.util._.debounce(projectSettings.actionRestoreVersion,500,true)});$(".brandingSettingsRow").bind("change",projectSettings.onBrandingChange).bind("reset",projectSettings.onBrandingReset);$("#updateBranding").bind("click",function(a){projectSettings.onBrandingSubmit(a)});$("#brandingImageTable .chooseFile.disabled").live("click",function(a){notification.add("alert",account.alerts.projectLimitHit.onFeatureStandard,{scope:"projectLimitHit",stopBuggingCallBack:function(){}})});$(".projectOptionsButtonSettings").live({click:fluid.util._.debounce(projectSettings.goToSettings,500,true)});$(".projectSettingsButtonShare, .projectSettingsButtonShared").live({click:fluid.util._.debounce(projectSettings.goToShare,500,true)});$(".projectSettingsButtonTransfer").live({click:fluid.util._.debounce(projectSettings.goToTransfer,500,true)});$(document).on("click",".projectSettingsButtonDevice",fluid.util._.debounce(function(a){if(a.target.classList.contains("disabled")){notification.add("alert","You can only change the device type of the currently opened project.");return}projectSettings.goToValues(a)},500,true));$(".projectSettingsButtonBranding").bind("click",fluid.util._.debounce(projectSettings.goToBranding,500,true));$(".projectSettingsButtonVersions").live({click:fluid.util._.debounce(projectSettings.goToVersions,500,true)});fluidEvent.bindEditor("panelGoBack",projectSettings.goToBackEnhancer);$(window).resize(projectSettings._resizeScreen)},goToBackEnhancer:function(b,a){if(!a){return}if(a.panelId=="projectSettingsPanelMain"){setTimeout(projectSettings.autoSelectOnOpen,800,true);return}},open:function(b){var a=b?$(b.target):null;if((a)&&((a.hasClass("buttonDisabled"))||(a.parent().hasClass("buttonDisabled")))){return}projectSettings.unselectProject();projectSettings.refreshListHeader();userSettings.open(null,$("#projectSettingsPanelMain"));projectSettings.adjustMainPanelSize();$("#projectSettingsFilter").hide();fluid.controllers.bin.showNonEmpty();setTimeout(projectSettings.autoSelectOnOpen,800)},autoSelectOnOpen:function(b){var a=b?projectSettings.lastSelectedId:account.get("lastOpenProject");projectSettings.actionSelectProject(projectSettings.getItemById(a))},close:function(){projectSettings.lastSelectedId=null;projectSettings.lastVersions=new Array();userSettings.close(null,false)},adjustMainPanelSize:function(){var d=$("#projectSettingsPanelMain .projectThumb").not(".hidden").size();var a=3;var e=Math.ceil(d/a);var c=(e*180)-20;var b=$(window).height()-210;b=c<b?c:b;b=b>570?570:b;$("#projectSettingsMainTop").css({height:b+"px"});if(b<c){projectSettings.hasScroll=true;panels.adjustScroll($("#projectSettingsMainTop"));$("#projectSettingsMainTop").removeClass("no-scroll");$(".scrollbar","#projectSettingsMainTop").fadeIn(300)}else{projectSettings.hasScroll=false;$("#projectSettingsMainTop").addClass("no-scroll").tinyscrollbar().tinyscrollbar_update();$(".scrollbar","#projectSettingsMainTop").hide()}},adjustVersionsPanelSize:function(){var c=$(".projectVersionItem").size();var b=(c*60);var a=$(window).height()-220;a=b<a?b:a;$("#projectSettingsVersionsTop").css({height:a+"px"})},selectProject:function(c){var d=$("#projectSettingsPanelMain .projectOptionsFrame");var b=$(c.target);b=b.hasClass("projectThumb")?b:b.parents(".projectThumb");var a=b.attr("id");if((d.is(":visible"))&&((a==d.parent().attr("id"))||(b.hasClass("projectOptionsFrame"))||(b.parents(".projectOptionsFrame").size()>0))){projectSettings.actionOpen(c);return false}projectSettings.actionSelectProject(b);c.stopPropagation()},actionSelectProject:function(a){if(a==undefined){projectSettings.unselectProject();return}if(projectSettings.hasScroll){projectSettings._scrollToSelected(a)}projectSettings.displayFrame(a)},unselectProject:function(a){if(a!=undefined){if($(a.target).hasClass("projectThumb")){a.stopPropagation();return false}if(($(a.target).hasClass("projectSettingsSearchBox"))||($(a.target).parents(".projectSettingsSearchBox").size()>0)){return true}}projectSettings.displayFrame()},displayFrame:function(c){var b=true;if((c==undefined)||(c.hasClass("projectPlaceholder")||c.parent().hasClass("projectPlaceholder"))){b=false}$(".projectThumb").removeClass("selectedPrj");$("#projectSettingsPanelMain .projectOptionsFrame").hide().remove();if(b){var a=$("#tmplProjectSettingsFrame").tmpl();$(".selectedProjectName",a).text(c.attr("title"));a.css({opacity:0.75}).appendTo(c);a.fadeIn(250);projectSettings.lastSelectedId=projectSettings.getSelectedId(c.attr("id"));c.addClass("selectedPrj")}else{projectSettings.lastSelectedId=null}},displayFilters:function(b){function a(){projectSettings.applyFilter();$("#projectSettingsFilter").hide()}if(!$("#projectSettingsFilter").is(":visible")){$("#projectSettingsFilter").fadeIn(250);return}setTimeout(a,200)},resetFilter:function(){$("#projectSettingsFilter li").removeClass("activeMenuOption");$("#projectSettingsSearchBoxInput").val("");projectSettings.applyFilter()},selectFilter:function(d){var c=$(d.target);var a=c.hasClass("activeMenuOption");var b=c.attr("data-filter")==undefined?"data-sort":"data-filter";if(a){c.removeClass("activeMenuOption")}else{$("#projectSettingsFilter li["+b+"]").removeClass("activeMenuOption");c.addClass("activeMenuOption")}if(b=="data-filter"){projectSettings.applyFilter()}else{projectSettings.applySort()}d.stopPropagation();return false},applyFilter:function(){if(projectSettings.hiddingElements>0){return}var f=$("#projectSettingsFilter li[data-filter].activeMenuOption");var d=f.size()==0?"all":f.attr("data-filter");var b=$.trim($("#projectSettingsSearchBoxInput").val().toLowerCase());var e=$(".projectThumb","#projectSettingsMainContent").not(".projectPlaceholder");var a=e;if(b!=""){a=e.filter("[data-name*='"+b.toLowerCase()+"']")}if((d=="todayPrj")||(d=="recentPrj")){projectSettings._refreshFilterAttributes()}if(d!="all"){a=a.filter("."+d)}var c=e.not(a);a.removeClass("hidden");c.each(projectSettings._hideProjectFromList);if(c.size()==0){projectSettings.postApplyFilter()}},postApplyFilter:function(){projectSettings.refreshListHeader();if($(".projectOptionsFrame").parent().hasClass("hidden")){projectSettings.unselectProject()}projectSettings.adjustMainPanelSize()},applySort:function(){var d=$("#projectSettingsFilter li[data-sort].activeMenuOption");var b=d.size()==0?"":d.attr("data-sort");var a=d.size()==0?"":d.attr("data-order");if(b!=""){var c=$(".projectThumb","#projectSettingsMainContent");if(a=="desc"){$("#projectSettingsMainContent").append(c.sort(function(f,e){return(f=$(f).attr("data-"+b),e=$(e).attr("data-"+b),f==undefined||f==""?-1:f==e?0:f>e?1:-1)}))}else{$("#projectSettingsMainContent").append(c.sort(function(f,e){return(f=$(f).attr("data-"+b),e=$(e).attr("data-"+b),f==undefined||f==""?-1:f==e?0:f<e?1:-1)}))}panels.adjustScroll($("#projectSettingsMainTop"))}},_refreshFilterAttributes:function(){var c=$(".projectThumb","#projectSettingsMainContent").not(".projectPlaceholder");var a=moment().format("YYYY/MM/DD");var b=moment().subtract("days",project.recentProjectDays).format("YYYY/MM/DD");c.each(function(g,j){var l=projectSettings.getSelectedId($(j).attr("id"));var h=storage.get(l);var k=moment(h.updated).format("YYYY/MM/DD HH:mm:ss");var d=k.split(" ")[0];var f=a==d;var e=d>b;$(j).attr("data-updated",k);if(f){$(j).addClass("todayPrj")}else{$(j).removeClass("todayPrj")}if(e){$(j).addClass("recentPrj")}else{$(j).removeClass("recentPrj")}})},actionDelete:function(a){fluid.command.create("drop",{id:projectSettings.lastSelectedId}).dispatchTo("fluid.controllers.bin");setTimeout(function(){projectSettings.open();setTimeout(function(){userSettings._fixCloseButton(false)},400)},500)},actionAdd:function(b){var a=project.add(b);if(a){var c=projectSettings.getItemById(a);projectSettings.displayFrame(c);tracker.record("addProject",1,"",b);fluid.main.trigger("projectCreated")}},actionOpen:function(a){if($(".actionOpenProject").hasClass("disabled")){return false}var b=projectSettings.lastSelectedId;if((b)&&(b!="")){fluid.command.create("open",{id:b}).dispatchTo("fluid.controllers.project");account.afterLoading();tracker.record("openProject",10,b,a);projectSettings.close();fluid.main.trigger("projectOpened",{id:b})}},actionRename:function(a){project.rename(a);projectSettings.applyFilter();projectSettings.applySort()},actionActivateForced:function(){var a=$("#"+projectSettings.lastSelectedId);project.dropToActive(a,true)},actionChangeStatus:function(c){var b=$(c.target);if(b.hasClass("activeOption")){return false}function a(){var d=b.hasClass("switchOn")?true:false;var f=false;var e=$("#"+projectSettings.lastSelectedId);if(d){f=project.dropToActive(projectSettings.lastSelectedId)}else{f=project.dropToInactive(projectSettings.lastSelectedId)}if(!f){return false}projectSettings.displayStatus(d)}setTimeout(a,100)},actionTransfer:function(a){panels.lastSubmitButton=$(".projectSettingsTransferButton");panels.enableLastButton(false,"projectTransfer");panels.lastSubmitButton=$(".projectSettingsTransferRecipients");var b=$.trim($(".projectSettingsTransferRecipients").val());ajax.userSettingsRequest({emails:b,projectId:projectSettings.lastSelectedId},"projectTransfer",projectSettings.actionTransferCallback);return false},actionTransferCallback:function(d,a){function c(){panels.lastSubmitButton=$(".projectSettingsTransferButton");panels.enableLastButton();panels.lastSubmitButton=$(".projectSettingsTransferRecipients");panels.enableLastButton()}var e=projectSettings._callbackSanitize(d,a);if(e!=null){var b=$(".projectSettingsTransferRemoveLocalInput").is(":checked");if(b){c();projectSettings.actionDelete();return}userSettings.goBack(null,"projectTransfer",$(".projectSettingsButtonTransfer"))}c()},actionChangeValue:function(h){var b=$(h.target);var g=b.attr("data-for");if((g=="deviceModel")&&(projectSettings.isLastSelectedOpen())){fluid.command.helper.createEventHandler("fluid.controllers.page","settingDevice")(h);projectSettings._fixOrientationAfterDeviceChange(project.get("orientation"))}else{if(g=="deviceModel"){var f=b.children(":selected").attr("data-type");var d=b.val().split(",");var c=projectSettings.getLastSelectedObject();d=c.orientation=="Portrait"?d:d.reverse();projectSettings.actionChangeValueData(h,g,f,false);projectSettings.actionChangeValueData(h,"pageWH",d)}else{projectSettings.actionChangeValueData(h,g,b.val())}}if(g=="deviceModel"){var f=b.children(":selected").attr("data-type");var a=projectSettings.getDeviceLabel(f);$(".projectSettingsButtonDevice").text("Device type is "+a)}},actionChangeOrientation:function(d){var b=$(d.target);if(b.hasClass("activeOption")){return false}var a=b.attr("data-for");var c=projectSettings.getLastSelectedObject();if(projectSettings.isLastSelectedOpen()){projectSettings.actionChangeValueData(d,"orientation",a)}else{projectSettings.actionChangeValueData(d,"orientation",a,false);projectSettings.actionChangeValueData(d,"pageWH",[c["pageWH"][1],c["pageWH"][0]])}$(".buttonSwitch","#projectSettingsValuesTop").removeClass("activeOption");b.addClass("activeOption")},actionChangeValueData:function(h,g,b,j){if(projectSettings.isLastSelectedOpen()){if(g=="orientation"){project.orient(h)}else{var d={};d[g]=b;project.set(d)}}else{var l=projectSettings.getLastSelectedObject();if((g=="pageWH")||(g=="orientation")){var c=l.pages;for(var f in c){if(g=="pageWH"){page.update({width:b[0],height:b[1]},c[f])}else{page.update({orientation:b},c[f])}}}l[g]=b;project.updated=new Date().getTime();storage.set(projectSettings.lastSelectedId,l);l.isModified=true}var a=j==undefined?true:j;if(a){if((g=="deviceModel")||(g=="orientation")||(g=="pageWH")){var k=projectSettings.isLastSelectedOpen()?"autopreviewgen":"missingpreview";project.renderPreview(projectSettings.lastSelectedId,k);setTimeout(projectSettings.updateThumbnailMedium,3000)}else{project.sync(projectSettings.lastSelectedId)}}},actionClone:function(){if(panels.isLastButtonDisabled()){return}$(".actionOpenProject").addClass("disabled");panels.hideErrors();panels.lastSubmitButton=$(".projectSettingsButtonClone");panels.enableLastButton(false,"projectClone");ajax.userSettingsRequest({projectId:projectSettings.lastSelectedId},"projectDuplicate",projectSettings.actionCloneCallback);return false},actionCloneCallback:function(b,h){var a=projectSettings._callbackSanitize(b,h,"defaultShort");if(a!=null){var c=a.newProjectId;var g=JSON.parse(a.projectData);projectObj=g[c];var i=g.uploads;var d=Object.keys(i).length;var e=0;if(i&&d){$.each(i,function(j){currentUpload=storage.get(j);if(currentUpload.groups){if($.inArray(projectObj.id,currentUpload.groups)===-1){currentUpload.groups.push(projectObj.id)}}else{currentUpload.groups=[projectObj.id]}storage.set(j,currentUpload);e+=1;if(e===d){f()}})}else{f()}function f(){var k=new Date();projectObj.created=projectObj.updated=k.getTime();projectObj.active=account.canAddProjects();account.addProjectId(c);storage.set(c,projectObj,false);account.set({"lastOpenProject":c});project._template(projectObj,c);project.setNumber();var l=projectSettings.getItemById(c);projectSettings.displayFrame(l);var m=moment().format("MMMM Do YYYY");$("#selectedProjectNameEdit").val("Copy of "+$("#selectedProjectNameEdit").val());$(".projectSettingsLastUpdateDate").text("Modified on "+m);$(".projectSettingsCreationDate").text("Created on "+m);projectSettings.displayStatus(projectObj.active);if(projectObj.active){$(".projectSettingsButtonVersions").text("Version History");projectSettings.actionLoadVersions()}if(projectObj.active){panels.setSuccessMessage("projectClone",$(".projectSettingsButtonClone"))}else{panels.setSuccessMessage("projectClone",$("#selectedProjectNameEdit"))}ajax.syncDown(c,function(o,s,p){var q=JSON.parse(p.responseText).t;var n=JSON.parse(q);for(var r in n){if((r!="uploads")&&(r!=c)){if(n.hasOwnProperty(r)){storage.set(r,n[r])}}}});function j(){panels.enableLastButton();$("#selectedProjectNameEdit").focus();$(".actionOpenProject").removeClass("disabled");fluid.main.trigger("projectCloned")}setTimeout(j,600)}}return false},actionLoadVersions:function(){ajax.userSettingsRequest({projectId:projectSettings.lastSelectedId},"projectVersionList",projectSettings.actionLoadVersionsCallback)},actionLoadVersionsCallback:function(c,b){var d=projectSettings._callbackSanitize(c,b);if(d!=null){projectSettings.lastVersions=d.versions;var a=d.versions.length-1;if(a<=0){a="No Older Versions Available"}else{a+=a==1?" Older Version":" Older Versions"}$(".projectSettingsButtonVersions").text(a)}},actionRestoreVersion:function(c){var b=$(c.target);var d=b.parents(".projectVersionItem");var a=d.attr("id");panels.lastSubmitButton=b;ajax.userSettingsRequest({projectId:projectSettings.lastSelectedId,projectDate:a,createNew:true},"projectVersionRestore",projectSettings.actionRestoreVersionCallback.bind(this,a))},actionRestoreVersionCallback:function(c,e,b){var f=projectSettings._callbackSanitize(e,b,"defaultShort");if(f!=null){var d=project.isOpen(projectSettings.lastSelectedId);if(d){project.close()}var a=JSON.parse(f.projectData);for(var g in a){if((g!="uploads")&&(a.hasOwnProperty(g))){storage.set(g,a[g])}}if(d){fluid.command.create("open",{id:projectSettings.lastSelectedId}).dispatchTo("fluid.controllers.project")}else{projectSettings.updateThumbnail(projectSettings.lastSelectedId);projectSettings.goToSettingsUpdate()}project.set({restoredFromDate:c});userSettings.goBack(null,"projectRestore",$(".projectSettingsButtonVersions"))}},goToSettings:function(c,d,b){if(project.isOpen(projectSettings.lastSelectedId)){project.sync();projectSettings.goToSettingsUpdate()}else{project.loadIfUnloaded(projectSettings.lastSelectedId,projectSettings.goToSettingsUpdate)}function a(){panels.setSuccessMessage(d,b)}userSettings._panelDisplay($("#projectSettingsPanelSettings"),true,a,true);if(c!=undefined){c.stopPropagation()}return false},goToSettingsUpdate:function(){var c=projectSettings.getLastSelectedObject(),d=c.active==undefined?true:c.active,b=projectSettings.getDeviceLabel(c.deviceModel||"iPhone"),a=project.isOpen(c.id);$("#selectedProjectNameEdit").val(c.name);$(".selectedProjectName").text(c.name);$(".projectSettingsLastUpdateDate").text("Modified on "+moment(c.updated).format("MMMM Do YYYY"));$(".projectSettingsCreationDate").text("Created on "+moment(c.created).format("MMMM Do YYYY"));$(".projectSettingsButtonDevice").text("Device type is "+b)[a?"removeClass":"addClass"]("disabled");projectSettings.displayStatus(d);projectSettings.updateThumbnailMedium();if(d){$(".projectSettingsButtonVersions").text("Version History");projectSettings.actionLoadVersions()}},goToShare:function(){fluid.main.trigger("projectSharingOpened");if($("#projectSettingsShareTop").children().size()==0){var a=$("#previewShareContainer").html();a=a.replace(/accordionPreviewSharing/g,"accordionProjectSharing");$("#projectSettingsShareTop").html(a)}share.init(projectSettings.lastSelectedId);userSettings._panelDisplay($("#projectSettingsPanelShare"),true,null,true)},goToTransfer:function(){$(".projectSettingsTransferRecipients").val("");$(".projectSettingsTransferRemoveLocalInput").removeAttr("checked");if(projectSettings.isLastSelectedOpen()){$("#projectSettingsTransferRemoveLocalArea").hide()}else{$("#projectSettingsTransferRemoveLocalArea").show()}userSettings._panelDisplay($("#projectSettingsPanelTransfer"),true,null,true)},goToBranding:function(){var e=document.getElementById("brandingImageTable"),f=branding.deviceScreen().screen,d=projectSettings.getLastSelectedObject(),a=d.deviceModel||"iPhone",b="tr.brandingSettingsRow[data-key=splash]";switch(a){case"iPhone":var c=e.querySelector(".brandingSettingsRow[data-key=splash] p[data-recommended]");c.setAttribute("data-recommended",branding.screens.iPhone4.splash.replace("x"," \u00D7 "));b="tr.brandingSettingsRow:not([data-key=splash]):not([data-key=icon])";break;case"iPhone5":var c=e.querySelector(".brandingSettingsRow[data-key=splash] p[data-recommended]");c.setAttribute("data-recommended",branding.screens.iPhone5.splash.replace("x"," \u00D7 "));b="tr.brandingSettingsRow:not([data-key=splash]):not([data-key=icon])";break;case"iPad":e.querySelector(".brandingSettingsRow[data-key=splashP] p[data-recommended]").setAttribute("data-recommended",branding.screens.iPadRetina.splashP.replace("x"," \u00D7 "));e.querySelector(".brandingSettingsRow[data-key=splashL] p[data-recommended]").setAttribute("data-recommended",branding.screens.iPadRetina.splashL.replace("x"," \u00D7 "));break;default:e.querySelector(".brandingSettingsRow[data-key=splashP] p[data-recommended]").setAttribute("data-recommended",d.pageWH[0]+"\u00D7"+d.pageWH[1]);e.querySelector(".brandingSettingsRow[data-key=splashL] p[data-recommended]").setAttribute("data-recommended",d.pageWH[0]+"\u00D7"+d.pageWH[1]);break}if(branding.screens[a]){e.querySelector(".brandingSettingsRow[data-key=icon] p[data-recommended]").setAttribute("data-recommended",branding.screens[a].icon+" \u00D7 "+branding.screens[a].icon)}else{e.querySelector(".brandingSettingsRow[data-key=icon] p[data-recommended]").setAttribute("data-recommended",branding.screens.iPhone5.icon+" \u00D7 "+branding.screens.iPhone5.icon)}fluid.util._.each(e.querySelectorAll("tr.brandingSettingsRow"),function(h,g,j){h.style.display=""});fluid.util._.each(e.querySelectorAll(b),function(h,g,j){h.style.display="none"});projectSettings.brandingUpdatePreview();branding.resetChange();userSettings._panelDisplay($("#projectSettingsPanelBranding"),true,projectSettings.afterBrandingPanelShow,true)},afterBrandingPanelShow:function(){fluid.main.fire("branding.panelShow")},brandingUpdatePreview:function(){var e=document.getElementById("brandingImageTable"),g=e.querySelectorAll("tr.brandingSettingsRow"),b=e.getElementsByTagName("form");fluid.util._.forEach(b,function(h){h.reset()});for(var d=0,a=g.length;d<a;d++){var c=g[d].getAttribute("data-key"),f;if(!/icon|splashiPhone/.test(c)){c+=projectSettings.getLastSelectedObject().deviceModel}f=branding.getUrl(c);if(f){g[d].getElementsByClassName("brandingPreview")[0].src=f;g[d].classList.add("set")}else{g[d].getElementsByClassName("brandingPreview")[0].src=g[d].getAttribute("data-default");g[d].classList.remove("set")}}},previewBrandingImage:function(a,d,c){var b=a.getAttribute("changeTime");if(b&&b>c){return}a.setAttribute("changeTime",c);a.src=d},onBrandingChange:function(d){var b=this.querySelector("img.brandingPreview"),c=this.getAttribute("data-key"),a=projectSettings.getLastSelectedObject().deviceModel;if(!/icon|splashiPhone/.test(c)){c+=a}if(d.target.files.length){var e=d.target.files[0];this.classList.add("set");branding.changeImage(c,e,function(f){projectSettings.previewBrandingImage(b,f,d.timeStamp)},function(f){projectSettings.onBrandingReset.call(this,f)})}else{projectSettings.onBrandingReset.call(this,d)}},onBrandingReset:function(c){var a=this.querySelector("img.brandingPreview"),b=this.getAttribute("data-key");if(b!=="icon"){b+=projectSettings.getLastSelectedObject().deviceModel}a.src=this.getAttribute("data-default");branding.resetChange(b);if(branding.get(b)){branding.changeImage(b,null)}this.classList.remove("set")},onBrandingSubmit:function(a){branding.update();userSettings.goBack(a,"projectBranding",$(".projectSettingsButtonBranding"))},goToValues:function(){project.loadIfUnloaded(projectSettings.lastSelectedId,function(){if($(".projectSettingsDevice").children().size()==0){$(".projectSettingsDevice").html($("#DeviceSizeTmpl",page.menu).html());$(".projectSettingsGesture").html($(".linkTriggerSelector").html());$(".projectSettingsTransition").html($(".transitionSelector").html())}var d=projectSettings.getLastSelectedObject(),c=d.deviceModel||"iPhone",a=d.orientation||"Portrait",g=d.defaultGesture||"tap",b=d.defaultTransition||"slide";var f=$(".projectSettingsDevice").children().filter("[data-type=Custom]");var e=$(".customDeviceSize");f.val(d["pageWH"].join(","));f.text("Custom Display Size ("+d["pageWH"].join("x")+")");if(c==="Custom"){e.show()}else{e.hide()}$(".projectSettingsDevice").children().filter("[data-type='"+c+"']").attr("selected",true);$(".projectSettingsGesture").children().filter("[value='"+g+"']").attr("selected",true);$(".projectSettingsTransition").children().filter("[value='"+b+"']").attr("selected",true);projectSettings._fixOrientationAfterDeviceChange(a);userSettings._panelDisplay($("#projectSettingsPanelValues"),true,null,true)})},_fixOrientationAfterDeviceChange:function(a){var b=$(".projectSettingsOrientation").children();b.removeClass("activeOption");b.filter("[data-for='"+a+"']").addClass("activeOption")},goToVersions:function(){var b=projectSettings.lastVersions.length-1;if(b<=0){return}var a=$("#projectSettingsVersionsContent");a.children().remove();var d=storage.get(project.get("id")).restoredFromDate;var g=false;for(var e=1;e<=b;e++){var f=projectSettings.lastVersions[e];f.updated=f.updated||Math.round(new Date().getTime()/1000);f.name=f.name||"Restored Project";f["dateUpdate"]=moment(f.updated).format("YYYY/MM/DD HH:mm:ss");f["sizeKb"]=(f.size/1024).toFixed(2);var c=$("#tmplProjectVersion").tmpl(f);if(d===f.date||(e===1&&!d)){c.addClass("activeVersion");g=true}c.appendTo(a)}if(!g){a.find(".projectVersionItem").eq(0).addClass("activeVersion")}$(".projectVersionsCount").text(b);projectSettings.adjustVersionsPanelSize();userSettings._panelDisplay($("#projectSettingsPanelVersions"),true,null,true)},refreshListHeader:function(){var g=$("#projectSettingsFilter li[data-filter].activeMenuOption");var e=g.size()==0?"all":g.attr("data-filter");var d=$(".projectThumb","#projectSettingsMainContent").not(".projectPlaceholder ");var b=d.not(".hidden");var c=d.size()==b.size()?d.size():b.size()+" of "+d.size();$(".projectsListFilterAmount").text(c);$(".projectsListFilterLabel").text(projectSettings.mainDashTitles[e]);if(b.size()<3){$("li[data-sort], .separator","#projectSettingsFilter").hide()}else{$("li[data-sort], .separator","#projectSettingsFilter").show()}var f=$("#projectSettingsFilter li.activeMenuOption").size()==0?false:true;var a=$.trim($("#projectSettingsSearchBoxInput").val().toLowerCase());f=f||a!="";if(f){$("#projectSettingsSearchBoxInput").addClass("usingFilter")}else{$("#projectSettingsSearchBoxInput").removeClass("usingFilter")}},navigateWithKeys:function(h){if(projectSettings.lastSelectedId==null){projectSettings.actionSelectProject($(".projectThumb").not(".hidden").eq(1));return}var c=$(".projectThumb").not(".hidden").size();if(c<3){return}var g=utils.getNavigationKeyDirection(h.keyCode);if(g==""){if((h.keyCode==13)&&(h.target.tagName!="INPUT")&&($("#projectSettingsPanelMain").is(":visible"))){projectSettings.actionOpen()}return}var f=projectSettings.getLastSelectedItem();var a=3;var b=1;var i=true;if((g=="top")||(g=="bottom")){b=a}if((g=="top")||(g=="left")){i=false}var d=projectSettings._findItemToNavigate(f,b,i);projectSettings.actionSelectProject(d)},_findItemToNavigate:function(c,a,d){if(a==0){return c}if(d){var b=c.nextAll().not(".hidden");c=b.size()>0?b.eq(0):$(".projectThumb").not(".hidden").eq(1);a=b.size()>0?a-1:0}else{var b=c.prevAll().not(".hidden");c=b.size()>1?b.eq(0):$(".projectThumb").not(".hidden").last();a=b.size()>1>0?a-1:0}return projectSettings._findItemToNavigate(c,a,d)},displayStatus:function(b){$(".buttonSwitch","#projectSettingsSettingsTop").removeClass("activeOption");var c=b?"projectSettingsButtonActive":"projectSettingsButtonInactive";$("."+c).addClass("activeOption");var a=$("#projectSettingsPanelSettings");var d=$(".buttonForActive",a);if(b){$(".projectThumbMedium, .projectThumbButtonOpen",a).add("#fluidDropdown .projectThumb").removeClass("inactivePrj");d.show()}else{$(".projectThumbMedium, .projectThumbButtonOpen",a).add("#fluidDropdown .projectThumb").addClass("inactivePrj");d.hide()}},_resizeScreen:function(){if(!userSettings.isOpen){return}if($("#projectSettingsPanelMain").is(":visible")){setTimeout(projectSettings.adjustMainPanelSize,600);return}else{if($("#projectSettingsPanelVersions").is(":visible")){setTimeout(projectSettings.adjustVersionsPanelSize,600);return}}},getSelectedId:function(a){if(a==undefined){return undefined}return a.replace(projectSettings.lastView,"")},getItemById:function(a){if(a==null){return undefined}return $("#"+a+projectSettings.lastView)},getLastSelectedItem:function(){return $("#"+projectSettings.lastSelectedId+projectSettings.lastView)},getObjectById:function(a){return storage.get(a)},getLastSelectedObject:function(){return projectSettings.getObjectById(projectSettings.lastSelectedId)},isLastSelectedOpen:function(){if(projectSettings.lastSelectedId==null){return false}return project.isOpen(projectSettings.lastSelectedId)},getDeviceLabel:function(c){var b=$("#DeviceSizeTmpl",page.menu).children();var d=b.filter("[data-type='"+c+"']").text();var a=d.replace(/\(([^\)]+)\)/,"");return a},_hideProjectFromList:function(a,b){projectSettings.hiddingElements++;var c=$(b);c.transition({width:0,height:0,"margin-left":100,"margin-top":80,opacity:0,"margin-right":0,complete:function(){c.addClass("hidden");c.removeAttr("style");projectSettings.hiddingElements=projectSettings.hiddingElements-1;if(projectSettings.hiddingElements<=0){projectSettings.postApplyFilter()}}},350)},_callbackSanitize:function(d,b,a){if(d==null){if(b!=""){panels.displayError(b);return null}panels.displayError();return null}try{var e=JSON.parse(d)}catch(c){return null}if(e.t===true||e.t==="true"){return e}else{var f=a==undefined?e.t:a;panels.displayError(f)}return null},updateThumbnail:function(c){var a=projectSettings.getObjectById(c);var b=projectSettings.getItemById(c);projectSettings._updateThumbnail(b,a)},updateThumbnailMedium:function(){var a=projectSettings.getObjectById(projectSettings.lastSelectedId);var b=$(".projectThumbMedium");projectSettings._updateThumbnail(b,a)},_updateThumbnail:function(c,a,b){c.find(".preview").remove();if((!a.unloaded&&a.pages&&a.pages.length===0)){c.append($('<div class="preview empty">Project empty</div>'))}else{if(b||(a.preview&&a.preview.src)){var d=b!=undefined&&b!=null?b:a.preview.src;c.append($('<img class="preview" src="'+d+'">'))}else{c.append($('<div class="preview">Preview not available</div>'))}}},_scrollToSelected:function(c){var b=$("#projectSettingsPanelMain .projectThumb").not(".hidden");var j=b.size();if((c==undefined)||(c==null)||(j<4)||c.length===0){return}var p=b.eq(3).position().top;var d=$("#projectSettingsMainTop").height();var g=3;var i=parseInt($("#projectSettingsMainContent").css("top"),10);var m=30;var q=parseInt(j/g,10);q=q*3==j?q:q+1;var a=d/p;var h=p*(q-a)-10;var f=p*2>d?0:p;var o=Math.abs(i);var l=c.position().top-f;l=l>0?l:0;l=l<h?l:h;if(l!=o){var n=l-o;for(var e=1;e<=m;e++){var k=o+(n/m)*e;setTimeout(projectSettings._scrollStepToSelected,e*11,k)}}},_scrollStepToSelected:function(a){$("#projectSettingsMainTop").tinyscrollbar_update(a)}};