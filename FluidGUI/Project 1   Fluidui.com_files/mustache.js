/*
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
fluid.module.define("fluid.util",function(a){(function(b,c){if(typeof exports==="object"&&exports){c(exports)}else{var d={};c(d);if(typeof define==="function"&&define.amd){define(d)}else{b.Mustache=d}}}(a,function(b){var g=/\s*/;var n=/\s+/;var l=/\S/;var j=/\s*=/;var p=/\s*\}/;var v=/#|\^|\/|>|\{|&|=|!/;var h=RegExp.prototype.test;function u(B,A){return h.call(B,A)}function i(A){return !u(l,A)}var x=Object.prototype.toString;var m=Array.isArray||function(A){return x.call(A)==="[object Array]"};function c(A){return typeof A==="function"}function f(A){return A.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function o(A){return String(A).replace(/[&<>"'\/]/g,function(B){return e[B]})}function w(A){this.string=A;this.tail=A;this.pos=0}w.prototype.eos=function(){return this.tail===""};w.prototype.scan=function(C){var B=this.tail.match(C);if(B&&B.index===0){var A=B[0];this.tail=this.tail.substring(A.length);this.pos+=A.length;return A}return""};w.prototype.scanUntil=function(C){var B=this.tail.search(C),A;switch(B){case -1:A=this.tail;this.tail="";break;case 0:A="";break;default:A=this.tail.substring(0,B);this.tail=this.tail.substring(B)}this.pos+=A.length;return A};function t(A,B){this.view=A==null?{}:A;this.parent=B;this._cache={".":this.view}}t.make=function(A){return(A instanceof t)?A:new t(A)};t.prototype.push=function(A){return new t(A,this)};t.prototype.lookup=function(A){var D;if(A in this._cache){D=this._cache[A]}else{var C=this;while(C){if(A.indexOf(".")>0){D=C.view;var E=A.split("."),B=0;while(D!=null&&B<E.length){D=D[E[B++]]}}else{D=C.view[A]}if(D!=null){break}C=C.parent}this._cache[A]=D}if(c(D)){D=D.call(this.view)}return D};function r(){this.clearCache()}r.prototype.clearCache=function(){this._cache={};this._partialCache={}};r.prototype.compile=function(C,A){var B=this._cache[C];if(!B){var D=b.parse(C,A);B=this._cache[C]=this.compileTokens(D,C)}return B};r.prototype.compilePartial=function(B,D,A){var C=this.compile(D,A);this._partialCache[B]=C;return C};r.prototype.getPartial=function(A){if(!(A in this._partialCache)&&this._loadPartial){this.compilePartial(A,this._loadPartial(A))}return this._partialCache[A]};r.prototype.compileTokens=function(C,B){var A=this;return function(D,F){if(F){if(c(F)){A._loadPartial=F}else{for(var E in F){A.compilePartial(E,F[E])}}}return q(C,A,t.make(D),B)}};r.prototype.render=function(C,A,B){return this.compile(C)(A,B)};function q(I,C,A,L){var F="";function B(O){return C.render(O,A)}var D,J,K;for(var G=0,H=I.length;G<H;++G){D=I[G];J=D[1];switch(D[0]){case"#":K=A.lookup(J);if(typeof K==="object"||typeof K==="string"){if(m(K)){for(var E=0,N=K.length;E<N;++E){F+=q(D[4],C,A.push(K[E]),L)}}else{if(K){F+=q(D[4],C,A.push(K),L)}}}else{if(c(K)){var M=L==null?null:L.slice(D[3],D[5]);K=K.call(A.view,M,B);if(K!=null){F+=K}}else{if(K){F+=q(D[4],C,A,L)}}}break;case"^":K=A.lookup(J);if(!K||(m(K)&&K.length===0)){F+=q(D[4],C,A,L)}break;case">":K=C.getPartial(J);if(c(K)){F+=K(A)}break;case"&":K=A.lookup(J);if(K!=null){F+=K}break;case"name":K=A.lookup(J);if(K!=null){F+=b.escape(K)}break;case"text":F+=J;break}}return F}function z(G){var B=[];var F=B;var H=[];var D;for(var C=0,A=G.length;C<A;++C){D=G[C];switch(D[0]){case"#":case"^":H.push(D);F.push(D);F=D[4]=[];break;case"/":var E=H.pop();E[5]=D[2];F=H.length>0?H[H.length-1][4]:B;break;default:F.push(D)}}return B}function d(F){var C=[];var E,B;for(var D=0,A=F.length;D<A;++D){E=F[D];if(E){if(E[0]==="text"&&B&&B[0]==="text"){B[1]+=E[1];B[3]=E[3]}else{B=E;C.push(E)}}}return C}function s(A){return[new RegExp(f(A[0])+"\\s*"),new RegExp("\\s*"+f(A[1]))]}function y(Q,G){Q=Q||"";G=G||b.tags;if(typeof G==="string"){G=G.split(n)}if(G.length!==2){throw new Error("Invalid tags: "+G.join(", "))}var K=s(G);var C=new w(Q);var I=[];var H=[];var F=[];var R=false;var P=false;function O(){if(R&&!P){while(F.length){delete H[F.pop()]}}else{F=[]}R=false;P=false}var D,B,J,L,E,A;while(!C.eos()){D=C.pos;J=C.scanUntil(K[0]);if(J){for(var M=0,N=J.length;M<N;++M){L=J.charAt(M);if(i(L)){F.push(H.length)}else{P=true}H.push(["text",L,D,D+1]);D+=1;if(L=="\n"){O()}}}if(!C.scan(K[0])){break}R=true;B=C.scan(v)||"name";C.scan(g);if(B==="="){J=C.scanUntil(j);C.scan(j);C.scanUntil(K[1])}else{if(B==="{"){J=C.scanUntil(new RegExp("\\s*"+f("}"+G[1])));C.scan(p);C.scanUntil(K[1]);B="&"}else{J=C.scanUntil(K[1])}}if(!C.scan(K[1])){throw new Error("Unclosed tag at "+C.pos)}E=[B,J,D,C.pos];H.push(E);if(B==="#"||B==="^"){I.push(E)}else{if(B==="/"){A=I.pop();if(!A){throw new Error('Unopened section "'+J+'" at '+D)}if(A[1]!==J){throw new Error('Unclosed section "'+A[1]+'" at '+D)}}else{if(B==="name"||B==="{"||B==="&"){P=true}else{if(B==="="){G=J.split(n);if(G.length!==2){throw new Error("Invalid tags at "+D+": "+G.join(", "))}K=s(G)}}}}}A=I.pop();if(A){throw new Error('Unclosed section "'+A[1]+'" at '+C.pos)}return z(d(H))}b.name="mustache.js";b.version="0.7.3";b.tags=["{{","}}"];b.Scanner=w;b.Context=t;b.Writer=r;b.parse=y;b.escape=o;var k=new r();b.clearCache=function(){return k.clearCache()};b.compile=function(B,A){return k.compile(B,A)};b.compilePartial=function(B,C,A){return k.compilePartial(B,C,A)};b.compileTokens=function(B,A){return k.compileTokens(B,A)};b.render=function(C,A,B){return k.render(C,A,B)};b.to_html=function(D,B,C,E){var A=b.render(D,B,C);if(c(E)){E(A)}else{return A}}}))});